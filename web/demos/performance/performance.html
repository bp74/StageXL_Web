<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>dartflash library - Performance Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
	<link href="../../assets/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/css/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../../assets/css/dartflash.css" rel="stylesheet" />

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-33055781-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="../../index.html"><strong>dartflash</strong></a>
                <ul class="nav">
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Showcase<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li class="nav-header">Games</li>
                            <li><a href="../../games/escape/escape.html">&nbsp;Escape</a></li>
                            <li><a href="../../games/supersonic/supersonic.html">&nbsp;Supersonic</a></li>
                            <li class="divider"></li>
                            <li class="nav-header">Demos</li>
                            <li><a href="../../demos/performance/performance.html">&nbsp;Performance</a></li>
                            <li><a href="../../demos/masking/masking.html">&nbsp;Masking</a></li>
                            <li><a href="../../demos/movieclip/movieclip.html">&nbsp;MovieClip</a></li>
                            <li><a href="../../demos/text/text.html">&nbsp;Text</a></li>
                            <li><a href="../../demos/filter/filter.html">&nbsp;Filter</a></li>
                            <li><a href="../../demos/sound/sound.html">&nbsp;Sound</a></li>
                            <li><a href="../../demos/tweener/tweener.html">&nbsp;Tweener</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            Runtimes<b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="../../runtimes/texturepacker/texturepacker.html">Texture Packer</a></li>
                            <li><a href="../../runtimes/flump/flump.html">Flump</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li><a href="../../docs/api/dartflash.html" target="_blank">API Reference</a></li>
                            <li><a href="../../docs/actionscript-dart.html">ActionScript&nbsp;<i class="icon-hand-right"></i>&nbsp;Dart</a></li>
                            <li><a href="../../docs/wiki-articles.html">Wiki Articles</a></li>
                            <li><a href="../../docs/faq.html">FAQ</a></li>
                        </ul>
                    </li>
                    <li><a href="../../info.html">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container">
        <h1>
            Performance</h1>
        <p>
            This demo is a benchmark to measure how many frames per second the browser is able to draw.
            Increase the number of objects to see the effect on the frame rate. A modern computer should
            be able to draw approximate 2000 objects at a smooth frame rate of 60 fps. Right now Google
            Chrome delivers the best performance compared to other browsers. Over the next weeks and months
            we expect noticeable better results for this benchmark enabled by the continuous work on the
            dart2js compiler. Some critical code paths still contain non-optimal JavaScript code that will
            improve with the steady progress of the compiler.</p>
        <br />
        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#demoShow" data-toggle="tab">Demo</a></li>
                <li><a href="#demoHTML" data-toggle="tab">HTML</a></li>
                <li><a href="#demoDart" data-toggle="tab">Dart</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="demoShow">
                    <div class="row">
                        <div class="span1">
                            <button id="minus10" class="btn btn-large btn-block btn-primary"><i class="icon-minus icon-white"></i> 10</button>
                        </div>
                        <div class="span1">
                            <button id="minus50" class="btn btn-large btn-block btn-primary"><i class="icon-minus icon-white"></i> 50</button>
                        </div>
                        <div class="span1">
                            <button id="plus50" class="btn btn-large btn-block btn-primary">50 <i class="icon-plus icon-white"></i></button>
                        </div>
                        <div class="span1">
                            <button id="plus10" class="btn btn-large btn-block btn-primary">10 <i class="icon-plus icon-white"></i></button>
                        </div>
                        <div class="offset4 span2">
                            <div class="alert alert-info" id="spriteCounter">Sprites: 0</div>
                        </div>
                        <div class="span2">
                            <div class="alert alert-success" id="fpsMeter">fps: 0.0</div>
                        </div>
                    </div>

                    <canvas id="stage" width="940" height="500">
                    </canvas>
                    <hr />
                    Credits for this beautiful flags to: <a href="http://www.icondrawer.com" target="_blank">www.IconDrawer.com</a>.
                </div>
                <div class="tab-pane" id="demoHTML">
                    <pre class="prettyprint lang-html">
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;minus10&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;&lt;i class=&quot;icon-minus icon-white&quot;&gt;&lt;/i&gt; 10&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;minus50&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;&lt;i class=&quot;icon-minus icon-white&quot;&gt;&lt;/i&gt; 50&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;plus50&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;50 &lt;i class=&quot;icon-plus icon-white&quot;&gt;&lt;/i&gt;&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;plus10&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;10 &lt;i class=&quot;icon-plus icon-white&quot;&gt;&lt;/i&gt;&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;offset4 span2&quot;&gt;
        &lt;div class=&quot;alert alert-info&quot; id=&quot;spriteCounter&quot;&gt;Sprites: 0&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span2&quot;&gt;
        &lt;div class=&quot;alert alert-success&quot; id=&quot;fpsMeter&quot;&gt;fps: 0.0&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;canvas id=&quot;stage&quot; width=&quot;940&quot; height=&quot;500&quot;&gt;
&lt;/canvas&gt;
                    </pre>
                </div>
                <div class="tab-pane" id="demoDart">
                     <pre class="prettyprint lang-java">
import &apos;dart:math&apos;;
import &apos;dart:html&apos; as html;
import &apos;package:dartflash/dartflash.dart&apos;;

class Flag extends Bitmap implements Animatable {

    num vx, vy;

    Flag(BitmapData bitmapData, this.vx, this.vy):super(bitmapData) {
      this.pivotX = bitmapData.width / 2;
      this.pivotY = bitmapData.height / 2;
    }

    bool advanceTime(num time) {
      var tx = x + vx * time;
      var ty = y + vy * time;
      if (tx &gt; 910 || tx &lt; 30) vx = -vx; else x = tx;
      if (ty &gt; 470 || ty &lt; 30) vy = -vy; else y = ty;
      return true;
    }
}

//-----------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------

Stage stage;
RenderLoop renderLoop;
Juggler juggler;
TextureAtlas textureAtlas;
Random random = new Random();
num fpsAverage;

void main() {

  // Initialize the Display List
  stage = new Stage(&apos;myStage&apos;, html.document.query(&apos;#stage&apos;));
  renderLoop = new RenderLoop();
  renderLoop.addStage(stage);
  juggler = renderLoop.juggler;

  // load the texture atlas with flag images
  Future loader = TextureAtlas.load(&apos;../common/images/flags.json&apos;, TextureAtlasFormat.JSONARRAY);

  loader.then((result) {
    textureAtlas = result;

    // let&apos;s start with 250 flags
    addFlags(250);

    // add html-button event listeners
    html.query(&apos;#minus10&apos;).onClick.listen((e) =&gt; removeFlags(10));
    html.query(&apos;#minus50&apos;).onClick.listen((e) =&gt; removeFlags(50));
    html.query(&apos;#plus50&apos;).onClick.listen((e) =&gt; addFlags(50));
    html.query(&apos;#plus10&apos;).onClick.listen((e) =&gt; addFlags(10));

    // add event listener for EnterFrame (fps meter)
    stage.onEnterFrame.listen(enterFrameListener);
  });
}

//-----------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------

void enterFrameListener(EnterFrameEvent e) {

  if (fpsAverage == null) {
    fpsAverage = 1.00 / e.passedTime;
  } else {
    fpsAverage = 0.05 / e.passedTime + 0.95 * fpsAverage;
  }

  html.query(&apos;#fpsMeter&apos;).innerHtml = &apos;fps: ${fpsAverage.round()}&apos;;
}

//-----------------------------------------------------------------------------------

void addFlags(int amount) {

  while(--amount &gt;= 0) {
  
    var flagIndex = random.nextInt(textureAtlas.frameNames.length);
    var flagName = textureAtlas.frameNames[flagIndex];
    var flagBitmapData = textureAtlas.getBitmapData(flagName);

    var flag = new Flag(flagBitmapData, random.nextInt(200) - 100, random.nextInt(200) - 100);
    flag.x = 30 + random.nextInt(940 - 60);
    flag.y = 30 + random.nextInt(500 - 60);
    flag.addTo(stage);

    juggler.add(flag);
  }

  html.query(&apos;#spriteCounter&apos;).innerHtml = &apos;Sprites: ${stage.numChildren}&apos;;
}

//-----------------------------------------------------------------------------------

void removeFlags(int amount) {

  while(--amount &gt;= 0 && stage.numChildren &gt; 0) {
    var displayObject = stage.getChildAt(0);
    displayObject.removeFromParent();
    juggler.remove(displayObject);
  }

  html.query(&apos;#spriteCounter&apos;).innerHtml = &apos;Sprites: ${stage.numChildren}&apos;;
}</pre>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../assets/js/prettify.js"></script>

    <script type="application/dart" src="performance.dart"></script>
    <script type="text/javascript" src="../../assets/js/dart.js"></script>
</body>
</html>
