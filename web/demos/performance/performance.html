<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>dartflash library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/css/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../../assets/css/dartflash.css" rel="stylesheet" />
    <!--<link rel="shortcut icon" href="/assets/img/favicon.ico" /> -->

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-33055781-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="/index.html"><strong>dartflash</strong></a>
                <ul class="nav">
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Showcase<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li class="nav-header">Games</li>
                            <li><a href="/games/escape/escape.html">&nbsp;Escape</a></li>
                            <li class="divider"></li>
                            <li class="nav-header">Demos</li>
                            <li><a href="/demos/performance/performance.html">&nbsp;Performance</a></li>
                            <li><a href="/demos/masking/masking.html">&nbsp;Masking</a></li>
                            <li><a href="/demos/movieclip/movieclip.html">&nbsp;MovieClip</a></li>
                            <li><a href="/demos/text/text.html">&nbsp;Text</a></li>
                            <li><a href="/demos/sound/sound.html">&nbsp;Sound</a></li>
                            <li><a href="/demos/tweener/tweener.html">&nbsp;Tweener</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li><a href="/docs/api/dartflash.html" target="_blank">API Reference</a></li>
                            <li><a href="/docs/actionscript-dart.html">ActionScript&nbsp;<i class="icon-hand-right"></i>&nbsp;Dart</a></li>
                            <li><a href="/docs/wiki-articles.html">Wiki Articles</a></li>
                            <li><a href="/docs/faq.html">FAQ</a></li>
                        </ul>
                    </li>
                    <li><a href="/info.html">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container">
        <h1>
            Performance</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
            exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
            irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
            deserunt mollit anim id est laborum.</p>
        <br />
        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#demoShow" data-toggle="tab">Demo</a></li>
                <li><a href="#demoHTML" data-toggle="tab">HTML</a></li>
                <li><a href="#demoDart" data-toggle="tab">Dart</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="demoShow">
                    <div class="row">
                        <div class="span1">
                            <button id="minus10" class="btn btn-large btn-block btn-primary"><i class="icon-minus icon-white"></i> 10</button>
                        </div>
                        <div class="span1">
                            <button id="minus50" class="btn btn-large btn-block btn-primary"><i class="icon-minus icon-white"></i> 50</button>
                        </div>
                        <div class="span1">
                            <button id="plus50" class="btn btn-large btn-block btn-primary">50 <i class="icon-plus icon-white"></i></button>
                        </div>
                        <div class="span1">
                            <button id="plus10" class="btn btn-large btn-block btn-primary">10 <i class="icon-plus icon-white"></i></button>
                        </div>
                        <div class="offset4 span2">
                            <div class="alert alert-info" id="spriteCounter">Sprites: 0</div>
                        </div>
                        <div class="span2">
                            <div class="alert alert-success" id="fpsMeter">fps: 0.0</div>
                        </div>
                    </div>

                    <canvas id="stage" width="940" height="500">
                    </canvas>
                    <hr />
                    Credits for this beautiful flags to: <a href="http://www.icondrawer.com" target="_blank">www.IconDrawer.com</a>.
                </div>
                <div class="tab-pane" id="demoHTML">
                    <pre class="prettyprint lang-html">
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;minus10&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;&lt;i class=&quot;icon-minus icon-white&quot;&gt;&lt;/i&gt; 10&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;minus50&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;&lt;i class=&quot;icon-minus icon-white&quot;&gt;&lt;/i&gt; 50&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;plus50&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;50 &lt;i class=&quot;icon-plus icon-white&quot;&gt;&lt;/i&gt;&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span1&quot;&gt;
        &lt;button id=&quot;plus10&quot; class=&quot;btn btn-large btn-block btn-primary&quot;&gt;10 &lt;i class=&quot;icon-plus icon-white&quot;&gt;&lt;/i&gt;&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;offset4 span2&quot;&gt;
        &lt;div class=&quot;alert alert-info&quot; id=&quot;spriteCounter&quot;&gt;Sprites: 0&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;span2&quot;&gt;
        &lt;div class=&quot;alert alert-success&quot; id=&quot;fpsMeter&quot;&gt;fps: 0.0&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;canvas id=&quot;stage&quot; width=&quot;940&quot; height=&quot;500&quot;&gt;
&lt;/canvas&gt;
                    </pre>
                </div>
                <div class="tab-pane" id="demoDart">
                     <pre class="prettyprint lang-java">
import &apos;dart:math&apos;;
import &apos;dart:html&apos; as html;
import &apos;package:dartflash/dartflash.dart&apos;;

Stage stage;
RenderLoop renderLoop;
Resource resource;
Random random;
List&lt;BitmapData&gt; bitmapDatas;
List&lt;Flag&gt; flags;
List&lt;num&gt; frameTimes;
int frameTimesIndex;

//-----------------------------------------------------------------------------------

class Flag
{
    Bitmap bitmap;
    num vx, vy;

    Flag(this.bitmap, this.vx, this.vy);

    void update(num passedTime)
    {
      var x = bitmap.x + vx * passedTime;
      var y = bitmap.y + vy * passedTime;
      if (x &gt; 910 || x &lt; 30) vx = -vx; else bitmap.x = x;
      if (y &gt; 470 || y &lt; 30) vy = -vy; else bitmap.y = y;
    }
}

//-----------------------------------------------------------------------------------

void main()
{
  random = new Random();
  bitmapDatas = new List&lt;BitmapData&gt;();
  flags = new List&lt;Flag&gt;();
  frameTimes = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];
  frameTimesIndex = 0;

  // Initialize the Display List

  stage = new Stage(&apos;myStage&apos;, html.document.query(&apos;#stage&apos;));

  renderLoop = new RenderLoop();
  renderLoop.addStage(stage);

  // Use the Resource class to load a texture atlas

  resource = new Resource();
  resource.addTextureAtlas(&apos;flagsTextureAtlas&apos;, &apos;../common/images/flags.json&apos;, TextureAtlasFormat.JSONARRAY);
  resource.load().then((result)
  {
    // Get all flags from the texture atlas.
    TextureAtlas textureAtlas = resource.getTextureAtlas(&apos;flagsTextureAtlas&apos;);
    for(var frameName in textureAtlas.frameNames)
      bitmapDatas.add(textureAtlas.getBitmapData(frameName));

    // add html-button event listeners
    html.query(&apos;#minus10&apos;).on.click.add((e) =&gt; removeFlags(10));
    html.query(&apos;#minus50&apos;).on.click.add((e) =&gt; removeFlags(50));
    html.query(&apos;#plus50&apos;).on.click.add((e) =&gt; addFlags(50));
    html.query(&apos;#plus10&apos;).on.click.add((e) =&gt; addFlags(10));

    // add event listener for EnterFrame
    stage.addEventListener(Event.ENTER_FRAME, (EnterFrameEvent e) =&gt; updateFlags(e.passedTime));

    // add 250 flags
    addFlags(250);
  });
}

//-----------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------

void addFlags(int amount)
{
  for(int i = 0; i &lt; amount; i++)
  {
    Bitmap bitmap = new Bitmap(bitmapDatas[random.nextInt(bitmapDatas.length)]);
    bitmap.pivotX = 24;
    bitmap.pivotY = 18;
    bitmap.x = 30 + random.nextInt(940 - 60);
    bitmap.y = 30 + random.nextInt(500 - 60);
    stage.addChild(bitmap);

    Flag flag = new Flag(bitmap, 200 * random.nextDouble() - 100, 200 * random.nextDouble() - 100);
    flags.add(flag);
  }

  html.query(&apos;#spriteCounter&apos;).innerHTML = &apos;Sprites: ${flags.length}&apos;;
}

//-----------------------------------------------------------------------------------

void removeFlags(int amount)
{
  if (flags.length &gt;= amount)
  {
    flags.removeRange(flags.length - amount, amount);

    for(int i = 0; i &lt; amount; i++)
      stage.removeChildAt(stage.numChildren - 1);

    html.query(&apos;#spriteCounter&apos;).innerHTML = &apos;Sprites: ${flags.length}&apos;;
  }
}

//-----------------------------------------------------------------------------------

void updateFlags(num passedTime)
{
    if (passedTime &lt; 1.0)
    {
      frameTimesIndex = (frameTimesIndex + 1) % frameTimes.length;
      frameTimes[frameTimesIndex] = passedTime;

      num avgFrameTime = 0;
      int frameTimesLength = frameTimes.length;
      for(int i = 0; i &lt; frameTimesLength; i++)
        avgFrameTime += frameTimes[i];

      int flagsLength = flags.length;
      for(int i = 0; i &lt; flagsLength; i++)
        flags[i].update(passedTime);

      html.query(&apos;#fpsMeter&apos;).innerHTML = &apos;fps: ${(frameTimes.length/avgFrameTime).round()}&apos;;
    }
}
                     </pre>
                </div>
            </div>
        </div> 
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../assets/js/prettify.js"></script>
    
    <script type="application/dart" src="performance.dart"></script>
    <script type="text/javascript" src="../../assets/js/dart.js"></script>
</body>
</html>
