<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>dartflash library - Sound demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
	<link href="../../assets/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/css/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../../assets/css/dartflash.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Sofadi+One' rel='stylesheet' type='text/css' />

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-33055781-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="../../index.html"><strong>dartflash</strong></a>
                <ul class="nav">
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Showcase<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li class="nav-header">Games</li>
                            <li><a href="../../games/escape/escape.html">&nbsp;Escape</a></li>
                            <li><a href="../../games/supersonic/supersonic.html">&nbsp;Supersonic</a></li>
                            <li class="divider"></li>
                            <li class="nav-header">Demos</li>
                            <li><a href="../../demos/performance/performance.html">&nbsp;Performance</a></li>
                            <li><a href="../../demos/masking/masking.html">&nbsp;Masking</a></li>
                            <li><a href="../../demos/movieclip/movieclip.html">&nbsp;MovieClip</a></li>
                            <li><a href="../../demos/text/text.html">&nbsp;Text</a></li>
                            <li><a href="../../demos/filter/filter.html">&nbsp;Filter</a></li>
                            <li><a href="../../demos/sound/sound.html">&nbsp;Sound</a></li>
                            <li><a href="../../demos/tweener/tweener.html">&nbsp;Tweener</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            Runtimes<b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="../../runtimes/texturepacker/texturepacker.html">Texture Packer</a></li>
                            <li><a href="../../runtimes/flump/flump.html">Flump</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents<b
                        class="caret"></b> </a>
                        <ul class="dropdown-menu">
                            <li><a href="../../docs/api/dartflash.html" target="_blank">API Reference</a></li>
                            <li><a href="../../docs/actionscript-dart.html">ActionScript&nbsp;<i class="icon-hand-right"></i>&nbsp;Dart</a></li>
                            <li><a href="../../docs/wiki-articles.html">Wiki Articles</a></li>
                            <li><a href="../../docs/faq.html">FAQ</a></li>
                        </ul>
                    </li>
                    <li><a href="../../info.html">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container">
        <h1>
            Sound</h1>
        <p>
            Playing audio in HTML5 can be difficult. All modern browsers use slightly different implementations
            of the standard. Google Chrome supports the Web Audio API which is not a HTML5 standard yet, but offers
            the best audio playback capabilities for games. Another problem is the support of all the audio
            codecs (mp3/ogg/wav) used in different browsers. To hide all the problems and differences the dartflash
            library wraps those APIs and provides the familiar Sound APIs of Flash. The library also selects the
            codec which is supported by the browser. You just have to provide the audio file in mp3 and ogg format,
            this way your application will work in all major browsers. Nevertheless Firefox and especially Internet
            Explorer have latency problems, let's hope those browser vendors are working on this issue.</p>
        <br />
        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#demoShow" data-toggle="tab">Demo</a></li>
                <li><a href="#demoHTML" data-toggle="tab">HTML</a></li>
                <li><a href="#demoDart" data-toggle="tab">Dart</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="demoShow">
                    <div class="row">
                        <div class="span9">
                            <div id="lyrics">
                            </div>
                        </div>
                        <div class="offset1 span2">
                            <br><br><br>
                            <button id="startOver" class="btn btn-large btn-block btn-warning">Start over</button>
                        </div>
                    </div>

                    <canvas id="stage" width="940" height="250">
                    </canvas>
                </div>
                <div class="tab-pane" id="demoHTML">
                    <pre class="prettyprint lang-html">
&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;span9&quot;&gt;
    &lt;div id=&quot;lyrics&quot;&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;offset1 span2&quot;&gt;
    &lt;br&gt;&lt;br&gt;&lt;br&gt;
    &lt;button id=&quot;startOver&quot; class=&quot;btn btn-large btn-block btn-warning&quot;&gt;Start over&lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;canvas id=&quot;stage&quot; width=&quot;940&quot; height=&quot;250&quot;&gt;
&lt;/canvas&gt; </pre>
                </div>
                <div class="tab-pane" id="demoDart">
                     <pre class="prettyprint lang-java">
import &apos;dart:math&apos;;
import &apos;dart:html&apos; as html;
import &apos;package:dartflash/dartflash.dart&apos;;

Stage stage;
RenderLoop renderLoop;
Resource resource;

var heyJudeNotes = [
  &apos;C4&apos;, &apos;A3&apos;, &apos;A3&apos;, &apos;C4&apos;, &apos;D4&apos;, &apos;G3&apos;,
  &apos;G3&apos;, &apos;A3&apos;, &apos;A3#&apos;, &apos;F4&apos;, &apos;F4&apos;, &apos;E4&apos;, &apos;C4&apos;, &apos;D4&apos;, &apos;C4&apos;, &apos;A3#&apos;, &apos;A3&apos;,
  &apos;C4&apos;, &apos;D4&apos;, &apos;D4&apos;, &apos;D4&apos;, &apos;G4&apos;, &apos;F4&apos;, &apos;E4&apos;, &apos;F4&apos;, &apos;D4&apos;, &apos;C4&apos;,
  &apos;F3&apos;, &apos;G3&apos;, &apos;A3&apos;, &apos;D4&apos;, &apos;C4&apos;, &apos;C4&apos;, &apos;A3#&apos;, &apos;A3&apos;, &apos;E3&apos;, &apos;F3&apos;];

var heyJudeLyrics = [
  &apos;Hey &apos;, &apos;Jude, &apos;, &quot;don&apos;t &quot;, &apos;make &apos;, &apos;it &apos;, &apos;bad.&lt;br&gt;&apos;,
  &apos;Take &apos;, &apos;a &apos;, &apos;sad &apos;, &apos;song &apos;, &apos;and &apos;, &apos;make &apos;, &apos;it &apos;, &apos;better.&lt;br&gt;&apos;,  &apos;&apos;,  &apos;&apos;,  &apos;&apos;,
  &apos;Remember &apos;, &apos;&apos;, &apos;&apos;, &apos;to &apos;, &apos;let &apos;, &apos;her &apos;, &apos;into &apos;, &apos;&apos;, &apos;your &apos;, &apos;heart.&lt;br&gt;&apos;,
  &apos;Than &apos;, &apos;you &apos;, &apos;can &apos;, &apos;start &apos;, &apos;&apos;, &apos;to &apos;, &apos;make &apos;, &apos;things &apos;, &apos;better.&apos;, &apos;&apos;, &apos; &apos;];

List pianoNotes = [
  &apos;C3&apos;, &apos;C3#&apos;, &apos;D3&apos;, &apos;D3#&apos;, &apos;E3&apos;, &apos;F3&apos;, &apos;F3#&apos;, &apos;G3&apos;, &apos;G3#&apos;, &apos;A3&apos;, &apos;A3#&apos;, &apos;B3&apos;,
  &apos;C4&apos;, &apos;C4#&apos;, &apos;D4&apos;, &apos;D4#&apos;, &apos;E4&apos;, &apos;F4&apos;, &apos;F4#&apos;, &apos;G4&apos;, &apos;G4#&apos;, &apos;A4&apos;, &apos;A4#&apos;, &apos;B4&apos;, &apos;C5&apos;];

//-----------------------------------------------------------------------------------

class Piano extends DisplayObjectContainer
{
  List songNotes;
  List songLyrics;
  int noteIndex;
  Bitmap noteFinger;

  Piano(this.songNotes, this.songLyrics)
  {
    // add all piano keys

    for(int n = 0, x = 0; n &lt; pianoNotes.length; n++) {
      var pianoKey = new PianoKey(this, pianoNotes[n], resource.getSound(&apos;Note${n+1}&apos;));
      pianoKey.x = x;
      pianoKey.y = 35;

      if (pianoNotes[n].endsWith(&apos;#&apos;)) {
        pianoKey.x = x - 16;
        addChild(pianoKey);
      } else {
        addChildAt(pianoKey, 0);
        x = x + 47;
      }
    }

    // prepare karaoke

    this.noteIndex = 0;
    this.noteFinger = new Bitmap(resource.getBitmapData(&apos;Finger&apos;));
    this.noteFinger.pivotX = 20;
    addChild(this.noteFinger);
    this.update();
  }

  void checkSongNote(String note)
  {
    // is it the next note of the song?

    if (this.noteIndex &lt; songNotes.length && songNotes[this.noteIndex] == note) {
      if (this.noteIndex == songNotes.length - 1)
        resource.getSound(&apos;Cheer&apos;).play();
      this.noteIndex++;
      this.update();
    }
  }

  void update()
  {
    // update karaoke lyrics

    var lyricsDiv = html.query(&apos;#lyrics&apos;);
    var wordIndex = -1;

    lyricsDiv.innerHtml = &apos;&apos;;

    for(int w = 0, last = 0; w &lt; songLyrics.length; w++)  {
      if (songLyrics[w] != &apos;&apos;) last = w;
      if (w == this.noteIndex) wordIndex = last;
    }

    for(int w = 0; w &lt; songLyrics.length; w++) {
      if (w == wordIndex)
        lyricsDiv.appendHtml(&apos;&lt;span id=&quot;word&quot;&gt;${songLyrics[w]}&lt;/span&gt;&apos;);
      else
        lyricsDiv.appendHtml(songLyrics[w]);
    }

    // update finger position

    if (this.noteIndex &lt; songNotes.length) {
      for(int i = 0; i &lt; this.numChildren; i++) {
        var displayObject = this.getChildAt(i);
        if (displayObject is PianoKey) {
          if (displayObject.note == songNotes[noteIndex]) {
            this.noteFinger.y = 0;
            Tween tweenX = new Tween(this.noteFinger, 0.4, TransitionFunction.easeInOutCubic);
            tweenX.animate(&apos;x&apos;, displayObject.x + displayObject.width / 2);
            Tween tweenY = new Tween(this.noteFinger, 0.4, TransitionFunction.sine);
            tweenY.animate(&apos;y&apos;, -10);
            renderLoop.juggler.removeTweens(this.noteFinger);
            renderLoop.juggler.add(tweenX);
            renderLoop.juggler.add(tweenY);
          }
        }
      }
    } else {
      Tween tweenY = new Tween(this.noteFinger, 0.4, TransitionFunction.linear);
      tweenY.animate(&apos;alpha&apos;, 0);
      renderLoop.juggler.add(tweenY);
    }
  }

  void reset()
  {
    this.noteIndex = 0;
    this.noteFinger.alpha = 1;
    this.update();
  }
}

//-----------------------------------------------------------------------------------

class PianoKey extends Sprite
{
  Piano piano;
  String note;
  Sound sound;

  PianoKey(this.piano, this.note, this.sound)
  {
    var key = null;

    if (note.endsWith(&apos;#&apos;)) {
      key = &apos;KeyBlack&apos;;
    } else if (note.startsWith(&apos;C5&apos;)) {
      key = &apos;KeyWhite0&apos;;
    } else if (note.startsWith(&apos;C&apos;) || note.startsWith(&apos;F&apos;)) {
      key = &apos;KeyWhite1&apos;;
    } else if (note.startsWith(&apos;D&apos;) || note.startsWith(&apos;G&apos;) || note.startsWith(&apos;A&apos;)) {
      key = &apos;KeyWhite2&apos;;
    } else if (note.startsWith(&apos;E&apos;) || note.startsWith(&apos;B&apos;)) {
      key = &apos;KeyWhite3&apos;;
    }

    // draw the key

    var bitmapData = resource.getBitmapData(key);
    var bitmap = new Bitmap(bitmapData);
    this.addChild(bitmap);

    // print note on key

    var textFormat = new TextFormat(&apos;Helvetica,Arial&apos;, 10, 0x000000, align:TextFormatAlign.CENTER);
    textFormat.color = note.endsWith(&apos;#&apos;) ? Color.White : Color.Black;

    var textField = new TextField();
    textField.defaultTextFormat = textFormat;
    textField.text = note;
    textField.width = bitmapData.width;
    textField.height = 20;
    textField.mouseEnabled = false;
    textField.y = bitmapData.height - 20;
    addChild(textField);

    // add event handlers

    this.useHandCursor = true;
    this.on.mouseDown.add(keyDown);
    this.on.mouseOver.add(keyDown);
    this.on.mouseUp.add(keyUp);
    this.on.mouseOut.add(keyUp);
  }

  void keyDown(MouseEvent me)
  {
    if (me.buttonDown) {
      this.sound.play();
      this.alpha = 0.7;
      this.piano.checkSongNote(this.note);
    }
  }

  void keyUp(MouseEvent me)
  {
      this.alpha = 1.0;
  }
}

//-----------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------

void main()
{
  // Initialize the Display List

  stage = new Stage(&apos;stage&apos;, html.document.query(&apos;#stage&apos;));
  renderLoop = new RenderLoop();
  renderLoop.addStage(stage);

  // load the images and sounds for the piano

  resource = new Resource();
  resource.addImage(&apos;KeyBlack&apos;,&apos;../common/images/piano/KeyBlack.png&apos;);
  resource.addImage(&apos;KeyWhite0&apos;,&apos;../common/images/piano/KeyWhite0.png&apos;);
  resource.addImage(&apos;KeyWhite1&apos;,&apos;../common/images/piano/KeyWhite1.png&apos;);
  resource.addImage(&apos;KeyWhite2&apos;,&apos;../common/images/piano/KeyWhite2.png&apos;);
  resource.addImage(&apos;KeyWhite3&apos;,&apos;../common/images/piano/KeyWhite3.png&apos;);
  resource.addImage(&apos;Finger&apos;,&apos;../common/images/piano/Finger.png&apos;);
  resource.addImage(&apos;Background&apos;,&apos;../common/images/piano/Background.jpg&apos;);
  resource.addSound(&apos;Cheer&apos;,&apos;../common/sounds/Cheer.mp3&apos;);

  for(int i = 1; i &lt;= 25; i++)
    resource.addSound(&apos;Note$i&apos;,&apos;../common/sounds/piano/Note$i.mp3&apos;);

  resource.load().then((res) {
    var background = new Bitmap(resource.getBitmapData(&apos;Background&apos;));
    stage.addChild(background);

    var piano = new Piano(heyJudeNotes, heyJudeLyrics);
    piano.x = 120;
    piano.y = 30;
    stage.addChild(piano);

    html.query(&apos;#startOver&apos;).onClick.listen((e) =&gt; piano.reset());
  });
}                 </pre>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../assets/js/prettify.js"></script>

    <script type="application/dart" src="sound.dart"></script>
    <script type="text/javascript" src="../../assets/js/dart.js"></script>
</body>
</html>
