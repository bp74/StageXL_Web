        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>BitmapData class / stagexl Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="stagexl" data-type="BitmapData">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../stagexl.html">stagexl</a> &rsaquo; <a href="../stagexl/BitmapData.html">BitmapData</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../metadata.html">metadata</a></h2><h2><div class="icon-library"></div><a href="../stagexl.html">stagexl</a></h2><ul class="icon">
<li><a href="../stagexl/AlphaMaskFilter.html"><div class="icon-class"></div>AlphaMaskFilter</a></li>
<li><a href="../stagexl/Animatable.html"><div class="icon-class"></div>Animatable</a></li>
<li><a href="../stagexl/AnimationChain.html"><div class="icon-class"></div>AnimationChain</a></li>
<li><a href="../stagexl/AnimationGroup.html"><div class="icon-class"></div>AnimationGroup</a></li>
<li><a href="../stagexl/AudioElementMixer.html"><div class="icon-class"></div>AudioElementMixer</a></li>
<li><a href="../stagexl/AudioElementSound.html"><div class="icon-class"></div>AudioElementSound</a></li>
<li><a href="../stagexl/AudioElementSoundChannel.html"><div class="icon-class"></div>AudioElementSoundChannel</a></li>
<li><a href="../stagexl/Bitmap.html"><div class="icon-class"></div>Bitmap</a></li>
<li><div class="icon-class"></div><strong>BitmapData</strong></li>
<li><a href="../stagexl/BitmapDataLoadOptions.html"><div class="icon-class"></div>BitmapDataLoadOptions</a></li>
<li><a href="../stagexl/BitmapDrawable.html"><div class="icon-class"></div>BitmapDrawable</a></li>
<li><a href="../stagexl/BitmapFilter.html"><div class="icon-class"></div>BitmapFilter</a></li>
<li><a href="../stagexl/BlurFilter.html"><div class="icon-class"></div>BlurFilter</a></li>
<li><a href="../stagexl/BroadcastEvent.html"><div class="icon-class"></div>BroadcastEvent</a></li>
<li><a href="../stagexl/ButtonHelper.html"><div class="icon-class"></div>ButtonHelper</a></li>
<li><a href="../stagexl/CapsStyle.html"><div class="icon-class"></div>CapsStyle</a></li>
<li><a href="../stagexl/ChangeHandler.html"><div class="icon-interface"></div>ChangeHandler</a></li>
<li><a href="../stagexl/Circle.html"><div class="icon-class"></div>Circle</a></li>
<li><a href="../stagexl/Color.html"><div class="icon-class"></div>Color</a></li>
<li><a href="../stagexl/ColorMatrixFilter.html"><div class="icon-class"></div>ColorMatrixFilter</a></li>
<li><a href="../stagexl/ColorTransform.html"><div class="icon-class"></div>ColorTransform</a></li>
<li><a href="../stagexl/CompositeOperation.html"><div class="icon-class"></div>CompositeOperation</a></li>
<li><a href="../stagexl/DelayedCall.html"><div class="icon-class"></div>DelayedCall</a></li>
<li><a href="../stagexl/DisplayObject.html"><div class="icon-class"></div>DisplayObject</a></li>
<li><a href="../stagexl/DisplayObjectContainer.html"><div class="icon-class"></div>DisplayObjectContainer</a></li>
<li><a href="../stagexl/DropShadowFilter.html"><div class="icon-class"></div>DropShadowFilter</a></li>
<li><a href="../stagexl/EaseFunction.html"><div class="icon-interface"></div>EaseFunction</a></li>
<li><a href="../stagexl/EnterFrameEvent.html"><div class="icon-class"></div>EnterFrameEvent</a></li>
<li><a href="../stagexl/Event.html"><div class="icon-class"></div>Event</a></li>
<li><a href="../stagexl/EventDispatcher.html"><div class="icon-class"></div>EventDispatcher</a></li>
<li><a href="../stagexl/EventListener.html"><div class="icon-interface"></div>EventListener&lt;T&gt;</a></li>
<li><a href="../stagexl/EventPhase.html"><div class="icon-class"></div>EventPhase</a></li>
<li><a href="../stagexl/EventStream.html"><div class="icon-class"></div>EventStream&lt;T&gt;</a></li>
<li><a href="../stagexl/EventStreamProvider.html"><div class="icon-class"></div>EventStreamProvider&lt;T&gt;</a></li>
<li><a href="../stagexl/EventStreamSubscription.html"><div class="icon-class"></div>EventStreamSubscription&lt;T&gt;</a></li>
<li><a href="../stagexl/ExitFrameEvent.html"><div class="icon-class"></div>ExitFrameEvent</a></li>
<li><a href="../stagexl/FlipBook.html"><div class="icon-class"></div>FlipBook</a></li>
<li><a href="../stagexl/Gauge.html"><div class="icon-class"></div>Gauge</a></li>
<li><a href="../stagexl/GlassPlate.html"><div class="icon-class"></div>GlassPlate</a></li>
<li><a href="../stagexl/GlowFilter.html"><div class="icon-class"></div>GlowFilter</a></li>
<li><a href="../stagexl/Graphics.html"><div class="icon-class"></div>Graphics</a></li>
<li><a href="../stagexl/GraphicsGradient.html"><div class="icon-class"></div>GraphicsGradient</a></li>
<li><a href="../stagexl/GraphicsPattern.html"><div class="icon-class"></div>GraphicsPattern</a></li>
<li><a href="../stagexl/HtmlObject.html"><div class="icon-class"></div>HtmlObject</a></li>
<li><a href="../stagexl/InteractiveObject.html"><div class="icon-class"></div>InteractiveObject</a></li>
<li><a href="../stagexl/JointStyle.html"><div class="icon-class"></div>JointStyle</a></li>
<li><a href="../stagexl/Juggler.html"><div class="icon-class"></div>Juggler</a></li>
<li><a href="../stagexl/KeyboardEvent.html"><div class="icon-class"></div>KeyboardEvent</a></li>
<li><a href="../stagexl/KeyLocation.html"><div class="icon-class"></div>KeyLocation</a></li>
<li><a href="../stagexl/Mask.html"><div class="icon-class"></div>Mask</a></li>
<li><a href="../stagexl/Matrix.html"><div class="icon-class"></div>Matrix</a></li>
<li><a href="../stagexl/MockSound.html"><div class="icon-class"></div>MockSound</a></li>
<li><a href="../stagexl/MockSoundChannel.html"><div class="icon-class"></div>MockSoundChannel</a></li>
<li><a href="../stagexl/Mouse.html"><div class="icon-class"></div>Mouse</a></li>
<li><a href="../stagexl/MouseCursor.html"><div class="icon-class"></div>MouseCursor</a></li>
<li><a href="../stagexl/MouseEvent.html"><div class="icon-class"></div>MouseEvent</a></li>
<li><a href="../stagexl/MovieClip.html"><div class="icon-class"></div>MovieClip</a></li>
<li><a href="../stagexl/Multitouch.html"><div class="icon-class"></div>Multitouch</a></li>
<li><a href="../stagexl/MultitouchInputMode.html"><div class="icon-class"></div>MultitouchInputMode</a></li>
<li><a href="../stagexl/ObjectPool.html"><div class="icon-class"></div>ObjectPool&lt;T&gt;</a></li>
<li><a href="../stagexl/PixelSnapping.html"><div class="icon-class"></div>PixelSnapping</a></li>
<li><a href="../stagexl/Point.html"><div class="icon-class"></div>Point</a></li>
<li><a href="../stagexl/Rectangle.html"><div class="icon-class"></div>Rectangle</a></li>
<li><a href="../stagexl/RenderEvent.html"><div class="icon-class"></div>RenderEvent</a></li>
<li><a href="../stagexl/RenderLoop.html"><div class="icon-class"></div>RenderLoop</a></li>
<li><a href="../stagexl/RenderState.html"><div class="icon-class"></div>RenderState</a></li>
<li><a href="../stagexl/ResourceManager.html"><div class="icon-class"></div>ResourceManager</a></li>
<li><a href="../stagexl/ResourceManagerResource.html"><div class="icon-class"></div>ResourceManagerResource</a></li>
<li><a href="../stagexl/Shadow.html"><div class="icon-class"></div>Shadow</a></li>
<li><a href="../stagexl/Shape.html"><div class="icon-class"></div>Shape</a></li>
<li><a href="../stagexl/SimpleButton.html"><div class="icon-class"></div>SimpleButton</a></li>
<li><a href="../stagexl/Sound.html"><div class="icon-class"></div>Sound</a></li>
<li><a href="../stagexl/SoundChannel.html"><div class="icon-class"></div>SoundChannel</a></li>
<li><a href="../stagexl/SoundLoadOptions.html"><div class="icon-class"></div>SoundLoadOptions</a></li>
<li><a href="../stagexl/SoundMixer.html"><div class="icon-class"></div>SoundMixer</a></li>
<li><a href="../stagexl/SoundTransform.html"><div class="icon-class"></div>SoundTransform</a></li>
<li><a href="../stagexl/Sprite.html"><div class="icon-class"></div>Sprite</a></li>
<li><a href="../stagexl/SpriteSheet.html"><div class="icon-class"></div>SpriteSheet</a></li>
<li><a href="../stagexl/Stage.html"><div class="icon-class"></div>Stage</a></li>
<li><a href="../stagexl/StageAlign.html"><div class="icon-class"></div>StageAlign</a></li>
<li><a href="../stagexl/StageRenderMode.html"><div class="icon-class"></div>StageRenderMode</a></li>
<li><a href="../stagexl/StageScaleMode.html"><div class="icon-class"></div>StageScaleMode</a></li>
<li><a href="../stagexl/TextEvent.html"><div class="icon-class"></div>TextEvent</a></li>
<li><a href="../stagexl/TextField.html"><div class="icon-class"></div>TextField</a></li>
<li><a href="../stagexl/TextFieldAutoSize.html"><div class="icon-class"></div>TextFieldAutoSize</a></li>
<li><a href="../stagexl/TextFieldType.html"><div class="icon-class"></div>TextFieldType</a></li>
<li><a href="../stagexl/TextFormat.html"><div class="icon-class"></div>TextFormat</a></li>
<li><a href="../stagexl/TextFormatAlign.html"><div class="icon-class"></div>TextFormatAlign</a></li>
<li><a href="../stagexl/TextLineMetrics.html"><div class="icon-class"></div>TextLineMetrics</a></li>
<li><a href="../stagexl/TextureAtlas.html"><div class="icon-class"></div>TextureAtlas</a></li>
<li><a href="../stagexl/TextureAtlasFormat.html"><div class="icon-class"></div>TextureAtlasFormat</a></li>
<li><a href="../stagexl/TextureAtlasFrame.html"><div class="icon-class"></div>TextureAtlasFrame</a></li>
<li><a href="../stagexl/TimeGauge.html"><div class="icon-class"></div>TimeGauge</a></li>
<li><a href="../stagexl/Timeline.html"><div class="icon-class"></div>Timeline</a></li>
<li><a href="../stagexl/TimelineAction.html"><div class="icon-class"></div>TimelineAction</a></li>
<li><a href="../stagexl/TimelineStep.html"><div class="icon-class"></div>TimelineStep</a></li>
<li><a href="../stagexl/TimelineTween.html"><div class="icon-class"></div>TimelineTween</a></li>
<li><a href="../stagexl/TouchEvent.html"><div class="icon-class"></div>TouchEvent</a></li>
<li><a href="../stagexl/Transition.html"><div class="icon-class"></div>Transition</a></li>
<li><a href="../stagexl/TransitionFunction.html"><div class="icon-class"></div>TransitionFunction</a></li>
<li><a href="../stagexl/Tween.html"><div class="icon-class"></div>Tween</a></li>
<li><a href="../stagexl/TweenProperty.html"><div class="icon-class"></div>TweenProperty</a></li>
<li><a href="../stagexl/TweenPropertyFactory.html"><div class="icon-class"></div>TweenPropertyFactory</a></li>
<li><a href="../stagexl/Vector.html"><div class="icon-class"></div>Vector</a></li>
<li><a href="../stagexl/Warp.html"><div class="icon-class"></div>Warp</a></li>
<li><a href="../stagexl/WebAudioApiMixer.html"><div class="icon-class"></div>WebAudioApiMixer</a></li>
<li><a href="../stagexl/WebAudioApiSound.html"><div class="icon-class"></div>WebAudioApiSound</a></li>
<li><a href="../stagexl/WebAudioApiSoundChannel.html"><div class="icon-class"></div>WebAudioApiSoundChannel</a></li>
</ul>
</div>
<div class="content">
        <h2><strong>BitmapData</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<pre class="source">
class BitmapData implements BitmapDrawable {

 int _width;
 int _height;
 bool _transparent;
 num _pixelRatio;
 num _pixelRatioSource;

 int _renderMode;
 int _destinationWidth;
 int _destinationHeight;
 int _destinationX;
 int _destinationY;
 int _sourceX;
 int _sourceY;
 int _sourceWidth;
 int _sourceHeight;

 CanvasImageSource _source;
 CanvasRenderingContext2D _context;

 static BitmapDataLoadOptions defaultLoadOptions = new BitmapDataLoadOptions();

 //-------------------------------------------------------------------------------------------------
 //-------------------------------------------------------------------------------------------------

 BitmapData(int width, int height, [bool transparent = true, int fillColor = 0xFFFFFFFF, pixelRatio = 1.0]) {
   _width = _ensureInt(width);
   _height = _ensureInt(height);
   _transparent = transparent;
   _pixelRatio = pixelRatio.toDouble();
   _pixelRatioSource = _pixelRatio / _backingStorePixelRatio;

   _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
   _destinationX = 0;
   _destinationY = 0;
   _destinationWidth = _width;
   _destinationHeight = _height;
   _sourceX = 0;
   _sourceY = 0;
   _sourceWidth = (_width * _pixelRatioSource).ceil();
   _sourceHeight = (_height * _pixelRatioSource).ceil();

   var canvas = new CanvasElement(width: _sourceWidth, height: _sourceHeight);

   _source = canvas;
   _context = canvas.context2D;
   _context.fillStyle = _transparent ? _color2rgba(fillColor) : _color2rgb(fillColor);
   _context.fillRect(0, 0, _sourceWidth, _sourceHeight);
 }

 BitmapData._default(int width, int height, [bool transparent = true, int fillColor = 0xFFFFFFFF, pixelRatio = 1.0]) {
   _width = _ensureInt(width);
   _height = _ensureInt(height);
   _transparent = transparent;
   _pixelRatio = pixelRatio.toDouble();
   _pixelRatioSource = _pixelRatio / _backingStorePixelRatio;

   _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
   _destinationX = 0;
   _destinationY = 0;
   _destinationWidth = _width;
   _destinationHeight = _height;
   _sourceX = 0;
   _sourceY = 0;
   _sourceWidth = (_width * _pixelRatioSource).ceil();
   _sourceHeight = (_height * _pixelRatioSource).ceil();
 }

 //-------------------------------------------------------------------------------------------------

 BitmapData.fromImageElement(ImageElement imageElement, [num pixelRatio = 1.0]) {

   var imageWidth = _ensureInt(imageElement.naturalWidth);
   var imageHeight = _ensureInt(imageElement.naturalHeight);

   _transparent = true;
   _pixelRatio = _ensureNum(pixelRatio);
   _pixelRatioSource = _pixelRatio;
   _width = (imageWidth / _pixelRatio).round();
   _height = (imageHeight / _pixelRatio).round();

   _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
   _destinationX = 0;
   _destinationY = 0;
   _destinationWidth = _width;
   _destinationHeight = _height;
   _sourceX = 0;
   _sourceY = 0;
   _sourceWidth = imageWidth;
   _sourceHeight = imageHeight;

   _source = imageElement;
 }

 //-------------------------------------------------------------------------------------------------

 BitmapData.fromTextureAtlasFrame(TextureAtlasFrame textureAtlasFrame) {

   var bitmapData = textureAtlasFrame.textureAtlas._bitmapData;

   _width = textureAtlasFrame.originalWidth.toInt();
   _height = textureAtlasFrame.originalHeight.toInt();
   _transparent = true;
   _pixelRatio = bitmapData._pixelRatio;
   _pixelRatioSource = bitmapData._pixelRatioSource;

   _renderMode = textureAtlasFrame.rotated ? 3 : 2;
   _destinationX = textureAtlasFrame.offsetX;
   _destinationY = textureAtlasFrame.offsetY;
   _destinationWidth = textureAtlasFrame.frameWidth;
   _destinationHeight = textureAtlasFrame.frameHeight;
   _sourceX = (textureAtlasFrame.frameX * _pixelRatioSource).floor();
   _sourceY = (textureAtlasFrame.frameY * _pixelRatioSource).floor();
   _sourceWidth = (textureAtlasFrame.frameWidth * _pixelRatioSource).ceil();
   _sourceHeight = (textureAtlasFrame.frameHeight * _pixelRatioSource).ceil();

   _source = bitmapData._source;
 }

 //-------------------------------------------------------------------------------------------------
 //-------------------------------------------------------------------------------------------------

 static Future&lt;BitmapData&gt; load(String url,
     [BitmapDataLoadOptions bitmapDataLoadOptions = null, num pixelRatio = 1.0]) {

   if (bitmapDataLoadOptions == null) {
     bitmapDataLoadOptions = BitmapData.defaultLoadOptions;
   }

   if (Stage.autoHiDpi &amp;&amp; bitmapDataLoadOptions.autoHiDpi) {
     if (url.contains("@1x.") &amp;&amp; _devicePixelRatio &gt;= 1.5) {
       pixelRatio = pixelRatio * 2.0;
       url = url.replaceAll("@1x.", "@2x.");
     }
   }

   Completer&lt;BitmapData&gt; completer = new Completer&lt;BitmapData&gt;();

   ImageElement imageElement = new ImageElement();
   StreamSubscription onLoadSubscription;
   StreamSubscription onErrorSubscription;

   onLoadSubscription = imageElement.onLoad.listen((event) {
     onLoadSubscription.cancel();
     onErrorSubscription.cancel();
     completer.complete(new BitmapData.fromImageElement(imageElement, pixelRatio));
   });

   onErrorSubscription = imageElement.onError.listen((event) {
     onLoadSubscription.cancel();
     onErrorSubscription.cancel();
     completer.completeError(new StateError("Failed to load image."));
   });

   if (bitmapDataLoadOptions.webp == false) {
     imageElement.src = url;
     return completer.future;
   }

   //---------------------------

   _isWebpSupported.then((bool webpSupported) {

     var regex = new RegExp(r"(png|jpg|jpeg)$", multiLine:false, caseSensitive:true);
     var match = regex.firstMatch(url);

     if (webpSupported == false || match == null) {
       imageElement.src = url;
     } else {
       imageElement.src = url.substring(0, url.length - match.group(1).length) + "webp";
     }
   });

   return completer.future;
 }

 //-------------------------------------------------------------------------------------------------
 //-------------------------------------------------------------------------------------------------

 int get width =&gt; _width;
 int get height =&gt; _height;
 Rectangle get rectangle =&gt; new Rectangle(0, 0, _width, _height);

 num get pixelRatio =&gt; _pixelRatio;

 //-------------------------------------------------------------------------------------------------

 /*
  * Returns an array of BitmapData based on this BitmapData's _source.
  *
  * This function is used to "slice" a spritesheet, tileset, or spritemap into
  * several different frames. All BitmapData's produced by this method are linked
  * to this BitmapData's _source for performance.
  *
  * The optional frameCount parameter will limit the number of frames generated,
  * in case you have empty frames you don't care about due to the width / height
  * of this BitmapData.
  */
 List&lt;BitmapData&gt; sliceIntoFrames(int frameWidth, int frameHeight, [int frameCount]) {
   int rows = (height ~/ frameHeight), cols = (width ~/ frameWidth);
   var frames = new List&lt;BitmapData&gt;();
   if (frameCount == null) {
     frameCount = rows * cols;
   }
   loop:
   for(var y = 0; y &lt; height; y += frameHeight) {
     for(var x = 0; x &lt; width; x += frameWidth) {
       if (frames.length &gt;= frameCount) { break loop; }
       var bitmapData = new BitmapData._default(frameWidth, frameHeight)
         .._sourceX = x
         .._sourceY = y
         .._source  = _source
         .._renderMode = 2;

       frames.add(bitmapData);
     }
   }
   return frames;
 }

 //-------------------------------------------------------------------------------------------------

 ImageData getImageData(int x, int y, int width, int height, [num pixelRatio]) {

   if (pixelRatio != null &amp;&amp; pixelRatio != _pixelRatio) {
     var tempBitmapData = new BitmapData(width, height, true, 0, pixelRatio);
     tempBitmapData.draw(this, new Matrix(1.0, 0.0, 0.0, 1.0, -x, -y));
     return tempBitmapData.getImageData(x, y, width, height);
   }

   _ensureContext();

   var pr = _pixelRatio;
   var prs = _pixelRatioSource;

   if (_backingStorePixelRatio &gt; 1.0) {
     return _context.getImageDataHD(x * pr, y * pr, width * pr, height * pr);
   } else {
     return _context.getImageData(x * prs, y * prs, width * prs, height * prs);
   }
 }

 void putImageData(ImageData imageData, int x, int y) {

   _ensureContext();

   var pr = _pixelRatio;
   var prs = _pixelRatioSource;

   if (_backingStorePixelRatio &gt; 1.0) {
     _context.putImageDataHD(imageData, x * pr, y * pr);
   } else {
     _context.putImageData(imageData, x * prs, y * prs);
   }
 }

 ImageData createImageData(int width, int height) {

   _ensureContext();

   var pr = _pixelRatio;
   var prs = _pixelRatioSource;

   return _context.createImageData(width * pr, height * pr);
 }

 //-------------------------------------------------------------------------------------------------

 BitmapData clone([num pixelRatio]) {

   pixelRatio = (pixelRatio != null) ? pixelRatio : _pixelRatio;

   var bitmapData = new BitmapData(_width, _height, true, 0, pixelRatio);
   bitmapData.draw(this);

   return bitmapData;
 }

 //-------------------------------------------------------------------------------------------------

 void applyFilter(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint, BitmapFilter filter) {

   filter.apply(sourceBitmapData, sourceRect, this, destPoint);
 }

 //-------------------------------------------------------------------------------------------------

 void colorTransform(Rectangle rect, ColorTransform transform) {

   int redMultiplier = (1024 * transform.redMultiplier).toInt();
   int greenMultiplier = (1024 * transform.greenMultiplier).toInt();
   int blueMultiplier = (1024 * transform.blueMultiplier).toInt();
   int alphaMultiplier = (1024 * transform.alphaMultiplier).toInt();

   int redOffset = transform.redOffset;
   int greenOffset = transform.greenOffset;
   int blueOffset = transform.blueOffset;
   int alphaOffset = transform.alphaOffset;

   var isLittleEndianSystem = _isLittleEndianSystem;

   int mulitplier0 = isLittleEndianSystem ? redMultiplier : alphaMultiplier;
   int mulitplier1 = isLittleEndianSystem ? greenMultiplier : blueMultiplier;
   int mulitplier2 = isLittleEndianSystem ? blueMultiplier : greenMultiplier;
   int mulitplier3 = isLittleEndianSystem ? alphaMultiplier : redMultiplier;

   int offset0 = isLittleEndianSystem ? redOffset : alphaOffset;
   int offset1 = isLittleEndianSystem ? greenOffset : blueOffset;
   int offset2 = isLittleEndianSystem ? blueOffset : greenOffset;
   int offset3 = isLittleEndianSystem ? alphaOffset : redOffset;

   var imageData = getImageData(rect.x, rect.y, rect.width, rect.height);
   var data = imageData.data;

   for (int i = 0; i &lt;= data.length - 4; i += 4) {
     int c0 = data[i + 0];
     int c1 = data[i + 1];
     int c2 = data[i + 2];
     int c3 = data[i + 3];

     if (c0 is! num) continue; // dart2js hint
     if (c1 is! num) continue; // dart2js hint
     if (c2 is! num) continue; // dart2js hint
     if (c3 is! num) continue; // dart2js hint

     data[i + 0] = offset0 + (((c0 * mulitplier0) | 0) &gt;&gt; 10);
     data[i + 1] = offset1 + (((c1 * mulitplier1) | 0) &gt;&gt; 10);
     data[i + 2] = offset2 + (((c2 * mulitplier2) | 0) &gt;&gt; 10);
     data[i + 3] = offset3 + (((c3 * mulitplier3) | 0) &gt;&gt; 10);
   }

   putImageData(imageData, rect.x, rect.y);
 }

 //-------------------------------------------------------------------------------------------------

 void copyPixels(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint) {

   _ensureContext();
   sourceBitmapData._ensureContext();

   var sourceContext = sourceBitmapData._context;
   var sourceCanvas = sourceContext.canvas;
   var sourcePixelRatio = sourceBitmapData._pixelRatioSource;
   var sx = sourcePixelRatio * sourceRect.x;
   var sy = sourcePixelRatio * sourceRect.y;
   var sw = sourcePixelRatio * sourceRect.width;
   var sh = sourcePixelRatio * sourceRect.height;

   var destinationContext = _context;
   var destinationPixelRatio = _pixelRatioSource;
   var dx = destinationPixelRatio * destPoint.x;
   var dy = destinationPixelRatio * destPoint.y;
   var dw = destinationPixelRatio * sourceRect.width;
   var dh = destinationPixelRatio * sourceRect.height;

   destinationContext.clearRect(dx, dy, dw, dh);
   destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
 }

 //-------------------------------------------------------------------------------------------------

 void drawPixels(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint,
                 [String compositeOperation = null]) {

   _ensureContext();
   sourceBitmapData._ensureContext();

   var sourceContext = sourceBitmapData._context;
   var sourceCanvas = sourceContext.canvas;
   var sourcePixelRatio = sourceBitmapData._pixelRatioSource;
   var sx = sourcePixelRatio * sourceRect.x;
   var sy = sourcePixelRatio * sourceRect.y;
   var sw = sourcePixelRatio * sourceRect.width;
   var sh = sourcePixelRatio * sourceRect.height;

   var destinationContext = _context;
   var destinationPixelRatio = _pixelRatioSource;
   var dx = destinationPixelRatio * destPoint.x;
   var dy = destinationPixelRatio * destPoint.y;
   var dw = destinationPixelRatio * sourceRect.width;
   var dh = destinationPixelRatio * sourceRect.height;

   if (compositeOperation != null) {
     destinationContext.globalCompositeOperation = compositeOperation;
     destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
     destinationContext.globalCompositeOperation = CompositeOperation.SOURCE_OVER;
   } else {
     destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
   }
 }

 //-------------------------------------------------------------------------------------------------

 void draw(BitmapDrawable source, [Matrix matrix = null]) {

   _ensureContext();

   matrix = (matrix == null) ? new Matrix.fromIdentity() : matrix.clone();
   matrix.scale(_pixelRatioSource, _pixelRatioSource);

   var renderState = new RenderState.fromCanvasRenderingContext2D(_context, matrix);
   source.render(renderState);

   _context.globalAlpha = 1.0;
   _context.globalCompositeOperation = CompositeOperation.SOURCE_OVER;
 }

 //-------------------------------------------------------------------------------------------------

 void fillRect(Rectangle rect, int color) {

   _ensureContext();

   _context.setTransform(_pixelRatioSource, 0.0, 0.0, _pixelRatioSource, 0.0, 0.0);
   _context.fillStyle = _color2rgba(color);
   _context.fillRect(rect.x, rect.y, rect.width, rect.height);
 }

 //-------------------------------------------------------------------------------------------------

 void clear() {

   _ensureContext();

   _context.setTransform(_pixelRatioSource, 0.0, 0.0, _pixelRatioSource, 0.0, 0.0);
   _context.clearRect(0, 0, _width, _height);
 }

 //-------------------------------------------------------------------------------------------------

 int getPixel(int x, int y) {
   return getPixel32(x, y) &amp; 0x00FFFFFF;
 }

 void setPixel(int x, int y, int color) {
   setPixel32(x, y, color | 0xFF000000);
 }

 //-------------------------------------------------------------------------------------------------

 int getPixel32(int x, int y) {

   var imageData = getImageData(x, y, 1, 1);
   var pixels = imageData.width * imageData.height;
   var data = imageData.data;
   var r = 0, g = 0, b = 0, a = 0;

   for(int p = 0; p &lt; pixels; p++) {
     r += _isLittleEndianSystem ? data[p * 4 + 0] : data[p * 4 + 3];
     g += _isLittleEndianSystem ? data[p * 4 + 1] : data[p * 4 + 2];
     b += _isLittleEndianSystem ? data[p * 4 + 2] : data[p * 4 + 1];
     a += _isLittleEndianSystem ? data[p * 4 + 3] : data[p * 4 + 0];
   }

   return ((a ~/ pixels) &lt;&lt; 24) + ((r ~/ pixels) &lt;&lt; 16) + ((g ~/ pixels) &lt;&lt; 8) + ((b ~/ pixels) &lt;&lt; 0);
 }

 void setPixel32(int x, int y, int color) {

   var imageData = createImageData(1, 1);
   var pixels = imageData.width * imageData.height;
   var data = imageData.data;

   var c0 = ((color | 0) &gt;&gt; 24) &amp; 0xFF;
   var c1 = ((color | 0) &gt;&gt; 16) &amp; 0xFF;
   var c2 = ((color | 0) &gt;&gt;  8) &amp; 0xFF;
   var c3 = ((color | 0)      ) &amp; 0xFF;

   for(int p = 0; p &lt; pixels; p++) {
     data[p * 4 + 0] = _isLittleEndianSystem ? c1 : c0;
     data[p * 4 + 1] = _isLittleEndianSystem ? c2 : c3;
     data[p * 4 + 2] = _isLittleEndianSystem ? c3 : c2;
     data[p * 4 + 3] = _isLittleEndianSystem ? c0 : c1;
   }

   putImageData(imageData, x, y);
 }

 //-------------------------------------------------------------------------------------------------
 //-------------------------------------------------------------------------------------------------

 void render(RenderState renderState) {

   var renderStateContext = renderState.context;

   switch(_renderMode) {

     case 0:
       renderStateContext.drawImage(_source,
           _destinationX, _destinationY);
       break;

     case 1:
       renderStateContext.drawImageScaled(_source,
           _destinationX, _destinationY, _destinationWidth, _destinationHeight);
       break;

     case 2:
       renderStateContext.drawImageScaledFromSource(_source,
           _sourceX, _sourceY, _sourceWidth, _sourceHeight,
           _destinationX, _destinationY, _destinationWidth, _destinationHeight);
       break;

     case 3:
       renderStateContext.transform(0.0, -1.0, 1.0, 0.0, _destinationX, _destinationY + _destinationHeight);
       renderStateContext.drawImageScaledFromSource(_source,
           _sourceX, _sourceY, _sourceHeight, _sourceWidth,
           0.0 , 0.0, _destinationHeight, _destinationWidth);
       break;
   }
 }

 //-------------------------------------------------------------------------------------------------

 void renderClipped(RenderState renderState, Rectangle clipRectangle) {

   if (clipRectangle.width == 0 ||  clipRectangle.height == 0) return;

   var renderStateContext = renderState.context;

   // Drawing a clipped BitmapData with a _renderMode other than 0 is pretty complicated.
   // Therefore we convert all BitmapDatas to _renderMode 0 and use a simple drawing method.

   if (_renderMode != 0) {
     _ensureContext();
   }

   var sourceX = (clipRectangle.x - _destinationX) * _pixelRatioSource;
   var sourceY = (clipRectangle.y - _destinationY) * _pixelRatioSource;
   var sourceWidth = clipRectangle.width * _pixelRatioSource;
   var sourceHeight = clipRectangle.height * _pixelRatioSource;
   var destinationX = clipRectangle.x + _destinationX;
   var destinationY = clipRectangle.y + _destinationY;
   var destinationWidth = clipRectangle.width;
   var destinationHeight = clipRectangle.height;

   renderStateContext.drawImageScaledFromSource(_source,
       sourceX, sourceY, sourceWidth, sourceHeight,
       destinationX, destinationY, destinationWidth, destinationHeight);
 }

 //-------------------------------------------------------------------------------------------------
 //-------------------------------------------------------------------------------------------------

 void _ensureContext() {

   if (_context == null) {

     var pixelRatioSource = _pixelRatio / _backingStorePixelRatio;
     var sourceWidth = (_width * pixelRatioSource).ceil();
     var sourceHeight = (_height * pixelRatioSource).ceil();

     var canvas = new CanvasElement(width: sourceWidth, height: sourceHeight);
     var matrix = new Matrix(pixelRatioSource, 0.0, 0.0, pixelRatioSource, 0.0, 0.0);
     var renderState = new RenderState.fromCanvasRenderingContext2D(canvas.context2D, matrix);
     this.render(renderState);

     _pixelRatio = _pixelRatio;
     _pixelRatioSource = pixelRatioSource;

     _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
     _destinationX = 0;
     _destinationY = 0;
     _destinationWidth = _width;
     _destinationHeight = _height;
     _sourceX = 0;
     _sourceY = 0;
     _sourceWidth = sourceWidth;
     _sourceHeight = sourceHeight;

     _source = canvas;
     _context = canvas.context2D;
   }
 }
}
</pre>
</div>
<h3>Implements</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../stagexl/BitmapDrawable.html">BitmapDrawable</a></span></p>
<div>
<h3>Static Properties</h3>
<div class="field"><h4 id="defaultLoadOptions">
<button class="show-code">Code</button>
<a href="../stagexl/BitmapDataLoadOptions.html">BitmapDataLoadOptions</a>         <strong>defaultLoadOptions</strong> <a class="anchor-link"
            href="#defaultLoadOptions"
            title="Permalink to BitmapData.defaultLoadOptions">#</a>
        </h4>
        <div class="doc">
<pre class="source">
static BitmapDataLoadOptions defaultLoadOptions = new BitmapDataLoadOptions()
</pre>
</div>
</div>
</div>
<div>
<h3>Static Methods</h3>
<div class="method"><h4 id="load">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_async/Future.html" ref="external">Future</a>&lt;<a href="../stagexl/BitmapData.html">BitmapData</a>&gt; <strong>load</strong>(<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> url, [<a href="../stagexl/BitmapDataLoadOptions.html">BitmapDataLoadOptions</a> bitmapDataLoadOptions = null, <a href="http://api.dartlang.org/dart_core/num.html" ref="external">num</a> pixelRatio = 1.0]) <a class="anchor-link" href="#load"
              title="Permalink to BitmapData.load">#</a></h4>
<div class="doc">
<pre class="source">
static Future&lt;BitmapData&gt; load(String url,
   [BitmapDataLoadOptions bitmapDataLoadOptions = null, num pixelRatio = 1.0]) {

 if (bitmapDataLoadOptions == null) {
   bitmapDataLoadOptions = BitmapData.defaultLoadOptions;
 }

 if (Stage.autoHiDpi &amp;&amp; bitmapDataLoadOptions.autoHiDpi) {
   if (url.contains("@1x.") &amp;&amp; _devicePixelRatio &gt;= 1.5) {
     pixelRatio = pixelRatio * 2.0;
     url = url.replaceAll("@1x.", "@2x.");
   }
 }

 Completer&lt;BitmapData&gt; completer = new Completer&lt;BitmapData&gt;();

 ImageElement imageElement = new ImageElement();
 StreamSubscription onLoadSubscription;
 StreamSubscription onErrorSubscription;

 onLoadSubscription = imageElement.onLoad.listen((event) {
   onLoadSubscription.cancel();
   onErrorSubscription.cancel();
   completer.complete(new BitmapData.fromImageElement(imageElement, pixelRatio));
 });

 onErrorSubscription = imageElement.onError.listen((event) {
   onLoadSubscription.cancel();
   onErrorSubscription.cancel();
   completer.completeError(new StateError("Failed to load image."));
 });

 if (bitmapDataLoadOptions.webp == false) {
   imageElement.src = url;
   return completer.future;
 }

 //---------------------------

 _isWebpSupported.then((bool webpSupported) {

   var regex = new RegExp(r"(png|jpg|jpeg)$", multiLine:false, caseSensitive:true);
   var match = regex.firstMatch(url);

   if (webpSupported == false || match == null) {
     imageElement.src = url;
   } else {
     imageElement.src = url.substring(0, url.length - match.group(1).length) + "webp";
   }
 });

 return completer.future;
}
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>BitmapData</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> width, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> height, [<a href="http://api.dartlang.org/dart_core/bool.html" ref="external">bool</a> transparent = true, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> fillColor = 0xFFFFFFFF, pixelRatio = 1.0]) <a class="anchor-link" href="#"
              title="Permalink to BitmapData.BitmapData">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Object.html" ref="external">Object</a> </div></div>
<pre class="source">
BitmapData(int width, int height, [bool transparent = true, int fillColor = 0xFFFFFFFF, pixelRatio = 1.0]) {
 _width = _ensureInt(width);
 _height = _ensureInt(height);
 _transparent = transparent;
 _pixelRatio = pixelRatio.toDouble();
 _pixelRatioSource = _pixelRatio / _backingStorePixelRatio;

 _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
 _destinationX = 0;
 _destinationY = 0;
 _destinationWidth = _width;
 _destinationHeight = _height;
 _sourceX = 0;
 _sourceY = 0;
 _sourceWidth = (_width * _pixelRatioSource).ceil();
 _sourceHeight = (_height * _pixelRatioSource).ceil();

 var canvas = new CanvasElement(width: _sourceWidth, height: _sourceHeight);

 _source = canvas;
 _context = canvas.context2D;
 _context.fillStyle = _transparent ? _color2rgba(fillColor) : _color2rgb(fillColor);
 _context.fillRect(0, 0, _sourceWidth, _sourceHeight);
}
</pre>
</div>
</div>
<div class="method"><h4 id="fromImageElement">
<button class="show-code">Code</button>
new <strong>BitmapData.fromImageElement</strong>(<a href="http://api.dartlang.org/dart_html/ImageElement.html" ref="external">ImageElement</a> imageElement, [<a href="http://api.dartlang.org/dart_core/num.html" ref="external">num</a> pixelRatio = 1.0]) <a class="anchor-link" href="#fromImageElement"
              title="Permalink to BitmapData.BitmapData.fromImageElement">#</a></h4>
<div class="doc">
<pre class="source">
BitmapData.fromImageElement(ImageElement imageElement, [num pixelRatio = 1.0]) {

 var imageWidth = _ensureInt(imageElement.naturalWidth);
 var imageHeight = _ensureInt(imageElement.naturalHeight);

 _transparent = true;
 _pixelRatio = _ensureNum(pixelRatio);
 _pixelRatioSource = _pixelRatio;
 _width = (imageWidth / _pixelRatio).round();
 _height = (imageHeight / _pixelRatio).round();

 _renderMode = ((1.0 - _pixelRatioSource).abs() &lt; 0.001) ? 0 : 1;
 _destinationX = 0;
 _destinationY = 0;
 _destinationWidth = _width;
 _destinationHeight = _height;
 _sourceX = 0;
 _sourceY = 0;
 _sourceWidth = imageWidth;
 _sourceHeight = imageHeight;

 _source = imageElement;
}
</pre>
</div>
</div>
<div class="method"><h4 id="fromTextureAtlasFrame">
<button class="show-code">Code</button>
new <strong>BitmapData.fromTextureAtlasFrame</strong>(<a href="../stagexl/TextureAtlasFrame.html">TextureAtlasFrame</a> textureAtlasFrame) <a class="anchor-link" href="#fromTextureAtlasFrame"
              title="Permalink to BitmapData.BitmapData.fromTextureAtlasFrame">#</a></h4>
<div class="doc">
<pre class="source">
BitmapData.fromTextureAtlasFrame(TextureAtlasFrame textureAtlasFrame) {

 var bitmapData = textureAtlasFrame.textureAtlas._bitmapData;

 _width = textureAtlasFrame.originalWidth.toInt();
 _height = textureAtlasFrame.originalHeight.toInt();
 _transparent = true;
 _pixelRatio = bitmapData._pixelRatio;
 _pixelRatioSource = bitmapData._pixelRatioSource;

 _renderMode = textureAtlasFrame.rotated ? 3 : 2;
 _destinationX = textureAtlasFrame.offsetX;
 _destinationY = textureAtlasFrame.offsetY;
 _destinationWidth = textureAtlasFrame.frameWidth;
 _destinationHeight = textureAtlasFrame.frameHeight;
 _sourceX = (textureAtlasFrame.frameX * _pixelRatioSource).floor();
 _sourceY = (textureAtlasFrame.frameY * _pixelRatioSource).floor();
 _sourceWidth = (textureAtlasFrame.frameWidth * _pixelRatioSource).ceil();
 _sourceHeight = (textureAtlasFrame.frameHeight * _pixelRatioSource).ceil();

 _source = bitmapData._source;
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="height">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a>         <strong>height</strong> <a class="anchor-link"
            href="#height"
            title="Permalink to BitmapData.height">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get height =&gt; _height;
</pre>
</div>
</div>
<div class="field"><h4 id="pixelRatio">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/num.html" ref="external">num</a>         <strong>pixelRatio</strong> <a class="anchor-link"
            href="#pixelRatio"
            title="Permalink to BitmapData.pixelRatio">#</a>
        </h4>
        <div class="doc">
<pre class="source">
num get pixelRatio =&gt; _pixelRatio;
</pre>
</div>
</div>
<div class="field"><h4 id="rectangle">
<button class="show-code">Code</button>
final <a href="../stagexl/Rectangle.html">Rectangle</a>         <strong>rectangle</strong> <a class="anchor-link"
            href="#rectangle"
            title="Permalink to BitmapData.rectangle">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Rectangle get rectangle =&gt; new Rectangle(0, 0, _width, _height);
</pre>
</div>
</div>
<div class="field"><h4 id="width">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a>         <strong>width</strong> <a class="anchor-link"
            href="#width"
            title="Permalink to BitmapData.width">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get width =&gt; _width;
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="applyFilter">
<button class="show-code">Code</button>
void <strong>applyFilter</strong>(<a href="../stagexl/BitmapData.html">BitmapData</a> sourceBitmapData, <a href="../stagexl/Rectangle.html">Rectangle</a> sourceRect, <a href="../stagexl/Point.html">Point</a> destPoint, <a href="../stagexl/BitmapFilter.html">BitmapFilter</a> filter) <a class="anchor-link" href="#applyFilter"
              title="Permalink to BitmapData.applyFilter">#</a></h4>
<div class="doc">
<pre class="source">
void applyFilter(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint, BitmapFilter filter) {

 filter.apply(sourceBitmapData, sourceRect, this, destPoint);
}
</pre>
</div>
</div>
<div class="method"><h4 id="clear">
<button class="show-code">Code</button>
void <strong>clear</strong>() <a class="anchor-link" href="#clear"
              title="Permalink to BitmapData.clear">#</a></h4>
<div class="doc">
<pre class="source">
void clear() {

 _ensureContext();

 _context.setTransform(_pixelRatioSource, 0.0, 0.0, _pixelRatioSource, 0.0, 0.0);
 _context.clearRect(0, 0, _width, _height);
}
</pre>
</div>
</div>
<div class="method"><h4 id="clone">
<button class="show-code">Code</button>
<a href="../stagexl/BitmapData.html">BitmapData</a> <strong>clone</strong>([<a href="http://api.dartlang.org/dart_core/num.html" ref="external">num</a> pixelRatio]) <a class="anchor-link" href="#clone"
              title="Permalink to BitmapData.clone">#</a></h4>
<div class="doc">
<pre class="source">
BitmapData clone([num pixelRatio]) {

 pixelRatio = (pixelRatio != null) ? pixelRatio : _pixelRatio;

 var bitmapData = new BitmapData(_width, _height, true, 0, pixelRatio);
 bitmapData.draw(this);

 return bitmapData;
}
</pre>
</div>
</div>
<div class="method"><h4 id="colorTransform">
<button class="show-code">Code</button>
void <strong>colorTransform</strong>(<a href="../stagexl/Rectangle.html">Rectangle</a> rect, <a href="../stagexl/ColorTransform.html">ColorTransform</a> transform) <a class="anchor-link" href="#colorTransform"
              title="Permalink to BitmapData.colorTransform">#</a></h4>
<div class="doc">
<pre class="source">
void colorTransform(Rectangle rect, ColorTransform transform) {

 int redMultiplier = (1024 * transform.redMultiplier).toInt();
 int greenMultiplier = (1024 * transform.greenMultiplier).toInt();
 int blueMultiplier = (1024 * transform.blueMultiplier).toInt();
 int alphaMultiplier = (1024 * transform.alphaMultiplier).toInt();

 int redOffset = transform.redOffset;
 int greenOffset = transform.greenOffset;
 int blueOffset = transform.blueOffset;
 int alphaOffset = transform.alphaOffset;

 var isLittleEndianSystem = _isLittleEndianSystem;

 int mulitplier0 = isLittleEndianSystem ? redMultiplier : alphaMultiplier;
 int mulitplier1 = isLittleEndianSystem ? greenMultiplier : blueMultiplier;
 int mulitplier2 = isLittleEndianSystem ? blueMultiplier : greenMultiplier;
 int mulitplier3 = isLittleEndianSystem ? alphaMultiplier : redMultiplier;

 int offset0 = isLittleEndianSystem ? redOffset : alphaOffset;
 int offset1 = isLittleEndianSystem ? greenOffset : blueOffset;
 int offset2 = isLittleEndianSystem ? blueOffset : greenOffset;
 int offset3 = isLittleEndianSystem ? alphaOffset : redOffset;

 var imageData = getImageData(rect.x, rect.y, rect.width, rect.height);
 var data = imageData.data;

 for (int i = 0; i &lt;= data.length - 4; i += 4) {
   int c0 = data[i + 0];
   int c1 = data[i + 1];
   int c2 = data[i + 2];
   int c3 = data[i + 3];

   if (c0 is! num) continue; // dart2js hint
   if (c1 is! num) continue; // dart2js hint
   if (c2 is! num) continue; // dart2js hint
   if (c3 is! num) continue; // dart2js hint

   data[i + 0] = offset0 + (((c0 * mulitplier0) | 0) &gt;&gt; 10);
   data[i + 1] = offset1 + (((c1 * mulitplier1) | 0) &gt;&gt; 10);
   data[i + 2] = offset2 + (((c2 * mulitplier2) | 0) &gt;&gt; 10);
   data[i + 3] = offset3 + (((c3 * mulitplier3) | 0) &gt;&gt; 10);
 }

 putImageData(imageData, rect.x, rect.y);
}
</pre>
</div>
</div>
<div class="method"><h4 id="copyPixels">
<button class="show-code">Code</button>
void <strong>copyPixels</strong>(<a href="../stagexl/BitmapData.html">BitmapData</a> sourceBitmapData, <a href="../stagexl/Rectangle.html">Rectangle</a> sourceRect, <a href="../stagexl/Point.html">Point</a> destPoint) <a class="anchor-link" href="#copyPixels"
              title="Permalink to BitmapData.copyPixels">#</a></h4>
<div class="doc">
<pre class="source">
void copyPixels(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint) {

 _ensureContext();
 sourceBitmapData._ensureContext();

 var sourceContext = sourceBitmapData._context;
 var sourceCanvas = sourceContext.canvas;
 var sourcePixelRatio = sourceBitmapData._pixelRatioSource;
 var sx = sourcePixelRatio * sourceRect.x;
 var sy = sourcePixelRatio * sourceRect.y;
 var sw = sourcePixelRatio * sourceRect.width;
 var sh = sourcePixelRatio * sourceRect.height;

 var destinationContext = _context;
 var destinationPixelRatio = _pixelRatioSource;
 var dx = destinationPixelRatio * destPoint.x;
 var dy = destinationPixelRatio * destPoint.y;
 var dw = destinationPixelRatio * sourceRect.width;
 var dh = destinationPixelRatio * sourceRect.height;

 destinationContext.clearRect(dx, dy, dw, dh);
 destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
}
</pre>
</div>
</div>
<div class="method"><h4 id="createImageData">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/ImageData.html" ref="external">ImageData</a> <strong>createImageData</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> width, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> height) <a class="anchor-link" href="#createImageData"
              title="Permalink to BitmapData.createImageData">#</a></h4>
<div class="doc">
<pre class="source">
ImageData createImageData(int width, int height) {

 _ensureContext();

 var pr = _pixelRatio;
 var prs = _pixelRatioSource;

 return _context.createImageData(width * pr, height * pr);
}
</pre>
</div>
</div>
<div class="method"><h4 id="draw">
<button class="show-code">Code</button>
void <strong>draw</strong>(<a href="../stagexl/BitmapDrawable.html">BitmapDrawable</a> source, [<a href="../stagexl/Matrix.html">Matrix</a> matrix = null]) <a class="anchor-link" href="#draw"
              title="Permalink to BitmapData.draw">#</a></h4>
<div class="doc">
<pre class="source">
void draw(BitmapDrawable source, [Matrix matrix = null]) {

 _ensureContext();

 matrix = (matrix == null) ? new Matrix.fromIdentity() : matrix.clone();
 matrix.scale(_pixelRatioSource, _pixelRatioSource);

 var renderState = new RenderState.fromCanvasRenderingContext2D(_context, matrix);
 source.render(renderState);

 _context.globalAlpha = 1.0;
 _context.globalCompositeOperation = CompositeOperation.SOURCE_OVER;
}
</pre>
</div>
</div>
<div class="method"><h4 id="drawPixels">
<button class="show-code">Code</button>
void <strong>drawPixels</strong>(<a href="../stagexl/BitmapData.html">BitmapData</a> sourceBitmapData, <a href="../stagexl/Rectangle.html">Rectangle</a> sourceRect, <a href="../stagexl/Point.html">Point</a> destPoint, [<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> compositeOperation = null]) <a class="anchor-link" href="#drawPixels"
              title="Permalink to BitmapData.drawPixels">#</a></h4>
<div class="doc">
<pre class="source">
void drawPixels(BitmapData sourceBitmapData, Rectangle sourceRect, Point destPoint,
               [String compositeOperation = null]) {

 _ensureContext();
 sourceBitmapData._ensureContext();

 var sourceContext = sourceBitmapData._context;
 var sourceCanvas = sourceContext.canvas;
 var sourcePixelRatio = sourceBitmapData._pixelRatioSource;
 var sx = sourcePixelRatio * sourceRect.x;
 var sy = sourcePixelRatio * sourceRect.y;
 var sw = sourcePixelRatio * sourceRect.width;
 var sh = sourcePixelRatio * sourceRect.height;

 var destinationContext = _context;
 var destinationPixelRatio = _pixelRatioSource;
 var dx = destinationPixelRatio * destPoint.x;
 var dy = destinationPixelRatio * destPoint.y;
 var dw = destinationPixelRatio * sourceRect.width;
 var dh = destinationPixelRatio * sourceRect.height;

 if (compositeOperation != null) {
   destinationContext.globalCompositeOperation = compositeOperation;
   destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
   destinationContext.globalCompositeOperation = CompositeOperation.SOURCE_OVER;
 } else {
   destinationContext.drawImageScaledFromSource(sourceCanvas, sx, sy, sw, sh, dx, dy, dw, dh);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="fillRect">
<button class="show-code">Code</button>
void <strong>fillRect</strong>(<a href="../stagexl/Rectangle.html">Rectangle</a> rect, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> color) <a class="anchor-link" href="#fillRect"
              title="Permalink to BitmapData.fillRect">#</a></h4>
<div class="doc">
<pre class="source">
void fillRect(Rectangle rect, int color) {

 _ensureContext();

 _context.setTransform(_pixelRatioSource, 0.0, 0.0, _pixelRatioSource, 0.0, 0.0);
 _context.fillStyle = _color2rgba(color);
 _context.fillRect(rect.x, rect.y, rect.width, rect.height);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getImageData">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/ImageData.html" ref="external">ImageData</a> <strong>getImageData</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> width, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> height, [<a href="http://api.dartlang.org/dart_core/num.html" ref="external">num</a> pixelRatio]) <a class="anchor-link" href="#getImageData"
              title="Permalink to BitmapData.getImageData">#</a></h4>
<div class="doc">
<pre class="source">
ImageData getImageData(int x, int y, int width, int height, [num pixelRatio]) {

 if (pixelRatio != null &amp;&amp; pixelRatio != _pixelRatio) {
   var tempBitmapData = new BitmapData(width, height, true, 0, pixelRatio);
   tempBitmapData.draw(this, new Matrix(1.0, 0.0, 0.0, 1.0, -x, -y));
   return tempBitmapData.getImageData(x, y, width, height);
 }

 _ensureContext();

 var pr = _pixelRatio;
 var prs = _pixelRatioSource;

 if (_backingStorePixelRatio &gt; 1.0) {
   return _context.getImageDataHD(x * pr, y * pr, width * pr, height * pr);
 } else {
   return _context.getImageData(x * prs, y * prs, width * prs, height * prs);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="getPixel">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> <strong>getPixel</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y) <a class="anchor-link" href="#getPixel"
              title="Permalink to BitmapData.getPixel">#</a></h4>
<div class="doc">
<pre class="source">
int getPixel(int x, int y) {
 return getPixel32(x, y) &amp; 0x00FFFFFF;
}
</pre>
</div>
</div>
<div class="method"><h4 id="getPixel32">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> <strong>getPixel32</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y) <a class="anchor-link" href="#getPixel32"
              title="Permalink to BitmapData.getPixel32">#</a></h4>
<div class="doc">
<pre class="source">
int getPixel32(int x, int y) {

 var imageData = getImageData(x, y, 1, 1);
 var pixels = imageData.width * imageData.height;
 var data = imageData.data;
 var r = 0, g = 0, b = 0, a = 0;

 for(int p = 0; p &lt; pixels; p++) {
   r += _isLittleEndianSystem ? data[p * 4 + 0] : data[p * 4 + 3];
   g += _isLittleEndianSystem ? data[p * 4 + 1] : data[p * 4 + 2];
   b += _isLittleEndianSystem ? data[p * 4 + 2] : data[p * 4 + 1];
   a += _isLittleEndianSystem ? data[p * 4 + 3] : data[p * 4 + 0];
 }

 return ((a ~/ pixels) &lt;&lt; 24) + ((r ~/ pixels) &lt;&lt; 16) + ((g ~/ pixels) &lt;&lt; 8) + ((b ~/ pixels) &lt;&lt; 0);
}
</pre>
</div>
</div>
<div class="method"><h4 id="putImageData">
<button class="show-code">Code</button>
void <strong>putImageData</strong>(<a href="http://api.dartlang.org/dart_html/ImageData.html" ref="external">ImageData</a> imageData, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y) <a class="anchor-link" href="#putImageData"
              title="Permalink to BitmapData.putImageData">#</a></h4>
<div class="doc">
<pre class="source">
void putImageData(ImageData imageData, int x, int y) {

 _ensureContext();

 var pr = _pixelRatio;
 var prs = _pixelRatioSource;

 if (_backingStorePixelRatio &gt; 1.0) {
   _context.putImageDataHD(imageData, x * pr, y * pr);
 } else {
   _context.putImageData(imageData, x * prs, y * prs);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="render">
<button class="show-code">Code</button>
void <strong>render</strong>(<a href="../stagexl/RenderState.html">RenderState</a> renderState) <a class="anchor-link" href="#render"
              title="Permalink to BitmapData.render">#</a></h4>
<div class="doc">
<pre class="source">
void render(RenderState renderState) {

 var renderStateContext = renderState.context;

 switch(_renderMode) {

   case 0:
     renderStateContext.drawImage(_source,
         _destinationX, _destinationY);
     break;

   case 1:
     renderStateContext.drawImageScaled(_source,
         _destinationX, _destinationY, _destinationWidth, _destinationHeight);
     break;

   case 2:
     renderStateContext.drawImageScaledFromSource(_source,
         _sourceX, _sourceY, _sourceWidth, _sourceHeight,
         _destinationX, _destinationY, _destinationWidth, _destinationHeight);
     break;

   case 3:
     renderStateContext.transform(0.0, -1.0, 1.0, 0.0, _destinationX, _destinationY + _destinationHeight);
     renderStateContext.drawImageScaledFromSource(_source,
         _sourceX, _sourceY, _sourceHeight, _sourceWidth,
         0.0 , 0.0, _destinationHeight, _destinationWidth);
     break;
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="renderClipped">
<button class="show-code">Code</button>
void <strong>renderClipped</strong>(<a href="../stagexl/RenderState.html">RenderState</a> renderState, <a href="../stagexl/Rectangle.html">Rectangle</a> clipRectangle) <a class="anchor-link" href="#renderClipped"
              title="Permalink to BitmapData.renderClipped">#</a></h4>
<div class="doc">
<pre class="source">
void renderClipped(RenderState renderState, Rectangle clipRectangle) {

 if (clipRectangle.width == 0 ||  clipRectangle.height == 0) return;

 var renderStateContext = renderState.context;

 // Drawing a clipped BitmapData with a _renderMode other than 0 is pretty complicated.
 // Therefore we convert all BitmapDatas to _renderMode 0 and use a simple drawing method.

 if (_renderMode != 0) {
   _ensureContext();
 }

 var sourceX = (clipRectangle.x - _destinationX) * _pixelRatioSource;
 var sourceY = (clipRectangle.y - _destinationY) * _pixelRatioSource;
 var sourceWidth = clipRectangle.width * _pixelRatioSource;
 var sourceHeight = clipRectangle.height * _pixelRatioSource;
 var destinationX = clipRectangle.x + _destinationX;
 var destinationY = clipRectangle.y + _destinationY;
 var destinationWidth = clipRectangle.width;
 var destinationHeight = clipRectangle.height;

 renderStateContext.drawImageScaledFromSource(_source,
     sourceX, sourceY, sourceWidth, sourceHeight,
     destinationX, destinationY, destinationWidth, destinationHeight);
}
</pre>
</div>
</div>
<div class="method"><h4 id="setPixel">
<button class="show-code">Code</button>
void <strong>setPixel</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> color) <a class="anchor-link" href="#setPixel"
              title="Permalink to BitmapData.setPixel">#</a></h4>
<div class="doc">
<pre class="source">
void setPixel(int x, int y, int color) {
 setPixel32(x, y, color | 0xFF000000);
}
</pre>
</div>
</div>
<div class="method"><h4 id="setPixel32">
<button class="show-code">Code</button>
void <strong>setPixel32</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> x, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> y, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> color) <a class="anchor-link" href="#setPixel32"
              title="Permalink to BitmapData.setPixel32">#</a></h4>
<div class="doc">
<pre class="source">
void setPixel32(int x, int y, int color) {

 var imageData = createImageData(1, 1);
 var pixels = imageData.width * imageData.height;
 var data = imageData.data;

 var c0 = ((color | 0) &gt;&gt; 24) &amp; 0xFF;
 var c1 = ((color | 0) &gt;&gt; 16) &amp; 0xFF;
 var c2 = ((color | 0) &gt;&gt;  8) &amp; 0xFF;
 var c3 = ((color | 0)      ) &amp; 0xFF;

 for(int p = 0; p &lt; pixels; p++) {
   data[p * 4 + 0] = _isLittleEndianSystem ? c1 : c0;
   data[p * 4 + 1] = _isLittleEndianSystem ? c2 : c3;
   data[p * 4 + 2] = _isLittleEndianSystem ? c3 : c2;
   data[p * 4 + 3] = _isLittleEndianSystem ? c0 : c1;
 }

 putImageData(imageData, x, y);
}
</pre>
</div>
</div>
<div class="method"><h4 id="sliceIntoFrames">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/List.html" ref="external">List</a>&lt;<a href="../stagexl/BitmapData.html">BitmapData</a>&gt; <strong>sliceIntoFrames</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> frameWidth, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> frameHeight, [<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> frameCount]) <a class="anchor-link" href="#sliceIntoFrames"
              title="Permalink to BitmapData.sliceIntoFrames">#</a></h4>
<div class="doc">
<pre class="source">
List&lt;BitmapData&gt; sliceIntoFrames(int frameWidth, int frameHeight, [int frameCount]) {
 int rows = (height ~/ frameHeight), cols = (width ~/ frameWidth);
 var frames = new List&lt;BitmapData&gt;();
 if (frameCount == null) {
   frameCount = rows * cols;
 }
 loop:
 for(var y = 0; y &lt; height; y += frameHeight) {
   for(var x = 0; x &lt; width; x += frameWidth) {
     if (frames.length &gt;= frameCount) { break loop; }
     var bitmapData = new BitmapData._default(frameWidth, frameHeight)
       .._sourceX = x
       .._sourceY = y
       .._source  = _source
       .._renderMode = 2;

     frames.add(bitmapData);
   }
 }
 return frames;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-12-26 08:49:52.264</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
