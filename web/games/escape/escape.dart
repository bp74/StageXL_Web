import "dart:html" as iC;import "dart:async" as gB;import "dart:json" as qH;import "dart:web_audio" as bF;import "dart:math" as TB;class rH{static const  sH="Chrome";static const  tH="Firefox";static const  uH="Internet Explorer";static const  vH="Safari";final  EH;final  WH;const rH(this.EH,[this.WH]);}class wH{final  name;const wH(this.name);}class yH extends BB implements qB{var iI;var tI;yH( h){this.VB=false;tI=0.0;iI=FB.hD(h);n(iI);IB(AB.wC,(g)=>p.add(this));IB(AB.yC,(g)=>p.remove(this));} BC( g){tI+= g;this.ZB=TB.sin(tI*7)*10*TB.PI/180;return true;}}class dB{static var KB;}class dF extends BB{var hI;var qI;var AJ;var GJ;var JJ;dF(){AJ=dB.KB.jB("Warning");GJ=null;hI=FB.pF();qI=new CB(hI[0]);n(qI);} start(){GJ=AJ.play();p.remove(JJ);JJ=new PC(0,80,9.0,MB.QC);JJ.KC=(h){var g=h.toInt()%8;qI.RB=hI[(g<=4)?g+1:8-g];};p.add(JJ);} stop(){if(GJ!=null){GJ.stop();GJ=null;}p.remove(JJ);qI.RB=hI[0];}}class eF extends BB{var MJ;var TJ;var YJ;var cJ;var fJ;var gJ;var hJ;var iJ;var jJ;var lJ;var mJ;var nJ;var oJ;var pJ;var qJ;var rJ;var tJ;var uJ;var vJ;var wJ;eF( EB, s, JB, m, o, w, k){iJ=new TB.Random();jJ=xB.rC;lJ=k;MJ=EB;TJ=s;YJ=JB;cJ=m;fJ=o;gJ=w;hJ=k.length;pJ=new List<PB>();rJ=new BB();tJ=new BB();uJ=new BB();vJ=new BB();wJ=new BB();n(rJ);n(tJ);n(uJ);n(vJ);n(wJ);tJ.VB=false;uJ.VB=false;vJ.VB=false;wJ.VB=false;QH();RH();PH();qJ=true;var l=new qC();this.mask=new nD.UI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=nJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.kB(rJ,tJ,uJ);var j=new PC(i.y,h*50+25,0.4,MB.rB);j.TC=g*0.03;j.KC=(SB){i.y=SB;};j.onComplete=(){if(l.XD()==100){EK();qJ=false;pJ.clear();this.mask=null;}};p.add(j);}}IB(q.PD,FK);} ZF( g){if(g==xB.dD)jJ=g;if(g==xB.eD&&jJ==xB.rC){jJ=g;if(qJ==false)dispatchEvent(new bB(bB.gD,null));}} FF(){this.mask=new nD.UI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=nJ[i+h*10];g.cB=false;g.JC=false;g.DB=u.ED;g.kB(rJ,tJ,uJ);var j=new PC(g.y,500+h*50+25,0.5,MB.rB);j.TC=i*0.1;j.KC=(k){g.y=k;};p.add(j);}}} QH(){oJ=new List<DD>();for(int h=0;h<TJ;h++ ){var g=new DD(h);g.ZB=(iJ.nextInt(30)-15)*TB.PI/180;g.x=300-(90*TJ)/2+h*90+iJ.nextInt(20)-10;g.y=550;oJ.add(g);vJ.n(g);}} CF( g, h){var i=0;var j=nJ[g+h*10];if(j.direction==0){var l=(g>0)?nJ[g-1+h*10]:null;var m=(g<9)?nJ[g+1+h*10]:null;if(j.aC(l))i++ ;if(j.aC(m))i++ ;}else{var k=(h>0)?nJ[g+(h-1)*10]:null;var o=(h<9)?nJ[g+(h+1)*10]:null;if(j.hC(k))i++ ;if(j.hC(o))i++ ;}return i;} BF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=nJ[g+h*10];var i=hJ*2;while (CF(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<lJ.length;j++ )if(k.color==lJ[j])m=j;k.color=lJ[(m+1)%lJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(CF(g,h)==2);return l;} QF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(nJ[(h-1)+g*10].VD(nJ[h+g*10])&&nJ[h+g*10].VD(nJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(nJ[h+(g-1)*10].VD(nJ[h+g*10])&&nJ[h+g*10].VD(nJ[h+(g+1)*10]))return true;return false;} LK( j, l, k){for(int g=0;g<20;g++ ){var h=MJ~/k;var i=l*h+iJ.nextInt(h);if(mJ[i].DB==u.ED){mJ[i].DB=j;return;}}} RH(){mJ=new List<HB>();for(int g=0;g<MJ;g++ ){var i=lJ[iJ.nextInt(lJ.length)];var h=iJ.nextInt(2);mJ.add(new HB(i,h));}for(int g=0;g<TJ*2;g++ )LK("Lock${(g%TJ)+1}",g,TJ*2);for(int g=0;g<YJ;g++ )LK(u.OB,g,YJ);for(int g=0;g<cJ;g++ )LK(u.yB,g,cJ);for(int g=0;g<fJ;g++ )LK(u.QE,g,fJ);for(int g=0;g<gJ;g++ )LK(u.RE,g,gJ);} PH(){nJ=new List<HB>();var g=true;while (g){nJ.clear();for(int h=0;h<100;h++ ){var j=lJ[iJ.nextInt(lJ.length)];var i=iJ.nextInt(2);nJ.add(new HB(j,i));}g=BF();}} VF(){if(qJ||jJ!=xB.rC)return false;var l=true;qJ=true;while (l){for(int k=0;k<nJ.length;k++ ){var g=nJ[k];g.cB=false;g.JC=false;g.kB(rJ,tJ,uJ);g.color=lJ[iJ.nextInt(lJ.length)];g.direction=iJ.nextInt(2);}l=BF()||(QF()==false);}var s=dB.KB.jB("BonusUniversal");s.play();var m=new qC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=nJ[i+j*10];g.WF=0.0;var h=new PC(0.0,1.0,0.2,MB.QC);h.TC=i*0.06;h.KC=(o){g.WF=o;};h.onStart=(){g.kB(rJ,tJ,uJ);};h.onComplete=(){if(m.XD()==100){EK();MK();pJ.clear();}};p.add(h);}}return true;} EK(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=nJ[h+i*10];var l=(h<9)?nJ[h+1+i*10]:null;var m=(i<9)?nJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.aC(l)){j=true;k=(g.DB==u.OB||l.DB==u.OB);}if(g.hC(m)){j=true;k=(g.DB==u.OB||m.DB==u.OB);}if(g.cB!=j||g.JC!=k){g.cB=j;g.JC=k;g.kB(rJ,tJ,uJ);}}}} OK( w, l, o, k, m, s){qJ=true;w.XD(k);var i=1;for(int h=0;h<k;h++ ){var g=nJ[l+h*m+(o+h*s)*10];if(g.DB==u.QE)i=i*2;if(g.DB==u.RE)i=i*5;var JB=l+h*m;var SB=o+h*s;p.eB((){g.empty=true;g.kB(rJ,tJ,uJ);var EB=dB.KB.jB("ChainBlast");EB.play();var j=new OE(g.color,g.direction);j.x=JB*50;j.y=SB*50;p.add(j);wJ.n(j);eH(g);if(w.DF()==0)QK();},0.1+h*0.1);}dispatchEvent(new bB(bB.OE,{"Length":k,"Factor":i}));} MK(){qJ=false;var j=new qC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&nJ[i+g-1+h*10].aC(nJ[i+g+h*10]))g++ ;if(g>=3)OK(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&nJ[i+(h+g-1)*10].hC(nJ[i+(h+g)*10]))g++ ;if(g>=3)OK(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(jJ==xB.dD)dispatchEvent(new bB(bB.PE,null));if(jJ==xB.eD)dispatchEvent(new bB(bB.gD,null));if(jJ==xB.rC&&QF()==false)VF();}} eH( h){if(h.DB.indexOf("Lock")==0){var k=int.parse(h.DB.substring(4,5))-1;var j=oJ[k];var g=FB.hD(h.DB);g.x=h.x;g.y=h.y;n(g);var i=new lB(g,0.5,MB.rB);i.YB("x",j.x);i.YB("y",j.y-10);i.onComplete=()=>tB(g);p.add(i);p.eB(()=>YH(k),0.5);}} YH( k){var h=oJ[k];var i;if(h.BD){i=new bB(bB.FD,{"Type":"SingleLocked","Position":new PB(h.x+20,h.y)});var l=dB.KB.jB("Unlock");l.play();}else{i=new bB(bB.FD,{"Type":"SingleUnlocked","Position":new PB(h.x+20,h.y)});}dispatchEvent(i);h.BD=false;h.UF(false);var j=true;for(int g=0;g<oJ.length;g++ )j=j&&(oJ[g].BD==false);if(j){var m=dB.KB.jB("BonusAllUnlock");m.play();for(int g=0;g<oJ.length;g++ ){oJ[g].BD=true;p.eB(()=>oJ[(g+k)%oJ.length].kH(),g*0.2);}p.eB(()=>dispatchEvent(new bB(bB.FD,{"Type":"All","Position":new PB(280,550)})),0.75);}} QK(){var o=new qC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&nJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&nJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=nJ[i+j*10];if(i>0){l=nJ[i-1+j*10];if(h.aC(l)){l.cB=false;l.kB(rJ,tJ,uJ);}}h.cB=false;h.empty=true;h.kB(rJ,tJ,uJ);}else{if(mJ.length>0){h=mJ[0];mJ.removeRange(0,1);}else{h=new HB(lJ[iJ.nextInt(lJ.length)],iJ.nextInt(2));}}g=nJ[i+k*10];g.color=h.color;g.direction=h.direction;g.DB=h.DB;g.cB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.kB(rJ,tJ,uJ);o.XD();var m=new PC(g.y,50*k+25,0.1,MB.QC);m.KC=(s){g.y=s;};m.onComplete=(){if(o.DF()==0){EK();MK();SK();}};p.add(m);}}}} FK( g){if(g.target==rJ&&this.VB){var j=TB.min(g.IF/50,9).toInt();var h=TB.min(g.JF/50,9).toInt();var i=new PB(j,h);pJ.add(i);SK();}} SK(){while (jJ==xB.rC&&qJ==false&&pJ.length>0){var m=pJ[0];pJ.removeRange(0,1);var j=m.x.toInt();var k=m.y.toInt();var g=nJ[j+k*10];var i=(j>0)?nJ[j-1+k*10]:null;var o=(j<9)?nJ[j+1+k*10]:null;var h=(k>0)?nJ[j+(k-1)*10]:null;var s=(k<9)?nJ[j+(k+1)*10]:null;var l=false;if(g.DB==u.yB){var EB=dB.KB.jB("ChainError");EB.play();continue;}if(g.hC(h)){h.cB=false;h.kB(rJ,tJ,uJ);}if(g.aC(i)){i.cB=false;i.kB(rJ,tJ,uJ);}g.direction=1-g.direction;g.cB=false;g.JC=false;var JB=dB.KB.jB("ChainRotate");JB.play();if(g.aC(o)){g.cB=true;g.JC=(g.DB==u.OB||o.DB==u.OB);}if(g.hC(s)){g.cB=true;g.JC=(g.DB==u.OB||s.DB==u.OB);}g.kB(rJ,tJ,uJ);l=l||g.cB;if(g.hC(h)){h.cB=true;h.JC=(g.DB==u.OB||h.DB==u.OB);h.kB(rJ,tJ,uJ);l=true;}if(g.aC(i)){i.cB=true;i.JC=(g.DB==u.OB||i.DB==u.OB);i.kB(rJ,tJ,uJ);l=true;}if(l){var w=dB.KB.jB("ChainLink");w.play();}MK();}}}class bB extends AB{static const  OE="Explosion";static const  FD="Unlocked";static const  PE="Finalized";static const  gD="Timeouted";var SJ;bB( h, g,[ bubbles=false]):super(h,bubbles){SJ=g;} get info{return SJ;}}class xB{static const  rC=1;static const  dD=2;static const  eD=3;}class NE extends BB{var cI;NE( j){var g=new NC();g.SC=new YE("Arial",30,0xFFFFFF,CC:true,align:pB.OC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.VB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;cI=new BB();cI.n(g);n(cI);var i=new PC(0.0,1.0,1.5,MB.rB);i.KC=(h){cI.alpha=1-h;cI.y=-h*50;cI.uB=1.0+0.1*TB.sin(h*10);cI.DC=1.0+0.1*TB.cos(h*10);};i.onComplete=(){this.FE();};p.add(i);}}class hF extends BB{var eI;var mI;var wI;var nI;hF(){var m=new CB(FB.KB.t("ExitBox"));n(m);var g=new NC();g.SC=new YE("Arial",24,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=100;g.wordWrap=true;g.text=dC.KB.oC("GENexitquery");g.x=47;g.y=150-g.IE/2;g.VB=false;n(g);eI=new oD(7,FB.KB.t("ExitGauge"),JD.vD);eI.x=268;eI.y=25;eI.IB("TimeOver",xJ);n(eI);eI.TD("TimeOver",0);eI.start();var i=new CB(FB.KB.t("ExitYesButtonNormal"));var j=new CB(FB.KB.t("ExitYesButtonPressed"));mI=new tC(i,i,j,j);mI.x=68;mI.y=239;mI.IB(q.ZC,AK);n(mI);var h=new CB(FB.KB.t("ExitNoButtonNormal"));var k=new CB(FB.KB.t("ExitNoButtonPressed"));wI=new tC(h,h,k,k);wI.x=173;wI.y=232;wI.IB(q.ZC,CK);n(wI);this.IB(AB.wC,(l)=>p.add(eI));this.IB(AB.yC,(l)=>p.remove(eI));} DK( g){if(nI!=null){nI(g);nI=null;}} AK( g){DK(true);} CK( g){DK(false);} xJ( g){DK(false);}show( g){nI=g;}}class cD{var yE;var XF;var YF;var angle;var aF;var ZB;}class HB{var ZI;var aI;var jI;var pI;var uI;var xI;var DJ;var HJ;var KJ;var OJ;var RJ;HB( h, g){ZI=h;aI=g;jI=u.ED;pI=-1000;uI=-1000;xI=false;DJ=false;HJ=false;KJ=null;OJ=null;RJ=null;} get color=>ZI; set color( g){ZI=g;} get direction=>aI; set direction( g){aI=g;} get DB=>jI; set DB( g){jI=g;} get cB=>xI; set cB( g){xI=g;} get JC=>DJ; set JC( g){DJ=g;} get empty=>HJ; set empty( g){HJ=g;} VD( g){var h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.DB!=u.yB&&jI!=u.yB;return h;} aC( g){var h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.direction==0&&aI==0&&g.DB!=u.yB&&jI!=u.yB;return h;} hC( g){var h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.direction==1&&aI==1&&g.DB!=u.yB&&jI!=u.yB;return h;} get x=>pI; set x( g){pI=g;if(KJ!=null)KJ.x=g;if(OJ!=null)OJ.x=g;if(RJ!=null)RJ.x=g;} get y=>uI; set y( g){uI=g;if(KJ!=null)KJ.y=g;if(OJ!=null)OJ.y=g;if(RJ!=null)RJ.y=g;} set WF( h){if(KJ!=null){var g=1+0.3*TB.sin(h*TB.PI);KJ.uB=g;KJ.DC=g;}} kB( g, h, i){if(KJ!=null){KJ.parent.tB(KJ);KJ=null;}if(OJ!=null){OJ.parent.tB(OJ);OJ=null;}if(RJ!=null){RJ.parent.tB(RJ);RJ=null;}if(empty==false){switch (jI){case u.OB:KJ=new zH(aI);KJ.x=pI;KJ.y=uI;g.n(KJ);break;case u.yB:KJ=FB.hD(u.yB);KJ.x=pI;KJ.y=uI;g.n(KJ);break;default:KJ=FB.fD(ZI,aI);KJ.x=pI;KJ.y=uI;g.n(KJ);break;}if(xI){OJ=DJ?new xH(aI):FB.iF(ZI,aI);OJ.x=pI+((aI==0)?25:0);OJ.y=uI+((aI==1)?25:0);h.n(OJ);}switch (jI){case u.ED:break;case u.yB:break;case u.OB:break;default:RJ=new yH(jI);RJ.x=pI;RJ.y=uI;i.n(RJ);break;}}}}class fF extends BB{var dI;var lI;var vI;var EJ;var eI;var IJ;var LJ;var NJ;var QJ;var bI;var UJ;var VJ;var WJ;var XJ;var ZJ;var aJ;var bJ;var dJ;var eJ;fF(){var j=new CB(FB.KB.t("ShuffleButtonNormal"));var h=new CB(FB.KB.t("ShuffleButtonPressed"));lI=new tC(j,j,h,h);lI.IB(q.ZC,sJ);lI.x=530;lI.y=525;n(lI);var g=new CB(FB.KB.t("ExitButtonNormal"));var i=new CB(FB.KB.t("ExitButtonPressed"));vI=new tC(g,g,i,i);vI.IB(q.ZC,zJ);vI.x=700;vI.y=500;n(vI);dI=new gF();dI.x=540;dI.y=-1000;n(dI);eI=new oD(10,FB.KB.t("TimeGauge"),JD.rD);eI.x=659;eI.y=244;eI.IB("TimeShort",BK);eI.IB("TimeOver",xJ);n(eI);p.add(eI);IJ=new cF();IJ.x=640;IJ.y=230;n(IJ);LJ=new dF();LJ.x=665;LJ.y=160;n(LJ);NJ=new NC();NJ.SC=new YE("Arial",30,0xD0D0D0,CC:true,align:pB.OC);NJ.width=140;NJ.height=36;NJ.wordWrap=false;NJ.x=646;NJ.y=130;NJ.VB=false;NJ.text="0";NJ.uB=0.9;n(NJ);QJ=new NC();QJ.SC=new YE("Arial",20,0xFFFFFF,CC:true,align:pB.OC);QJ.width=44;QJ.height=30;QJ.wordWrap=false;QJ.x=610;QJ.y=559;QJ.VB=false;QJ.text="3x";n(QJ);ZJ=new BB();n(ZJ);aJ=new BB();n(aJ);bJ=new BB();n(bJ);dJ=dB.KB.jB("Intro");eJ=dJ.play();} start(){bI=1;UJ=1;XJ=0;VJ=3;var g=new bD(dC.KB.oC("ESCStartText"));aJ.n(g);p.eB(()=>IJ.OF(21),1);g.show(()=>p.eB(()=>GK(),0.5));} GK(){if(EJ!=null&&this.contains(EJ))ZJ.tB(EJ);var m=bI;var g=0;var h=0;switch (bI){case 01:h=50;EJ=new eF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;EJ=new eF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;EJ=new eF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;EJ=new eF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;EJ=new eF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;EJ=new eF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;EJ=new eF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;EJ=new eF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;EJ=new eF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;EJ=new eF(g=80+(bI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}WJ=g;if(VJ<3){VJ++ ;QJ.text="${VJ}x";}EJ.IB(bB.OE,HK);EJ.IB(bB.FD,IK);EJ.IB(bB.PE,JK);EJ.IB(bB.gD,KK);EJ.x=20;EJ.y=16;EJ.VB=false;ZJ.n(EJ);eI.reset(h);eI.TD("TimeShort",9);eI.TD("TimeOver",0);eI.pause();dI.level=m;dI.zE=g;dI.y=-210;var k=new lB(dI,0.4,MB.rB);k.YB("y",-90);p.add(k);var j=new bD(dC.KB.oC("ESCLevelBoxText").replaceAll("{0}","${g}"));aJ.n(j);j.show((){EJ.VB=true;eI.start();if(dJ!=null){var i=new PC(1.0,0.0,4.0,MB.QC);i.KC=(l){eJ.EC.volume=l;eJ.EC=eJ.EC;};i.onComplete=(){eJ.stop();IJ.XH();};p.add(i);dJ=null;}});} BK( g){LJ.start();} xJ( g){EJ.ZF(xB.eD);} IK( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new NE(g);i.x=k.x;i.y=k.y;ZJ.n(i);XJ=XJ+g;NJ.text="${XJ}";} HK( j){var g=WJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;WJ=g;dI.zE=g;if(g==0)EJ.ZF(xB.dD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}XJ=XJ+h*k;NJ.text="${XJ}";} JK( m){eI.pause();LJ.stop();var l=dB.KB.jB("Laugh");var k=dB.KB.jB("LevelUp");l.play();IJ.OF(3);var g=FB.jF();g.x=55;g.y=260;ZJ.n(g);p.eB((){EJ.FF();k.play();},2.0);p.eB((){var j=(eI.hH*1000).toInt();var h=new NE(j);h.x=704;h.y=360;ZJ.n(h);XJ=XJ+j;NJ.text="${XJ}";},2.5);var i=new lB(dI,0.5,MB.rB);i.YB("y",-210);i.TC=3.0;p.add(i);p.eB((){ZJ.tB(g);},3.5);p.eB((){bI++ ;GK();},4.0);} KK( j){LJ.stop();EJ.FF();var g;var i;if(UJ>0){UJ-- ;g=new bD(dC.KB.oC("GEN2ndchancetime"));aJ.n(g);i=dB.KB.jB("LevelUp");i.play();g.show((){p.eB(()=>GK(),0.5);var h=new lB(dI,0.5,MB.rB);h.YB("y",-210);p.add(h);});}else{g=new bD(dC.KB.oC("GENtimeup"));aJ.n(g);i=dB.KB.jB("GameOver");i.play();g.show((){p.eB(()=>NK(),0.5);var h=new lB(dI,0.5,MB.rB);h.YB("y",-210);p.add(h);});}} sJ( h){if(EJ!=null&&VJ>0){var g=EJ.VF();if(g){VJ=VJ-1;QJ.text="${VJ}x";}}} zJ( j){var h=new BB();h.n(new CB(new GB(800,600,false,0x000000)));h.alpha=0.6;bJ.n(h);var g=new hF();g.x=235;g.y=150;bJ.n(g);g.show(( i){bJ.tB(g);if(i==false)bJ.tB(h);else PK(false);});}NK(){var h=new BB();var j=new CB(FB.KB.t("ExitBox"));h.n(j);var g=new NC();g.SC=new YE("Arial",30,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=200;g.wordWrap=true;g.text=dC.KB.oC("GENgameover");g.x=47;g.y=30+(g.height-g.IE)/2;g.VB=false;h.n(g);h.x=110;h.y=-h.height;aJ.n(h);var k=dB.KB.jB("Laugh");p.eB(()=>k.play(),0.3);var i=new lB(h,0.3,MB.rB);i.YB("y",150);p.add(i);p.eB(()=>PK(true),5.0);h.IB(q.ZC,( l)=>PK(true));}var RK=false; PK( g){eI.pause();if(RK==false){RK=true;}}}class FB{static var KB;static  fD( i, h){var g=new CB(KB.UC("Elements").t("Chain${i}${h}"));g.WC=25;g.XC=25;return g;}static  iF( i, h){var g=new CB(KB.UC("Elements").t("Link${i}${h}"));g.WC=25;g.XC=25;return g;}static  hD( h){var g=new CB(KB.UC("Elements").t(h));g.WC=25;g.XC=25;return g;}static  jF(){var m=new BB();var l=0;var o=KB.UC("Levelup");for(int k=0;k<7;k++ ){var g=new CB(o.t("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new BB();h.n(g);h.x=l+g.width/2;h.uB=0;h.DC=0;m.n(h);var i=new lB(h,2.0,MB.BH);i.YB("scaleX",1.0);i.YB("scaleY",1.0);i.TC=k*0.05;var j=new lB(h,0.4,MB.QC);j.YB("scaleX",0.0);j.YB("scaleY",0.0);j.TC=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  lF( h){var i=KB.UC("Elements");var g=new List<GB>();g.add(i.t("JokerChain${h}0"));g.add(i.t("JokerChain${h}1"));g.add(i.t("JokerChain${h}2"));g.add(i.t("JokerChain${h}3"));g.add(i.t("JokerChain${h}4"));return g;}static  mF( h){var i=KB.UC("Elements");var g=new List<GB>();g.add(i.t("JokerLink${h}0"));g.add(i.t("JokerLink${h}1"));g.add(i.t("JokerLink${h}2"));g.add(i.t("JokerLink${h}3"));g.add(i.t("JokerLink${h}4"));return g;}static  nF( h){var i=KB.UC("Locks");var g=new List<GB>();g.add(i.t("Lock${h}0"));g.add(i.t("Lock${h}1"));g.add(i.t("Lock${h}2"));g.add(i.t("Lock${h}3"));g.add(i.t("Lock${h}4"));return g;}static  oF(){var h=KB.UC("Head");var g=new List<GB>();g.add(h.t("Head1"));g.add(h.t("Head2"));g.add(h.t("Head3"));g.add(h.t("Head2"));g.add(h.t("Head1"));return g;}static  pF(){var h=KB.UC("Alarm");var g=new List<GB>();g.add(h.t("Alarm0"));g.add(h.t("Alarm1"));g.add(h.t("Alarm2"));g.add(h.t("Alarm3"));g.add(h.t("Alarm4"));g.add(h.t("Alarm5"));return g;}}class cF extends BB{var fI;var oI;var BJ;cF(){fI=FB.oF();oI=new CB(fI[0]);oI.x=-oI.width/2;oI.y=-oI.height/2;n(oI);BJ=null;} OF( g){p.remove(BJ);BJ=new PC(0,g,0.5*g,MB.QC);BJ.KC=(h){var i=((h*fI.length)%fI.length).toInt();oI.RB=fI[i];oI.y=TB.sin(h*2*TB.PI)*3-oI.height/2;};p.add(BJ);} XH(){p.remove(BJ);oI.RB=fI[0];}}class gF extends BB{var bI;var kI;var rI;var zI;var FJ;gF(){n(new CB(FB.KB.t("InfoBox")));kI=new NC();kI.SC=new YE("Arial",35,0xFFFFFF,CC:true,align:pB.OC);kI.width=220;kI.height=40;kI.wordWrap=false;kI.text="Level 1";kI.x=20;kI.y=115;kI.ZB=-2*TB.PI/180;n(kI);zI=new NC();zI.SC=new YE("Arial",25,0xFFFFFF,CC:true,align:pB.OC);zI.width=220;zI.height=30;zI.wordWrap=false;zI.text="40";zI.x=-zI.width/2;zI.y=-zI.height/2;zI.ZB=-2*TB.PI/180;FJ=new BB();FJ.n(zI);FJ.x=150;FJ.y=172;n(FJ);var g=FB.fD(3,0);g.x=110;g.y=171;g.ZB=-2*TB.PI/180;g.uB=g.DC=0.6;n(g);} set level( g){bI=g;kI.text="Level ${bI}";} set zE( g){rI=g;zI.text="${rI}";}}class DD extends BB{var ZI;var iI;var sI;var CJ;DD( g){ZI=g;sI=FB.nF(g);CJ=true;iI=new CB(sI[0]);iI.x=-34;iI.y=-50;n(iI);} get BD=>CJ; set BD( g){CJ=g;} UF( g){iI.RB=sI[g?0:4];} kH(){var i=new PC(0.0,1.0,2.0,MB.rB);i.KC=(j){uB=DC=1.0+0.2*TB.sin(j*4*TB.PI);};var g=new lB(this,0.2,MB.rB);g.YB("alpha",0.0);g.TC=2.0;g.onComplete=()=>UF(CJ);var h=new lB(this,0.2,MB.vE);h.YB("alpha",1);h.TC=2.2;p.add(i);p.add(g);p.add(h);}}class bD extends BB{var gI;var nI;bD( h){var i=new CB(FB.KB.t("MessageBox"));n(i);var g=new NC();g.SC=new YE("Arial",24,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.IE/2;g.VB=false;n(g);gI=null;IB(q.ZC,kJ);}void show( h){this.parent.n(this);this.x=-this.width;this.y=150;nI=h;var g=new lB(this,0.3,MB.rB);g.YB("x",110);g.onComplete=()=>gI=p.eB(yJ,10);p.add(g);} yJ(){if(gI!=null){p.remove(gI);gI=null;nI();var g=new lB(this,0.4,MB.vE);g.YB("x",800);g.onComplete=()=>this.parent.tB(this);p.add(g);}} kJ( g){yJ();}}class u{static const  ED="None";static const  OB="Joker";static const  yB="Block";static const  QE="Double";static const  RE="Quint";}class qC{var value=0; XD([ inc=1])=>(value+= inc); DF([ dec=1])=>(value-= dec);}class dC{static var KB;}class xH extends BB implements qB{var iI;var yI;var tI;xH( g){this.VB=false;tI=0.0;yI=FB.mF(g);iI=new CB(yI[0]);iI.x=-25;iI.y=-25;n(iI);IB(AB.wC,(h)=>p.add(this));IB(AB.yC,(h)=>p.remove(this));} BC( g){tI+= g;var h=(tI*10).toInt()%yI.length;iI.RB=yI[h];return true;}}class zH extends BB implements qB{var iI;var yI;var tI;zH( g){this.VB=false;tI=0.0;yI=FB.lF(g);iI=new CB(yI[0]);iI.x=-25;iI.y=-25;n(iI);IB(AB.wC,(h)=>p.add(this));IB(AB.yC,(h)=>p.remove(this));} BC( g){tI+= g;var h=(tI*10).toInt()%yI.length;iI.RB=yI[h];return true;}}class OE extends BB implements qB{var PJ;var tI;OE( s, o){PJ=new List<cD>();tI=0.0;this.VB=false;var w=FB.fD(s,o);var m=new TB.Random();var i;var l;var EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=TB.PI*1.15;ZB=-TB.PI*2;}if(g==1&&h==0){i=TB.PI*1.85;ZB=TB.PI*2;}if(g==1&&h==1){i=TB.PI*0.15;ZB=TB.PI*2;}if(g==0&&h==1){i=TB.PI*0.85;ZB=-TB.PI*2;}i=i+0.2*TB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new CB(w.RB);j.UD=new QB(g*25,h*25,25,25);j.WC=12.5+g*25;j.XC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);var k=new cD();k.yE=j;k.XF=g*25+12.5;k.YF=h*25+12.5;k.angle=i;k.aF=l;k.ZB=ZB;PJ.add(k);}}} BC( m){tI=TB.min(0.8,tI+m);var w=981.0;for(int h=0;h<PJ.length;h++ ){var g=PJ[h];var i=g.yE;var j=g.angle;var k=g.aF;var l=g.ZB;var o=g.XF+tI*(TB.cos(j)*k);var s=g.YF+tI*(TB.sin(j)*k+tI*w*0.5);i.x=o;i.y=s;i.ZB=tI*l;}if(tI>=0.6)this.alpha=(0.8-tI)/0.2;if(tI>=0.8)this.FE();return (tI<0.8);}}var GD;var eC;var HD;var p;var YC;var ID;var zB; main(){GD=new nC("StageBackground",iC.query('#stageBackground'));eC=new nC("StageForeground",iC.query('#stageForeground'));HD=new rF();HD.xE(GD);HD.xE(eC);p=HD.TH;var g=GB.wE("images/Loading.png");g.then((h){YC=new CB(h);YC.WC=20;YC.XC=20;YC.x=400;YC.y=270;eC.n(YC);ID=new lB(YC,100,MB.QC);ID.YB("rotation",100.0*2.0*TB.PI);p.add(ID);zB=new NC();zB.SC=new YE("Arial",20,0xA0A0A0,CC:true);zB.width=240;zB.height=40;zB.text="... loading ...";zB.x=400-zB.lH/2;zB.y=320;zB.VB=false;eC.n(zB);kF();});} kF(){var g=new ND();g.iB("Background","images/Background.jpg");g.iB("ExitBox","images/ExitBox.png");g.iB("ExitButtonNormal","images/ExitButtonNormal.png");g.iB("ExitButtonPressed","images/ExitButtonPressed.png");g.iB("ExitGauge","images/ExitGauge.png");g.iB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.iB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.iB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.iB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.iB("InfoBox","images/InfoBox.png");g.iB("MessageBox","images/MessageBox.png");g.iB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.iB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.iB("TimeGauge","images/TimeGauge.png");g.zC("Alarm","images/AlarmTextureAtlas.json",fC.mC);g.zC("Head","images/HeadTextureAtlas.json",fC.mC);g.zC("Elements","images/ElementsTextureAtlas.json",fC.mC);g.zC("Levelup","images/LevelupTextureAtlas.json",fC.mC);g.zC("Locks","images/LocksTextureAtlas.json",fC.mC);g.aB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.aB("BonusUniversal","sounds/BonusUniversal.mp3");g.aB("ChainBlast","sounds/ChainBlast.mp3");g.aB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.aB("ChainError","sounds/ChainError.mp3");g.aB("ChainFall","sounds/ChainFall.mp3");g.aB("ChainHelp","sounds/ChainHelp.mp3");g.aB("ChainLink","sounds/ChainLink.mp3");g.aB("ChainRotate","sounds/ChainRotate.mp3");g.aB("Click","sounds/Click.mp3");g.aB("GameOver","sounds/GameOver.mp3");g.aB("Laugh","sounds/Laugh.mp3");g.aB("LevelUp","sounds/LevelUp.mp3");g.aB("PointsCounter","sounds/PointsCounter.mp3");g.aB("Unlock","sounds/Unlock.mp3");g.aB("Warning","sounds/Warning.mp3");g.aB("Intro","sounds/Intro.mp3");g.mB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.mB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.mB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.mB("ESCBlockErrorHint","Sorry but block chains canÂ´t be twisted!");g.mB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.mB("ESCNoActionHint","Press on the chain links to twist them.");g.mB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.mB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.mB("ESCtogo","Chain links:");g.mB("GENexitquery","Do you really want to quit the game?");g.mB("GEN2ndchancetime","Time is up. Second chance!");g.mB("GENtimeup","Sorry! Your time is up.");g.mB("GENgameover","Game Over");g.load().then((l){eC.tB(YC);eC.tB(zB);p.remove(ID);FB.KB=g;dB.KB=g;dC.KB=g;var j=new CB(FB.KB.t("Background"));GD.n(j);GD.gH=jC.uD;var i=new fF();eC.n(i);i.start();}).catchError((k){for(var h in g.GF){print("Loading resouce failed: ${h.kind}.${h.name} - ${h.error}");}});}class pB{static const  OC="center";static const  HG="end";static const  NG="justify";static const  LG="right";}class SE{static const  JG="none";static const  OG="touchPoint";}class qF{static const  JG="none";}class VE{var ZK;var pK;var CL;var KL;var PL;var aL;var iL;var oL;var rL;var zL;var GM;VE( g, h){ZK=g;pK=h;} get mH=>pK; get name=>ZK; get JH=>CL; get KH=>KL; get IH=>PL; get HH=>aL; get offsetX=>iL; get offsetY=>oL; get aH=>rL; get ZH=>zL; get jH=>GM;}class fC{static const  zF="json";static const  mC="jsonarray";}class BI extends LC{var wK;var BL;var hK;var jL;var uL;BI( j, h, i){wK=j;hK=h;BL=i;var g=sC.SD;jL=g.createGain();jL.connect(g.destination,0,0);jL.gain.value=(BL!=null)?TB.pow(BL.volume,2):1;uL=g.createBufferSource();uL.buffer=wK.iK;uL.loop=h;uL.connect(jL,0,0);uL.start(0);} get EC=>BL; set EC( g){BL=g;jL.gain.value=(BL!=null)?TB.pow(BL.volume,2):1;} stop(){uL.stop(0);}}class kD implements qB{final  rK;var AL=0.0;var ML=0.0;var YL=1;kD( g, h):rK=g{ML=TB.max(h,0.0001);} BC( h){var g=AL+h;while (g>=ML&&YL>0){AL=ML;YL-- ;rK();g-= ML;}AL=g;return (YL>0);} get totalTime=>ML; get currentTime=>AL;}abstract class qB{ BC( g);}class iD implements qB{final  tK=new List<qB>();var SL=0;var eL=0.0; add( g){if(g==null)return;if(SL==tK.length){tK.add(g);}else{tK[SL]=g;}SL++ ;} remove( h){if(h==null)return;for(int g=0;g<SL;g++ ){if(tK[g]==h){tK[g]=null;break;}}} eB( h, i){var g=new kD(h,i);add(g);return g;} BC( k){eL+= k;var j=SL;var h=0;for(int g=0;g<j;g++ ){var i=tK[g];if(i==null)continue;if(i.BC(k)==false){tK[g]=null;continue;}if(h!=g){tK[h]=i;tK[g]=null;}h++ ;}if(h!=j){for(int g=j;g<SL;g++ ){tK[h++ ]=tK[g];tK[g]=null;}SL=h;}return true;}}class lD extends LB{var iK;lD(){if(sC.SD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  wE( o){var h=new lD();var k=LB.tE(o);var g=new gB.Completer<LB>();iC.HttpRequest.request(k,responseType:'arraybuffer').then((i){var j=i.response;var m=sC.SD;m.decodeAudioData(j,( l){h.iK=l;g.complete(h);},(s){g.completeError(new StateError("Failed to decode audio."));});}).catchError((s){g.completeError(new StateError("Failed to load audio."));});return g.future;} get length{return iK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new BI(this,loop,soundTransform);}}class vF{var name;var vB;var HE;vF(this.name,this.vB,this.HE);}class KD extends LC{var yK;var mK;var hK;var BL;KD( g, i, h){yK=g;hK=i;BL=h;mK=g.jM(this);mK.loop=hK;this.EC=h;mK.play();} get EC=>BL; set EC( g){BL=g;if(mK!=null)mK.volume=(BL!=null)?BL.volume:1;} stop(){if(mK!=null){if(mK.ended==false)mK.pause();yK.tN(this);mK=null;}}}class jD extends LB{var mK;var GL;var bL;jD(){bL=new List<KD>();mK=new iC.AudioElement();mK.onEnded.listen(QM);GL=new List<iC.AudioElement>();GL.add(mK);iC.document.body.children.add(mK);}static  wE( s){var k=new jD();var g=k.mK;var i=new gB.Completer<LB>();var h;var j;o(m){h.cancel();j.cancel();i.complete(k);}l(m){h.cancel();j.cancel();i.completeError(new StateError("Failed to load audio."));}h=g.onCanPlayThrough.listen(o);j=g.onError.listen(l);g.src=LB.tE(s);g.load();return i.future;} get length{return mK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new KD(this,loop,soundTransform);} jM( h){var g;if(GL.length==0){g=mK.clone(true);g.onEnded.listen(QM);}else{g=GL.removeAt(0);}bL.add(h);return g;} tN( g){var h=g.mK;var i=bL.indexOf(g);bL.removeAt(i);GL.add(h);if(mK.currentTime>0&&mK.ended==false)mK.currentTime=0;} QM(j){var i=j.target;var g=null;for(int h=0;h<bL.length&&g==null;h++ )if(bL[h].mK==i)g=bL[h];if(g!=null)g.stop();}}class PB{var x;var y;PB(this.x,this.y);PB.TI():this(0,0); get length=>TB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new PB(this.x+g.x,this.y+g.y); CE( g){this.x=g.x;this.y=g.y;} equals( g)=>this.x==g.x&&this.y==g.y;}class QB{var x;var y;var width;var height;QB(this.x,this.y,this.width,this.height);QB.TI():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new PB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0); CE( g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class uF{uF();}class UB{var UK,VK,XK,YK,aK,dK;var lK;UB.VI():UK=1.0,VK=0.0,XK=0.0,YK=1.0,aK=0.0,dK=0.0,lK=1.0; get a=>UK; get b=>VK; get c=>XK; get d=>YK; get FC=>aK; get GC=>dK; get bC=>lK; nH( g){return new PB(g.x*UK+g.y*XK+aK,g.x*VK+g.y*YK+dK);} concat( g){var m=UK;var w=VK;var EB=XK;var s=YK;var l=aK;var o=dK;var SB=lK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var fB=g.FC;var JB=g.GC;var wB=g.bC;UK=(m*j+w*i);VK=(m*k+w*h);XK=(EB*j+s*i);YK=(EB*k+s*h);aK=(l*j+o*i+fB);dK=(l*k+o*h+JB);lK=(SB*wB);} MH(){UK=1.0;VK=0.0;XK=0.0;YK=1.0;aK=0.0;dK=0.0;lK=1.0;} SH(){var j=UK;var m=VK;var l=XK;var k=YK;var h=aK;var i=dK;var g=lK;UK=(k/g);VK=-(m/g);XK=-(l/g);YK=(j/g);aK=-(UK*h+XK*i);dK=-(VK*h+YK*i);lK=(1.0/g);} TF( h, i, g, j, k, l){UK=h;VK=i;XK=g;YK=j;aK=k;dK=l;lK=(h*j-i*g);} CE( g){UK=g.a;VK=g.b;XK=g.c;YK=g.d;aK=g.FC;dK=g.GC;lK=g.bC;} DE( h, g){var o=h.a;var EB=h.b;var JB=h.c;var w=h.d;var m=h.FC;var s=h.GC;var fB=h.bC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var wB=g.FC;var SB=g.GC;var cC=g.bC;UK=(o*k+EB*j);VK=(o*l+EB*i);XK=(JB*k+w*j);YK=(JB*l+w*i);aK=(m*k+s*j+wB);dK=(m*l+s*i+SB);lK=(fB*cC);}}class rF{var WK;var jK;var uK;var NL;var dL;rF(){WK=new iD();jK=new List<nC>();uK=double.NAN;NL=LD.lE;dL=new TE(0);iC.window.requestAnimationFrame(iM);} get TH=>WK; iM( g){iC.window.requestAnimationFrame(iM);if(uK.isNaN)uK=g;if(uK>g)uK=g;var j=g-uK;var i=j/1000.0;if(j>=1){uK=g;dL.eK=i;NL.TN(dL);WK.BC(i);for(int h=0;h<jK.length;h++ ){var k=jK[h];k.VH();}}} xE( g){jK.add(g);}}class AC{final  kK;final  FL=new List<UB>.fixedLength(100);final  lL=new List<double>.fixedLength(100);var AM=0;AC.WI( j,[ matrix]):kK=j{for(int h=0;h<100;h++ ){FL[h]=new UB.VI();lL[h]=1.0;}if(matrix!=null)FL[0].CE(matrix);var g=FL[0];var i=lL[0];kK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);kK.globalAlpha=i;} get context=>kK; reset(){AM=0;var g=FL[0];var h=lL[0];kK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);kK.globalAlpha=h;kK.clearRect(0,0,kK.canvas.width,kK.canvas.height);} SF( h){var i=AM;var j=AM+1;var l=FL[i];var g=FL[j];var m=lL[i];var k=lL[j]=h.HM*m;g.DE(h.hN,l);kK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);kK.globalAlpha=k;AM=j;if(h.mask==null){h.nB(this);}else{kK.save();h.mask.nB(this);h.nB(this);kK.restore();}AM=i;}}class hB{final  fK=new iC.ImageElement();final  TL=new List<VE>();static  wE( m, SB){var l=new gB.Completer<hB>();var j=new hB();switch (SB){case fC.zF:case fC.mC: o( k, g){var EB=nG(k);var h=new VE(EB,j);h.CL=g["frame"]["x"].toInt();h.KL=g["frame"]["y"].toInt();h.PL=g["frame"]["w"].toInt();h.aL=g["frame"]["h"].toInt();h.iL=g["spriteSourceSize"]["x"].toInt();h.oL=g["spriteSourceSize"]["y"].toInt();h.rL=g["sourceSize"]["w"].toInt();h.zL=g["sourceSize"]["h"].toInt();h.GM=g["rotated"] as bool;j.TL.add(h);}iC.HttpRequest.getString(m).then((JB){var s=qH.parse(JB);var i=s["frames"];var w=s["meta"];if(i is List)for(var g in i)o(g["filename"],g);if(i is Map)for(String k in i.keys)o(k,i[k]);j.fK..onLoad.listen((fB)=>l.complete(j))..onError.listen((fB)=>l.completeError(new StateError("Failed to load image.")))..src=rG(m,w["image"]);}).catchError((wB){l.completeError(new StateError("Failed to load json file."));});break;}return l.future;} get NH=>fK; t( i){var h;for(int g=0;g<TL.length&&h==null;g++ )if(TL[g].name==i)h=new GB.YI(TL[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}}class AB{static const  BG="added";static const  wC="addedToStage";static const  iE="enterFrame";static const  TG="removed";static const  yC="removedFromStage";var TK;var eN;var WN;var DL;var kN;var YN;var cN;AB( g,[ bubbles=false]){HN(g,bubbles);} HN( g,[ bubbles=false]){TK=g;eN=bubbles;WN=gC.OD;DL=null;kN=null;YN=false;cN=false;} get GE=>YN; get type=>TK; get bubbles=>eN; get AE=>true; get target=>DL;}class gC{static const  cE=1;static const  OD=2;static const  MG=3;}class MC{var gK; LH( g){if(gK!=null)return gK.containsKey(g)||gK.containsKey("${g}_CAPTURE");else return false;} IB( g, i(event),{ useCapture: false}){var h=CM(g,useCapture);var j=h.listen(i);return j;} dispatchEvent( g){nN(g,this,this,gC.OD);} nN( g, k, l, i){if(gK!=null){var j=(i==gC.cE)?"${g.type}_CAPTURE":g.type;var h=gK[j];if(h!=null){g.DL=k;g.kN=l;g.WN=i;g.YN=false;g.cN=false;h.TN(g);}}} CM( g, j){if(gK==null)gK=new Map<String,uC>();var i=j?"${g}_CAPTURE":g;var h=gK[i];if(h==null)h=gK[i]=new uC(this,g,j);return h;}}class LD<vC extends AB>{final  gK=new List<uC>();var VL=0;static var lE=new LD<TE>(); ZM( g){for(int h=0;h<VL;h++ )if(gK[h]==g)return;if(VL==gK.length)gK.add(g);else gK[VL]=g;VL++ ;} TN( j){j.WN=gC.OD;j.YN=false;j.cN=false;var k=VL;var i=0;for(int g=0;g<k;g++ ){var h=gK[g];if(h==null)continue;if(h.IM==0){gK[g]=null;continue;}j.DL=h.DL;j.kN=h.DL;h.TN(j);if(i!=g){gK[i]=h;gK[g]=null;}i++ ;}if(i!=k){for(int g=k;g<VL;g++ ){gK[i++ ]=gK[g];gK[g]=null;}VL=i;}}}class uC<vC extends AB> extends gB.Stream<vC>{final  DL;final  sK;final  cL;final  sL=new List<AG>();var IM=0;uC(this.DL,this.sK,this.cL); get isBroadcast=>true; asBroadcastStream()=>this; listen( h( event),{ onError( error), onDone(), unsubscribeOnError}){var g=new AG<vC>(this,h);if(IM==sL.length)sL.add(g);else sL[IM]=g;IM++ ;if(sK==AB.iE&&cL==false)LD.lE.ZM(this);return g;} zM( h){for(int g=0;g<IM;g++ ){if(sL[g]==h){sL[g]=null;break;}}} TN( k){var j=IM;var h=0;for(int g=0;g<j;g++ ){var i=sL[g];if(i==null)continue;i.vL(k);if(h!=g){sL[h]=i;sL[g]=null;}h++ ;}if(h!=j){for(int g=j;g<IM;g++ ){sL[h++ ]=sL[g];sL[g]=null;}IM=h;}}}class HC<vC extends AB>{final  sK;const HC(this.sK); forTarget( g,{ useCapture: false}){return g.CM(sK,useCapture);}}class MD{var cK;var ZK;var xK;var IL;var QL;var ZL;MD( g, h, i){cK=g;ZK=h;xK=i;QL=null;ZL=null;} get kind=>cK; get name=>ZK; get CD=>ZL; get error=>QL;KN( i){IL=i.then((g){ZL=g;QL=null;},onError:( h){ZL=null;QL=h.error;});}}class TE extends AB{var eK;TE( g):super(AB.iE,false){eK=g;} get AE=>false;}class q extends AB{static const  ZC="click";static const  KG="doubleClick";static const  PD="mouseDown";static const  wD="mouseUp";static const  oE="mouseMove";static const  RD="mouseOut";static const  pE="mouseOver";static const  cG="mouseWheel";static const  rE="middleClick";static const  gG="middleMouseDown";static const  iG="middleMouseUp";static const  sE="rightClick";static const  mG="rightMouseDown";static const  pG="rightMouseUp";var QN,RN;var UN,VN;var sN;var UM;var nM;var YM;var cM;var uN;var vN;var wN;q( g,[ bubbles=false]):super(g,bubbles){HN(g,bubbles);} HN( g,[ bubbles=false]){super.HN(g,bubbles);QN=RN=0;UN=VN=0;sN=false;UM=false;nM=false;YM=false;cM=false;uN=0;vN=0;wN=0;}set xN( g){QN=g.x;RN=g.y;}set yN( g){UN=g.x;VN=g.y;} get IF=>QN; get JF=>RN; get RC=>sN; get altKey=>UM; get ctrlKey=>YM; get shiftKey=>cM; get AD=>uN;}class IC extends AB{static const  qD="keyDown";static const  eE="keyUp";var UM;var YM;var cM;var fM;var nM;var qM;var tM;var wM;IC( g,[ bubbles=false]):super(g,bubbles){HN(g,bubbles);} HN( g,[ bubbles=false]){super.HN(g,bubbles);UM=false;YM=false;cM=false;fM=false;nM=false;qM=0;tM=0;wM=0;} get altKey=>UM; get ctrlKey=>YM; get shiftKey=>cM; get charCode=>qM; get keyCode=>tM; get keyLocation=>wM;}class aE extends AB{static const  IG="textInput";var oK="";aE( g,[ bubbles=false]):super(g,bubbles){}}class XB extends AB{static const  dE="touchBegin";static const  fE="touchEnd";static const  hE="touchCancel";static const  nE="touchMove";static const  XG="touchOver";static const  YG="touchOut";var NN;var PN;var QN,RN;var UN,VN;var UM;var nM;var YM;var cM;var ZN;var bN;var dN;XB( g,[ bubbles=false]):super(g,bubbles){HN(g,bubbles);} HN( g,[ bubbles=false]){super.HN(g,bubbles);NN=0;PN=false;QN=RN=0;UN=VN=0;UM=false;nM=false;YM=false;cM=false;ZN=1.00;bN=0;dN=0;}set xN( g){QN=g.x;RN=g.y;}set yN( g){UN=g.x;VN=g.y;} get aD=>NN; get IF=>QN; get JF=>RN; get altKey=>UM; get ctrlKey=>YM; get shiftKey=>cM;}class XE extends LB{XE(){}static  wE( g){return new gB.Future<LB>.of(()=>new XE());} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null){soundTransform=new WB();}return new AI(this,loop,soundTransform);}}class AI extends LC{var hK;var BL;AI( i, h, g){hK=h;BL=g;} get EC=>BL;set EC( g){BL=g;} stop(){}}class sF{static const  EG="pixel";}class oB{static const  pD="auto";static const  sD="arrow";static const  tD="button";static const  RG="hand";static const  SG="ibeam";static const  VG="wait";}class NC extends NB{var oK="";var zK=0x000000;var RL=null;var hL=qF.JG;var wL=sF.EG;var TK=tF.yF;var NM=false;var RM=false;var TM=0x000000;var bM=false;var gM=0x000000;var lM=0;var oM=0;var rM;var xM;var AN=true;var CN=100;var GN=100;var JN=null;var kK=null;NC(){RL=new YE("Arial",12,0x000000);rM=new List<String>();xM=new List<UE>();} get type=>TK; get width=>CN; get height=>GN; set text( g){oK=g;AN=true;} set SC( g){RL=g;zK=RL.color;AN=true;} set wordWrap( g){NM=g;AN=true;} set width( g){CN=g;AN=true;} set height( g){GN=g;AN=true;} get lH{EO();return lM;} get IE{EO();return oM;} sB( g,[ returnRectangle]){return zD(g,CN,GN,returnRectangle);} VC( g, h){if(g>=0&&h>=0&&g<CN&&h<GN)return this;return null;} nB( g){EO();g.kK.drawImage(JN,0.0,0.0);} GO(){rM.clear();xM.clear();if(NM==false){rM.add(oK);}else{for(String o in oK.replaceAll('\r','').split('\n')){var h=new StringBuffer();var i=0;var g="";for(String j in o.split(' ')){i=h.length;h.write((i>0)?" ${j}":j);g=h.toString();if(kK.measureText(g).width>CN){if(i>0){g=g.substring(0,i);}else{j="";}rM.add(g);h=new StringBuffer();h.write(j);}}if(h.isEmpty==false){rM.add(h.toString());}}}lM=0;oM=0;for(String g in rM){var l=kK.measureText(g);var m=0;if(RL.align==pB.OC||RL.align==pB.NG)m=(CN-l.width)/2;if(RL.align==pB.LG||RL.align==pB.HG)m=CN-l.width;var k=new UE(m,l.width,RL.size,0,0,0);xM.add(k);lM=TB.max(lM,k.width);oM=oM+k.height;}} EO(){if(AN){AN=false;var j=CN.ceil().toInt();var i=GN.ceil().toInt();if(JN==null){JN=new iC.CanvasElement(width:j,height:i);kK=JN.context2d;}if(JN.width!=j)JN.width=j;if(JN.height!=i)JN.height=i;var g=new StringBuffer();g.write(RL.HF?"italic ":"normal ");g.write("normal ");g.write(RL.CC?"bold ":"normal ");g.write("${RL.size}px ");g.write("${RL.font},sans-serif");kK.font=g.toString();kK.textAlign="start";kK.textBaseline="top";kK.fillStyle=xC(zK);GO();if(RM){kK.fillStyle=xC(TM);kK.fillRect(0,0,CN,GN);}else{kK.clearRect(0,0,CN,GN);}var k=0;for(int h=0;h<rM.length;h++ ){var l=xM[h];kK.fillStyle=xC(zK);kK.fillText(rM[h],l.x,k);k+= l.height;}if(bM){kK.strokeStyle=xC(gM);kK.lineWidth=1;kK.strokeRect(0,0,CN,GN);}}}}abstract class v extends MC implements WE{var JL=0.0;var OL=0.0;var WL=0.0;var fL=0.0;var nL=1.0;var tL=1.0;var BM=0.0;var HM=1.0;var JM=true;var OM=null;var ZK="";var XM=null;final  dM=new UB.VI();final  mM=new UB.VI();final  uM=new UB.VI();var BN=true; get x=>JL; get y=>OL; get WC=>WL; get XC=>fL; get uB=>nL; get DC=>tL; get ZB=>BM; get alpha=>HM; get visible=>JM; get mask=>OM; get name=>ZK; get parent=>XM; get root{var g=this;while (g.XM!=null)g=g.XM;return g;} get ZD{var g=this.root;if(g is nC)return g;return null;}set x( g){JL=g;BN=true;}set y( g){OL=g;BN=true;}set WC( g){WL=g;BN=true;}set XC( g){fL=g;BN=true;}set uB( g){nL=g;BN=true;}set DC( g){tL=g;BN=true;}set ZB( g){BM=g;BN=true;}set alpha( g){HM=g;BN=true;}set mask( g){OM=g;} get width=>sB(hN).width; get height=>sB(hN).height; set width( h){this.uB=1;var g=this.width;this.uB=(g!=0.0)?h/g:1.0;} set height( h){this.DC=1;var g=this.height;this.DC=(g!=0.0)?h/g:1.0;} FE(){if(XM!=null)XM.tB(this);} get hN{if(BN){BN=false;if(BM==0.0){uM.TF(nL,0.0,0.0,tL,JL-WL*nL,OL-fL*tL);}else{var g=TB.cos(BM);var h=TB.sin(BM);var i=nL*g;var l=nL*h;var k=-tL*h;var j=tL*g;var m=JL-WL*i-fL*k;var o=OL-WL*l-fL*j;uM.TF(i,l,k,j,m,o);}}return uM;} sB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.TI();returnRectangle.x=g.FC;returnRectangle.y=g.GC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} VC( g, h){if(sB(mM).contains(g,h))return this;return null;} pC( h){dM.MH();for(v g=this;g!=null;g=g.XM)dM.concat(g.hN);dM.SH();return dM.nH(h);} dispatchEvent( h){var g=null;if(h.AE||h.bubbles)for(v j=XM;j!=null;j=j.XM)if(j.LH(h.type)){if(g==null)g=new List<v>();g.add(j);}if(h.AE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.GE==false)g[i].nN(h,this,g[i],gC.cE);if(h.GE==false)nN(h,this,this,gC.OD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.GE==false)g[i].nN(h,this,g[i],gC.MG);} zN( h){for(var g=h;g!=null;g=g.XM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");XM=h;} nB( g);}abstract class NB extends v{var GH=false;var VB=true;var SI=true;var tabIndex=0;static const  WG=const HC<q>(q.RD);static const  hG=const HC<q>(q.oE);static const  kG=const HC<q>(q.PD);static const  qG=const HC<q>(q.wD);static const  vG=const HC<q>(q.cG); get onMouseOut=>NB.WG.forTarget(this); get onMouseMove=>NB.hG.forTarget(this); get onMouseDown=>NB.kG.forTarget(this); get onMouseUp=>NB.qG.forTarget(this); get onMouseWheel=>NB.vG.forTarget(this);static const  wG=const HC<XB>(XB.nE);static const  xG=const HC<XB>(XB.fE);static const  yG=const HC<XB>(XB.hE); get onTouchMove=>NB.wG.forTarget(this); get onTouchEnd=>NB.xG.forTarget(this); get onTouchCancel=>NB.yG.forTarget(this);static const  zG=const HC<IC>(IC.eE);static const  AH=const HC<IC>(IC.qD); get onKeyUp=>NB.zG.forTarget(this); get onKeyDown=>NB.AH.forTarget(this);}abstract class kC extends NB{final  LL=new List<v>();var gL=true;var qL=true; n( g){if(g.parent==this){var h=LL.indexOf(g);LL.removeAt(h);LL.add(g);}else{CH(g,LL.length);}} CH( g, h){if(h<0&&h>LL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){LL.removeAt(LL.indexOf(g));if(h>LL.length)h-- ;LL.insertRange(h,1,g);}else{g.FE();g.zN(this);LL.insertRange(h,1,g);g.dispatchEvent(new AB(AB.BG,true));if(this.ZD!=null)AO(g,new AB(AB.wC));}} tB( h){var g=LL.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");fH(g);} fH( g){if(g<0&&g>=LL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=LL[g];h.dispatchEvent(new AB(AB.TG,true));if(this.ZD!=null)AO(h,new AB(AB.yC));h.zN(null);LL.removeAt(g);} contains( g){for(;g!=null;g=g.XM)if(g==this)return true;return false;} sB( o,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.TI();if(LL.length==0)return super.sB(o,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var k=double.NEGATIVE_INFINITY;var j=double.NEGATIVE_INFINITY;var s=LL.length;for(int l=0;l<LL.length;l++ ){var m=LL[l];dM.DE(m.hN,o);var g=m.sB(dM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>k)k=g.right;if(g.bottom>j)j=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=k-h;returnRectangle.height=j-i;return returnRectangle;} VC( s, w){var l=null;for(int j=LL.length-1;j>=0;j-- ){var i=LL[j];if(i.visible){var g=i.hN;var m=s-g.FC;var k=w-g.GC;var EB=(g.d*m-g.c*k)/g.bC;var o=(g.a*k-g.b*m)/g.bC;var h=i.VC(EB,o);if(h!=null){if(h is NB)if(h.VB)return gL?h:this;l=this;}}}return l;} nB( i){for(int g=0;g<LL.length;g++ ){var h=LL[g];if(h.visible)i.SF(h);}} AO( g, j){g.dispatchEvent(j);if(g is kC){var i=new List<v>.from(g.LL);for(int h=0;h<i.length;h++ )AO(i[h],j);}}}class ZE{var target=null;var RC=false;var BE=0;var AD=0;var MF,NF;var KF,LF;ZE(this.MF,this.NF,this.KF,this.LF);}class WB{var volume;var bH;var LI=1;var MI=0;var RI=1;var QI=0;WB([this.volume=1,this.bH=0]);}abstract class LC extends MC{ get EC; set EC( g); stop();}class BB extends kC{var FI=false;var KE=false;}class CB extends v{var RB;var dH;var UD;CB([this.RB=null,this.dH="auto"]){UD=null;} sB( h,[ returnRectangle]){var g=(RB!=null)?RB.width:0;var i=(RB!=null)?RB.height:0;return zD(h,g,i,returnRectangle);} VC( g, h){if(RB!=null&&g>=0.0&&h>=0.0&&g<RB.width&&h<RB.height)return this;return null;} nB( g){if(RB!=null){if(UD==null)RB.nB(g);else RB.RF(g,UD);}}}abstract class LB{static  wE( g){var h=sC.ZG;if(h=="WebAudioApi")return lD.wE(g);if(h=="AudioElement")return jD.wE(g);return XE.wE(g);} get length; play([ loop=false, soundTransform]);static  tE( g){var m=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,caseSensitive:false);var i=m.firstMatch(g);var h=sC.qE;if(i==null)throw new ArgumentError("Unsupported file extension.");if(h.length==0)throw new UnsupportedError("This browser supports no known audio codec.");var j=i.group(1).toLowerCase();if(h.indexOf(j)==-1){var l=g.substring(0,g.length-j.length);var k=h[0];g="${l}${k}";}return g;}}abstract class WE{ nB( g);}class tF{static const  yF="dynamic";}class YE{var font;var size;var color;var CC;var HF;var oH;var align;var UH;var iH;var OH;var EE;var letterSpacing=0;var DI=0;var EI=false;var KI=false;YE(this.font,this.size,this.color,{this.CC: false,this.HF: false,this.oH: false,this.align: "left",this.UH: 0,this.iH: 0,this.OH: 0,this.EE: 0});}class mD{static var bE=oB.pD;static var DG=false;static var QG=new gB.StreamController<String>();static var UG=QG.stream.asBroadcastStream();static  uE( i){var h=i;var g="auto";if(bE!=oB.pD)h=bE;switch (h){case oB.pD:g="auto";break;case oB.sD:g="default";break;case oB.tD:g="pointer";break;case oB.RG:g="move";break;case oB.SG:g="text";break;case oB.VG:g="wait";break;}if(DG)g="none";return g;}}class tC extends NB{var JE;var PF;var EF;var WD;var KE=true;var enabled=true;var FM;tC([this.JE,this.PF,this.EF,this.WD]){IB(q.pE,eM);IB(q.RD,eM);IB(q.PD,eM);IB(q.wD,eM);FM=this.JE;} sB( g,[ returnRectangle]){if(FM!=null){dM.DE(FM.hN,g);return FM.sB(dM,returnRectangle);}return super.sB(g,returnRectangle);} VC( k, l){if(this.WD!=null){var g=this.WD.hN;var h=k-g.FC;var i=l-g.GC;var m=(g.d*h-g.c*i)/g.bC;var j=(g.a*i-g.b*h)/g.bC;if(this.WD.VC(m,j)!=null)return this;}return null;} nB( g){if(FM!=null)g.SF(FM);} eM( g){if(g.type==q.RD){FM=JE;}else{FM=g.RC?EF:PF;}}}class lC{static const  xF=0;static const  CG=1;static const  LG=2;static const  PG=3;static const  kE=4;}class UE{var DH;var FH;var height;var EE;var width;var x;UE(this.x,this.width,this.height,this.DH,this.FH,this.EE);}class nD{var TK;var bK;var qK;var EL;nD.UI( i, g, h, j){TK=0;bK=new QB(i,g,h,j);} nB( i){var g=i.context;g.beginPath();switch (TK){case 0:g.rect(bK.x,bK.y,bK.width,bK.height);break;case 1:g.arc(qK.x,qK.y,qK.NI,0,TB.PI*2.0,false);break;case 2:g.moveTo(EL[0].x,EL[0].y);for(int h=1;h<EL.length;h++ )g.lineTo(EL[h].x,EL[h].y);break;}g.clip();}}class JD extends v{static const  rD='DIRECTION_UP';static const  gE='DIRECTION_RIGHT';static const  vD='DIRECTION_DOWN';static const  QD='DIRECTION_LEFT';var LM;var PM;var SM;var VM;JD( g,[ direction=QD]){if(direction!=rD&&direction!=vD&&direction!=QD&&direction!=gE){throw new ArgumentError('Invalid Gauge direction!');}LM=direction;PM=1.0;SM=g;VM=new QB.TI();ON();} get ratio=>PM;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;PM=g;ON();} get RB=>SM;set RB( g){SM=g;ON();}ON(){if(SM==null){VM.left=0;VM.top=0;VM.right=0;VM.bottom=0;}else{var h=SM.width;var g=SM.height;switch (LM){case QD:VM.left=((1.0-PM)*h).toInt();VM.top=0;VM.right=h;VM.bottom=g;break;case rD:VM.left=0;VM.top=((1.0-PM)*g).toInt();VM.right=h;VM.bottom=g;break;case gE:VM.left=0;VM.top=0;VM.right=(PM*h).toInt();VM.bottom=g;break;case vD:VM.left=0;VM.top=0;VM.right=h;VM.bottom=(PM*g).toInt();break;}}} sB( h,[ returnRectangle]){var g=(SM!=null)?SM.width:0;var i=(SM!=null)?SM.height:0;return zD(h,g,i,returnRectangle);} VC( g, h){if(SM!=null&&g>=0.0&&h>=0.0&&g<SM.width&&h<SM.height)return this;return null;} nB( g){if(SM!=null)SM.RF(g,VM);}}class sC{static var ZG=oG();static var SD=sG();static var qE=tG();static  oG(){var h=(SD!=null)?"WebAudioApi":"AudioElement";var g=iC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(qE.length==0)h="Mock";print("dartflash: supported audio engine is: ${h}");return h;}static  sG(){try {return new bF.AudioContext();}catch (g){return null;}}static  tG(){var g=new List<String>();var h=new iC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("dartflash: supported audio types are: ${g}");return g;}}class jC{static const  pD="auto";static const  GG="stop";static const  uD="once";}class GB implements WE{var nK;var vK;var HL;var UL;var kK;var pL;var xL;var DM;var CL;var KL;var PL;var aL;GB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){nK=g;vK=h;HL=transparent;var i=new iC.CanvasElement(width:nK,height:vK);kK=i.context2d;kK.fillStyle=HL?bG(fillColor):xC(fillColor);kK.fillRect(0,0,g,h);UL=i;pL=0;}GB.XI( g){nK=g.naturalWidth;vK=g.naturalHeight;HL=true;UL=g;pL=0;}GB.YI( g){nK=g.aH;vK=g.ZH;HL=true;UL=g.mH.NH;pL=g.jH?2:1;xL=g.offsetX.toDouble();DM=g.offsetY.toDouble();CL=g.JH.toDouble();KL=g.KH.toDouble();PL=g.IH.toDouble();aL=g.HH.toDouble();}static  wE( i){var h=new gB.Completer<GB>();var g=new iC.ImageElement();g.onLoad.listen((j)=>h.complete(new GB.XI(g)));g.onError.listen((j)=>h.completeError(new StateError("Error loading image.")));g.src=i;return h.future;} get width=>nK; get height=>vK; nB( g){switch (pL){case 0:g.context.drawImage(UL,0.0,0.0);break;case 1:g.context.drawImage(UL,CL,KL,PL,aL,xL,DM,PL,aL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,xL,DM+aL);g.context.drawImage(UL,CL,KL,aL,PL,0.0,0.0,aL,PL);break;}} RF( fB, g){if(g.width<=0.0||g.height<=0.0)return;switch (pL){case 0:fB.context.drawImage(UL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=CL;double h=KL;double w=j+PL;double EB=h+aL;double l=CL-xL+g.x;double m=KL-DM+g.y;double SB=l+g.width;double JB=m+g.height;double s=(j>l)?j:l;double o=(h>m)?h:m;double wB=(w<SB)?w:SB;double LE=(EB<JB)?EB:JB;double ME=xL-j+s;double cC=DM-h+o;double k=wB-s;double i=LE-o;if(k>0.0&&i>0.0){fB.context.drawImage(UL,s,o,k,i,ME,cC,k,i);}break;case 2:double j=CL;double h=KL;double w=j+aL;double EB=h+PL;double l=CL+DM-g.y+aL-g.height;double m=KL-xL+g.x;double SB=l+g.height;double JB=m+g.width;double s=(j>l)?j:l;double o=(h>m)?h:m;double wB=(w<SB)?w:SB;double LE=(EB<JB)?EB:JB;double ME=xL-h+o;double cC=DM+w-wB;double k=LE-o;double i=wB-s;if(k>0.0&&i>0.0){fB.context.transform(0.0,-1.0,1.0,0.0,ME,cC+i);fB.context.drawImage(UL,s,o,i,k,0.0,0.0,i,k);}break;}}}class oD extends JD implements qB{static const  FG='TIME_OUT';var mL=false;var AL=0.0;var ML=0.0;var KM;var MM=true;oD( g, h,[ direction=JD.QD]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');ML=g;AF();} BC( g){if(mL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){mL=true;} pause(){mL=false;} reset([ time=0.0]){pause();time=TB.max(time,0.0);if(time!=0.0){ML=time;AF();}ratio=1.0;} TD( g, h){KM[g]=h/totalTime;} AF(){KM=new Map<String,num>();TD(oD.FG,0);} get totalTime=>ML; get hH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(MM){KM.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new AB(j));});}}}typedef  wF<vC extends AB>( event);class AG<vC extends AB> extends gB.StreamSubscription<vC>{var kL;var vL;var yL;var EM;AG(this.kL,this.vL){yL=0;EM=false;} cancel(){if(EM==false){kL.zM(this);EM=true;vL=null;}} onError( g( error)){} get jN=>yL>0; pause([ resumeSignal]){yL++ ;if(resumeSignal!=null)resumeSignal.whenComplete(resume);} resume(){if(jN==false)throw new StateError("Subscription is not paused.");yL-- ;}}class ND{var XL;ND(){XL=new Map<String,MD>();} WM( g){var j=g.kind;var h=g.name;var i="${j}.${h}";if(XL.containsKey(i))throw new StateError("ResourceManager already contains a resource called '${h}'");XL[i]=g;} LN( i, g){var h="${i}.${g}";if(XL.containsKey(h)==false)throw new StateError("ResourceManager does not contains a resource called '${g}'");return XL[h];} iB( i, h){var g=new MD("BitmapData",i,h);g.KN(GB.wE(h));WM(g);} aB( i, h){var g=new MD("Sound",i,h);g.KN(LB.wE(h));WM(g);} zC( j, h, i){var g=new MD("TextureAtlas",j,h);g.KN(hB.wE(h,i));WM(g);} mB( i, h){var g=new MD("Text",i,"");g.KN(new gB.Future.immediate(h));WM(g);} load(){var h=this.cH.map((i)=>i.IL);return gB.Future.wait(h).then((j){var g=this.GF;if(g.length>0)throw new StateError("Failed to load ${g.length} resource(s).");return this;});} get cH{return XL.values.where((g)=>g.CD==null).toList();} get GF{return XL.values.where((g)=>g.error!=null).toList();} t( g){return LN("BitmapData",g).CD;} jB( g){return LN("Sound",g).CD;} UC( g){return LN("TextureAtlas",g).CD;} oC( g){return LN("Text",g).CD;}} xC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class jE{static var mE=false;static var xD=false;static var yD=0;static var eG=SE.JG;static var fG=new gB.StreamController<String>();static var jG=fG.stream.asBroadcastStream();static lG(){if(mE==false){mE=true;var g=iC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){xD=true;yD=10;}if(g.contains("Android")){xD=true;yD=10;}if(g.contains("IEMobile")){xD=true;yD=10;}}}static  get uG{lG();return eG;}}class PC extends qB{final  aM;final  hM;final  kM;var pM;var sM;var vM;var yM;var ML;var AL;var DN;var EN;var IN;PC( g, h, i,[ transitionFunction( ratio)]):aM=g,hM=h,kM=(transitionFunction!=null)?transitionFunction:MB.QC{pM=g;AL=0.0;ML=TB.max(0.0001,i);DN=0.0;EN=false;IN=false;} BC( i){if(AL<ML||IN==false){AL=AL+i;if(AL>ML)AL=ML;if(AL>=0.0){if(IN==false){IN=true;if(sM!=null)sM();}var g=AL/ML;var h=kM(g);pM=aM+h*(hM-aM);if(vM!=null)vM(EN?pM.round():pM);if(yM!=null&&AL==ML)yM();}}return AL<ML;} get vB=>aM; get HE=>hM; get totalTime=>ML; get currentTime=>AL;set TC( g){if(IN==false)AL=AL+DN-g;DN=g;} set onStart( g()){sM=g;} set KC( g( value)){vM=g;} set onComplete( g()){yM=g;}}class aG{static var dG=0;var aD=dG++ ;var target=null;var YD=false;aG(this.target,this.YD);} bG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static  QC( g){return g;}static  vE( g){return g*g*g;}static  rB( g){g=1.0-g;return 1.0-g*g*g;}static  BH( g){if(g==0.0||g==1.0)return g;return TB.pow(2.0,-10.0*g)*TB.sin((g-0.3/4.0)*(2.0*TB.PI)/0.3)+1;}}class lB implements qB{final  MN;final  kM;final  SN=new List<vF>();var sM;var vM;var yM;var ML;var AL;var DN;var EN;var IN;lB( g, h,[ transitionFunction( ratio)]):MN=g,kM=(transitionFunction!=null)?transitionFunction:MB.QC{AL=0.0;ML=TB.max(0.0001,h);DN=0.0;EN=false;IN=false;} YB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(MN!=null&&IN==false)SN.add(new vF(g,0.0,h));} moveTo( h, g){YB('x',h);YB('y',g);} BC( l){if(AL<ML||IN==false){AL=AL+l;if(AL>ML)AL=ML;if(AL>=0.0){if(IN==false){IN=true;for(int i=0;i<SN.length;i++ ){var g=SN[i];switch (g.name){case 'x':g.vB=MN.x;break;case 'y':g.vB=MN.y;break;case 'pivotX':g.vB=MN.WC;break;case 'pivotY':g.vB=MN.XC;break;case 'scaleX':g.vB=MN.uB;break;case 'scaleY':g.vB=MN.DC;break;case 'rotation':g.vB=MN.ZB;break;case 'alpha':g.vB=MN.alpha;break;}}if(sM!=null)sM();}var j=AL/ML;var k=kM(j);for(int i=0;i<SN.length;i++ ){var g=SN[i];var h=g.vB+k*(g.HE-g.vB);h=EN?h.round():h;switch (g.name){case 'x':MN.x=h;break;case 'y':MN.y=h;break;case 'pivotX':MN.WC=h;break;case 'pivotY':MN.XC=h;break;case 'scaleX':MN.uB=h;break;case 'scaleY':MN.DC=h;break;case 'rotation':MN.ZB=h;break;case 'alpha':MN.alpha=h;break;}}if(vM!=null)vM();if(yM!=null&&AL==ML)yM();}}return AL<ML;} get totalTime=>ML; get currentTime=>AL;set TC( g){if(IN==false)AL=AL+DN-g;DN=g;} set onStart( g()){sM=g;} set KC( g()){vM=g;} set onComplete( g()){yM=g;}} nG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);var i=h.firstMatch(g);return i.group(1);}class nC extends kC{var JN;var kK;var XN;var aN;var fN;var gN;var iN;var lN;var mN;var oN;var pN;var qN;var rN;nC( h, g){ZK=h;JN=g;JN.focus();kK=g.context2d;aN=new AC.WI(kK);fN=jC.pD;gN=oB.sD;mD.UG.listen(UG);mN=[new ZE(q.PD,q.wD,q.ZC,q.KG),new ZE(q.gG,q.iG,q.rE,q.rE),new ZE(q.mG,q.pG,q.sE,q.sE)];lN=null;iN=new PB(0,0);pN=new q(q.ZC,true);JN.onMouseDown.listen(eM);JN.onMouseUp.listen(eM);JN.onMouseMove.listen(eM);JN.onMouseOut.listen(eM);JN.onMouseWheel.listen(eM);oN=new Map<int,aG>();rN=new XB(XB.dE,true);jE.jG.listen(BO);BO(null);qN=new IC(IC.qD,true);JN.onKeyDown.listen(CO);JN.onKeyUp.listen(CO);JN.onKeyPress.listen(DO);} get focus=>XN; set gH( g){fN=g;} FO(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){FO();} set y( g){FO();} set WC( g){FO();} set XC( g){FO();} set uB( g){FO();} set DC( g){FO();} set ZB( g){FO();} set alpha( g){FO();} set width( g){FO();} set height( g){FO();} VH(){if(fN==jC.pD||fN==jC.uD){aN.reset();nB(aN);if(fN==jC.uD)fN=jC.GG;}} UG( g){JN.style.cursor=mD.uE(gN);} eM( j){j.preventDefault();var EB=JN.getBoundingClientRect();var o=new DateTime.now().millisecondsSinceEpoch;var w=j.button;var h=null;var i=new PB(j.clientX-EB.left,j.clientY-EB.top);var m=null;if(w<0||w>2)return;if(j.type=="mousemove"&&iN.equals(i))return;var g=mN[w];iN=i;if(j.type!="mouseout")h=VC(i.x,i.y) as NB;var l=oB.sD;if(h is BB)if(h.KE)l=oB.tD;if(h is tC)if(h.KE)l=oB.tD;if(gN!=l){gN=l;JN.style.cursor=mD.uE(l);}if(lN!=null&&lN!=h){lN.dispatchEvent(pN..HN(q.RD,true)..xN=(lN.ZD!=null)?lN.pC(i):new PB.TI()..yN=i..sN=g.RC);lN=null;}if(h!=null&&h!=lN){h.dispatchEvent(pN..HN(q.pE,true)..xN=h.pC(i)..yN=i..sN=g.RC);lN=h;}var k=null;var s=false;var JB=false;if(j.type=="mousedown"){k=g.MF;if(h!=g.target||o>g.BE+500)g.AD=0;g.RC=true;g.target=h;g.BE=o;g.AD++ ;}if(j.type=="mouseup"){k=g.NF;g.RC=false;s=(g.target==h);JB=s&&g.AD.isEven&&(o<g.BE+500);}if(j.type=="mousemove"){k=q.oE;}if(k!=null&&h!=null){m=h.pC(i);h.dispatchEvent(pN..HN(k,true)..xN=m..yN=i..sN=g.RC..uN=g.AD);if(s){if(JB&&h.GH){h.dispatchEvent(pN..HN(g.LF,true)..xN=m..yN=i..sN=g.RC);}else{h.dispatchEvent(pN..HN(g.KF,true)..xN=m..yN=i..sN=g.RC);}}}}var HO=[] ; BO( h){HO.forEach((g)=>g.cancel());if(jE.uG==SE.OG){HO=[JN.onTouchStart.listen(IO),JN.onTouchEnd.listen(IO),JN.onTouchMove.listen(IO),JN.onTouchEnter.listen(IO),JN.onTouchLeave.listen(IO),JN.onTouchCancel.listen(IO)];}} IO( j){j.preventDefault();var o=JN.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var i=new PB(m.clientX-o.left,m.clientY-o.top);var h=VC(i.x,i.y) as NB;var g=oN.containsKey(l)?oN[l]:new aG(h,oN.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(rN..HN(XB.YG,true)..xN=(g.target.ZD!=null)?g.target.pC(i):new PB.TI()..yN=i..NN=g.aD..PN=g.YD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(rN..HN(XB.XG,true)..xN=h.pC(i)..yN=i..NN=g.aD..PN=g.YD);g.target=h;}var k=null;if(j.type=="touchstart"){oN[l]=g;k=XB.dE;}if(j.type=="touchend"){oN.remove(l);k=XB.fE;}if(j.type=="touchcancel"){oN.remove(l);k=XB.hE;}if(j.type=="touchmove"){k=XB.nE;}if(k!=null&&h!=null){h.dispatchEvent(rN..HN(k,true)..xN=h.pC(i)..yN=i..NN=g.aD..PN=g.YD);}}} CO( g){g.preventDefault();var h=null;if(g.type=="keyup")h=IC.eE;if(g.type=="keydown")h=IC.qD;qN..HN(h,true)..UM=g.altKey..YM=g.ctrlKey..cM=g.shiftKey..qM=g.charCode..tM=g.keyCode..wM=lC.xF;if(g.keyLocation==iC.KeyLocation.LEFT)qN.wM=lC.CG;if(g.keyLocation==iC.KeyLocation.RIGHT)qN.wM=lC.LG;if(g.keyLocation==iC.KeyLocation.NUMPAD)qN.wM=lC.PG;if(g.keyLocation==iC.KeyLocation.JOYSTICK)qN.wM=lC.kE;if(g.keyLocation==iC.KeyLocation.MOBILE)qN.wM=lC.kE;if(XN!=null)XN.dispatchEvent(qN);} DO( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new aE(aE.IG,true);h.oK=new String.fromCharCodes([i]);if(XN!=null)XN.dispatchEvent(h);}} rG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";} zD( g, m, EB, j){var cC=0.0;var wB=0.0;var w=m*g.a;var fB=m*g.b;var JB=m*g.a+EB*g.c;var s=m*g.b+EB*g.d;var SB=EB*g.c;var o=EB*g.d;var h=cC;if(h>w)h=w;if(h>JB)h=JB;if(h>SB)h=SB;var i=wB;if(i>fB)i=fB;if(i>s)i=s;if(i>o)i=o;var l=cC;if(l<w)l=w;if(l<JB)l=JB;if(l<SB)l=SB;var k=wB;if(k<fB)k=fB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new QB.TI();j.x=g.FC+h;j.y=g.GC+i;j.width=l-h;j.height=k-i;return j;}//@ sourceMappingURL=escape.dart.map
