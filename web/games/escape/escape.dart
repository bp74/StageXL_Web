import "dart:json" as qH;import "dart:web_audio" as bF;import "dart:math" as TB;import "dart:html" as iC;import "dart:async" as gB;class rH{static const String sH="Chrome";static const String tH="Firefox";static const String uH="Internet Explorer";static const String vH="Safari";final String EH;final String WH;const rH(this.EH,[this.WH]);}class wH{final String name;const wH(this.name);}class cF extends BB{List<GB> gI;CB qI;LB AJ;NC GJ;PC IJ;cF(){AJ=dB.KB.jB("Warning");GJ=null;gI=FB.pF();qI=new CB(gI[0]);n(qI);}void start(){GJ=AJ.play();p.remove(IJ);IJ=new PC(0,80,9.0,MB.QC);IJ.KC=(h){int g=h.toInt()%8;qI.RB=gI[(g<=4)?g+1:8-g];};p.add(IJ);}void stop(){if(GJ!=null){GJ.stop();GJ=null;}p.remove(IJ);qI.RB=gI[0];}}class eF extends BB{int MJ;int TJ;int YJ;int cJ;int fJ;int gJ;int hJ;TB.Random iJ;int jJ;List<int> lJ;List<HB> mJ;List<HB> nJ;List<DD> oJ;List<PB> pJ;bool qJ;BB rJ;BB tJ;BB uJ;BB vJ;BB wJ;eF(int EB,int s,int JB,int m,int o,int w,List<int> k){iJ=new TB.Random();jJ=xB.rC;lJ=k;MJ=EB;TJ=s;YJ=JB;cJ=m;fJ=o;gJ=w;hJ=k.length;pJ=new List<PB>();rJ=new BB();tJ=new BB();uJ=new BB();vJ=new BB();wJ=new BB();n(rJ);n(tJ);n(uJ);n(vJ);n(wJ);tJ.VB=false;uJ.VB=false;vJ.VB=false;wJ.VB=false;QH();RH();PH();qJ=true;qC l=new qC();this.mask=new oD.UI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){HB i=nJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.kB(rJ,tJ,uJ);PC j=new PC(i.y,h*50+25,0.4,MB.rB);j.TC=g*0.03;j.KC=(SB){i.y=SB;};j.onComplete=(){if(l.XD()==100){EK();qJ=false;pJ.clear();this.mask=null;}};p.add(j);}}IB(q.PD,FK);}void ZF(int g){if(g==xB.dD)jJ=g;if(g==xB.eD&&jJ==xB.rC){jJ=g;if(qJ==false)dispatchEvent(new bB(bB.gD,null));}}void FF(){this.mask=new oD.UI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){HB g=nJ[i+h*10];g.cB=false;g.JC=false;g.DB=u.ED;g.kB(rJ,tJ,uJ);PC j=new PC(g.y,500+h*50+25,0.5,MB.rB);j.TC=i*0.1;j.KC=(k){g.y=k;};p.add(j);}}}void QH(){oJ=new List<DD>();for(int h=0;h<TJ;h++ ){DD g=new DD(h);g.ZB=(iJ.nextInt(30)-15)*TB.PI/180;g.x=300-(90*TJ)/2+h*90+iJ.nextInt(20)-10;g.y=550;oJ.add(g);vJ.n(g);}}int CF(int g,int h){int i=0;HB j=nJ[g+h*10];if(j.direction==0){HB l=(g>0)?nJ[g-1+h*10]:null;HB m=(g<9)?nJ[g+1+h*10]:null;if(j.aC(l))i++ ;if(j.aC(m))i++ ;}else{HB k=(h>0)?nJ[g+(h-1)*10]:null;HB o=(h<9)?nJ[g+(h+1)*10]:null;if(j.hC(k))i++ ;if(j.hC(o))i++ ;}return i;}bool BF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){HB k=nJ[g+h*10];int i=hJ*2;while (CF(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{int m=0;for(int j=0;j<lJ.length;j++ )if(k.color==lJ[j])m=j;k.color=lJ[(m+1)%lJ.length];i-- ;}}}}bool l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(CF(g,h)==2);return l;}bool QF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(nJ[(h-1)+g*10].VD(nJ[h+g*10])&&nJ[h+g*10].VD(nJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(nJ[h+(g-1)*10].VD(nJ[h+g*10])&&nJ[h+g*10].VD(nJ[h+(g+1)*10]))return true;return false;}void LK(String j,int l,int k){for(int g=0;g<20;g++ ){int h=MJ~/k;int i=l*h+iJ.nextInt(h);if(mJ[i].DB==u.ED){mJ[i].DB=j;return;}}}void RH(){mJ=new List<HB>();for(int g=0;g<MJ;g++ ){int i=lJ[iJ.nextInt(lJ.length)];int h=iJ.nextInt(2);mJ.add(new HB(i,h));}for(int g=0;g<TJ*2;g++ )LK("Lock${(g%TJ)+1}",g,TJ*2);for(int g=0;g<YJ;g++ )LK(u.OB,g,YJ);for(int g=0;g<cJ;g++ )LK(u.yB,g,cJ);for(int g=0;g<fJ;g++ )LK(u.RE,g,fJ);for(int g=0;g<gJ;g++ )LK(u.SE,g,gJ);}void PH(){nJ=new List<HB>();bool g=true;while (g){nJ.clear();for(int h=0;h<100;h++ ){int j=lJ[iJ.nextInt(lJ.length)];int i=iJ.nextInt(2);nJ.add(new HB(j,i));}g=BF();}}bool VF(){if(qJ||jJ!=xB.rC)return false;bool l=true;qJ=true;while (l){for(int k=0;k<nJ.length;k++ ){HB g=nJ[k];g.cB=false;g.JC=false;g.kB(rJ,tJ,uJ);g.color=lJ[iJ.nextInt(lJ.length)];g.direction=iJ.nextInt(2);}l=BF()||(QF()==false);}LB s=dB.KB.jB("BonusUniversal");s.play();qC m=new qC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){HB g=nJ[i+j*10];g.WF=0.0;PC h=new PC(0.0,1.0,0.2,MB.QC);h.TC=i*0.06;h.KC=(o){g.WF=o;};h.onStart=(){g.kB(rJ,tJ,uJ);};h.onComplete=(){if(m.XD()==100){EK();MK();pJ.clear();}};p.add(h);}}return true;}void EK(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){HB g=nJ[h+i*10];HB l=(h<9)?nJ[h+1+i*10]:null;HB m=(i<9)?nJ[h+(i+1)*10]:null;bool j=false;bool k=false;if(g.aC(l)){j=true;k=(g.DB==u.OB||l.DB==u.OB);}if(g.hC(m)){j=true;k=(g.DB==u.OB||m.DB==u.OB);}if(g.cB!=j||g.JC!=k){g.cB=j;g.JC=k;g.kB(rJ,tJ,uJ);}}}}void OK(qC w,int l,int o,int k,int m,int s){qJ=true;w.XD(k);int i=1;for(int h=0;h<k;h++ ){HB g=nJ[l+h*m+(o+h*s)*10];if(g.DB==u.RE)i=i*2;if(g.DB==u.SE)i=i*5;int JB=l+h*m;int SB=o+h*s;p.eB((){g.empty=true;g.kB(rJ,tJ,uJ);LB EB=dB.KB.jB("ChainBlast");EB.play();PE j=new PE(g.color,g.direction);j.x=JB*50;j.y=SB*50;p.add(j);wJ.n(j);eH(g);if(w.DF()==0)QK();},0.1+h*0.1);}dispatchEvent(new bB(bB.PE,{"Length":k,"Factor":i}));}void MK(){qJ=false;qC j=new qC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){int g=1;while (i+g<10&&nJ[i+g-1+h*10].aC(nJ[i+g+h*10]))g++ ;if(g>=3)OK(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){int g=1;while (h+g<10&&nJ[i+(h+g-1)*10].hC(nJ[i+(h+g)*10]))g++ ;if(g>=3)OK(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(jJ==xB.dD)dispatchEvent(new bB(bB.QE,null));if(jJ==xB.eD)dispatchEvent(new bB(bB.gD,null));if(jJ==xB.rC&&QF()==false)VF();}}void eH(HB h){if(h.DB.indexOf("Lock")==0){int k=int.parse(h.DB.substring(4,5))-1;DD j=oJ[k];CB g=FB.hD(h.DB);g.x=h.x;g.y=h.y;n(g);lB i=new lB(g,0.5,MB.rB);i.YB("x",j.x);i.YB("y",j.y-10);i.onComplete=()=>tB(g);p.add(i);p.eB(()=>YH(k),0.5);}}void YH(int k){DD h=oJ[k];bB i;if(h.BD){i=new bB(bB.FD,{"Type":"SingleLocked","Position":new PB(h.x+20,h.y)});LB l=dB.KB.jB("Unlock");l.play();}else{i=new bB(bB.FD,{"Type":"SingleUnlocked","Position":new PB(h.x+20,h.y)});}dispatchEvent(i);h.BD=false;h.UF(false);bool j=true;for(int g=0;g<oJ.length;g++ )j=j&&(oJ[g].BD==false);if(j){LB m=dB.KB.jB("BonusAllUnlock");m.play();for(int g=0;g<oJ.length;g++ ){oJ[g].BD=true;p.eB(()=>oJ[(g+k)%oJ.length].kH(),g*0.2);}p.eB(()=>dispatchEvent(new bB(bB.FD,{"Type":"All","Position":new PB(280,550)})),0.75);}}void QK(){qC o=new qC();for(int i=0;i<10;i++ ){int k=9;int j=8;while (k>=0){while (k>=0&&nJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&nJ[i+j*10].empty==true){j-- ;}if(k>=0){HB g,h,l;if(j>=0){h=nJ[i+j*10];if(i>0){l=nJ[i-1+j*10];if(h.aC(l)){l.cB=false;l.kB(rJ,tJ,uJ);}}h.cB=false;h.empty=true;h.kB(rJ,tJ,uJ);}else{if(mJ.length>0){h=mJ[0];mJ.removeRange(0,1);}else{h=new HB(lJ[iJ.nextInt(lJ.length)],iJ.nextInt(2));}}g=nJ[i+k*10];g.color=h.color;g.direction=h.direction;g.DB=h.DB;g.cB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.kB(rJ,tJ,uJ);o.XD();PC m=new PC(g.y,50*k+25,0.1,MB.QC);m.KC=(s){g.y=s;};m.onComplete=(){if(o.DF()==0){EK();MK();SK();}};p.add(m);}}}}void FK(q g){if(g.target==rJ&&this.VB){int j=TB.min(g.IF/50,9).toInt();int h=TB.min(g.JF/50,9).toInt();PB i=new PB(j,h);pJ.add(i);SK();}}void SK(){while (jJ==xB.rC&&qJ==false&&pJ.length>0){PB m=pJ[0];pJ.removeRange(0,1);int j=m.x.toInt();int k=m.y.toInt();HB g=nJ[j+k*10];HB i=(j>0)?nJ[j-1+k*10]:null;HB o=(j<9)?nJ[j+1+k*10]:null;HB h=(k>0)?nJ[j+(k-1)*10]:null;HB s=(k<9)?nJ[j+(k+1)*10]:null;bool l=false;if(g.DB==u.yB){LB EB=dB.KB.jB("ChainError");EB.play();continue;}if(g.hC(h)){h.cB=false;h.kB(rJ,tJ,uJ);}if(g.aC(i)){i.cB=false;i.kB(rJ,tJ,uJ);}g.direction=1-g.direction;g.cB=false;g.JC=false;LB JB=dB.KB.jB("ChainRotate");JB.play();if(g.aC(o)){g.cB=true;g.JC=(g.DB==u.OB||o.DB==u.OB);}if(g.hC(s)){g.cB=true;g.JC=(g.DB==u.OB||s.DB==u.OB);}g.kB(rJ,tJ,uJ);l=l||g.cB;if(g.hC(h)){h.cB=true;h.JC=(g.DB==u.OB||h.DB==u.OB);h.kB(rJ,tJ,uJ);l=true;}if(g.aC(i)){i.cB=true;i.JC=(g.DB==u.OB||i.DB==u.OB);i.kB(rJ,tJ,uJ);l=true;}if(l){LB w=dB.KB.jB("ChainLink");w.play();}MK();}}}class bB extends AB{static const String PE="Explosion";static const String FD="Unlocked";static const String QE="Finalized";static const String gD="Timeouted";Map<String,dynamic> SJ;bB(String h,Map<String,dynamic> g,[bool bubbles=false]):super(h,bubbles){SJ=g;}Map<String,dynamic> get info{return SJ;}}class xB{static const int rC=1;static const int dD=2;static const int eD=3;}class OE extends BB{BB cI;OE(int j){MC g=new MC();g.SC=new aE("Arial",30,0xFFFFFF,CC:true,align:pB.OC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.VB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;cI=new BB();cI.n(g);n(cI);PC i=new PC(0.0,1.0,1.5,MB.rB);i.KC=(h){cI.alpha=1-h;cI.y=-h*50;cI.uB=1.0+0.1*TB.sin(h*10);cI.DC=1.0+0.1*TB.cos(h*10);};i.onComplete=(){this.GE();};p.add(i);}}class hF extends BB{pD eI;sC mI;sC wI;Function nI;hF(){CB m=new CB(FB.KB.t("ExitBox"));n(m);MC g=new MC();g.SC=new aE("Arial",24,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=100;g.wordWrap=true;g.text=dC.KB.oC("GENexitquery");g.x=47;g.y=150-g.JE/2;g.VB=false;n(g);eI=new pD(7,FB.KB.t("ExitGauge"),MD.wD);eI.x=268;eI.y=25;eI.IB("TimeOver",xJ);n(eI);eI.TD("TimeOver",0);eI.start();CB i=new CB(FB.KB.t("ExitYesButtonNormal"));CB j=new CB(FB.KB.t("ExitYesButtonPressed"));mI=new sC(i,i,j,j);mI.x=68;mI.y=239;mI.IB(q.ZC,AK);n(mI);CB h=new CB(FB.KB.t("ExitNoButtonNormal"));CB k=new CB(FB.KB.t("ExitNoButtonPressed"));wI=new sC(h,h,k,k);wI.x=173;wI.y=232;wI.IB(q.ZC,CK);n(wI);this.IB(AB.wC,(l)=>p.add(eI));this.IB(AB.yC,(l)=>p.remove(eI));}void DK(bool g){if(nI!=null){nI(g);nI=null;}}void AK(q g){DK(true);}void CK(q g){DK(false);}void xJ(AB g){DK(false);}show(Function g){nI=g;}}class cD{CB yE;num XF;num YF;num angle;num aF;num ZB;}class HB{int ZI;int aI;String jI;num pI;num uI;bool xI;bool DJ;bool HJ;v KJ;v OJ;v RJ;HB(int h,int g){ZI=h;aI=g;jI=u.ED;pI=-1000;uI=-1000;xI=false;DJ=false;HJ=false;KJ=null;OJ=null;RJ=null;}int get color=>ZI;void set color(int g){ZI=g;}int get direction=>aI;void set direction(int g){aI=g;}String get DB=>jI;void set DB(String g){jI=g;}bool get cB=>xI;void set cB(bool g){xI=g;}bool get JC=>DJ;void set JC(bool g){DJ=g;}bool get empty=>HJ;void set empty(bool g){HJ=g;}bool VD(HB g){bool h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.DB!=u.yB&&jI!=u.yB;return h;}bool aC(HB g){bool h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.direction==0&&aI==0&&g.DB!=u.yB&&jI!=u.yB;return h;}bool hC(HB g){bool h=g!=null&&(g.color==ZI||g.DB==u.OB||jI==u.OB)&&g.direction==1&&aI==1&&g.DB!=u.yB&&jI!=u.yB;return h;}num get x=>pI;void set x(num g){pI=g;if(KJ!=null)KJ.x=g;if(OJ!=null)OJ.x=g;if(RJ!=null)RJ.x=g;}num get y=>uI;void set y(num g){uI=g;if(KJ!=null)KJ.y=g;if(OJ!=null)OJ.y=g;if(RJ!=null)RJ.y=g;}void set WF(num h){if(KJ!=null){num g=1+0.3*TB.sin(h*TB.PI);KJ.uB=g;KJ.DC=g;}}void kB(BB g,BB h,BB i){if(KJ!=null){KJ.parent.tB(KJ);KJ=null;}if(OJ!=null){OJ.parent.tB(OJ);OJ=null;}if(RJ!=null){RJ.parent.tB(RJ);RJ=null;}if(empty==false){switch (jI){case u.OB:KJ=new xH(aI);KJ.x=pI;KJ.y=uI;g.n(KJ);break;case u.yB:KJ=FB.hD(u.yB);KJ.x=pI;KJ.y=uI;g.n(KJ);break;default:KJ=FB.fD(ZI,aI);KJ.x=pI;KJ.y=uI;g.n(KJ);break;}if(xI){OJ=DJ?new yH(aI):FB.iF(ZI,aI);OJ.x=pI+((aI==0)?25:0);OJ.y=uI+((aI==1)?25:0);h.n(OJ);}switch (jI){case u.ED:break;case u.yB:break;case u.OB:break;default:RJ=new zH(jI);RJ.x=pI;RJ.y=uI;i.n(RJ);break;}}}}class dF extends BB{gF dI;sC lI;sC vI;eF EJ;pD eI;fF JJ;cF LJ;MC NJ;MC QJ;int bI;int UJ;int VJ;int WJ;int XJ;BB ZJ;BB aJ;BB bJ;LB dJ;NC eJ;dF(){CB j=new CB(FB.KB.t("ShuffleButtonNormal"));CB h=new CB(FB.KB.t("ShuffleButtonPressed"));lI=new sC(j,j,h,h);lI.IB(q.ZC,sJ);lI.x=530;lI.y=525;n(lI);CB g=new CB(FB.KB.t("ExitButtonNormal"));CB i=new CB(FB.KB.t("ExitButtonPressed"));vI=new sC(g,g,i,i);vI.IB(q.ZC,zJ);vI.x=700;vI.y=500;n(vI);dI=new gF();dI.x=540;dI.y=-1000;n(dI);eI=new pD(10,FB.KB.t("TimeGauge"),MD.sD);eI.x=659;eI.y=244;eI.IB("TimeShort",BK);eI.IB("TimeOver",xJ);n(eI);p.add(eI);JJ=new fF();JJ.x=640;JJ.y=230;n(JJ);LJ=new cF();LJ.x=665;LJ.y=160;n(LJ);NJ=new MC();NJ.SC=new aE("Arial",30,0xD0D0D0,CC:true,align:pB.OC);NJ.width=140;NJ.height=36;NJ.wordWrap=false;NJ.x=646;NJ.y=130;NJ.VB=false;NJ.text="0";NJ.uB=0.9;n(NJ);QJ=new MC();QJ.SC=new aE("Arial",20,0xFFFFFF,CC:true,align:pB.OC);QJ.width=44;QJ.height=30;QJ.wordWrap=false;QJ.x=610;QJ.y=559;QJ.VB=false;QJ.text="3x";n(QJ);ZJ=new BB();n(ZJ);aJ=new BB();n(aJ);bJ=new BB();n(bJ);dJ=dB.KB.jB("Intro");eJ=dJ.play();}void start(){bI=1;UJ=1;XJ=0;VJ=3;bD g=new bD(dC.KB.oC("ESCStartText"));aJ.n(g);p.eB(()=>JJ.OF(21),1);g.show(()=>p.eB(()=>GK(),0.5));}void GK(){if(EJ!=null&&this.contains(EJ))ZJ.tB(EJ);int m=bI;int g=0;num h=0;switch (bI){case 01:h=50;EJ=new eF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;EJ=new eF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;EJ=new eF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;EJ=new eF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;EJ=new eF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;EJ=new eF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;EJ=new eF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;EJ=new eF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;EJ=new eF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;EJ=new eF(g=80+(bI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}WJ=g;if(VJ<3){VJ++ ;QJ.text="${VJ}x";}EJ.IB(bB.PE,HK);EJ.IB(bB.FD,IK);EJ.IB(bB.QE,JK);EJ.IB(bB.gD,KK);EJ.x=20;EJ.y=16;EJ.VB=false;ZJ.n(EJ);eI.reset(h);eI.TD("TimeShort",9);eI.TD("TimeOver",0);eI.pause();dI.level=m;dI.zE=g;dI.y=-210;lB k=new lB(dI,0.4,MB.rB);k.YB("y",-90);p.add(k);bD j=new bD(dC.KB.oC("ESCLevelBoxText").replaceAll("{0}","${g}"));aJ.n(j);j.show((){EJ.VB=true;eI.start();if(dJ!=null){PC i=new PC(1.0,0.0,4.0,MB.QC);i.KC=(l){eJ.EC.volume=l;eJ.EC=eJ.EC;};i.onComplete=(){eJ.stop();JJ.XH();};p.add(i);dJ=null;}});}void BK(AB g){LJ.start();}void xJ(AB g){EJ.ZF(xB.eD);}void IK(bB j){int g=0;PB k=j.info["Position"];String h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;OE i=new OE(g);i.x=k.x;i.y=k.y;ZJ.n(i);XJ=XJ+g;NJ.text="${XJ}";}void HK(bB j){int g=WJ;int i=j.info["Length"];int k=j.info["Factor"];g=(g>i)?g-i:0;WJ=g;dI.zE=g;if(g==0)EJ.ZF(xB.dD);int h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}XJ=XJ+h*k;NJ.text="${XJ}";}void JK(bB m){eI.pause();LJ.stop();LB l=dB.KB.jB("Laugh");LB k=dB.KB.jB("LevelUp");l.play();JJ.OF(3);BB g=FB.jF();g.x=55;g.y=260;ZJ.n(g);p.eB((){EJ.FF();k.play();},2.0);p.eB((){int j=(eI.hH*1000).toInt();OE h=new OE(j);h.x=704;h.y=360;ZJ.n(h);XJ=XJ+j;NJ.text="${XJ}";},2.5);lB i=new lB(dI,0.5,MB.rB);i.YB("y",-210);i.TC=3.0;p.add(i);p.eB((){ZJ.tB(g);},3.5);p.eB((){bI++ ;GK();},4.0);}void KK(bB j){LJ.stop();EJ.FF();bD g;LB i;if(UJ>0){UJ-- ;g=new bD(dC.KB.oC("GEN2ndchancetime"));aJ.n(g);i=dB.KB.jB("LevelUp");i.play();g.show((){p.eB(()=>GK(),0.5);lB h=new lB(dI,0.5,MB.rB);h.YB("y",-210);p.add(h);});}else{g=new bD(dC.KB.oC("GENtimeup"));aJ.n(g);i=dB.KB.jB("GameOver");i.play();g.show((){p.eB(()=>NK(),0.5);lB h=new lB(dI,0.5,MB.rB);h.YB("y",-210);p.add(h);});}}void sJ(q h){if(EJ!=null&&VJ>0){bool g=EJ.VF();if(g){VJ=VJ-1;QJ.text="${VJ}x";}}}void zJ(q j){BB h=new BB();h.n(new CB(new GB(800,600,false,0x000000)));h.alpha=0.6;bJ.n(h);hF g=new hF();g.x=235;g.y=150;bJ.n(g);g.show((bool i){bJ.tB(g);if(i==false)bJ.tB(h);else PK(false);});}NK(){BB h=new BB();CB j=new CB(FB.KB.t("ExitBox"));h.n(j);MC g=new MC();g.SC=new aE("Arial",30,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=200;g.wordWrap=true;g.text=dC.KB.oC("GENgameover");g.x=47;g.y=30+(g.height-g.JE)/2;g.VB=false;h.n(g);h.x=110;h.y=-h.height;aJ.n(h);LB k=dB.KB.jB("Laugh");p.eB(()=>k.play(),0.3);lB i=new lB(h,0.3,MB.rB);i.YB("y",150);p.add(i);p.eB(()=>PK(true),5.0);h.IB(q.ZC,(q l)=>PK(true));}bool RK=false;void PK(bool g){eI.pause();if(RK==false){RK=true;}}}class FB{static ND KB;static CB fD(int i,int h){CB g=new CB(KB.UC("Elements").t("Chain${i}${h}"));g.WC=25;g.XC=25;return g;}static CB iF(int i,int h){CB g=new CB(KB.UC("Elements").t("Link${i}${h}"));g.WC=25;g.XC=25;return g;}static CB hD(String h){CB g=new CB(KB.UC("Elements").t(h));g.WC=25;g.XC=25;return g;}static BB jF(){BB m=new BB();num l=0;hB o=KB.UC("Levelup");for(int k=0;k<7;k++ ){CB g=new CB(o.t("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;BB h=new BB();h.n(g);h.x=l+g.width/2;h.uB=0;h.DC=0;m.n(h);lB i=new lB(h,2.0,MB.BH);i.YB("scaleX",1.0);i.YB("scaleY",1.0);i.TC=k*0.05;lB j=new lB(h,0.4,MB.QC);j.YB("scaleX",0.0);j.YB("scaleY",0.0);j.TC=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static List<GB> lF(int h){hB i=KB.UC("Elements");List<GB> g=new List<GB>();g.add(i.t("JokerChain${h}0"));g.add(i.t("JokerChain${h}1"));g.add(i.t("JokerChain${h}2"));g.add(i.t("JokerChain${h}3"));g.add(i.t("JokerChain${h}4"));return g;}static List<GB> mF(int h){hB i=KB.UC("Elements");List<GB> g=new List<GB>();g.add(i.t("JokerLink${h}0"));g.add(i.t("JokerLink${h}1"));g.add(i.t("JokerLink${h}2"));g.add(i.t("JokerLink${h}3"));g.add(i.t("JokerLink${h}4"));return g;}static List<GB> nF(int h){hB i=KB.UC("Locks");List<GB> g=new List<GB>();g.add(i.t("Lock${h}0"));g.add(i.t("Lock${h}1"));g.add(i.t("Lock${h}2"));g.add(i.t("Lock${h}3"));g.add(i.t("Lock${h}4"));return g;}static List<GB> oF(){hB h=KB.UC("Head");List<GB> g=new List<GB>();g.add(h.t("Head1"));g.add(h.t("Head2"));g.add(h.t("Head3"));g.add(h.t("Head2"));g.add(h.t("Head1"));return g;}static List<GB> pF(){hB h=KB.UC("Alarm");List<GB> g=new List<GB>();g.add(h.t("Alarm0"));g.add(h.t("Alarm1"));g.add(h.t("Alarm2"));g.add(h.t("Alarm3"));g.add(h.t("Alarm4"));g.add(h.t("Alarm5"));return g;}}class fF extends BB{List<GB> fI;CB oI;PC BJ;fF(){fI=FB.oF();oI=new CB(fI[0]);oI.x=-oI.width/2;oI.y=-oI.height/2;n(oI);BJ=null;}void OF(int g){p.remove(BJ);BJ=new PC(0,g,0.5*g,MB.QC);BJ.KC=(h){int i=((h*fI.length)%fI.length).toInt();oI.RB=fI[i];oI.y=TB.sin(h*2*TB.PI)*3-oI.height/2;};p.add(BJ);}void XH(){p.remove(BJ);oI.RB=fI[0];}}class gF extends BB{int bI;MC kI;int rI;MC zI;BB FJ;gF(){n(new CB(FB.KB.t("InfoBox")));kI=new MC();kI.SC=new aE("Arial",35,0xFFFFFF,CC:true,align:pB.OC);kI.width=220;kI.height=40;kI.wordWrap=false;kI.text="Level 1";kI.x=20;kI.y=115;kI.ZB=-2*TB.PI/180;n(kI);zI=new MC();zI.SC=new aE("Arial",25,0xFFFFFF,CC:true,align:pB.OC);zI.width=220;zI.height=30;zI.wordWrap=false;zI.text="40";zI.x=-zI.width/2;zI.y=-zI.height/2;zI.ZB=-2*TB.PI/180;FJ=new BB();FJ.n(zI);FJ.x=150;FJ.y=172;n(FJ);CB g=FB.fD(3,0);g.x=110;g.y=171;g.ZB=-2*TB.PI/180;g.uB=g.DC=0.6;n(g);}void set level(int g){bI=g;kI.text="Level ${bI}";}void set zE(int g){rI=g;zI.text="${rI}";}}class DD extends BB{int ZI;CB iI;List<GB> sI;bool CJ;DD(int g){ZI=g;sI=FB.nF(g);CJ=true;iI=new CB(sI[0]);iI.x=-34;iI.y=-50;n(iI);}bool get BD=>CJ;void set BD(bool g){CJ=g;}void UF(bool g){iI.RB=sI[g?0:4];}void kH(){PC i=new PC(0.0,1.0,2.0,MB.rB);i.KC=(j){uB=DC=1.0+0.2*TB.sin(j*4*TB.PI);};lB g=new lB(this,0.2,MB.rB);g.YB("alpha",0.0);g.TC=2.0;g.onComplete=()=>UF(CJ);lB h=new lB(this,0.2,MB.vE);h.YB("alpha",1);h.TC=2.2;p.add(i);p.add(g);p.add(h);}}class bD extends BB{iD hI;Function nI;bD(String h){CB i=new CB(FB.KB.t("MessageBox"));n(i);MC g=new MC();g.SC=new aE("Arial",24,0xFFFFFF,CC:true,align:pB.OC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.JE/2;g.VB=false;n(g);hI=null;IB(q.ZC,kJ);}void show(Function h){this.parent.n(this);this.x=-this.width;this.y=150;nI=h;lB g=new lB(this,0.3,MB.rB);g.YB("x",110);g.onComplete=()=>hI=p.eB(yJ,10);p.add(g);}void yJ(){if(hI!=null){p.remove(hI);hI=null;nI();lB g=new lB(this,0.4,MB.vE);g.YB("x",800);g.onComplete=()=>this.parent.tB(this);p.add(g);}}void kJ(q g){yJ();}}class dB{static ND KB;}class u{static const String ED="None";static const String OB="Joker";static const String yB="Block";static const String RE="Double";static const String SE="Quint";}class xH extends BB implements qB{CB iI;List<GB> yI;num tI;xH(int g){this.VB=false;tI=0.0;yI=FB.lF(g);iI=new CB(yI[0]);iI.x=-25;iI.y=-25;n(iI);IB(AB.wC,(h)=>p.add(this));IB(AB.yC,(h)=>p.remove(this));}bool BC(num g){tI+= g;int h=(tI*10).toInt()%yI.length;iI.RB=yI[h];return true;}}class yH extends BB implements qB{CB iI;List<GB> yI;num tI;yH(int g){this.VB=false;tI=0.0;yI=FB.mF(g);iI=new CB(yI[0]);iI.x=-25;iI.y=-25;n(iI);IB(AB.wC,(h)=>p.add(this));IB(AB.yC,(h)=>p.remove(this));}bool BC(num g){tI+= g;int h=(tI*10).toInt()%yI.length;iI.RB=yI[h];return true;}}class zH extends BB implements qB{CB iI;num tI;zH(String h){this.VB=false;tI=0.0;iI=FB.hD(h);n(iI);IB(AB.wC,(g)=>p.add(this));IB(AB.yC,(g)=>p.remove(this));}bool BC(num g){tI+= g;this.ZB=TB.sin(tI*7)*10*TB.PI/180;return true;}}class dC{static ND KB;}class qC{int value=0;int XD([int inc=1])=>(value+= inc);int DF([int dec=1])=>(value-= dec);}class PE extends BB implements qB{List<cD> PJ;num tI;PE(int s,int o){PJ=new List<cD>();tI=0.0;this.VB=false;CB w=FB.fD(s,o);TB.Random m=new TB.Random();num i;num l;num EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=TB.PI*1.15;ZB=-TB.PI*2;}if(g==1&&h==0){i=TB.PI*1.85;ZB=TB.PI*2;}if(g==1&&h==1){i=TB.PI*0.15;ZB=TB.PI*2;}if(g==0&&h==1){i=TB.PI*0.85;ZB=-TB.PI*2;}i=i+0.2*TB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();CB j=new CB(w.RB);j.UD=new QB(g*25,h*25,25,25);j.WC=12.5+g*25;j.XC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);cD k=new cD();k.yE=j;k.XF=g*25+12.5;k.YF=h*25+12.5;k.angle=i;k.aF=l;k.ZB=ZB;PJ.add(k);}}}bool BC(num m){tI=TB.min(0.8,tI+m);num w=981.0;for(int h=0;h<PJ.length;h++ ){cD g=PJ[h];CB i=g.yE;num j=g.angle;num k=g.aF;num l=g.ZB;num o=g.XF+tI*(TB.cos(j)*k);num s=g.YF+tI*(TB.sin(j)*k+tI*w*0.5);i.x=o;i.y=s;i.ZB=tI*l;}if(tI>=0.6)this.alpha=(0.8-tI)/0.2;if(tI>=0.8)this.GE();return (tI<0.8);}}nC GD;nC eC;tF HD;jD p;CB YC;lB ID;MC zB;void main(){GD=new nC("StageBackground",iC.query('#stageBackground'));eC=new nC("StageForeground",iC.query('#stageForeground'));HD=new tF();HD.xE(GD);HD.xE(eC);p=HD.TH;gB.Future<GB> g=GB.wE("images/Loading.png");g.then((h){YC=new CB(h);YC.WC=20;YC.XC=20;YC.x=400;YC.y=270;eC.n(YC);ID=new lB(YC,100,MB.QC);ID.YB("rotation",100.0*2.0*TB.PI);p.add(ID);zB=new MC();zB.SC=new aE("Arial",20,0xA0A0A0,CC:true);zB.width=240;zB.height=40;zB.text="... loading ...";zB.x=400-zB.lH/2;zB.y=320;zB.VB=false;eC.n(zB);kF();});}void kF(){var g=new ND();g.iB("Background","images/Background.jpg");g.iB("ExitBox","images/ExitBox.png");g.iB("ExitButtonNormal","images/ExitButtonNormal.png");g.iB("ExitButtonPressed","images/ExitButtonPressed.png");g.iB("ExitGauge","images/ExitGauge.png");g.iB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.iB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.iB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.iB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.iB("InfoBox","images/InfoBox.png");g.iB("MessageBox","images/MessageBox.png");g.iB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.iB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.iB("TimeGauge","images/TimeGauge.png");g.zC("Alarm","images/AlarmTextureAtlas.json",fC.mC);g.zC("Head","images/HeadTextureAtlas.json",fC.mC);g.zC("Elements","images/ElementsTextureAtlas.json",fC.mC);g.zC("Levelup","images/LevelupTextureAtlas.json",fC.mC);g.zC("Locks","images/LocksTextureAtlas.json",fC.mC);g.aB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.aB("BonusUniversal","sounds/BonusUniversal.mp3");g.aB("ChainBlast","sounds/ChainBlast.mp3");g.aB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.aB("ChainError","sounds/ChainError.mp3");g.aB("ChainFall","sounds/ChainFall.mp3");g.aB("ChainHelp","sounds/ChainHelp.mp3");g.aB("ChainLink","sounds/ChainLink.mp3");g.aB("ChainRotate","sounds/ChainRotate.mp3");g.aB("Click","sounds/Click.mp3");g.aB("GameOver","sounds/GameOver.mp3");g.aB("Laugh","sounds/Laugh.mp3");g.aB("LevelUp","sounds/LevelUp.mp3");g.aB("PointsCounter","sounds/PointsCounter.mp3");g.aB("Unlock","sounds/Unlock.mp3");g.aB("Warning","sounds/Warning.mp3");g.aB("Intro","sounds/Intro.mp3");g.mB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.mB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.mB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.mB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.mB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.mB("ESCNoActionHint","Press on the chain links to twist them.");g.mB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.mB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.mB("ESCtogo","Chain links:");g.mB("GENexitquery","Do you really want to quit the game?");g.mB("GEN2ndchancetime","Time is up. Second chance!");g.mB("GENtimeup","Sorry! Your time is up.");g.mB("GENgameover","Game Over");g.load().then((l){eC.tB(YC);eC.tB(zB);p.remove(ID);FB.KB=g;dB.KB=g;dC.KB=g;CB j=new CB(FB.KB.t("Background"));GD.n(j);GD.gH=jC.vD;dF i=new dF();eC.n(i);i.start();}).catchError((k){for(var h in g.GF){print("Loading resouce failed: ${h.kind}.${h.name} - ${h.error}");}});}class LC{Map<String,tC> gK;bool LH(String g){if(gK!=null)return gK.containsKey(g)||gK.containsKey("${g}_CAPTURE");else return false;}gB.StreamSubscription<AB> IB(String g,void i(event),{bool useCapture: false}){var h=CM(g,useCapture);var j=h.listen(i);return j;}void dispatchEvent(AB g){nN(g,this,this,gC.OD);}void nN(AB g,LC k,LC l,int i){if(gK!=null){var j=(i==gC.cE)?"${g.type}_CAPTURE":g.type;var h=gK[j];if(h!=null){g.EL=k;g.iN=l;g.dN=i;g.kN=false;g.mN=false;h.cN(g);}}}tC CM(String g,bool j){if(gK==null)gK=new Map<String,tC>();var i=j?"${g}_CAPTURE":g;var h=gK[i];if(h==null)h=gK[i]=new tC(this,g,j);return h;}}class JD<vC extends AB>{final List<tC> gK;int LL=0;JD():gK=new List<tC>(50);static JD<TE> pE=new JD<TE>();void wM(tC g){for(int h=0;h<LL;h++ )if(gK[h]==g)return;if(LL==gK.length)gK.add(g);else gK[LL]=g;LL++ ;}void cN(AB j){j.dN=gC.OD;j.kN=false;j.mN=false;int k=LL;int i=0;for(int g=0;g<k;g++ ){var h=gK[g];if(h==null)continue;if(h.IM==0){gK[g]=null;continue;}j.EL=h.EL;j.iN=h.EL;h.cN(j);if(i!=g){gK[i]=h;gK[g]=null;}i++ ;}if(i!=k){for(int g=k;g<LL;g++ ){gK[i++ ]=gK[g];gK[g]=null;}LL=i;}}}class aE{String font;int size;int color;bool CC;bool HF;bool oH;String align;int UH;int iH;int OH;int FE;int letterSpacing=0;int DI=0;bool EI=false;bool KI=false;aE(this.font,this.size,this.color,{this.CC: false,this.HF: false,this.oH: false,this.align: "left",this.UH: 0,this.iH: 0,this.OH: 0,this.FE: 0});}class iD implements qB{final Function qK;num AL=0.0;num OL=0.0;int YL=1;iD(Function g,num h):qK=g{OL=TB.max(h,0.0001);}bool BC(num h){num g=AL+h;while (g>=OL&&YL>0){AL=OL;YL-- ;qK();g-= OL;}AL=g;return (YL>0);}num get totalTime=>OL;num get currentTime=>AL;}abstract class qB{bool BC(num g);}class jD implements qB{final List<qB> tK=new List<qB>();int UL=0;num fL=0.0;void add(qB g){if(g==null)return;if(UL==tK.length){tK.add(g);}else{tK[UL]=g;}UL++ ;}void remove(qB h){if(h==null)return;for(int g=0;g<UL;g++ ){if(tK[g]==h){tK[g]=null;break;}}}iD eB(Function h,num i){iD g=new iD(h,i);add(g);return g;}bool BC(num k){fL+= k;int j=UL;int h=0;for(int g=0;g<j;g++ ){var i=tK[g];if(i==null)continue;if(i.BC(k)==false){tK[g]=null;continue;}if(h!=g){tK[h]=i;tK[g]=null;}h++ ;}if(h!=j){for(int g=j;g<UL;g++ ){tK[h++ ]=tK[g];tK[g]=null;}UL=h;}return true;}}class rF{static const String EG="pixel";}class sF{String name;num vB;num IE;sF(this.name,this.vB,this.IE);}class AI extends NC{bool iK;XB CL;AI(VE i,bool h,XB g){iK=h;CL=g;}XB get EC=>CL;set EC(XB g){CL=g;}void stop(){}}class VE extends LB{VE(){}static gB.Future<LB> wE(String g){return new gB.Future<LB>.of(()=>new VE());}num get length{return double.NAN;}NC play([bool loop=false,XB soundTransform]){if(soundTransform==null){soundTransform=new XB();}return new AI(this,loop,soundTransform);}}class PB{num x;num y;PB(this.x,this.y);PB.TI():this(0,0);num get length=>TB.sqrt(this.x*this.x+this.y*this.y);PB add(PB g)=>new PB(this.x+g.x,this.y+g.y);void DE(PB g){this.x=g.x;this.y=g.y;}bool equals(PB g)=>this.x==g.x&&this.y==g.y;}class QB{num x;num y;num width;num height;QB(this.x,this.y,this.width,this.height);QB.TI():this(0,0,0,0);num get left=>this.x;num get top=>this.y;num get right=>this.x+this.width;num get bottom=>this.y+this.height;PB get size=>new PB(this.width,this.height);void set bottom(num g){this.height=g-this.y;}void set left(num g){this.x=g;}void set right(num g){this.width=g-this.x;}void set top(num g){this.y=g;}bool contains(num g,num h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h);bool equals(QB g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height);bool get isEmpty=>(this.width==0&&this.height==0);void DE(QB g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class vF{vF();}class UB{num UK,VK,XK,YK,bK,eK;num hK;UB.VI():UK=1.0,VK=0.0,XK=0.0,YK=1.0,bK=0.0,eK=0.0,hK=1.0;num get a=>UK;num get b=>VK;num get c=>XK;num get d=>YK;num get FC=>bK;num get GC=>eK;num get bC=>hK;PB nH(PB g){return new PB(g.x*UK+g.y*XK+bK,g.x*VK+g.y*YK+eK);}void concat(UB g){num m=UK;num w=VK;num EB=XK;num s=YK;num l=bK;num o=eK;num SB=hK;num j=g.a;num k=g.b;num i=g.c;num h=g.d;num fB=g.FC;num JB=g.GC;num wB=g.bC;UK=(m*j+w*i);VK=(m*k+w*h);XK=(EB*j+s*i);YK=(EB*k+s*h);bK=(l*j+o*i+fB);eK=(l*k+o*h+JB);hK=(SB*wB);}void MH(){UK=1.0;VK=0.0;XK=0.0;YK=1.0;bK=0.0;eK=0.0;hK=1.0;}void SH(){num j=UK;num m=VK;num l=XK;num k=YK;num h=bK;num i=eK;num g=hK;UK=(k/g);VK=-(m/g);XK=-(l/g);YK=(j/g);bK=-(UK*h+XK*i);eK=-(VK*h+YK*i);hK=(1.0/g);}void TF(num h,num i,num g,num j,num k,num l){UK=h;VK=i;XK=g;YK=j;bK=k;eK=l;hK=(h*j-i*g);}void DE(UB g){UK=g.a;VK=g.b;XK=g.c;YK=g.d;bK=g.FC;eK=g.GC;hK=g.bC;}void EE(UB h,UB g){num o=h.a;num EB=h.b;num JB=h.c;num w=h.d;num m=h.FC;num s=h.GC;num fB=h.bC;num k=g.a;num l=g.b;num j=g.c;num i=g.d;num wB=g.FC;num SB=g.GC;num cC=g.bC;UK=(o*k+EB*j);VK=(o*l+EB*i);XK=(JB*k+w*j);YK=(JB*l+w*i);bK=(m*k+s*j+wB);eK=(m*l+s*i+SB);hK=(fB*cC);}}class tF{jD WK;List<nC> kK;num uK;JD PL;TE dL;tF(){WK=new jD();kK=new List<nC>();uK=double.NAN;PL=JD.pE;dL=new TE(0);iC.window.requestAnimationFrame(hM);}jD get TH=>WK;void hM(num g){iC.window.requestAnimationFrame(hM);if(uK.isNaN)uK=g;if(uK>g)uK=g;num j=g-uK;num i=j/1000.0;if(j>=1){uK=g;dL.fK=i;PL.cN(dL);WK.BC(i);for(int h=0;h<kK.length;h++ ){var k=kK[h];k.VH();}}}void xE(nC g){kK.add(g);}}class AC{final iC.CanvasRenderingContext2D lK;final List<UB> GL=new List<UB>.fixedLength(100);final List<double> kL=new List<double>.fixedLength(100);int BM=0;AC.WI(iC.CanvasRenderingContext2D j,[UB matrix]):lK=j{for(int h=0;h<100;h++ ){GL[h]=new UB.VI();kL[h]=1.0;}if(matrix!=null)GL[0].DE(matrix);var g=GL[0];var i=kL[0];lK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);lK.globalAlpha=i;}iC.CanvasRenderingContext2D get context=>lK;void reset(){BM=0;var g=GL[0];var h=kL[0];lK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);lK.globalAlpha=h;lK.clearRect(0,0,lK.canvas.width,lK.canvas.height);}void SF(v h){var i=BM;var j=BM+1;var l=GL[i];var g=GL[j];var m=kL[i];var k=kL[j]=h.RM*m;g.EE(h.fN,l);lK.setTransform(g.a,g.b,g.c,g.d,g.FC,g.GC);lK.globalAlpha=k;BM=j;if(h.mask==null){h.nB(this);}else{lK.save();h.mask.nB(this);h.nB(this);lK.restore();}BM=i;}}class jC{static const String qD="auto";static const String GG="stop";static const String vD="once";}class AB{static const String BG="added";static const String wC="addedToStage";static const String iE="enterFrame";static const String TG="removed";static const String yC="removedFromStage";String TK;bool aN;int dN;LC EL;LC iN;bool kN;bool mN;AB(String g,[bool bubbles=false]){HN(g,bubbles);}void HN(String g,[bool bubbles=false]){TK=g;aN=bubbles;dN=gC.OD;EL=null;iN=null;kN=false;mN=false;}bool get HE=>kN;String get type=>TK;bool get bubbles=>aN;bool get BE=>true;LC get target=>EL;}class gC{static const int cE=1;static const int OD=2;static const int MG=3;}abstract class lC extends NB{final List<v> NL=new List<v>();bool gL=true;bool pL=true;void n(v g){if(g.parent==this){int h=NL.indexOf(g);NL.removeAt(h);NL.add(g);}else{CH(g,NL.length);}}void CH(v g,int h){if(h<0&&h>NL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){NL.removeAt(NL.indexOf(g));if(h>NL.length)h-- ;NL.insertRange(h,1,g);}else{g.GE();g.zN(this);NL.insertRange(h,1,g);g.dispatchEvent(new AB(AB.BG,true));if(this.ZD!=null)AO(g,new AB(AB.wC));}}void tB(v h){int g=NL.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");fH(g);}void fH(int g){if(g<0&&g>=NL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");v h=NL[g];h.dispatchEvent(new AB(AB.TG,true));if(this.ZD!=null)AO(h,new AB(AB.yC));h.zN(null);NL.removeAt(g);}bool contains(v g){for(;g!=null;g=g.jM)if(g==this)return true;return false;}QB sB(UB o,[QB returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.TI();if(NL.length==0)return super.sB(o,returnRectangle);num h=double.INFINITY;num i=double.INFINITY;num k=double.NEGATIVE_INFINITY;num j=double.NEGATIVE_INFINITY;int s=NL.length;for(int l=0;l<NL.length;l++ ){v m=NL[l];uM.EE(m.fN,o);QB g=m.sB(uM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>k)k=g.right;if(g.bottom>j)j=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=k-h;returnRectangle.height=j-i;return returnRectangle;}v VC(num s,num w){v l=null;for(int j=NL.length-1;j>=0;j-- ){v i=NL[j];if(i.visible){UB g=i.fN;double m=s-g.FC;double k=w-g.GC;double EB=(g.d*m-g.c*k)/g.bC;double o=(g.a*k-g.b*m)/g.bC;var h=i.VC(EB,o);if(h!=null){if(h is NB)if(h.VB)return gL?h:this;l=this;}}}return l;}void nB(AC i){for(int g=0;g<NL.length;g++ ){v h=NL[g];if(h.visible)i.SF(h);}}void AO(v g,AB j){g.dispatchEvent(j);if(g is lC){List<v> i=new List<v>.from(g.NL);for(int h=0;h<i.length;h++ )AO(i[h],j);}}}class hB{iC.ImageElement aK;List<ZE> BL;hB(){aK=new iC.ImageElement();BL=new List<ZE>();}static gB.Future<hB> wE(String m,String SB){gB.Completer<hB> l=new gB.Completer<hB>();hB j=new hB();switch (SB){case fC.zF:case fC.mC:void o(String k,Map g){var EB=nG(k);var h=new ZE(EB,j);h.DL=g["frame"]["x"].toInt();h.ML=g["frame"]["y"].toInt();h.SL=g["frame"]["w"].toInt();h.aL=g["frame"]["h"].toInt();h.iL=g["spriteSourceSize"]["x"].toInt();h.oL=g["spriteSourceSize"]["y"].toInt();h.rL=g["sourceSize"]["w"].toInt();h.zL=g["sourceSize"]["h"].toInt();h.GM=g["rotated"] as bool;j.BL.add(h);}iC.HttpRequest.getString(m).then((JB){var s=qH.parse(JB);var i=s["frames"];var w=s["meta"];if(i is List)for(var g in i)o(g["filename"],g);if(i is Map)for(String k in i.keys)o(k,i[k]);j.aK..onLoad.listen((fB)=>l.complete(j))..onError.listen((fB)=>l.completeError(new StateError("Failed to load image.")))..src=rG(m,w["image"]);}).catchError((wB){l.completeError(new StateError("Failed to load json file."));});break;}return l.future;}iC.ImageElement get NH=>aK;GB t(String i){GB h;for(int g=0;g<BL.length&&h==null;g++ )if(BL[g].name==i)h=new GB.YI(BL[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}}class tC<vC extends AB> extends gB.Stream<vC>{final LC EL;final String sK;final bool cL;final List<AG> tL=new List<AG>(5);int IM=0;tC(this.EL,this.sK,this.cL);bool get isBroadcast=>true;gB.Stream<vC> asBroadcastStream()=>this;gB.StreamSubscription<vC> listen(void h(vC event),{void onError(gB.AsyncError error),void onDone(),bool unsubscribeOnError}){var g=new AG<vC>(this,h);if(IM==tL.length)tL.add(g);else tL[IM]=g;IM++ ;if(sK==AB.iE&&cL==false)JD.pE.wM(this);return g;}void AN(gB.StreamSubscription h){for(int g=0;g<IM;g++ ){if(tL[g]==h){tL[g]=null;break;}}}void cN(vC k){int j=IM;int h=0;for(int g=0;g<j;g++ ){var i=tL[g];if(i==null)continue;i.uL(k);if(h!=g){tL[h]=i;tL[g]=null;}h++ ;}if(h!=j){for(int g=j;g<IM;g++ ){tL[h++ ]=tL[g];tL[g]=null;}IM=h;}}}class IC<vC extends AB>{final String sK;const IC(this.sK);gB.Stream<vC> forTarget(LC g,{bool useCapture: false}){return g.CM(sK,useCapture);}}class BI extends NC{nD xK;XB CL;bool iK;bF.GainNode jL;bF.AudioBufferSourceNode vL;BI(nD j,bool h,XB i){xK=j;iK=h;CL=i;var g=uC.SD;jL=g.createGain();jL.connect(g.destination,0,0);jL.gain.value=(CL!=null)?TB.pow(CL.volume,2):1;vL=g.createBufferSource();vL.buffer=xK.mK;vL.loop=h;vL.connect(jL,0,0);vL.start(0);}XB get EC=>CL;void set EC(XB g){CL=g;jL.gain.value=(CL!=null)?TB.pow(CL.volume,2):1;}void stop(){vL.stop(0);}}class TE extends AB{num fK;TE(num g):super(AB.iE,false){fK=g;}bool get BE=>false;}class q extends AB{static const String ZC="click";static const String KG="doubleClick";static const String PD="mouseDown";static const String xD="mouseUp";static const String nE="mouseMove";static const String RD="mouseOut";static const String oE="mouseOver";static const String cG="mouseWheel";static const String rE="middleClick";static const String gG="middleMouseDown";static const String iG="middleMouseUp";static const String sE="rightClick";static const String mG="rightMouseDown";static const String pG="rightMouseUp";num QN,RN;num TN,UN;bool sN;bool VM;bool mM;bool ZM;bool cM;int uN;int vN;int wN;q(String g,[bool bubbles=false]):super(g,bubbles){HN(g,bubbles);}void HN(String g,[bool bubbles=false]){super.HN(g,bubbles);QN=RN=0;TN=UN=0;sN=false;VM=false;mM=false;ZM=false;cM=false;uN=0;vN=0;wN=0;}set xN(PB g){QN=g.x;RN=g.y;}set yN(PB g){TN=g.x;UN=g.y;}num get IF=>QN;num get JF=>RN;bool get RC=>sN;bool get altKey=>VM;bool get ctrlKey=>ZM;bool get shiftKey=>cM;int get AD=>uN;}class HC extends AB{static const String rD="keyDown";static const String eE="keyUp";bool VM;bool ZM;bool cM;bool eM;bool mM;int pM;int sM;int vM;HC(String g,[bool bubbles=false]):super(g,bubbles){HN(g,bubbles);}void HN(String g,[bool bubbles=false]){super.HN(g,bubbles);VM=false;ZM=false;cM=false;eM=false;mM=false;pM=0;sM=0;vM=0;}bool get altKey=>VM;bool get ctrlKey=>ZM;bool get shiftKey=>cM;int get charCode=>pM;int get keyCode=>sM;int get keyLocation=>vM;}class UE extends AB{static const String IG="textInput";String jK="";UE(String g,[bool bubbles=false]):super(g,bubbles){}}class WB extends AB{static const String dE="touchBegin";static const String fE="touchEnd";static const String hE="touchCancel";static const String mE="touchMove";static const String XG="touchOver";static const String YG="touchOut";int NN;bool PN;num QN,RN;num TN,UN;bool VM;bool mM;bool ZM;bool cM;num WN;int YN;int ZN;WB(String g,[bool bubbles=false]):super(g,bubbles){HN(g,bubbles);}void HN(String g,[bool bubbles=false]){super.HN(g,bubbles);NN=0;PN=false;QN=RN=0;TN=UN=0;VM=false;mM=false;ZM=false;cM=false;WN=1.00;YN=0;ZN=0;}set xN(PB g){QN=g.x;RN=g.y;}set yN(PB g){TN=g.x;UN=g.y;}int get aD=>NN;num get IF=>QN;num get JF=>RN;bool get altKey=>VM;bool get ctrlKey=>ZM;bool get shiftKey=>cM;}class fC{static const String zF="json";static const String mC="jsonarray";}class ZE{String ZK;hB pK;int DL;int ML;int SL;int aL;int iL;int oL;int rL;int zL;bool GM;ZE(String g,hB h){ZK=g;pK=h;}hB get mH=>pK;String get name=>ZK;int get JH=>DL;int get KH=>ML;int get IH=>SL;int get HH=>aL;int get offsetX=>iL;int get offsetY=>oL;int get aH=>rL;int get ZH=>zL;bool get jH=>GM;}class pB{static const String OC="center";static const String HG="end";static const String NG="justify";static const String LG="right";}class lD{num DH;num FH;num height;num FE;num width;num x;lD(this.x,this.width,this.height,this.DH,this.FH,this.FE);}class kC{static const int xF=0;static const int CG=1;static const int LG=2;static const int PG=3;static const int kE=4;}abstract class v extends LC implements XE{num IL=0.0;num QL=0.0;num WL=0.0;num eL=0.0;num mL=1.0;num sL=1.0;num AM=0.0;UB HM;bool KM;num RM=1.0;bool TM=true;oD YM=null;String ZK="";lC jM=null;UB uM;UB yM;v(){HM=new UB.VI();KM=true;uM=new UB.VI();yM=new UB.VI();}num get x=>IL;num get y=>QL;num get WC=>WL;num get XC=>eL;num get uB=>mL;num get DC=>sL;num get ZB=>AM;num get alpha=>RM;bool get visible=>TM;oD get mask=>YM;String get name=>ZK;lC get parent=>jM;v get root{v g=this;while (g.jM!=null)g=g.jM;return g;}nC get ZD{v g=this.root;if(g is nC)return g;return null;}set x(num g){IL=g;KM=true;}set y(num g){QL=g;KM=true;}set WC(num g){WL=g;KM=true;}set XC(num g){eL=g;KM=true;}set uB(num g){mL=g;KM=true;}set DC(num g){sL=g;KM=true;}set ZB(num g){AM=g;KM=true;}set alpha(num g){RM=g;KM=true;}set mask(oD g){YM=g;}num get width=>sB(fN).width;num get height=>sB(fN).height;void set width(num h){this.uB=1;num g=this.width;this.uB=(g!=0.0)?h/g:1.0;}void set height(num h){this.DC=1;num g=this.height;this.DC=(g!=0.0)?h/g:1.0;}void GE(){if(jM!=null)jM.tB(this);}UB get fN{if(KM){KM=false;if(AM==0.0){HM.TF(mL,0.0,0.0,sL,IL-WL*mL,QL-eL*sL);}else{double g=TB.cos(AM);double h=TB.sin(AM);double i=mL*g;double l=mL*h;double k=-sL*h;double j=sL*g;double m=IL-WL*i-eL*k;double o=QL-WL*l-eL*j;HM.TF(i,l,k,j,m,o);}}return HM;}QB sB(UB g,[QB returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.TI();returnRectangle.x=g.FC;returnRectangle.y=g.GC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;}v VC(num g,num h){if(sB(yM).contains(g,h))return this;return null;}PB pC(PB h){uM.MH();for(v g=this;g!=null;g=g.jM)uM.concat(g.fN);uM.SH();return uM.nH(h);}void dispatchEvent(AB h){List<v> g=null;if(h.BE||h.bubbles)for(v j=jM;j!=null;j=j.jM)if(j.LH(h.type)){if(g==null)g=new List<v>();g.add(j);}if(h.BE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.HE==false)g[i].nN(h,this,g[i],gC.cE);if(h.HE==false)nN(h,this,this,gC.OD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.HE==false)g[i].nN(h,this,g[i],gC.MG);}void zN(lC h){for(var g=h;g!=null;g=g.jM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");jM=h;}void nB(AC g);}abstract class NB extends v{bool GH=false;bool VB=true;bool SI=true;int tabIndex=0;static const IC<q> WG=const IC<q>(q.RD);static const IC<q> hG=const IC<q>(q.nE);static const IC<q> kG=const IC<q>(q.PD);static const IC<q> qG=const IC<q>(q.xD);static const IC<q> vG=const IC<q>(q.cG);gB.Stream<q> get onMouseOut=>NB.WG.forTarget(this);gB.Stream<q> get onMouseMove=>NB.hG.forTarget(this);gB.Stream<q> get onMouseDown=>NB.kG.forTarget(this);gB.Stream<q> get onMouseUp=>NB.qG.forTarget(this);gB.Stream<q> get onMouseWheel=>NB.vG.forTarget(this);static const IC<WB> wG=const IC<WB>(WB.mE);static const IC<WB> xG=const IC<WB>(WB.fE);static const IC<WB> yG=const IC<WB>(WB.hE);gB.Stream<WB> get onTouchMove=>NB.wG.forTarget(this);gB.Stream<WB> get onTouchEnd=>NB.xG.forTarget(this);gB.Stream<WB> get onTouchCancel=>NB.yG.forTarget(this);static const IC<HC> zG=const IC<HC>(HC.eE);static const IC<HC> AH=const IC<HC>(HC.rD);gB.Stream<HC> get onKeyUp=>NB.zG.forTarget(this);gB.Stream<HC> get onKeyDown=>NB.AH.forTarget(this);}class qF{static const String yF="dynamic";}class YE{NB target=null;bool RC=false;int CE=0;int AD=0;String MF,NF;String KF,LF;YE(this.MF,this.NF,this.KF,this.LF);}class KD{String dK;String ZK;String yK;gB.Future KL;dynamic TL;dynamic ZL;KD(String g,String h,String i){dK=g;ZK=h;yK=i;TL=null;ZL=null;}String get kind=>dK;String get name=>ZK;dynamic get CD=>ZL;dynamic get error=>TL;KN(gB.Future i){KL=i.then((g){ZL=g;TL=null;},onError:(gB.AsyncError h){ZL=null;TL=h.error;});}}class LD extends NC{mD zK;iC.AudioElement nK;bool iK;XB CL;LD(mD g,bool i,XB h){zK=g;iK=i;CL=h;nK=g.iM(this);nK.loop=iK;this.EC=h;nK.play();}XB get EC=>CL;void set EC(XB g){CL=g;if(nK!=null)nK.volume=(CL!=null)?CL.volume:1;}void stop(){if(nK!=null){if(nK.ended==false)nK.pause();zK.tN(this);nK=null;}}}class BB extends lC{bool FI=false;bool LE=false;}class CB extends v{GB RB;String dH;QB UD;CB([this.RB=null,this.dH="auto"]){UD=null;}QB sB(UB h,[QB returnRectangle]){int g=(RB!=null)?RB.width:0;int i=(RB!=null)?RB.height:0;return AE(h,g,i,returnRectangle);}v VC(num g,num h){if(RB!=null&&g>=0.0&&h>=0.0&&g<RB.width&&h<RB.height)return this;return null;}void nB(AC g){if(RB!=null){if(UD==null)RB.nB(g);else RB.RF(g,UD);}}}class MC extends NB{String jK="";int wK=0x000000;aE RL=null;String hL=uF.JG;String wL=rF.EG;String TK=qF.yF;bool LM=false;bool QM=false;int UM=0x000000;bool aM=false;int fM=0x000000;num kM=0;num nM=0;List<String> qM;List<lD> xM;bool BN=true;num CN=100;num GN=100;iC.CanvasElement JN=null;iC.CanvasRenderingContext2D lK=null;MC(){RL=new aE("Arial",12,0x000000);qM=new List<String>();xM=new List<lD>();}String get type=>TK;num get width=>CN;num get height=>GN;void set text(String g){jK=g;BN=true;}void set SC(aE g){RL=g;wK=RL.color;BN=true;}void set wordWrap(bool g){LM=g;BN=true;}void set width(num g){CN=g;BN=true;}void set height(num g){GN=g;BN=true;}num get lH{EO();return kM;}num get JE{EO();return nM;}QB sB(UB g,[QB returnRectangle]){return AE(g,CN,GN,returnRectangle);}v VC(num g,num h){if(g>=0&&h>=0&&g<CN&&h<GN)return this;return null;}void nB(AC g){EO();g.lK.drawImage(JN,0.0,0.0);}void GO(){qM.clear();xM.clear();if(LM==false){qM.add(jK);}else{StringBuffer g=new StringBuffer();int i;String h;for(String o in jK.replaceAll('\r','').split('\n')){for(String j in o.split(' ')){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(lK.measureText(h).width>CN){if(i>0)h=h.substring(0,i);else j="";qM.add(h);g.clear();g.add(j);}}if(g.isEmpty==false){qM.add(g.toString());g.clear();}}}kM=0;nM=0;for(String h in qM){var l=lK.measureText(h);var m=0;if(RL.align==pB.OC||RL.align==pB.NG)m=(CN-l.width)/2;if(RL.align==pB.LG||RL.align==pB.HG)m=CN-l.width;lD k=new lD(m,l.width,RL.size,0,0,0);xM.add(k);kM=TB.max(kM,k.width);nM=nM+k.height;}}void EO(){if(BN){BN=false;int j=CN.ceil().toInt();int i=GN.ceil().toInt();if(JN==null){JN=new iC.CanvasElement(width:j,height:i);lK=JN.context2d;}if(JN.width!=j)JN.width=j;if(JN.height!=i)JN.height=i;StringBuffer g=new StringBuffer();g.add(RL.HF?"italic ":"normal ");g.add("normal ");g.add(RL.CC?"bold ":"normal ");g.add("${RL.size}px ");g.add("${RL.font},sans-serif");lK.font=g.toString();lK.textAlign="start";lK.textBaseline="top";lK.fillStyle=xC(wK);GO();if(QM){lK.fillStyle=xC(UM);lK.fillRect(0,0,CN,GN);}else{lK.clearRect(0,0,CN,GN);}int k=0;for(int h=0;h<qM.length;h++ ){lD l=xM[h];lK.fillStyle=xC(wK);lK.fillText(qM[h],l.x,k);k+= l.height;}if(aM){lK.strokeStyle=xC(fM);lK.lineWidth=1;lK.strokeRect(0,0,CN,GN);}}}}abstract class XE{void nB(AC g);}class kD{static String bE=oB.qD;static bool DG=false;static gB.StreamController<String> QG=new gB.StreamController<String>();static gB.Stream<String> UG=QG.stream.asBroadcastStream();static String uE(String i){String h=i;String g="auto";if(bE!=oB.qD)h=bE;switch (h){case oB.qD:g="auto";break;case oB.tD:g="default";break;case oB.uD:g="pointer";break;case oB.RG:g="move";break;case oB.SG:g="text";break;case oB.VG:g="wait";break;}if(DG)g="none";return g;}}class oB{static const String qD="auto";static const String tD="arrow";static const String uD="button";static const String RG="hand";static const String SG="ibeam";static const String VG="wait";}class sC extends NB{v KE;v PF;v EF;v WD;bool LE=true;bool enabled=true;v FM;sC([this.KE,this.PF,this.EF,this.WD]){IB(q.oE,dM);IB(q.RD,dM);IB(q.PD,dM);IB(q.xD,dM);FM=this.KE;}QB sB(UB g,[QB returnRectangle]){if(FM!=null){uM.EE(FM.fN,g);return FM.sB(uM,returnRectangle);}return super.sB(g,returnRectangle);}v VC(num k,num l){if(this.WD!=null){UB g=this.WD.fN;double h=k-g.FC;double i=l-g.GC;double m=(g.d*h-g.c*i)/g.bC;double j=(g.a*i-g.b*h)/g.bC;if(this.WD.VC(m,j)!=null)return this;}return null;}void nB(AC g){if(FM!=null)g.SF(FM);}void dM(q g){if(g.type==q.RD){FM=KE;}else{FM=g.RC?EF:PF;}}}class mD extends LB{iC.AudioElement nK;List<iC.AudioElement> HL;List<LD> bL;mD(){bL=new List<LD>();nK=new iC.AudioElement();nK.onEnded.listen(PM);HL=new List<iC.AudioElement>();HL.add(nK);iC.document.body.children.add(nK);}static gB.Future<LB> wE(String s){var k=new mD();var g=k.nK;var i=new gB.Completer<LB>();gB.StreamSubscription h;gB.StreamSubscription j;o(m){h.cancel();j.cancel();i.complete(k);}l(m){h.cancel();j.cancel();i.completeError(new StateError("Failed to load audio."));}h=g.onCanPlayThrough.listen(o);j=g.onError.listen(l);g.src=LB.tE(s);g.load();return i.future;}num get length{return nK.duration;}NC play([bool loop=false,XB soundTransform]){if(soundTransform==null)soundTransform=new XB();return new LD(this,loop,soundTransform);}iC.AudioElement iM(LD h){iC.AudioElement g;if(HL.length==0){g=nK.clone(true);g.onEnded.listen(PM);}else{g=HL.removeAt(0);}bL.add(h);return g;}void tN(LD g){iC.AudioElement h=g.nK;int i=bL.indexOf(g);bL.removeAt(i);HL.add(h);if(nK.currentTime>0&&nK.ended==false)nK.currentTime=0;}void PM(j){iC.AudioElement i=j.target;LD g=null;for(int h=0;h<bL.length&&g==null;h++ )if(bL[h].nK==i)g=bL[h];if(g!=null)g.stop();}}class uC{static String ZG=oG();static bF.AudioContext SD=sG();static List<String> qE=tG();static String oG(){var h=(SD!=null)?"WebAudioApi":"AudioElement";var g=iC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(qE.length==0)h="Mock";print("dartflash: supported audio engine is: ${h}");return h;}static bF.AudioContext sG(){try {return new bF.AudioContext();}catch (g){return null;}}static List<String> tG(){var g=new List<String>();var h=new iC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("dartflash: supported audio types are: ${g}");return g;}}class XB{num volume;num bH;num LI=1;num MI=0;num RI=1;num QI=0;XB([this.volume=1,this.bH=0]);}class WE{static const String JG="none";static const String OG="touchPoint";}abstract class NC extends LC{XB get EC;void set EC(XB g);void stop();}class uF{static const String JG="none";}class oD{int TK;QB cK;vF rK;List<PB> FL;oD.UI(num i,num g,num h,num j){TK=0;cK=new QB(i,g,h,j);}void nB(AC i){var g=i.context;g.beginPath();switch (TK){case 0:g.rect(cK.x,cK.y,cK.width,cK.height);break;case 1:g.arc(rK.x,rK.y,rK.NI,0,TB.PI*2.0,false);break;case 2:g.moveTo(FL[0].x,FL[0].y);for(int h=1;h<FL.length;h++ )g.lineTo(FL[h].x,FL[h].y);break;}g.clip();}}class MD extends v{static const String sD='DIRECTION_UP';static const String gE='DIRECTION_RIGHT';static const String wD='DIRECTION_DOWN';static const String QD='DIRECTION_LEFT';String MM;num OM;GB SM;QB XM;MD(GB g,[String direction=QD]){if(direction!=sD&&direction!=wD&&direction!=QD&&direction!=gE){throw new ArgumentError('Invalid Gauge direction!');}MM=direction;OM=1.0;SM=g;XM=new QB.TI();ON();}num get ratio=>OM;set ratio(num g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;OM=g;ON();}GB get RB=>SM;set RB(GB g){SM=g;ON();}ON(){if(SM==null){XM.left=0;XM.top=0;XM.right=0;XM.bottom=0;}else{int h=SM.width;int g=SM.height;switch (MM){case QD:XM.left=((1.0-OM)*h).toInt();XM.top=0;XM.right=h;XM.bottom=g;break;case sD:XM.left=0;XM.top=((1.0-OM)*g).toInt();XM.right=h;XM.bottom=g;break;case gE:XM.left=0;XM.top=0;XM.right=(OM*h).toInt();XM.bottom=g;break;case wD:XM.left=0;XM.top=0;XM.right=h;XM.bottom=(OM*g).toInt();break;}}}QB sB(UB h,[QB returnRectangle]){int g=(SM!=null)?SM.width:0;int i=(SM!=null)?SM.height:0;return AE(h,g,i,returnRectangle);}v VC(num g,num h){if(SM!=null&&g>=0.0&&h>=0.0&&g<SM.width&&h<SM.height)return this;return null;}void nB(AC g){if(SM!=null)SM.RF(g,XM);}}abstract class LB{static gB.Future<LB> wE(String g){var h=uC.ZG;if(h=="WebAudioApi")return nD.wE(g);if(h=="AudioElement")return mD.wE(g);return VE.wE(g);}num get length;NC play([bool loop=false,XB soundTransform]);static String tE(String g){var m=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,caseSensitive:false);var i=m.firstMatch(g);var h=uC.qE;if(i==null)throw new ArgumentError("Unsupported file extension.");if(h.length==0)throw new UnsupportedError("This browser supports no known audio codec.");var j=i.group(1).toLowerCase();if(h.indexOf(j)==-1){var l=g.substring(0,g.length-j.length);var k=h[0];g="${l}${k}";}return g;}}class nD extends LB{bF.AudioBuffer mK;nD(){if(uC.SD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static gB.Future<LB> wE(String o){var h=new nD();var k=LB.tE(o);var g=new gB.Completer<LB>();iC.HttpRequest.request(k,responseType:'arraybuffer').then((i){var j=i.response;var m=uC.SD;m.decodeAudioData(j,(bF.AudioBuffer l){h.mK=l;g.complete(h);},(s){g.completeError(new StateError("Failed to decode audio."));});}).catchError((s){g.completeError(new StateError("Failed to load audio."));});return g.future;}num get length{return mK.duration;}NC play([bool loop=false,XB soundTransform]){if(soundTransform==null)soundTransform=new XB();return new BI(this,loop,soundTransform);}}class GB implements XE{int oK;int vK;bool JL;iC.Element VL;iC.CanvasRenderingContext2D lK;int qL;double xL;double DM;double DL;double ML;double SL;double aL;GB(int g,int h,[bool transparent=true,int fillColor=0xFFFFFFFF]){oK=g;vK=h;JL=transparent;var i=new iC.CanvasElement(width:oK,height:vK);lK=i.context2d;lK.fillStyle=JL?bG(fillColor):xC(fillColor);lK.fillRect(0,0,g,h);VL=i;qL=0;}GB.XI(iC.ImageElement g){oK=g.naturalWidth;vK=g.naturalHeight;JL=true;VL=g;qL=0;}GB.YI(ZE g){oK=g.aH;vK=g.ZH;JL=true;VL=g.mH.NH;qL=g.jH?2:1;xL=g.offsetX.toDouble();DM=g.offsetY.toDouble();DL=g.JH.toDouble();ML=g.KH.toDouble();SL=g.IH.toDouble();aL=g.HH.toDouble();}static gB.Future<GB> wE(String i){gB.Completer<GB> h=new gB.Completer<GB>();var g=new iC.ImageElement();g.onLoad.listen((j)=>h.complete(new GB.XI(g)));g.onError.listen((j)=>h.completeError(new StateError("Error loading image.")));g.src=i;return h.future;}int get width=>oK;int get height=>vK;void nB(AC g){switch (qL){case 0:g.context.drawImage(VL,0.0,0.0);break;case 1:g.context.drawImage(VL,DL,ML,SL,aL,xL,DM,SL,aL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,xL,DM+aL);g.context.drawImage(VL,DL,ML,aL,SL,0.0,0.0,aL,SL);break;}}void RF(AC fB,QB g){if(g.width<=0.0||g.height<=0.0)return;switch (qL){case 0:fB.context.drawImage(VL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=DL;double h=ML;double w=j+SL;double EB=h+aL;double l=DL-xL+g.x;double m=ML-DM+g.y;double SB=l+g.width;double JB=m+g.height;double s=(j>l)?j:l;double o=(h>m)?h:m;double wB=(w<SB)?w:SB;double ME=(EB<JB)?EB:JB;double NE=xL-j+s;double cC=DM-h+o;double k=wB-s;double i=ME-o;if(k>0.0&&i>0.0){fB.context.drawImage(VL,s,o,k,i,NE,cC,k,i);}break;case 2:double j=DL;double h=ML;double w=j+aL;double EB=h+SL;double l=DL+DM-g.y+aL-g.height;double m=ML-xL+g.x;double SB=l+g.height;double JB=m+g.width;double s=(j>l)?j:l;double o=(h>m)?h:m;double wB=(w<SB)?w:SB;double ME=(EB<JB)?EB:JB;double NE=xL-h+o;double cC=DM+w-wB;double k=ME-o;double i=wB-s;if(k>0.0&&i>0.0){fB.context.transform(0.0,-1.0,1.0,0.0,NE,cC+i);fB.context.drawImage(VL,s,o,i,k,0.0,0.0,i,k);}break;}}}class pD extends MD implements qB{static const String FG='TIME_OUT';bool nL=false;num AL=0.0;num OL=0.0;Map<String,num> JM;bool NM=true;pD(num g,GB h,[String direction=MD.QD]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');OL=g;AF();}bool BC(num g){if(nL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;}void start(){nL=true;}void pause(){nL=false;}void reset([num time=0.0]){pause();time=TB.max(time,0.0);if(time!=0.0){OL=time;AF();}ratio=1.0;}void TD(String g,num h){JM[g]=h/totalTime;}void AF(){JM=new Map<String,num>();TD(pD.FG,0);}num get totalTime=>OL;num get hH=>ratio*totalTime;void set ratio(num i){num h=ratio;super.ratio=i;if(NM){JM.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new AB(j));});}}}typedef void wF<vC extends AB>(vC event);class AG<vC extends AB> extends gB.StreamSubscription<vC>{tC lL;wF<vC> uL;int yL;bool EM;AG(this.lL,this.uL){yL=0;EM=false;}void cancel(){if(EM==false){lL.AN(this);EM=true;uL=null;}}void onError(void g(gB.AsyncError error)){}bool get hN=>yL>0;void pause([gB.Future resumeSignal]){yL++ ;if(resumeSignal!=null)resumeSignal.whenComplete(resume);}void resume(){if(hN==false)throw new StateError("Subscription is not paused.");yL-- ;}}class ND{Map<String,KD> XL;ND(){XL=new Map<String,KD>();}void WM(KD g){var j=g.kind;var h=g.name;var i="${j}.${h}";if(XL.containsKey(i))throw new StateError("ResourceManager already contains a resource called '${h}'");XL[i]=g;}dynamic LN(String i,String g){var h="${i}.${g}";if(XL.containsKey(h)==false)throw new StateError("ResourceManager does not contains a resource called '${g}'");return XL[h];}void iB(String i,String h){var g=new KD("BitmapData",i,h);g.KN(GB.wE(h));WM(g);}void aB(String i,String h){var g=new KD("Sound",i,h);g.KN(LB.wE(h));WM(g);}void zC(String j,String h,String i){var g=new KD("TextureAtlas",j,h);g.KN(hB.wE(h,i));WM(g);}void mB(String i,String h){var g=new KD("Text",i,"");g.KN(new gB.Future.immediate(h));WM(g);}gB.Future<ND> load(){var h=this.cH.map((i)=>i.KL);return gB.Future.wait(h).then((j){var g=this.GF;if(g.length>0)throw new StateError("Failed to load ${g.length} resource(s).");return this;});}List<KD> get cH{return XL.values.where((g)=>g.CD==null).toList();}List<KD> get GF{return XL.values.where((g)=>g.error!=null).toList();}GB t(String g){return LN("BitmapData",g).CD;}LB jB(String g){return LN("Sound",g).CD;}hB UC(String g){return LN("TextureAtlas",g).CD;}String oC(String g){return LN("Text",g).CD;}}String xC(int g){int h=(g>>16)&0xFF;int i=(g>>8)&0xFF;int j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class jE{static bool lE=false;static bool yD=false;static int zD=0;static String eG=WE.JG;static gB.StreamController<String> fG=new gB.StreamController<String>();static gB.Stream<String> jG=fG.stream.asBroadcastStream();static lG(){if(lE==false){lE=true;var g=iC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){yD=true;zD=10;}if(g.contains("Android")){yD=true;zD=10;}if(g.contains("IEMobile")){yD=true;zD=10;}}}static String get uG{lG();return eG;}}class PC extends qB{final num bM;final num gM;final Function lM;num oM;Function rM;Function tM;Function zM;num OL;num AL;num DN;bool EN;bool IN;PC(num g,num h,num i,[num transitionFunction(num ratio)]):bM=g,gM=h,lM=(transitionFunction!=null)?transitionFunction:MB.QC{oM=g;AL=0.0;OL=TB.max(0.0001,i);DN=0.0;EN=false;IN=false;}bool BC(num i){if(AL<OL||IN==false){AL=AL+i;if(AL>OL)AL=OL;if(AL>=0.0){if(IN==false){IN=true;if(rM!=null)rM();}num g=AL/OL;num h=lM(g);oM=bM+h*(gM-bM);if(tM!=null)tM(EN?oM.round():oM);if(zM!=null&&AL==OL)zM();}}return AL<OL;}num get vB=>bM;num get IE=>gM;num get totalTime=>OL;num get currentTime=>AL;set TC(num g){if(IN==false)AL=AL+DN-g;DN=g;}void set onStart(void g()){rM=g;}void set KC(void g(num value)){tM=g;}void set onComplete(void g()){zM=g;}}class aG{static int dG=0;int aD=dG++ ;NB target=null;bool YD=false;aG(this.target,this.YD);}String bG(int g){int h=(g>>24)&0xFF;int i=(g>>16)&0xFF;int j=(g>>8)&0xFF;int k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static num QC(num g){return g;}static num vE(num g){return g*g*g;}static num rB(num g){g=1.0-g;return 1.0-g*g*g;}static num BH(num g){if(g==0.0||g==1.0)return g;return TB.pow(2.0,-10.0*g)*TB.sin((g-0.3/4.0)*(2.0*TB.PI)/0.3)+1;}}class lB implements qB{final v MN;final Function lM;final List<sF> SN=new List<sF>();Function rM;Function tM;Function zM;num OL;num AL;num DN;bool EN;bool IN;lB(v g,num h,[num transitionFunction(num ratio)]):MN=g,lM=(transitionFunction!=null)?transitionFunction:MB.QC{AL=0.0;OL=TB.max(0.0001,h);DN=0.0;EN=false;IN=false;}void YB(String g,num h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(MN!=null&&IN==false)SN.add(new sF(g,0.0,h));}void moveTo(num h,num g){YB('x',h);YB('y',g);}bool BC(num l){if(AL<OL||IN==false){AL=AL+l;if(AL>OL)AL=OL;if(AL>=0.0){if(IN==false){IN=true;for(int i=0;i<SN.length;i++ ){var g=SN[i];switch (g.name){case 'x':g.vB=MN.x;break;case 'y':g.vB=MN.y;break;case 'pivotX':g.vB=MN.WC;break;case 'pivotY':g.vB=MN.XC;break;case 'scaleX':g.vB=MN.uB;break;case 'scaleY':g.vB=MN.DC;break;case 'rotation':g.vB=MN.ZB;break;case 'alpha':g.vB=MN.alpha;break;}}if(rM!=null)rM();}num j=AL/OL;num k=lM(j);for(int i=0;i<SN.length;i++ ){var g=SN[i];var h=g.vB+k*(g.IE-g.vB);h=EN?h.round():h;switch (g.name){case 'x':MN.x=h;break;case 'y':MN.y=h;break;case 'pivotX':MN.WC=h;break;case 'pivotY':MN.XC=h;break;case 'scaleX':MN.uB=h;break;case 'scaleY':MN.DC=h;break;case 'rotation':MN.ZB=h;break;case 'alpha':MN.alpha=h;break;}}if(tM!=null)tM();if(zM!=null&&AL==OL)zM();}}return AL<OL;}num get totalTime=>OL;num get currentTime=>AL;set TC(num g){if(IN==false)AL=AL+DN-g;DN=g;}void set onStart(void g()){rM=g;}void set KC(void g()){tM=g;}void set onComplete(void g()){zM=g;}}String nG(String g){RegExp h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);Match i=h.firstMatch(g);return i.group(1);}class nC extends lC{iC.CanvasElement JN;iC.CanvasRenderingContext2D lK;NB VN;AC XN;String bN;String eN;PB gN;NB jN;List<YE> lN;Map<int,aG> oN;q pN;HC qN;WB rN;nC(String h,iC.CanvasElement g){ZK=h;JN=g;JN.focus();lK=g.context2d;XN=new AC.WI(lK);bN=jC.qD;eN=oB.tD;kD.UG.listen(UG);lN=[new YE(q.PD,q.xD,q.ZC,q.KG),new YE(q.gG,q.iG,q.rE,q.rE),new YE(q.mG,q.pG,q.sE,q.sE)];jN=null;gN=new PB(0,0);pN=new q(q.ZC,true);JN.onMouseDown.listen(dM);JN.onMouseUp.listen(dM);JN.onMouseMove.listen(dM);JN.onMouseOut.listen(dM);JN.onMouseWheel.listen(dM);oN=new Map<int,aG>();rN=new WB(WB.dE,true);jE.jG.listen(BO);BO(null);qN=new HC(HC.rD,true);JN.onKeyDown.listen(CO);JN.onKeyUp.listen(CO);JN.onKeyPress.listen(DO);}NB get focus=>VN;void set gH(String g){bN=g;}void FO(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");}void set x(num g){FO();}void set y(num g){FO();}void set WC(num g){FO();}void set XC(num g){FO();}void set uB(num g){FO();}void set DC(num g){FO();}void set ZB(num g){FO();}void set alpha(num g){FO();}void set width(num g){FO();}void set height(num g){FO();}void VH(){if(bN==jC.qD||bN==jC.vD){XN.reset();nB(XN);if(bN==jC.vD)bN=jC.GG;}}void UG(String g){JN.style.cursor=kD.uE(eN);}void dM(iC.MouseEvent j){j.preventDefault();var EB=JN.getBoundingClientRect();var o=new DateTime.now().millisecondsSinceEpoch;var w=j.button;NB h=null;PB i=new PB(j.clientX-EB.left,j.clientY-EB.top);PB m=null;if(w<0||w>2)return;if(j.type=="mousemove"&&gN.equals(i))return;YE g=lN[w];gN=i;if(j.type!="mouseout")h=VC(i.x,i.y) as NB;var l=oB.tD;if(h is BB)if(h.LE)l=oB.uD;if(h is sC)if(h.LE)l=oB.uD;if(eN!=l){eN=l;JN.style.cursor=kD.uE(l);}if(jN!=null&&jN!=h){jN.dispatchEvent(pN..HN(q.RD,true)..xN=(jN.ZD!=null)?jN.pC(i):new PB.TI()..yN=i..sN=g.RC);jN=null;}if(h!=null&&h!=jN){h.dispatchEvent(pN..HN(q.oE,true)..xN=h.pC(i)..yN=i..sN=g.RC);jN=h;}String k=null;bool s=false;bool JB=false;if(j.type=="mousedown"){k=g.MF;if(h!=g.target||o>g.CE+500)g.AD=0;g.RC=true;g.target=h;g.CE=o;g.AD++ ;}if(j.type=="mouseup"){k=g.NF;g.RC=false;s=(g.target==h);JB=s&&g.AD.isEven&&(o<g.CE+500);}if(j.type=="mousemove"){k=q.nE;}if(k!=null&&h!=null){m=h.pC(i);h.dispatchEvent(pN..HN(k,true)..xN=m..yN=i..sN=g.RC..uN=g.AD);if(s){if(JB&&h.GH){h.dispatchEvent(pN..HN(g.LF,true)..xN=m..yN=i..sN=g.RC);}else{h.dispatchEvent(pN..HN(g.KF,true)..xN=m..yN=i..sN=g.RC);}}}}List<gB.StreamSubscription<WB>> HO=[] ;void BO(String h){HO.forEach((g)=>g.cancel());if(jE.uG==WE.OG){HO=[JN.onTouchStart.listen(IO),JN.onTouchEnd.listen(IO),JN.onTouchMove.listen(IO),JN.onTouchEnter.listen(IO),JN.onTouchLeave.listen(IO),JN.onTouchCancel.listen(IO)];}}void IO(iC.TouchEvent j){j.preventDefault();var o=JN.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var i=new PB(m.clientX-o.left,m.clientY-o.top);var h=VC(i.x,i.y) as NB;var g=oN.containsKey(l)?oN[l]:new aG(h,oN.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(rN..HN(WB.YG,true)..xN=(g.target.ZD!=null)?g.target.pC(i):new PB.TI()..yN=i..NN=g.aD..PN=g.YD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(rN..HN(WB.XG,true)..xN=h.pC(i)..yN=i..NN=g.aD..PN=g.YD);g.target=h;}String k=null;if(j.type=="touchstart"){oN[l]=g;k=WB.dE;}if(j.type=="touchend"){oN.remove(l);k=WB.fE;}if(j.type=="touchcancel"){oN.remove(l);k=WB.hE;}if(j.type=="touchmove"){k=WB.mE;}if(k!=null&&h!=null){h.dispatchEvent(rN..HN(k,true)..xN=h.pC(i)..yN=i..NN=g.aD..PN=g.YD);}}}void CO(iC.KeyboardEvent g){g.preventDefault();String h=null;if(g.type=="keyup")h=HC.eE;if(g.type=="keydown")h=HC.rD;qN..HN(h,true)..VM=g.altKey..ZM=g.ctrlKey..cM=g.shiftKey..pM=g.charCode..sM=g.keyCode..vM=kC.xF;if(g.keyLocation==iC.KeyLocation.LEFT)qN.vM=kC.CG;if(g.keyLocation==iC.KeyLocation.RIGHT)qN.vM=kC.LG;if(g.keyLocation==iC.KeyLocation.NUMPAD)qN.vM=kC.PG;if(g.keyLocation==iC.KeyLocation.JOYSTICK)qN.vM=kC.kE;if(g.keyLocation==iC.KeyLocation.MOBILE)qN.vM=kC.kE;if(VN!=null)VN.dispatchEvent(qN);}void DO(iC.KeyboardEvent g){int i=(g.charCode!=0)?g.charCode:g.keyCode;UE h=new UE(UE.IG,true);h.jK=new String.fromCharCodes([i]);if(VN!=null)VN.dispatchEvent(h);}}String rG(String j,String g){RegExp i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);Match k=i.firstMatch(j);String h=k.group(1);return (h==null)?g:"${h}${g}";}QB AE(UB g,num m,num EB,QB j){num cC=0.0;num wB=0.0;num w=m*g.a;num fB=m*g.b;num JB=m*g.a+EB*g.c;num s=m*g.b+EB*g.d;num SB=EB*g.c;num o=EB*g.d;num h=cC;if(h>w)h=w;if(h>JB)h=JB;if(h>SB)h=SB;num i=wB;if(i>fB)i=fB;if(i>s)i=s;if(i>o)i=o;num l=cC;if(l<w)l=w;if(l<JB)l=JB;if(l<SB)l=SB;num k=wB;if(k<fB)k=fB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new QB.TI();j.x=g.FC+h;j.y=g.GC+i;j.width=l-h;j.height=k-i;return j;}//@ sourceMappingURL=escape.dart.map
