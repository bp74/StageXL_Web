import "dart:math" as SB;import "dart:json" as fH;import "dart:html" as cC;import "dart:web_audio" as fF;class u{static const  DD="None";static const  OB="Joker";static const  yB="Block";static const  UE="Double";static const  VE="Quint";}class xB{static const  tC=1;static const  eD=2;static const  fD=3;}class GB{static var LB;static  gD( i, h){var g=new BB(LB.SC("Elements").q("Chain${i}${h}"));g.UC=25;g.VC=25;return g;}static  mF( i, h){var g=new BB(LB.SC("Elements").q("Link${i}${h}"));g.UC=25;g.VC=25;return g;}static  iD( h){var g=new BB(LB.SC("Elements").q(h));g.UC=25;g.VC=25;return g;}static  nF(){var m=new AB();var l=0;var o=LB.SC("Levelup");for(int k=0;k<7;k++ ){var g=new BB(o.q("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new AB();h.n(g);h.x=l+g.width/2;h.vB=0;h.EC=0;m.n(h);var i=new mB(h,2.0,MB.sG);i.XB("scaleX",1.0);i.XB("scaleY",1.0);i.RC=k*0.05;var j=new mB(h,0.4,MB.OC);j.XB("scaleX",0.0);j.XB("scaleY",0.0);j.RC=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  pF( h){var i=LB.SC("Elements");var g=new List<DB>();g.add(i.q("JokerChain${h}0"));g.add(i.q("JokerChain${h}1"));g.add(i.q("JokerChain${h}2"));g.add(i.q("JokerChain${h}3"));g.add(i.q("JokerChain${h}4"));return g;}static  qF( h){var i=LB.SC("Elements");var g=new List<DB>();g.add(i.q("JokerLink${h}0"));g.add(i.q("JokerLink${h}1"));g.add(i.q("JokerLink${h}2"));g.add(i.q("JokerLink${h}3"));g.add(i.q("JokerLink${h}4"));return g;}static  rF( h){var i=LB.SC("Locks");var g=new List<DB>();g.add(i.q("Lock${h}0"));g.add(i.q("Lock${h}1"));g.add(i.q("Lock${h}2"));g.add(i.q("Lock${h}3"));g.add(i.q("Lock${h}4"));return g;}static  sF(){var h=LB.SC("Head");var g=new List<DB>();g.add(h.q("Head1"));g.add(h.q("Head2"));g.add(h.q("Head3"));g.add(h.q("Head2"));g.add(h.q("Head1"));return g;}static  tF(){var h=LB.SC("Alarm");var g=new List<DB>();g.add(h.q("Alarm0"));g.add(h.q("Alarm1"));g.add(h.q("Alarm2"));g.add(h.q("Alarm3"));g.add(h.q("Alarm4"));g.add(h.q("Alarm5"));return g;}}class JB{var HI;var II;var SI;var YI;var dI;var fI;var mI;var qI;var tI;var xI;var AJ;JB( h, g){HI=h;II=g;SI=u.DD;YI=-1000;dI=-1000;fI=false;mI=false;qI=false;tI=null;xI=null;AJ=null;} get color=>HI; set color( g){HI=g;} get direction=>II; set direction( g){II=g;} get FB=>SI; set FB( g){SI=g;} get dB=>fI; set dB( g){fI=g;} get IC=>mI; set IC( g){mI=g;} get empty=>qI; set empty( g){qI=g;} UD( g){var h=g!=null&&(g.color==HI||g.FB==u.OB||SI==u.OB)&&g.FB!=u.yB&&SI!=u.yB;return h;} ZC( g){var h=g!=null&&(g.color==HI||g.FB==u.OB||SI==u.OB)&&g.direction==0&&II==0&&g.FB!=u.yB&&SI!=u.yB;return h;} hC( g){var h=g!=null&&(g.color==HI||g.FB==u.OB||SI==u.OB)&&g.direction==1&&II==1&&g.FB!=u.yB&&SI!=u.yB;return h;} get x=>YI; set x( g){YI=g;if(tI!=null)tI.x=g;if(xI!=null)xI.x=g;if(AJ!=null)AJ.x=g;} get y=>dI; set y( g){dI=g;if(tI!=null)tI.y=g;if(xI!=null)xI.y=g;if(AJ!=null)AJ.y=g;} set aF( h){if(tI!=null){var g=1+0.3*SB.sin(h*SB.PI);tI.vB=g;tI.EC=g;}} jB( g, h, i){if(tI!=null){tI.parent.uB(tI);tI=null;}if(xI!=null){xI.parent.uB(xI);xI=null;}if(AJ!=null){AJ.parent.uB(AJ);AJ=null;}if(empty==false){switch (SI){case u.OB:tI=new gH(II);tI.x=YI;tI.y=dI;g.n(tI);break;case u.yB:tI=GB.iD(u.yB);tI.x=YI;tI.y=dI;g.n(tI);break;default:tI=GB.gD(HI,II);tI.x=YI;tI.y=dI;g.n(tI);break;}if(fI){xI=mI?new hH(II):GB.mF(HI,II);xI.x=YI+((II==0)?25:0);xI.y=dI+((II==1)?25:0);h.n(xI);}switch (SI){case u.DD:break;case u.yB:break;case u.OB:break;default:AJ=new iH(SI);AJ.x=YI;AJ.y=dI;i.n(AJ);break;}}}}class eB{static var LB;}class sC{var value=0; XD([ inc=1])=>(value+= inc); GF([ dec=1])=>(value-= dec);}class jF extends AB{var MI;var VI;var gI;var WI;jF(){var m=new BB(GB.LB.q("ExitBox"));n(m);var g=new LC();g.QC=new aE("Arial",24,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=100;g.wordWrap=true;g.text=dC.LB.qC("GENexitquery");g.x=47;g.y=150-g.ME/2;g.VB=false;n(g);MI=new pD(7,GB.LB.q("ExitGauge"),KD.yD);MI.x=268;MI.y=25;MI.addEventListener("TimeOver",fJ);n(MI);MI.SD("TimeOver",0);MI.start();var i=new BB(GB.LB.q("ExitYesButtonNormal"));var j=new BB(GB.LB.q("ExitYesButtonPressed"));VI=new uC(i,i,j,j);VI.x=68;VI.y=239;VI.addEventListener(t.XC,jJ);n(VI);var h=new BB(GB.LB.q("ExitNoButtonNormal"));var k=new BB(GB.LB.q("ExitNoButtonPressed"));gI=new uC(h,h,k,k);gI.x=173;gI.y=232;gI.addEventListener(t.XC,lJ);n(gI);this.addEventListener(CB.vC,(l)=>p.add(MI));this.addEventListener(CB.xC,(l)=>p.remove(MI));} mJ( g){if(WI!=null){WI(g);WI=null;}} jJ( g){mJ(true);} lJ( g){mJ(false);} fJ( g){mJ(false);}show( g){WI=g;}}class iH extends AB implements kB{var RI;var cI;iH( h){this.VB=false;cI=0.0;RI=GB.iD(h);n(RI);addEventListener(CB.vC,(g)=>p.add(this));addEventListener(CB.xC,(g)=>p.remove(this));} CC( g){cI+= g;this.YB=SB.sin(cI*7)*10*SB.PI/180;return true;}}class hH extends AB implements kB{var RI;var hI;var cI;hH( g){this.VB=false;cI=0.0;hI=GB.qF(g);RI=new BB(hI[0]);RI.x=-25;RI.y=-25;n(RI);addEventListener(CB.vC,(h)=>p.add(this));addEventListener(CB.xC,(h)=>p.remove(this));} CC( g){cI+= g;var h=(cI*10).toInt()%hI.length;RI.QB=hI[h];return true;}}class gH extends AB implements kB{var RI;var hI;var cI;gH( g){this.VB=false;cI=0.0;hI=GB.pF(g);RI=new BB(hI[0]);RI.x=-25;RI.y=-25;n(RI);addEventListener(CB.vC,(h)=>p.add(this));addEventListener(CB.xC,(h)=>p.remove(this));} CC( g){cI+= g;var h=(cI*10).toInt()%hI.length;RI.QB=hI[h];return true;}}class cD extends AB{var OI;var WI;cD( h){var i=new BB(GB.LB.q("MessageBox"));n(i);var g=new LC();g.QC=new aE("Arial",24,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.ME/2;g.VB=false;n(g);OI=null;addEventListener(t.XC,TJ);}void show( h){this.parent.n(this);this.x=-this.width;this.y=150;WI=h;var g=new mB(this,0.3,MB.sB);g.XB("x",110);g.onComplete=()=>OI=p.fB(hJ,10);p.add(g);} hJ(){if(OI!=null){p.remove(OI);OI=null;WI();var g=new mB(this,0.4,MB.yE);g.XB("x",800);g.onComplete=()=>this.parent.uB(this);p.add(g);}} TJ( g){hJ();}}class CD extends AB{var HI;var RI;var bI;var lI;CD( g){HI=g;bI=GB.rF(g);lI=true;RI=new BB(bI[0]);RI.x=-34;RI.y=-50;n(RI);} get BD=>lI; set BD( g){lI=g;} YF( g){RI.QB=bI[g?0:4];} YH(){var i=new NC(0.0,1.0,2.0,MB.sB);i.JC=(j){vB=EC=1.0+0.2*SB.sin(j*4*SB.PI);};var g=new mB(this,0.2,MB.sB);g.XB("alpha",0.0);g.RC=2.0;g.onComplete=()=>YF(lI);var h=new mB(this,0.2,MB.yE);h.XB("alpha",1);h.RC=2.2;p.add(i);p.add(g);p.add(h);}}class kF extends AB{var JI;var TI;var aI;var iI;var oI;kF(){n(new BB(GB.LB.q("InfoBox")));TI=new LC();TI.QC=new aE("Arial",35,0xFFFFFF,DC:true,align:rB.MC);TI.width=220;TI.height=40;TI.wordWrap=false;TI.text="Level 1";TI.x=20;TI.y=115;TI.YB=-2*SB.PI/180;n(TI);iI=new LC();iI.QC=new aE("Arial",25,0xFFFFFF,DC:true,align:rB.MC);iI.width=220;iI.height=30;iI.wordWrap=false;iI.text="40";iI.x=-iI.width/2;iI.y=-iI.height/2;iI.YB=-2*SB.PI/180;oI=new AB();oI.n(iI);oI.x=150;oI.y=172;n(oI);var g=GB.gD(3,0);g.x=110;g.y=171;g.YB=-2*SB.PI/180;g.vB=g.EC=0.6;n(g);} set level( g){JI=g;TI.text="Level ${JI}";} set CF( g){aI=g;iI.text="${aI}";}}class iF extends AB{var NI;var XI;var kI;iF(){NI=GB.sF();XI=new BB(NI[0]);XI.x=-XI.width/2;XI.y=-XI.height/2;n(XI);kI=null;} RF( g){p.remove(kI);kI=new NC(0,g,0.5*g,MB.OC);kI.JC=(h){var i=((h*NI.length)%NI.length).toInt();XI.QB=NI[i];XI.y=SB.sin(h*2*SB.PI)*3-XI.height/2;};p.add(kI);} MH(){p.remove(kI);XI.QB=NI[0];}}class gF extends AB{var KI;var UI;var eI;var nI;var MI;var sI;var uI;var wI;var zI;var JI;var DJ;var EJ;var FJ;var GJ;var IJ;var JJ;var KJ;var MJ;var NJ;gF(){var j=new BB(GB.LB.q("ShuffleButtonNormal"));var h=new BB(GB.LB.q("ShuffleButtonPressed"));UI=new uC(j,j,h,h);UI.addEventListener(t.XC,aJ);UI.x=530;UI.y=525;n(UI);var g=new BB(GB.LB.q("ExitButtonNormal"));var i=new BB(GB.LB.q("ExitButtonPressed"));eI=new uC(g,g,i,i);eI.addEventListener(t.XC,iJ);eI.x=700;eI.y=500;n(eI);KI=new kF();KI.x=540;KI.y=-1000;n(KI);MI=new pD(10,GB.LB.q("TimeGauge"),KD.sD);MI.x=659;MI.y=244;MI.addEventListener("TimeShort",kJ);MI.addEventListener("TimeOver",fJ);n(MI);p.add(MI);sI=new iF();sI.x=640;sI.y=230;n(sI);uI=new lF();uI.x=665;uI.y=160;n(uI);wI=new LC();wI.QC=new aE("Arial",30,0xD0D0D0,DC:true,align:rB.MC);wI.width=140;wI.height=36;wI.wordWrap=false;wI.x=646;wI.y=130;wI.VB=false;wI.text="0";wI.vB=0.9;n(wI);zI=new LC();zI.QC=new aE("Arial",20,0xFFFFFF,DC:true,align:rB.MC);zI.width=44;zI.height=30;zI.wordWrap=false;zI.x=610;zI.y=559;zI.VB=false;zI.text="3x";n(zI);IJ=new AB();n(IJ);JJ=new AB();n(JJ);KJ=new AB();n(KJ);MJ=eB.LB.iB("Intro");NJ=MJ.play();} start(){JI=1;DJ=1;GJ=0;EJ=3;var g=new cD(dC.LB.qC("ESCStartText"));JJ.n(g);p.fB(()=>sI.RF(21),1);g.show(()=>p.fB(()=>pJ(),0.5));} pJ(){if(nI!=null&&this.contains(nI))IJ.uB(nI);var m=JI;var g=0;var h=0;switch (JI){case 01:h=50;nI=new hF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;nI=new hF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;nI=new hF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;nI=new hF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;nI=new hF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;nI=new hF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;nI=new hF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;nI=new hF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;nI=new hF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;nI=new hF(g=80+(JI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}FJ=g;if(EJ<3){EJ++ ;zI.text="${EJ}x";}nI.addEventListener(cB.SE,qJ);nI.addEventListener(cB.ED,rJ);nI.addEventListener(cB.TE,sJ);nI.addEventListener(cB.hD,tJ);nI.x=20;nI.y=16;nI.VB=false;IJ.n(nI);MI.reset(h);MI.SD("TimeShort",9);MI.SD("TimeOver",0);MI.pause();KI.level=m;KI.CF=g;KI.y=-210;var k=new mB(KI,0.4,MB.sB);k.XB("y",-90);p.add(k);var j=new cD(dC.LB.qC("ESCLevelBoxText").replaceAll("{0}","${g}"));JJ.n(j);j.show((){nI.VB=true;MI.start();if(MJ!=null){var i=new NC(1.0,0.0,4.0,MB.OC);i.JC=(l){NJ.FC.volume=l;NJ.FC=NJ.FC;};i.onComplete=(){NJ.stop();sI.MH();};p.add(i);MJ=null;}});} kJ( g){uI.start();} fJ( g){nI.dF(xB.fD);} rJ( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new RE(g);i.x=k.x;i.y=k.y;IJ.n(i);GJ=GJ+g;wI.text="${GJ}";} qJ( j){var g=FJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;FJ=g;KI.CF=g;if(g==0)nI.dF(xB.eD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}GJ=GJ+h*k;wI.text="${GJ}";} sJ( m){MI.pause();uI.stop();var l=eB.LB.iB("Laugh");var k=eB.LB.iB("LevelUp");l.play();sI.RF(3);var g=GB.nF();g.x=55;g.y=260;IJ.n(g);p.fB((){nI.IF();k.play();},2.0);p.fB((){var j=(MI.VH*1000).toInt();var h=new RE(j);h.x=704;h.y=360;IJ.n(h);GJ=GJ+j;wI.text="${GJ}";},2.5);var i=new mB(KI,0.5,MB.sB);i.XB("y",-210);i.RC=3.0;p.add(i);p.fB((){IJ.uB(g);},3.5);p.fB((){JI++ ;pJ();},4.0);} tJ( j){uI.stop();nI.IF();var g;var i;if(DJ>0){DJ-- ;g=new cD(dC.LB.qC("GEN2ndchancetime"));JJ.n(g);i=eB.LB.iB("LevelUp");i.play();g.show((){p.fB(()=>pJ(),0.5);var h=new mB(KI,0.5,MB.sB);h.XB("y",-210);p.add(h);});}else{g=new cD(dC.LB.qC("GENtimeup"));JJ.n(g);i=eB.LB.iB("GameOver");i.play();g.show((){p.fB(()=>wJ(),0.5);var h=new mB(KI,0.5,MB.sB);h.XB("y",-210);p.add(h);});}} aJ( h){if(nI!=null&&EJ>0){var g=nI.ZF();if(g){EJ=EJ-1;zI.text="${EJ}x";}}} iJ( j){var h=new AB();h.n(new BB(new DB(800,600,false,0x000000)));h.alpha=0.6;KJ.n(h);var g=new jF();g.x=235;g.y=150;KJ.n(g);g.show(( i){KJ.uB(g);if(i==false)KJ.uB(h);else yJ(false);});}wJ(){var h=new AB();var j=new BB(GB.LB.q("ExitBox"));h.n(j);var g=new LC();g.QC=new aE("Arial",30,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=dC.LB.qC("GENgameover");g.x=47;g.y=30+(g.height-g.ME)/2;g.VB=false;h.n(g);h.x=110;h.y=-h.height;JJ.n(h);var k=eB.LB.iB("Laugh");p.fB(()=>k.play(),0.3);var i=new mB(h,0.3,MB.sB);i.XB("y",150);p.add(i);p.fB(()=>yJ(true),5.0);h.addEventListener(t.XC,( l)=>yJ(true));}var AK=false; yJ( g){MI.pause();if(AK==false){AK=true;}}}class dD{var BF;var bF;var cF;var angle;var eF;var YB;}class RE extends AB{var LI;RE( j){var g=new LC();g.QC=new aE("Arial",30,0xFFFFFF,DC:true,align:rB.MC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.VB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;LI=new AB();LI.n(g);n(LI);var i=new NC(0.0,1.0,1.5,MB.sB);i.JC=(h){LI.alpha=1-h;LI.y=-h*50;LI.vB=1.0+0.1*SB.sin(h*10);LI.EC=1.0+0.1*SB.cos(h*10);};i.onComplete=(){this.JE();};p.add(i);}}class cB extends CB{static const  SE="Explosion";static const  ED="Unlocked";static const  TE="Finalized";static const  hD="Timeouted";var BJ;cB( h, g,[ bubbles=false]):super(h,bubbles){BJ=g;} get info{return BJ;}}class hF extends AB{var vI;var CJ;var HJ;var LJ;var OJ;var PJ;var QJ;var RJ;var SJ;var UJ;var VJ;var WJ;var XJ;var YJ;var ZJ;var bJ;var cJ;var dJ;var eJ;var gJ;hF( v, s, IB, m, o, EB, k){RJ=new SB.Random();SJ=xB.tC;UJ=k;vI=v;CJ=s;HJ=IB;LJ=m;OJ=o;PJ=EB;QJ=k.length;YJ=new List<NB>();bJ=new AB();cJ=new AB();dJ=new AB();eJ=new AB();gJ=new AB();n(bJ);n(cJ);n(dJ);n(eJ);n(gJ);cJ.VB=false;dJ.VB=false;eJ.VB=false;gJ.VB=false;GH();HH();FH();ZJ=true;var l=new sC();this.mask=new wF.CI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=WJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.jB(bJ,cJ,dJ);var j=new NC(i.y,h*50+25,0.4,MB.sB);j.RC=g*0.03;j.JC=(RB){i.y=RB;};j.onComplete=(){if(l.XD()==100){nJ();ZJ=false;YJ.clear();this.mask=null;}};p.add(j);}}addEventListener(t.ND,oJ);} dF( g){if(g==xB.eD)SJ=g;if(g==xB.fD&&SJ==xB.tC){SJ=g;if(ZJ==false)KB(new cB(cB.hD,null));}} IF(){this.mask=new wF.CI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=WJ[i+h*10];g.dB=false;g.IC=false;g.FB=u.DD;g.jB(bJ,cJ,dJ);var j=new NC(g.y,500+h*50+25,0.5,MB.sB);j.RC=i*0.1;j.JC=(k){g.y=k;};p.add(j);}}} GH(){XJ=new List<CD>();for(int h=0;h<CJ;h++ ){var g=new CD(h);g.YB=(RJ.nextInt(30)-15)*SB.PI/180;g.x=300-(90*CJ)/2+h*90+RJ.nextInt(20)-10;g.y=550;XJ.add(g);eJ.n(g);}} FF( g, h){var i=0;var j=WJ[g+h*10];if(j.direction==0){var l=(g>0)?WJ[g-1+h*10]:null;var m=(g<9)?WJ[g+1+h*10]:null;if(j.ZC(l))i++ ;if(j.ZC(m))i++ ;}else{var k=(h>0)?WJ[g+(h-1)*10]:null;var o=(h<9)?WJ[g+(h+1)*10]:null;if(j.hC(k))i++ ;if(j.hC(o))i++ ;}return i;} EF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=WJ[g+h*10];var i=QJ*2;while (FF(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<UJ.length;j++ )if(k.color==UJ[j])m=j;k.color=UJ[(m+1)%UJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(FF(g,h)==2);return l;} UF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(WJ[(h-1)+g*10].UD(WJ[h+g*10])&&WJ[h+g*10].UD(WJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(WJ[h+(g-1)*10].UD(WJ[h+g*10])&&WJ[h+g*10].UD(WJ[h+(g+1)*10]))return true;return false;} uJ( k, l, j){for(int h=0;h<20;h++ ){var g=vI~/j;var i=l*g+RJ.nextInt(g);if(VJ[i].FB==u.DD){VJ[i].FB=k;return;}}} HH(){VJ=new List<JB>();for(int g=0;g<vI;g++ ){var i=UJ[RJ.nextInt(UJ.length)];var h=RJ.nextInt(2);VJ.add(new JB(i,h));}for(int g=0;g<CJ*2;g++ )uJ("Lock${(g%CJ)+1}",g,CJ*2);for(int g=0;g<HJ;g++ )uJ(u.OB,g,HJ);for(int g=0;g<LJ;g++ )uJ(u.yB,g,LJ);for(int g=0;g<OJ;g++ )uJ(u.UE,g,OJ);for(int g=0;g<PJ;g++ )uJ(u.VE,g,PJ);} FH(){WJ=new List<JB>();var g=true;while (g){WJ.clear();for(int h=0;h<100;h++ ){var j=UJ[RJ.nextInt(UJ.length)];var i=RJ.nextInt(2);WJ.add(new JB(j,i));}g=EF();}} ZF(){if(ZJ||SJ!=xB.tC)return false;var l=true;ZJ=true;while (l){for(int k=0;k<WJ.length;k++ ){var g=WJ[k];g.dB=false;g.IC=false;g.jB(bJ,cJ,dJ);g.color=UJ[RJ.nextInt(UJ.length)];g.direction=RJ.nextInt(2);}l=EF()||(UF()==false);}var s=eB.LB.iB("BonusUniversal");s.play();var m=new sC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=WJ[i+j*10];g.aF=0.0;var h=new NC(0.0,1.0,0.2,MB.OC);h.RC=i*0.06;h.JC=(o){g.aF=o;};h.SF=(){g.jB(bJ,cJ,dJ);};h.onComplete=(){if(m.XD()==100){nJ();vJ();YJ.clear();}};p.add(h);}}return true;} nJ(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=WJ[h+i*10];var l=(h<9)?WJ[h+1+i*10]:null;var m=(i<9)?WJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.ZC(l)){j=true;k=(g.FB==u.OB||l.FB==u.OB);}if(g.hC(m)){j=true;k=(g.FB==u.OB||m.FB==u.OB);}if(g.dB!=j||g.IC!=k){g.dB=j;g.IC=k;g.jB(bJ,cJ,dJ);}}}} xJ( o, l, s, k, m, v){ZJ=true;o.XD(k);var i=1;for(int h=0;h<k;h++ ){var g=WJ[l+h*m+(s+h*v)*10];if(g.FB==u.UE)i=i*2;if(g.FB==u.VE)i=i*5;var IB=l+h*m;var RB=s+h*v;p.fB((){g.empty=true;g.jB(bJ,cJ,dJ);var EB=eB.LB.iB("ChainBlast");EB.play();var j=new SE(g.color,g.direction);j.x=IB*50;j.y=RB*50;p.add(j);gJ.n(j);SH(g);if(o.GF()==0)zJ();},0.1+h*0.1);}KB(new cB(cB.SE,{"Length":k,"Factor":i}));} vJ(){ZJ=false;var j=new sC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&WJ[i+g-1+h*10].ZC(WJ[i+g+h*10]))g++ ;if(g>=3)xJ(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&WJ[i+(h+g-1)*10].hC(WJ[i+(h+g)*10]))g++ ;if(g>=3)xJ(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(SJ==xB.eD)KB(new cB(cB.TE,null));if(SJ==xB.fD)KB(new cB(cB.hD,null));if(SJ==xB.tC&&UF()==false)ZF();}} SH( h){if(h.FB.indexOf("Lock")==0){var k=int.parse(h.FB.substring(4,5))-1;var j=XJ[k];var g=GB.iD(h.FB);g.x=h.x;g.y=h.y;n(g);var i=new mB(g,0.5,MB.sB);i.XB("x",j.x);i.XB("y",j.y-10);i.onComplete=()=>uB(g);p.add(i);p.fB(()=>NH(k),0.5);}} NH( k){var h=XJ[k];var i;if(h.BD){i=new cB(cB.ED,{"Type":"SingleLocked","Position":new NB(h.x+20,h.y)});var m=eB.LB.iB("Unlock");m.play();}else{i=new cB(cB.ED,{"Type":"SingleUnlocked","Position":new NB(h.x+20,h.y)});}KB(i);h.BD=false;h.YF(false);var j=true;for(int g=0;g<XJ.length;g++ )j=j&&(XJ[g].BD==false);if(j){var l=eB.LB.iB("BonusAllUnlock");l.play();for(int g=0;g<XJ.length;g++ ){XJ[g].BD=true;p.fB(()=>XJ[(g+k)%XJ.length].YH(),g*0.2);}p.fB(()=>KB(new cB(cB.ED,{"Type":"All","Position":new NB(280,550)})),0.75);}} zJ(){var o=new sC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&WJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&WJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=WJ[i+j*10];if(i>0){l=WJ[i-1+j*10];if(h.ZC(l)){l.dB=false;l.jB(bJ,cJ,dJ);}}h.dB=false;h.empty=true;h.jB(bJ,cJ,dJ);}else{if(VJ.length>0){h=VJ[0];VJ.removeRange(0,1);}else{h=new JB(UJ[RJ.nextInt(UJ.length)],RJ.nextInt(2));}}g=WJ[i+k*10];g.color=h.color;g.direction=h.direction;g.FB=h.FB;g.dB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.jB(bJ,cJ,dJ);o.XD();var m=new NC(g.y,50*k+25,0.1,MB.OC);m.JC=(s){g.y=s;};m.onComplete=(){if(o.GF()==0){nJ();vJ();BK();}};p.add(m);}}}} oJ( g){if(g.target==bJ&&this.VB){var j=SB.min(g.LF/50,9).toInt();var h=SB.min(g.MF/50,9).toInt();var i=new NB(j,h);YJ.add(i);BK();}} BK(){while (SJ==xB.tC&&ZJ==false&&YJ.length>0){var s=YJ[0];YJ.removeRange(0,1);var j=s.x.toInt();var k=s.y.toInt();var g=WJ[j+k*10];var h=(j>0)?WJ[j-1+k*10]:null;var o=(j<9)?WJ[j+1+k*10]:null;var i=(k>0)?WJ[j+(k-1)*10]:null;var m=(k<9)?WJ[j+(k+1)*10]:null;var l=false;if(g.FB==u.yB){var v=eB.LB.iB("ChainError");v.play();continue;}if(g.hC(i)){i.dB=false;i.jB(bJ,cJ,dJ);}if(g.ZC(h)){h.dB=false;h.jB(bJ,cJ,dJ);}g.direction=1-g.direction;g.dB=false;g.IC=false;var EB=eB.LB.iB("ChainRotate");EB.play();if(g.ZC(o)){g.dB=true;g.IC=(g.FB==u.OB||o.FB==u.OB);}if(g.hC(m)){g.dB=true;g.IC=(g.FB==u.OB||m.FB==u.OB);}g.jB(bJ,cJ,dJ);l=l||g.dB;if(g.hC(i)){i.dB=true;i.IC=(g.FB==u.OB||i.FB==u.OB);i.jB(bJ,cJ,dJ);l=true;}if(g.ZC(h)){h.dB=true;h.IC=(g.FB==u.OB||h.FB==u.OB);h.jB(bJ,cJ,dJ);l=true;}if(l){var IB=eB.LB.iB("ChainLink");IB.play();}vJ();}}}class lF extends AB{var QI;var ZI;var jI;var pI;var rI;lF(){jI=eB.LB.iB("Warning");pI=null;QI=GB.tF();ZI=new BB(QI[0]);n(ZI);} start(){pI=jI.play();p.remove(rI);rI=new NC(0,80,9.0,MB.OC);rI.JC=(h){var g=h.toInt()%8;ZI.QB=QI[(g<=4)?g+1:8-g];};p.add(rI);} stop(){if(pI!=null){pI.stop();pI=null;}p.remove(rI);ZI.QB=QI[0];}}class dC{static var LB;}class SE extends AB implements kB{var yI;var cI;SE( s, o){yI=new List<dD>();cI=0.0;this.VB=false;var v=GB.gD(s,o);var m=new SB.Random();var i;var l;var EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=SB.PI*1.15;YB=-SB.PI*2;}if(g==1&&h==0){i=SB.PI*1.85;YB=SB.PI*2;}if(g==1&&h==1){i=SB.PI*0.15;YB=SB.PI*2;}if(g==0&&h==1){i=SB.PI*0.85;YB=-SB.PI*2;}i=i+0.2*SB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new BB(v.QB);j.TD=new PB(g*25,h*25,25,25);j.UC=12.5+g*25;j.VC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);var k=new dD();k.BF=j;k.bF=g*25+12.5;k.cF=h*25+12.5;k.angle=i;k.eF=l;k.YB=YB;yI.add(k);}}} CC( m){cI=SB.min(0.8,cI+m);var v=981.0;for(int h=0;h<yI.length;h++ ){var g=yI[h];var i=g.BF;var j=g.angle;var k=g.eF;var l=g.YB;var o=g.bF+cI*(SB.cos(j)*k);var s=g.cF+cI*(SB.sin(j)*k+cI*v*0.5);i.x=o;i.y=s;i.YB=cI*l;}if(cI>=0.6)this.alpha=(0.8-cI)/0.2;if(cI>=0.8)this.JE();return (cI<0.8);}}var FD;var eC;var GD;var p;var WC;var HD;var zB; main(){FD=new pC("StageBackground",cC.query('#stageBackground'));eC=new pC("StageForeground",cC.query('#stageForeground'));GD=new zF();GD.AF(FD);GD.AF(eC);p=GD.JH;var g=DB.zE("images/Loading.png");g.then((h){WC=new BB(h);WC.UC=20;WC.VC=20;WC.x=400;WC.y=270;eC.n(WC);HD=new mB(WC,100,MB.OC);HD.XB("rotation",100.0*2.0*SB.PI);p.add(HD);zB=new LC();zB.QC=new aE("Arial",20,0xA0A0A0,DC:true);zB.width=240;zB.height=40;zB.text="... loading ...";zB.x=400-zB.aH/2;zB.y=320;zB.VB=false;eC.n(zB);oF();});} oF(){var g=new kC();g.hB("Background","images/Background.jpg");g.hB("ExitBox","images/ExitBox.png");g.hB("ExitButtonNormal","images/ExitButtonNormal.png");g.hB("ExitButtonPressed","images/ExitButtonPressed.png");g.hB("ExitGauge","images/ExitGauge.png");g.hB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.hB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.hB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.hB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.hB("InfoBox","images/InfoBox.png");g.hB("MessageBox","images/MessageBox.png");g.hB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.hB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.hB("TimeGauge","images/TimeGauge.png");g.zC("Alarm","images/AlarmTextureAtlas.json",fC.oC);g.zC("Head","images/HeadTextureAtlas.json",fC.oC);g.zC("Elements","images/ElementsTextureAtlas.json",fC.oC);g.zC("Levelup","images/LevelupTextureAtlas.json",fC.oC);g.zC("Locks","images/LocksTextureAtlas.json",fC.oC);g.bB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.bB("BonusUniversal","sounds/BonusUniversal.mp3");g.bB("ChainBlast","sounds/ChainBlast.mp3");g.bB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.bB("ChainError","sounds/ChainError.mp3");g.bB("ChainFall","sounds/ChainFall.mp3");g.bB("ChainHelp","sounds/ChainHelp.mp3");g.bB("ChainLink","sounds/ChainLink.mp3");g.bB("ChainRotate","sounds/ChainRotate.mp3");g.bB("Click","sounds/Click.mp3");g.bB("GameOver","sounds/GameOver.mp3");g.bB("Laugh","sounds/Laugh.mp3");g.bB("LevelUp","sounds/LevelUp.mp3");g.bB("PointsCounter","sounds/PointsCounter.mp3");g.bB("Unlock","sounds/Unlock.mp3");g.bB("Warning","sounds/Warning.mp3");g.bB("Intro","sounds/Intro.mp3");g.nB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.nB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.nB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.nB("ESCBlockErrorHint","Sorry but block chains canÂ´t be twisted!");g.nB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.nB("ESCNoActionHint","Press on the chain links to twist them.");g.nB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.nB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.nB("ESCtogo","Chain links:");g.nB("GENexitquery","Do you really want to quit the game?");g.nB("GEN2ndchancetime","Time is up. Second chance!");g.nB("GENtimeup","Sorry! Your time is up.");g.nB("GENgameover","Game Over");g.load().then((j){eC.uB(WC);eC.uB(zB);p.remove(HD);GB.LB=g;eB.LB=g;dC.LB=g;var i=new BB(GB.LB.q("Background"));FD.n(i);FD.UH=iC.wD;var h=new gF();eC.n(h);h.start();});}class lC extends CB{static const  tD="keyDown";static const  jE="keyUp";var wL;var yL;var BM;var EM;var NM;var QM;var UM;var WM;lC( g,[ bubbles=false]):super(g,bubbles){fM(g,bubbles);} fM( g,[ bubbles=false]){super.fM(g,bubbles);wL=false;yL=false;BM=false;EM=false;NM=false;QM=0;UM=0;WM=0;} get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM; get charCode=>QM; get keyCode=>UM; get keyLocation=>WM;}class WE extends CB{static const  PG="textInput";var VK="";WE( g,[ bubbles=false]):super(g,bubbles){}}class AC extends CB{static const  iE="touchBegin";static const  kE="touchEnd";static const  mE="touchCancel";static const  qE="touchMove";static const  cG="touchOver";static const  dG="touchOut";var jM;var lM;var nM,pM;var qM,rM;var wL;var NM;var yL;var BM;var tM;var vM;var wM;AC( g,[ bubbles=false]):super(g,bubbles){fM(g,bubbles);} fM( g,[ bubbles=false]){super.fM(g,bubbles);jM=0;lM=false;nM=pM=0;qM=rM=0;wL=false;NM=false;yL=false;BM=false;tM=1.00;vM=0;wM=0;}set WN( g){nM=g.x;pM=g.y;}set XN( g){qM=g.x;rM=g.y;} get aD=>jM; get LF=>nM; get MF=>pM; get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM;}class t extends CB{static const  XC="click";static const  RG="doubleClick";static const  ND="mouseDown";static const  zD="mouseUp";static const  rE="mouseMove";static const  PD="mouseOut";static const  sE="mouseOver";static const  gG="mouseWheel";static const  uE="middleClick";static const  jG="middleMouseDown";static const  lG="middleMouseUp";static const  vE="rightClick";static const  mG="rightMouseDown";static const  nG="rightMouseUp";var nM,pM;var qM,rM;var PN;var wL;var NM;var yL;var BM;var TN;var UN;var VN;t( g,[ bubbles=false]):super(g,bubbles){fM(g,bubbles);} fM( g,[ bubbles=false]){super.fM(g,bubbles);nM=pM=0;qM=rM=0;PN=false;wL=false;NM=false;yL=false;BM=false;TN=0;UN=0;VN=0;}set WN( g){nM=g.x;pM=g.y;}set XN( g){qM=g.x;rM=g.y;} get LF=>nM; get MF=>pM; get PC=>PN; get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM; get AD=>TN;}abstract class lB extends w{var wG=false;var VB=true;var AI=true;var tabIndex=0;fE get on=>new fE(this);}abstract class mC extends lB{var sK;var yK=true;var JL=true;mC(){sK=new List<w>();}vF get on=>new vF(this); n( g){if(g.parent==this){var h=sK.indexOf(g);sK.removeAt(h);sK.add(g);}else{tG(g,sK.length);}} tG( g, h){if(h<0&&h>sK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){sK.removeAt(sK.indexOf(g));if(h>sK.length)h-- ;sK.insertRange(h,1,g);}else{g.JE();g.ZN(this);sK.insertRange(h,1,g);g.KB(new CB(CB.IG,true));if(this.ZD!=null)aN(g,new CB(CB.vC));}} uB( h){var g=sK.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");TH(g);} TH( g){if(g<0&&g>=sK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=sK[g];h.KB(new CB(CB.aG,true));if(this.ZD!=null)aN(h,new CB(CB.xC));h.ZN(null);sK.removeAt(g);} contains( g){for(;g!=null;g=g.GM)if(g==this)return true;return false;} tB( m,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.BI();if(sK.length==0)return super.tB(m,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var o=sK.length;for(int j=0;j<o;j++ ){eM.GE(sK[j].CN,m);var g=sK[j].tB(eM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>l)l=g.right;if(g.bottom>k)k=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=l-h;returnRectangle.height=k-i;return returnRectangle;} TC( s, v){var l=null;for(int j=sK.length-1;j>=0;j-- ){var i=sK[j];if(i.visible){var g=i.CN;var m=s-g.GC;var k=v-g.HC;var EB=(g.d*m-g.c*k)/g.aC;var o=(g.a*k-g.b*m)/g.aC;var h=i.TC(EB,o);if(h!=null){if(h is lB)if(h.VB)return yK?h:this;l=this;}}}return l;} oB( i){for(int g=0;g<sK.length;g++ ){var h=sK[g];if(h.visible)i.WF(h);}} aN( g, j){g.KB(j);if(g is mC){var i=new List<w>.from(g.sK);var k=i.length;for(int h=0;h<k;h++ )aN(i[h],j);}}}class XE{var target=null;var PC=false;var EE=0;var AD=0;var PF,QF;var NF,OF;XE(this.PF,this.QF,this.NF,this.OF);}class xF extends CB{var OK;xF( g):super(CB.xD,false){OK=g;} get DE=>false;}class dE{static const  QG="none";static const  WG="touchPoint";}class AB extends mC{var oH=false;var OE=false;}class BB extends w{var QB;var RH;var TD;BB([this.QB=null,this.RH="auto"]){TD=null;} tB( h,[ returnRectangle]){var g=(QB!=null)?QB.width:0;var i=(QB!=null)?QB.height:0;return CE(h,g,i,returnRectangle);} TC( g, h){if(QB!=null&&g>=0.0&&h>=0.0&&g<QB.width&&h<QB.height)return this;return null;} oB( g){if(QB!=null){if(TD==null)QB.oB(g);else QB.VF(g,TD);}}}class DG{static const  FG="dynamic";}abstract class bE{ oB( g);}class uC extends lB{var NE;var TF;var HF;var WD;var OE=true;var enabled=true;var hL;uC([this.NE,this.TF,this.HF,this.WD]){addEventListener(t.sE,CM);addEventListener(t.PD,CM);addEventListener(t.ND,CM);addEventListener(t.zD,CM);hL=this.NE;} tB( g,[ returnRectangle]){if(hL!=null){eM.GE(hL.CN,g);return hL.tB(eM,returnRectangle);}return super.tB(g,returnRectangle);} TC( k, l){if(this.WD!=null){var g=this.WD.CN;var h=k-g.GC;var i=l-g.HC;var m=(g.d*h-g.c*i)/g.aC;var j=(g.a*i-g.b*h)/g.aC;if(this.WD.TC(m,j)!=null)return this;}return null;} oB( g){if(hL!=null)g.WF(hL);} CM( g){if(g.type==t.PD){hL=NE;}else{hL=g.PC?HF:TF;}}}class wF{var CK;var LK;var bK;var oK;wF.CI( i, g, h, j){CK=0;LK=new PB(i,g,h,j);} oB( i){var g=i.context;g.beginPath();switch (CK){case 0:g.rect(LK.x,LK.y,LK.width,LK.height);break;case 1:g.arc(bK.x,bK.y,bK.wH,0,SB.PI*2.0,false);break;case 2:g.moveTo(oK[0].x,oK[0].y);for(int h=1;h<oK.length;h++ )g.lineTo(oK[h].x,oK[h].y);break;}g.clip();}}class cE extends YE{cE( g):super(g);}class vF extends fE{vF( g):super(g);}class fE extends cE{fE( g):super(g); get mouseOut=>this[t.PD]; get mouseMove=>this[t.rE]; get mouseDown=>this[t.ND]; get mouseUp=>this[t.zD]; get mouseWheel=>this[t.gG]; get touchMove=>this[AC.qE]; get touchEnd=>this[AC.kE]; get touchCancel=>this[AC.mE]; get keyUp=>this[lC.jE]; get keyDown=>this[lC.tD];}class KD extends w{static const  sD='DIRECTION_UP';static const  lE='DIRECTION_RIGHT';static const  yD='DIRECTION_DOWN';static const  OD='DIRECTION_LEFT';var nL;var qL;var tL;var xL;KD( g,[ direction=OD]){if(direction!=sD&&direction!=yD&&direction!=OD&&direction!=lE){throw new ArgumentError('Invalid Gauge direction!');}nL=direction;qL=1.0;tL=g;xL=new PB.BI();kM();} get ratio=>qL;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;qL=g;kM();} get QB=>tL;set QB( g){tL=g;kM();}kM(){if(tL==null){xL.left=0;xL.top=0;xL.right=0;xL.bottom=0;}else{var h=tL.width;var g=tL.height;switch (nL){case OD:xL.left=((1.0-qL)*h).toInt();xL.top=0;xL.right=h;xL.bottom=g;break;case sD:xL.left=0;xL.top=((1.0-qL)*g).toInt();xL.right=h;xL.bottom=g;break;case lE:xL.left=0;xL.top=0;xL.right=(qL*h).toInt();xL.bottom=g;break;case yD:xL.left=0;xL.top=0;xL.right=h;xL.bottom=(qL*g).toInt();break;}}} tB( h,[ returnRectangle]){var g=(tL!=null)?tL.width:0;var i=(tL!=null)?tL.height:0;return CE(h,g,i,returnRectangle);} TC( g, h){if(tL!=null&&g>=0.0&&h>=0.0&&g<tL.width&&h<tL.height)return this;return null;} oB( g){if(tL!=null)tL.VF(g,xL);}}class uF{static const  QG="none";}abstract class HB{static  GG( g){var h=LD.oG;if(h=="WebAudioApi")return nD.GG(g);if(h=="AudioElement")return lD.GG(g);return ZE.GG(g);} get length; play([ loop=false, soundTransform]);static var YC;static  wE( g){if(YC==null){YC=new List<String>();var i=new cC.AudioElement();var h=["maybe","probably"];if(h.indexOf(i.canPlayType("audio/ogg",""))!=-1)YC.add("ogg");if(h.indexOf(i.canPlayType("audio/mp3",""))!=-1)YC.add("mp3");if(h.indexOf(i.canPlayType("audio/wav",""))!=-1)YC.add("wav");}var k=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,ignoreCase:true);var j=k.firstMatch(g);if(j==null)throw new ArgumentError("Unsupported file extension.");var l=j.group(1).toLowerCase();if(YC.indexOf(l)==-1&&YC.length>0)g="${g.substring(0,g.length-3)}${YC[0]}";return g;}}abstract class KC extends aB{ get FC; set FC( g); stop();}class WB{var volume;var QH;var uH=1;var vH=0;var zH=1;var yH=0;WB([this.volume=1,this.QH=0]);}class LD{static var QD;static  get RD{if(QD==null){try {QD=new fF.AudioContext();}catch (g){QD=null;}}return QD;}static var yC;static  get oG{if(yC==null){yC=(RD!=null)?"WebAudioApi":"AudioElement";var g=cC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))yC="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))yC="Mock";}return yC;}}class lD extends HB{var XK;var pK;var IL;lD(){IL=new List<JD>();XK=new cC.AudioElement();XK.on.ended.add(pL);pK=new List<cC.AudioElement>();pK.add(XK);cC.document.body.children.add(XK);}static  GG( l){var g=new lD();var j=new Completer<HB>();var i;var h;i=(k){g.XK.on.canPlayThrough.remove(i);g.XK.on.error.remove(h);j.complete(g);};h=(k){g.XK.on.canPlayThrough.remove(i);g.XK.on.error.remove(h);j.completeException("Failed to load audio.");};g.XK.src=HB.wE(l);g.XK.on.canPlayThrough.add(i);g.XK.on.error.add(h);g.XK.load();return j.future;} get length{return XK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new JD(this,loop,soundTransform);} IM( h){var g;if(pK.length==0){g=XK.clone(true);g.on.ended.add(pL);}else{g=pK.removeAt(0);}IL.add(h);return g;} QN( g){var h=g.XK;var i=IL.indexOf(g);IL.removeAt(i);pK.add(h);if(XK.currentTime>0&&XK.ended==false)XK.currentTime=0;} pL(j){var i=j.target;var g=null;for(int h=0;h<IL.length&&g==null;h++ )if(IL[h].XK==i)g=IL[h];if(g!=null)g.stop();}}class JD extends KC{var iK;var XK;var UK;var lK;JD( g, i, h){iK=g;UK=i;lK=h;XK=g.IM(this);XK.loop=UK;this.FC=h;XK.play();} get FC=>lK; set FC( g){lK=g;if(XK!=null)XK.volume=(lK!=null)?lK.volume:1;} stop(){if(XK!=null){if(XK.ended==false)XK.pause();iK.QN(this);XK=null;}}}class nD extends HB{var RK;nD(){if(LD.RD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  GG( o){var i=new nD();var g=new Completer<HB>();var h=new cC.HttpRequest(); l( k){i.RK=k;if(g.future.isComplete==false)g.complete(i);} v(IB){if(g.future.isComplete==false)g.completeException("Failed to decode audio.");} EB(s){var m=LD.RD;m.decodeAudioData(h.response,l,v);} j(s){if(g.future.isComplete==false)g.completeException("Failed to load audio.");}h.open('GET',HB.wE(o),true);h.responseType='arraybuffer';h.on.load.add(EB);h.on.error.add(j);h.send();return g.future;} get length{return RK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new jH(this,loop,soundTransform);}}class jH extends KC{var fK;var lK;var UK;var PL;var XL;jH( j, h, i){fK=j;UK=h;lK=i;var g=LD.RD;PL=g.createGain();PL.connect(g.destination,0,0);PL.gain.value=(lK!=null)?SB.pow(lK.volume,2):1;XL=g.createBufferSource();XL.buffer=fK.RK;XL.loop=h;XL.connect(PL,0,0);XL.start(0);} get FC=>lK; set FC( g){lK=g;PL.gain.value=(lK!=null)?SB.pow(lK.volume,2):1;} stop(){XL.stop(0);}}class ZE extends HB{ZE(){}static  GG( i){var h=new ZE();var g=new Completer<HB>();cC.window.setTimeout(()=>g.complete(h),1);return g.future;} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new kH(this,loop,soundTransform);}}class ID{static final rD=new ID();var eL;ID(){eL=new List<UB>();} add( g){eL.add(g);} remove( h){var g=eL.indexOf(h);if(g!=-1)eL[g]=null;} KB( j){var k=eL.length;var h=0;for(int g=0;g<k;g++ ){var i=eL[g];if(i!=null){j.EN=i.JF;j.GN=i.JF;j.zM=gC.MD;i.KB(j);if(h!=g)eL[h]=i;h++ ;}}for(int g=k;g<eL.length;g++ )eL[h++ ]=eL[g];eL.length=h;}}class yF{var VD;var bD;yF(this.VD,this.bD);}class LC extends lB{var VK="";var eK=0x000000;var zK=null;var LL=uF.QG;var YL=CG.LG;var CK=DG.FG;var mL=false;var rL=false;var vL=0x000000;var AM=false;var FM=0x000000;var JM=0;var OM=0;var SM;var XM;var YM=true;var aM=100;var dM=100;var hM=null;var PK=null;LC(){zK=new aE("Arial",12,0x000000);SM=new List<String>();XM=new List<jD>();} get type=>CK; get width=>aM; get height=>dM; set text( g){VK=g;YM=true;} set QC( g){zK=g;eK=zK.color;YM=true;} set wordWrap( g){mL=g;YM=true;} set width( g){aM=g;YM=true;} set height( g){dM=g;YM=true;} get aH{dN();return JM;} get ME{dN();return OM;} tB( g,[ returnRectangle]){return CE(g,aM,dM,returnRectangle);} TC( g, h){if(g>=0&&h>=0&&g<aM&&h<dM)return this;return null;} oB( g){dN();g.PK.drawImage(hM,0.0,0.0);} hN(){SM.clear();XM.clear();if(mL==false){SM.add(VK);}else{var g=new StringBuffer();var i;var h;for(String o in VK.replaceAll('\r','').split('\n')){for(String j in o.split(' ')){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(PK.measureText(h).width>aM){if(i>0)h=h.substring(0,i);else j="";SM.add(h);g.clear();g.add(j);}}if(g.isEmpty==false){SM.add(g.toString());g.clear();}}}JM=0;OM=0;for(String h in SM){var l=PK.measureText(h);var m=0;if(zK.align==rB.MC||zK.align==rB.UG)m=(aM-l.width)/2;if(zK.align==rB.SG||zK.align==rB.OG)m=aM-l.width;var k=new jD(m,l.width,zK.size,0,0,0);XM.add(k);JM=SB.max(JM,k.width);OM=OM+k.height;}} dN(){if(YM){YM=false;var i=aM.ceil().toInt();var j=dM.ceil().toInt();if(hM==null){hM=new cC.CanvasElement(width:i,height:j);PK=hM.context2d;}if(hM.width!=i)hM.width=i;if(hM.height!=j)hM.height=j;var g=new StringBuffer();g.add(zK.KF?"italic ":"normal ");g.add("normal ");g.add(zK.DC?"bold ":"normal ");g.add("${zK.size}px ");g.add("${zK.font},sans-serif");PK.font=g.toString();PK.textAlign="start";PK.textBaseline="top";PK.fillStyle=wC(eK);hN();if(rL){PK.fillStyle=wC(vL);PK.fillRect(0,0,aM,dM);}else{PK.clearRect(0,0,aM,dM);}var k=0;for(int h=0;h<SM.length;h++ ){var l=XM[h];PK.fillStyle=wC(eK);PK.fillText(SM[h],l.x,k);k+= l.height;}if(AM){PK.strokeStyle=wC(FM);PK.lineWidth=1;PK.strokeRect(0,0,aM,dM);}}}}class aB{var ZK; BH( g){return ZK!=null&&ZK.containsKey(g);} addEventListener( g, h,[ useCapture=false]){gL(g).add(h,useCapture);} KB( g){mM(g,this,this,gC.MD);}YE get on=>new YE(this); mM( g, i, k, j){if(ZK!=null){var h=ZK[g.type];if(h!=null){g.EN=i;g.GN=k;g.zM=j;g.IN=false;g.KN=false;h.KB(g);}}} gL( h){if(ZK==null)ZK=new Map<String,UB>();var g=ZK[h];if(g==null)g=ZK[h]=new UB(this,h);return g;}}class gC{static const  hE=1;static const  MD=2;static const  TG=3;}class aE{var font;var size;var color;var DC;var KF;var dH;var align;var KH;var WH;var EH;var HE;var letterSpacing=0;var mH=0;var nH=false;var tH=false;aE(this.font,this.size,this.color,{this.DC: false,this.KF: false,this.dH: false,this.align: "left",this.KH: 0,this.WH: 0,this.EH: 0,this.HE: 0});}class YE{var VG;YE( g){VG=g;} operator[]( g){return VG.gL(g);}}class jD{var uG;var vG;var height;var HE;var width;var x;jD(this.x,this.width,this.height,this.uG,this.vG,this.HE);}class CB{static const  IG="added";static const  vC="addedToStage";static const  xD="enterFrame";static const  aG="removed";static const  xC="removedFromStage";var CK;var xM;var zM;var EN;var GN;var IN;var KN;CB( g,[ bubbles=false]){fM(g,bubbles);} fM( g,[ bubbles=false]){CK=g;xM=bubbles;zM=gC.MD;EN=null;GN=null;IN=false;KN=false;} get KE=>IN; get ZH=>KN; get type=>CK; get eventPhase=>zM; get bubbles=>xM; get DE=>true; get target=>EN;}class iC{static const  qD="auto";static const  NG="stop";static const  wD="once";}class BC{var PK;var gK;var vK;var EL;BC.DI( j,[ matrix]){PK=j;gK=new List<TB>(100);vK=new List<double>(100);for(int h=0;h<100;h++ ){gK[h]=new TB.EI();vK[h]=1.0;}EL=0;if(matrix!=null)gK[0].FE(matrix);var g=gK[0];var i=vK[0];PK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);PK.globalAlpha=i;} get context=>PK; reset(){EL=0;var g=gK[0];var h=vK[0];PK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);PK.globalAlpha=h;PK.clearRect(0,0,PK.canvas.width,PK.canvas.height);} WF( h){var i=EL;var j=EL+1;var l=gK[i];var g=gK[j];var m=vK[i];var k=vK[j]=h.sL*m;g.GE(h.CN,l);PK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);PK.globalAlpha=k;EL=j;if(h.mask==null){h.oB(this);}else{PK.save();h.mask.oB(this);h.oB(this);PK.restore();}EL=i;}}class zF{var GK;var TK;var cK;var AL;var ML;zF(){GK=new mD();TK=new List<pC>();cK=double.NAN;AL=ID.rD;ML=new xF(0);cC.window.requestAnimationFrame(LM);} get JH=>GK; LM( g){cC.window.requestAnimationFrame(LM);if(cK.isNaN)cK=g;if(cK>g)cK=g;var j=g-cK;var i=j/1000.0;if(j>=1){cK=g;ML.OK=i;AL.KB(ML);GK.CC(i);for(int h=0;h<TK.length;h++ ){var k=TK[h];k.LH();}}} AF( g){TK.add(g);}}class TB{var DK,EK,FK,HK,KK,MK;var SK;TB.EI():DK=1.0,EK=0.0,FK=0.0,HK=1.0,KK=0.0,MK=0.0,SK=1.0; get a=>DK; get b=>EK; get c=>FK; get d=>HK; get GC=>KK; get HC=>MK; get aC=>SK; cH( g){return new NB(g.x*DK+g.y*FK+KK,g.x*EK+g.y*HK+MK);} concat( g){var m=DK;var v=EK;var EB=FK;var s=HK;var l=KK;var o=MK;var RB=SK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var gB=g.GC;var IB=g.HC;var pB=g.aC;DK=(m*j+v*i);EK=(m*k+v*h);FK=(EB*j+s*i);HK=(EB*k+s*h);KK=(l*j+o*i+gB);MK=(l*k+o*h+IB);SK=(RB*pB);} CH(){DK=1.0;EK=0.0;FK=0.0;HK=1.0;KK=0.0;MK=0.0;SK=1.0;} IH(){var j=DK;var m=EK;var l=FK;var k=HK;var h=KK;var i=MK;var g=SK;DK=(k/g);EK=-(m/g);FK=-(l/g);HK=(j/g);KK=-(DK*h+FK*i);MK=-(EK*h+HK*i);SK=(1.0/g);} XF( g, j, i, h, k, l){DK=g;EK=j;FK=i;HK=h;KK=k;MK=l;SK=(g*h-j*i);} FE( g){DK=g.a;EK=g.b;FK=g.c;HK=g.d;KK=g.GC;MK=g.HC;SK=g.aC;} GE( h, g){var o=h.a;var EB=h.b;var IB=h.c;var v=h.d;var m=h.GC;var s=h.HC;var gB=h.aC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var pB=g.GC;var RB=g.HC;var bC=g.aC;DK=(o*k+EB*j);EK=(o*l+EB*i);FK=(IB*k+v*j);HK=(IB*l+v*i);KK=(m*k+s*j+pB);MK=(m*l+s*i+RB);SK=(gB*bC);}}class PB{var x;var y;var width;var height;PB(this.x,this.y,this.width,this.height);PB.BI():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new NB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0); FE( g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class kC{var NK;var hK;var CL;var OL;var UL;var aL;var fL;kC(){NK=new Map<String,DB>();hK=new Map<String,HB>();CL=new Map<String,ZB>();OL=new Map<String,String>();UL=null;aL=0;fL=0;} hB( h, i){var g=DB.zE(i);aL++ ;g.then(( j){NK[h]=j;aL-- ;BN();});g.handleException((k){fL++ ;aL-- ;BN();});} bB( h, i){var g=HB.GG(i);aL++ ;g.then(( j){hK[h]=j;aL-- ;BN();});g.handleException((k){fL++ ;aL-- ;BN();});} zC( i, k, h){var g=ZB.eG(k,h);aL++ ;g.then(( j){CL[i]=j;aL-- ;BN();});g.handleException((l){fL++ ;aL-- ;BN();});} nB( h, g){OL[h]=g;} load(){UL=new Completer<kC>();BN();return UL.future;} q( g){if(NK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return NK[g];} iB( g){if(hK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return hK[g];} SC( g){if(CL.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return CL[g];} qC( g){if(OL.containsKey(g)==false)return "[[${g}]]";return OL[g];}BN(){if(UL!=null&&aL==0){if(fL==0)UL.complete(this);else UL.completeException(this);}}}class NB{var x;var y;NB(this.x,this.y);NB.BI():this(0,0); get length=>SB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new NB(this.x+g.x,this.y+g.y); FE( g){this.x=g.x;this.y=g.y;} equals( g)=>this.x==g.x&&this.y==g.y;}class ZB{var JK;var kK;ZB(){JK=new cC.ImageElement();kK=new List<eE>();}static  eG( o, RB){var m=new Completer<ZB>();var i=new ZB();switch (RB){case fC.HG:case fC.oC:var k=new cC.HttpRequest();k.open('GET',o,true);k.on.load.add((pB){ s( l, g){var EB=qG(l);var h=new eE(EB,i);h.nK=g["frame"]["x"].toInt();h.tK=g["frame"]["y"].toInt();h.BL=g["frame"]["w"].toInt();h.HL=g["frame"]["h"].toInt();h.NL=g["spriteSourceSize"]["x"].toInt();h.SL=g["spriteSourceSize"]["y"].toInt();h.VL=g["sourceSize"]["w"].toInt();h.bL=g["sourceSize"]["h"].toInt();h.iL=g["rotated"] as bool;i.kK.add(h);}var v=fH.JSON.parse(k.responseText);var j=v["frames"];var IB=v["meta"];if(j is List)for(var g in j)s(g["filename"],g);if(j is Map)for(String l in j.keys)s(l,j[l]);i.JK.on.load.add((gB)=>m.complete(i));i.JK.on.error.add((gB)=>m.completeException("Failed to load image."));i.JK.src=rG(o,IB["image"]);});k.on.error.add((pB)=>m.completeException("Failed to load json file."));k.send();break;}return m.future;} get DH=>JK; q( i){var h;for(int g=0;g<kK.length&&h==null;g++ )if(kK[g].name==i)h=new DB.GI(kK[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}static  qG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,ignoreCase:true);var i=h.firstMatch(g);return i.group(1);}static  rG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,ignoreCase:true);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";}}class fC{static const  HG="json";static const  oC="jsonarray";}class BG{var name;var wB;var LE;BG(this.name,this.wB,this.LE);}class mD implements kB{var aK;var mK;var wK;mD(){wK=0.0;aK=new List<kB>();mK=0;} add( g){if(g==null)return;if(mK>=aK.length)aK.add(g);else aK[mK]=g;mK++ ;} remove( h){if(h==null)return;for(int g=0;g<mK;g++ )if(aK[g]==h)aK[g]=null;} fB( h, i){var g=new kD(h,i);add(g);return g;} CC( j){wK+= j;var k=mK;var h=0;for(int g=0;g<k;g++ ){var i=aK[g];if(i!=null&&i.CC(j)){if(h!=g)aK[h]=i;h++ ;}}for(int g=k;g<mK;g++ )aK[h++ ]=aK[g];for(int g=h;g<mK;g++ )aK[g]=null;mK=h;return true;}}abstract class kB{ CC( g);}class kD implements kB{var QK=0.0;var jK=0.0;var uK=1;var GL;kD( g, h){GL=g;jK=SB.max(h,0.0001);} CC( h){var g=QK+h;while (g>=jK&&uK>0){QK=jK;uK-- ;GL();g-= jK;}if(uK==0)return false;QK=g;return true;} get totalTime=>jK; get currentTime=>QK;}class CG{static const  LG="pixel";}class eE{var IK;var YK;var nK;var tK;var BL;var HL;var NL;var SL;var VL;var bL;var iL;eE( g, h){IK=g;YK=h;} get bH=>YK; get name=>IK; get zG=>nK; get AH=>tK; get yG=>BL; get xG=>HL; get offsetX=>NL; get offsetY=>SL; get PH=>VL; get OH=>bL; get XH=>iL;}class oD{static var gE=qB.qD;static var KG=false;static var VG=new aB();static  xE( i){var h=i;var g="auto";if(gE!=qB.qD)h=gE;switch (h){case qB.qD:g="auto";break;case qB.uD:g="default";break;case qB.vD:g="pointer";break;case qB.YG:g="move";break;case qB.ZG:g="text";break;case qB.bG:g="wait";break;}if(KG)g="none";return g;}}class qB{static const  qD="auto";static const  uD="arrow";static const  vD="button";static const  YG="hand";static const  ZG="ibeam";static const  bG="wait";}abstract class w extends aB implements bE{var rK=0.0;var xK=0.0;var FL=0.0;var KL=0.0;var QL=1.0;var WL=1.0;var cL=0.0;var jL;var lL;var sL=1.0;var uL=true;var IK="";var GM=null;var mask;var eM;var gM;w(){jL=new TB.EI();lL=true;eM=new TB.EI();gM=new TB.EI();} get x=>rK; get y=>xK; get UC=>FL; get VC=>KL; get vB=>QL; get EC=>WL; get YB=>cL; get alpha=>sL; get visible=>uL; get name=>IK; get parent=>GM;cE get on=>new cE(this); get root{var g=this;while (g.GM!=null)g=g.GM;return g;} get ZD{var g=this.root;if(g is pC)return g;return null;} set x( g){rK=g;lL=true;} set y( g){xK=g;lL=true;} set UC( g){FL=g;lL=true;} set VC( g){KL=g;lL=true;} set vB( g){QL=g;lL=true;} set EC( g){WL=g;lL=true;} set YB( g){cL=g;lL=true;} set alpha( g){sL=g;lL=true;} get width=>tB(CN).width; get height=>tB(CN).height; set width( h){this.vB=1;var g=this.width;this.vB=(g!=0.0)?h/g:1.0;} set height( h){this.EC=1;var g=this.height;this.EC=(g!=0.0)?h/g:1.0;} JE(){if(GM!=null)GM.uB(this);} get CN{if(lL){lL=false;if(cL==0.0){jL.XF(QL,0.0,0.0,WL,rK-FL*QL,xK-KL*WL);}else{var g=SB.cos(cL);var h=SB.sin(cL);var i=QL*g;var l=QL*h;var k=-WL*h;var j=WL*g;var m=rK-FL*i-KL*k;var o=xK-FL*l-KL*j;jL.XF(i,l,k,j,m,o);}}return jL;} tB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.BI();returnRectangle.x=g.GC;returnRectangle.y=g.HC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} TC( g, h){if(tB(gM).contains(g,h))return this;return null;} rC( h){eM.CH();for(w g=this;g!=null;g=g.GM)eM.concat(g.CN);eM.IH();return eM.cH(h);} KB( h){var g=null;if(h.DE||h.bubbles)for(w j=GM;j!=null;j=j.GM)if(j.BH(h.type)){if(g==null)g=new List<w>();g.add(j);}if(h.DE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.KE==false)g[i].mM(h,this,g[i],gC.hE);if(h.KE==false)mM(h,this,this,gC.MD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.KE==false)g[i].mM(h,this,g[i],gC.TG);} ZN( h){for(var g=h;g!=null;g=g.GM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");GM=h;} oB( g);}class rB{static const  MC="center";static const  OG="end";static const  UG="justify";static const  SG="right";}class kH extends KC{var UK;var lK;kH( i, h, g){UK=h;lK=g;} get FC=>lK; set FC( g){lK=g;} stop(){}}class jC{static const  EG=0;static const  JG=1;static const  SG=2;static const  XG=3;static const  oE=4;}class AG{AG();}class pD extends KD implements kB{static const  MG='TIME_OUT';var RL=false;var QK=0.0;var jK=0.0;var kL;var oL=true;pD( g, h,[ direction=KD.OD]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');jK=g;DF();} CC( g){if(RL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){RL=true;} pause(){RL=false;} reset([ time=0.0]){pause();time=SB.max(time,0.0);if(time!=0.0){jK=time;DF();}ratio=1.0;} SD( g, h){kL[g]=h/totalTime;} DF(){kL=new Map<String,num>();SD(pD.MG,0);} get totalTime=>jK; get VH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(oL){kL.forEach((j,g){if(g<h&&g>=ratio)KB(new CB(j));});}}}class DB implements bE{var WK;var dK;var qK;var DL;var PK;var TL;var ZL;var dL;var nK;var tK;var BL;var HL;DB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){WK=g;dK=h;qK=transparent;var i=new cC.CanvasElement(width:WK,height:dK);PK=i.context2d;PK.fillStyle=qK?fG(fillColor):wC(fillColor);PK.fillRect(0,0,g,h);DL=i;TL=0;}DB.FI( g){WK=g.naturalWidth;dK=g.naturalHeight;qK=true;DL=g;TL=0;}DB.GI( g){WK=g.PH;dK=g.OH;qK=true;DL=g.bH.DH;TL=g.XH?2:1;ZL=g.offsetX.toDouble();dL=g.offsetY.toDouble();nK=g.zG.toDouble();tK=g.AH.toDouble();BL=g.yG.toDouble();HL=g.xG.toDouble();}static  zE( i){var h=new Completer<DB>();var g=new cC.ImageElement();g.on.load.add((j)=>h.complete(new DB.FI(g)));g.on.error.add((j)=>h.completeException("Failed to load image."));g.src=i;return h.future;} get width=>WK; get height=>dK; oB( g){switch (TL){case 0:g.context.drawImage(DL,0.0,0.0);break;case 1:g.context.drawImage(DL,nK,tK,BL,HL,ZL,dL,BL,HL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,ZL,dL+HL);g.context.drawImage(DL,nK,tK,HL,BL,0.0,0.0,HL,BL);break;}} VF( gB, g){if(g.width<=0.0||g.height<=0.0)return;switch (TL){case 0:gB.context.drawImage(DL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=nK;double h=tK;double v=j+BL;double EB=h+HL;double l=nK-ZL+g.x;double m=tK-dL+g.y;double RB=l+g.width;double IB=m+g.height;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double PE=(EB<IB)?EB:IB;double QE=ZL-j+s;double bC=dL-h+o;double k=pB-s;double i=PE-o;if(k>0.0&&i>0.0){gB.context.drawImage(DL,s,o,k,i,QE,bC,k,i);}break;case 2:double j=nK;double h=tK;double v=j+HL;double EB=h+BL;double l=nK+dL-g.y+HL-g.height;double m=tK-ZL+g.x;double RB=l+g.height;double IB=m+g.width;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double PE=(EB<IB)?EB:IB;double QE=ZL-h+o;double bC=dL+v-pB;double k=PE-o;double i=pB-s;if(k>0.0&&i>0.0){gB.context.transform(0.0,-1.0,1.0,0.0,QE,bC+i);gB.context.drawImage(DL,s,o,i,k,0.0,0.0,i,k);}break;}}}typedef  nC(event); wC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class nE{static var pE=false;static var AE=false;static var BE=0;static var iG=dE.QG;static var VG=new aB();static kG(){if(pE==false){pE=true;var g=cC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){AE=true;BE=10;}if(g.contains("Android")){AE=true;BE=10;}if(g.contains("IEMobile")){AE=true;BE=10;}}}static  get pG{kG();return iG;}}class NC extends kB{var zL;var DM;var HM;var KM;var PM;var TM;var VM;var jK;var QK;var ZM;var bM;var cM;NC( g, h, i,[ transitionFunction( ratio)]){zL=g;DM=h;HM=g;KM=(transitionFunction!=null)?transitionFunction:MB.OC;QK=0.0;jK=SB.max(0.0001,i);ZM=0.0;bM=false;cM=false;} CC( i){if(QK<jK||cM==false){QK=QK+i;if(QK>jK)QK=jK;if(QK>=0.0){if(cM==false){cM=true;if(PM!=null)PM();}var g=QK/jK;var h=KM(g);HM=zL+h*(DM-zL);if(TM!=null)TM(bM?HM.round():HM);if(VM!=null&&QK==jK)VM();}}return QK<jK;} get wB=>zL; get LE=>DM; get totalTime=>jK; get currentTime=>QK; get isComplete=>QK>=jK;set RC( g){if(cM==false)QK=QK+ZM-g;ZM=g;} set SF( g()){PM=g;} set JC( g( value)){TM=g;} set onComplete( g()){VM=g;}}class UB{var VG;var MM;var RM;UB( h, g){VG=h;MM=g;RM=new List<yF>();} get JF=>VG; add( h,[ useCapture=false]){for(int g=0;g<RM.length;g++ )if(RM[g].VD==h&&RM[g].bD==useCapture)return;if(MM==CB.xD&&RM.length==0)ID.rD.add(this);RM.add(new yF(h,useCapture));} remove( h,[ useCapture=false]){for(int g=0;g<RM.length;g++ ){if(RM[g].VD==h&&RM[g].bD==useCapture){RM=new List<yF>.from(RM);RM.removeAt(g);if(MM==CB.xD&&RM.length==0)ID.rD.remove(this);break;}}} operator+( g){this.add(g,false);} operator-( g){this.remove(g,false);} KB( h){for(int g=0;g<RM.length;g++ )if(h.eventPhase!=gC.hE||RM[g].bD)if(h.ZH==false)RM[g].VD(h);}}class tE{static var hG=0;var aD=hG++ ;var target=null;var YD=false;tE(this.target,this.YD);} fG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static  OC( g){return g;}static  yE( g){return g*g*g;}static  sB( g){g=1.0-g;return 1.0-g*g*g;}static  sG( g){if(g==0.0||g==1.0)return g;return SB.pow(2.0,-10.0*g)*SB.sin((g-0.3/4.0)*(2.0*SB.PI)/0.3)+1;}}class mB implements kB{var iM;var KM;var oM;var PM;var TM;var VM;var jK;var QK;var ZM;var bM;var cM;mB( g, h,[ transitionFunction( ratio)]){iM=g;KM=(transitionFunction!=null)?transitionFunction:MB.OC;QK=0.0;jK=SB.max(0.0001,h);ZM=0.0;bM=false;cM=false;oM=new List<BG>();} XB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(iM!=null&&cM==false)oM.add(new BG(g,0.0,h));} moveTo( h, g){XB('x',h);XB('y',g);} CC( l){if(QK<jK||cM==false){QK=QK+l;if(QK>jK)QK=jK;if(QK>=0.0){if(cM==false){cM=true;for(int i=0;i<oM.length;i++ ){var g=oM[i];switch (g.name){case 'x':g.wB=iM.x;break;case 'y':g.wB=iM.y;break;case 'pivotX':g.wB=iM.UC;break;case 'pivotY':g.wB=iM.VC;break;case 'scaleX':g.wB=iM.vB;break;case 'scaleY':g.wB=iM.EC;break;case 'rotation':g.wB=iM.YB;break;case 'alpha':g.wB=iM.alpha;break;}}if(PM!=null)PM();}var j=QK/jK;var k=KM(j);for(int i=0;i<oM.length;i++ ){var g=oM[i];var h=g.wB+k*(g.LE-g.wB);h=bM?h.round():h;switch (g.name){case 'x':iM.x=h;break;case 'y':iM.y=h;break;case 'pivotX':iM.UC=h;break;case 'pivotY':iM.VC=h;break;case 'scaleX':iM.vB=h;break;case 'scaleY':iM.EC=h;break;case 'rotation':iM.YB=h;break;case 'alpha':iM.alpha=h;break;}}if(TM!=null)TM();if(VM!=null&&QK==jK)VM();}}return QK<jK;} get totalTime=>jK; get currentTime=>QK; get isComplete=>QK>=jK;set RC( g){if(cM==false)QK=QK+ZM-g;ZM=g;} set SF( g()){PM=g;} set JC( g()){TM=g;} set onComplete( g()){VM=g;}}class pC extends mC{var hM;var PK;var sM;var uM;var yM;var AN;var DN;var HN;var JN;var LN;var MN;var NN;var ON;var RN;var SN;pC( h, g){IK=h;hM=g;hM.focus();PK=g.context2d;uM=new BC.DI(PK);yM=iC.qD;AN=qB.uD;oD.VG.addEventListener("mouseCursorChanged",YN);JN=[new XE(t.ND,t.zD,t.XC,t.RG),new XE(t.jG,t.lG,t.uE,t.uE),new XE(t.mG,t.nG,t.vE,t.vE)];HN=null;DN=new NB(0,0);MN=new t(t.XC,true);RN=CM;hM.on..mouseDown.add(RN)..mouseUp.add(RN)..mouseMove.add(RN)..mouseOut.add(RN)..mouseWheel.add(RN);LN=new Map<int,tE>();ON=new AC(AC.iE,true);SN=bN;nE.VG.addEventListener("inputModeChanged",cN);cN(null);NN=new lC(lC.tD,true);hM.on.keyDown.add(eN);hM.on.keyUp.add(eN);hM.on.keyPress.add(fN);} get focus=>sM; set UH( g){yM=g;} gN(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){gN();} set y( g){gN();} set UC( g){gN();} set VC( g){gN();} set vB( g){gN();} set EC( g){gN();} set YB( g){gN();} set alpha( g){gN();} set width( g){gN();} set height( g){gN();} LH(){if(yM==iC.qD||yM==iC.wD){uM.reset();oB(uM);if(yM==iC.wD)yM=iC.NG;}} YN( g){hM.style.cursor=oD.xE(AN);} CM( j){j.preventDefault();var IB=hM.getBoundingClientRect();var o=new Date.now().millisecondsSinceEpoch;var v=j.button;var h=null;var i=new NB(j.clientX-IB.left,j.clientY-IB.top);var m=null;if(v<0||v>2)return;if(j.type=="mousemove"&&DN.equals(i))return;var g=JN[v];DN=i;if(j.type!="mouseout")h=TC(i.x,i.y) as lB;var k=qB.uD;if(h is AB)if(h.OE)k=qB.vD;if(h is uC)if(h.OE)k=qB.vD;if(AN!=k){AN=k;hM.style.cursor=oD.xE(k);}if(HN!=null&&HN!=h){HN.KB(MN..fM(t.PD,true)..WN=(HN.ZD!=null)?HN.rC(i):new NB.BI()..XN=i..PN=g.PC);HN=null;}if(h!=null&&h!=HN){h.KB(MN..fM(t.sE,true)..WN=h.rC(i)..XN=i..PN=g.PC);HN=h;}var l=null;var s=false;var EB=false;if(j.type=="mousedown"){l=g.PF;if(h!=g.target||o>g.EE+500)g.AD=0;g.PC=true;g.target=h;g.EE=o;g.AD++ ;}if(j.type=="mouseup"){l=g.QF;g.PC=false;s=(g.target==h);EB=s&&g.AD.isEven&&(o<g.EE+500);}if(j.type=="mousemove"){l=t.rE;}if(l!=null&&h!=null){m=h.rC(i);h.KB(MN..fM(l,true)..WN=m..XN=i..PN=g.PC..TN=g.AD);if(s){if(EB&&h.wG){h.KB(MN..fM(g.OF,true)..WN=m..XN=i..PN=g.PC);}else{h.KB(MN..fM(g.NF,true)..WN=m..XN=i..PN=g.PC);}}}} cN( g){hM.on..touchStart.remove(SN)..touchEnd.remove(SN)..touchMove.remove(SN)..touchEnter.remove(SN)..touchLeave.remove(SN)..touchCancel.remove(SN);if(nE.pG==dE.WG){hM.on..touchStart.add(SN)..touchEnd.add(SN)..touchMove.add(SN)..touchEnter.add(SN)..touchLeave.add(SN)..touchCancel.add(SN);}} bN( j){j.preventDefault();var o=hM.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var h=null;var i=new NB(m.clientX-o.left,m.clientY-o.top);var s=null;h=TC(i.x,i.y) as lB;var g=LN.containsKey(l)?LN[l]:new tE(h,LN.length==0);if(g.target!=null&&g.target!=h){g.target.KB(ON..fM(AC.dG,true)..WN=(g.target.ZD!=null)?g.target.rC(i):new NB.BI()..XN=i..jM=g.aD..lM=g.YD);g.target=null;}if(h!=null&&h!=g.target){h.KB(ON..fM(AC.cG,true)..WN=h.rC(i)..XN=i..jM=g.aD..lM=g.YD);g.target=h;}var k=null;if(j.type=="touchstart"){LN[l]=g;k=AC.iE;}if(j.type=="touchend"){LN.remove(l);k=AC.kE;}if(j.type=="touchcancel"){LN.remove(l);k=AC.mE;}if(j.type=="touchmove"){k=AC.qE;}if(k!=null&&h!=null){h.KB(ON..fM(k,true)..WN=h.rC(i)..XN=i..jM=g.aD..lM=g.YD);}}} eN( g){g.preventDefault();var h=null;if(g.type=="keyup")h=lC.jE;if(g.type=="keydown")h=lC.tD;NN..fM(h,true)..wL=g.altKey..yL=g.ctrlKey..BM=g.shiftKey..QM=g.charCode..UM=g.keyCode..WM=jC.EG;if(g.keyLocation==cC.KeyLocation.LEFT)NN.WM=jC.JG;if(g.keyLocation==cC.KeyLocation.RIGHT)NN.WM=jC.SG;if(g.keyLocation==cC.KeyLocation.NUMPAD)NN.WM=jC.XG;if(g.keyLocation==cC.KeyLocation.JOYSTICK)NN.WM=jC.oE;if(g.keyLocation==cC.KeyLocation.MOBILE)NN.WM=jC.oE;if(sM!=null)sM.KB(NN);} fN( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new WE(WE.PG,true);h.VK=new String.fromCharCodes([i]);if(sM!=null)sM.KB(h);}} CE( g, m, EB, j){var bC=0.0;var pB=0.0;var v=m*g.a;var gB=m*g.b;var IB=m*g.a+EB*g.c;var s=m*g.b+EB*g.d;var RB=EB*g.c;var o=EB*g.d;var h=bC;if(h>v)h=v;if(h>IB)h=IB;if(h>RB)h=RB;var i=pB;if(i>gB)i=gB;if(i>s)i=s;if(i>o)i=o;var l=bC;if(l<v)l=v;if(l<IB)l=IB;if(l<RB)l=RB;var k=pB;if(k<gB)k=gB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new PB.BI();j.x=g.GC+h;j.y=g.HC+i;j.width=l-h;j.height=k-i;return j;}
//@ sourceMappingURL=escape.dart.map