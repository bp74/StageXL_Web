import "dart:html" as lC;import "dart:async" as aB;import "dart:json" as LJ;import "dart:web_audio" as wE;import "dart:math" as WB;class MJ{static const  NJ="Chrome";static const  OJ="Firefox";static const  PJ="Internet Explorer";static const  QJ="Safari";final  WI;final  minimumVersion;const MJ(this.WI,[this.minimumVersion]);}class RJ{const RJ();}class SJ{final  name;const SJ(this.name);}class TJ{const TJ();}class UJ{const UJ();}class dB extends BB{static const  zE="Explosion";static const  XD="Unlocked";static const  AF="Finalized";static const  JE="Timeouted";var rK;dB( h, g,[ i=false]):super(h,i){rK=g;} get info{return rK;}}class VD extends EB{var BK;var FK;var JK;var GK;var aK;var gK;VD( h, i, g){BK=h;FK=i;JK=g;aK=tB.sG(BK,g);gK=true;GK=new JB(aK[0]);GK.x=-34;GK.y=-50;q(GK);} get UD=>gK; set UD( g){gK=g;} VG( g){GK.GC=aK[g?0:4];} DJ(){var i=new XC(0.0,1.0,2.0,QB.FC);i.QC=(j){lB=rB=1.0+0.2*WB.sin(j*4*WB.PI);};var g=new fB(this,0.2,QB.FC);g.gB.alpha.cB(0.0);g.bC=2.0;g.onComplete=()=>VG(gK);var h=new fB(this,0.2,QB.wF);h.gB.alpha.cB(1);h.bC=2.2;FK.add(i);FK.add(g);FK.add(h);}}class nG extends EB{var BK;var FK;var RK;var XK;var fK;nG( g, h){BK=g;FK=h;RK=tB.tG(BK);XK=new JB(RK[0]);XK.x=-XK.width/2;XK.y=-XK.height/2;q(XK);fK=null;} PG( g){FK.remove(fK);fK=new XC(0,g,0.5*g,QB.YC);fK.QC=(h){var i=((h*RK.length)%RK.length).toInt();XK.GC=RK[i];XK.y=WB.sin(h*2*WB.PI)*3-XK.height/2;};FK.add(fK);} qI(){FK.remove(fK);XK.GC=RK[0];}}class tB{static  GE( j, i, h){var g=new JB(j.cC("Elements").AB("Chain${i}${h}"));g.RC=25;g.SC=25;return g;}static  oG( j, i, h){var g=new JB(j.cC("Elements").AB("Link${i}${h}"));g.RC=25;g.SC=25;return g;}static  KE( i, h){var g=new JB(i.cC("Elements").AB(h));g.RC=25;g.SC=25;return g;}static  pG( o, n){var m=new EB();var l=0;var s=o.cC("Levelup");for(int k=0;k<7;k++ ){var g=new JB(s.AB("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new EB();h.q(g);h.x=l+g.width/2;h.lB=0;h.rB=0;m.q(h);var i=new fB(h,2.0,QB.SI);i.gB.lB.cB(1.0);i.gB.rB.cB(1.0);i.bC=k*0.05;var j=new fB(h,0.4,QB.YC);j.gB.lB.cB(0.0);j.gB.rB.cB(0.0);j.bC=3.0;n.add(i);n.add(j);l=l+5+g.width;}return m;}static  qG( j, h){var i=j.cC("Elements");var g=new List<DB>();g.add(i.AB("JokerChain${h}0"));g.add(i.AB("JokerChain${h}1"));g.add(i.AB("JokerChain${h}2"));g.add(i.AB("JokerChain${h}3"));g.add(i.AB("JokerChain${h}4"));return g;}static  rG( j, h){var i=j.cC("Elements");var g=new List<DB>();g.add(i.AB("JokerLink${h}0"));g.add(i.AB("JokerLink${h}1"));g.add(i.AB("JokerLink${h}2"));g.add(i.AB("JokerLink${h}3"));g.add(i.AB("JokerLink${h}4"));return g;}static  sG( j, h){var i=j.cC("Locks");var g=new List<DB>();g.add(i.AB("Lock${h}0"));g.add(i.AB("Lock${h}1"));g.add(i.AB("Lock${h}2"));g.add(i.AB("Lock${h}3"));g.add(i.AB("Lock${h}4"));return g;}static  tG( i){var h=i.cC("Head");var g=new List<DB>();g.add(h.AB("Head1"));g.add(h.AB("Head2"));g.add(h.AB("Head3"));g.add(h.AB("Head2"));g.add(h.AB("Head1"));return g;}static  uG( i){var h=i.cC("Alarm");var g=new List<DB>();g.add(h.AB("Alarm0"));g.add(h.AB("Alarm1"));g.add(h.AB("Alarm2"));g.add(h.AB("Alarm3"));g.add(h.AB("Alarm4"));g.add(h.AB("Alarm5"));return g;}}class VJ extends EB{var BK;var FK;var MK;var UK;var cK;var iK;var DK;var oK;var qK;var tK;var vK;var CK;var yK;var zK;var AL;var BL;var DL;var EL;var FL;var HL;var IL;VJ( k, l){BK=k;FK=l;var j=new JB(BK.AB("ShuffleButtonNormal"));var i=new JB(BK.AB("ShuffleButtonPressed"));UK=new yC(j,j,i,i);UK.OB(t.fC,bL);UK.x=530;UK.y=525;q(UK);var h=new JB(BK.AB("ExitButtonNormal"));var g=new JB(BK.AB("ExitButtonPressed"));cK=new yC(h,h,g,g);cK.OB(t.fC,dL);cK.x=700;cK.y=500;q(cK);MK=new kG(BK,FK);MK.x=540;MK.y=-1000;q(MK);DK=new UE(10,BK.AB("TimeGauge"),bD.XE);DK.x=659;DK.y=244;DK.OB("TimeShort",fL);DK.OB("TimeOver",YL);q(DK);FK.add(DK);oK=new nG(BK,FK);oK.x=640;oK.y=230;q(oK);qK=new lG(BK,FK);qK.x=665;qK.y=160;q(qK);tK=new LC();tK.OC=new aD("Arial",30,0xD0D0D0,bold:true,align:DC.WC);tK.width=140;tK.height=36;tK.wordWrap=false;tK.x=646;tK.y=130;tK.VB=false;tK.text="0";tK.lB=0.9;q(tK);vK=new LC();vK.OC=new aD("Arial",20,0xFFFFFF,bold:true,align:DC.WC);vK.width=44;vK.height=30;vK.wordWrap=false;vK.x=610;vK.y=559;vK.VB=false;vK.text="3x";q(vK);DL=new EB();q(DL);EL=new EB();q(EL);FL=new EB();q(FL);HL=BK.pB("Intro");IL=HL.play();} start(){CK=1;yK=1;BL=0;zK=3;var g=new FE(BK,FK,BK.ED("ESCStartText"));EL.q(g);FK.kB(()=>oK.PG(21),1);g.show(()=>FK.kB(()=>kL(),0.5));} kL(){if(iK!=null&&this.contains(iK))DL.HC(iK);var m=CK;var g=0;var h=0;switch (CK){case 01:h=50;iK=new mG(BK,FK,g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;iK=new mG(BK,FK,g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;iK=new mG(BK,FK,g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;iK=new mG(BK,FK,g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;iK=new mG(BK,FK,g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;iK=new mG(BK,FK,g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;iK=new mG(BK,FK,g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;iK=new mG(BK,FK,g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;iK=new mG(BK,FK,g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;iK=new mG(BK,FK,g=80+(CK-10)*5,5,5,6,3,2,[0,1,2,3]);break;}AL=g;if(zK<3){zK++ ;vK.text="${zK}x";}iK.OB(dB.zE,lL);iK.OB(dB.XD,mL);iK.OB(dB.AF,nL);iK.OB(dB.JE,oL);iK.x=20;iK.y=16;iK.VB=false;DL.q(iK);DK.reset(h);DK.qD("TimeShort",9);DK.qD("TimeOver",0);DK.pause();MK.lI=m;MK.zF=g;MK.y=-210;var k=new fB(MK,0.4,QB.FC);k.gB.y.cB(-90);FK.add(k);var j=new FE(BK,FK,BK.ED("ESCLevelBoxText").replaceAll("{0}","${g}"));EL.q(j);j.show((){iK.VB=true;DK.start();if(HL!=null){var i=new XC(1.0,0.0,4.0,QB.YC);i.QC=(l){IL.MC.volume=l;IL.MC=IL.MC;};i.onComplete=(){IL.stop();oK.qI();};FK.add(i);HL=null;}});} fL( g){qK.start();} YL( g){iK.aG(IC.IE);} mL( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new yE(BK,FK,g);i.x=k.x;i.y=k.y;DL.q(i);BL=BL+g;tK.text="${BL}";} lL( j){var g=AL;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;AL=g;MK.zF=g;if(g==0)iK.aG(IC.HE);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}BL=BL+h*k;tK.text="${BL}";} nL( m){DK.pause();qK.stop();var l=BK.pB("Laugh");var k=BK.pB("LevelUp");l.play();oK.PG(3);var g=tB.pG(BK,FK);g.x=55;g.y=260;DL.q(g);FK.kB((){iK.FG();k.play();},2.0);FK.kB((){var j=(DK.BJ*1000).toInt();var h=new yE(BK,FK,j);h.x=704;h.y=360;DL.q(h);BL=BL+j;tK.text="${BL}";},2.5);var i=new fB(MK,0.5,QB.FC);i.gB.y.cB(-210);i.bC=3.0;FK.add(i);FK.kB((){DL.HC(g);},3.5);FK.kB((){CK++ ;kL();},4.0);} oL( i){qK.stop();iK.FG();var g;if(yK>0){yK-- ;g=new FE(BK,FK,BK.ED("GEN2ndchancetime"));EL.q(g);BK.pB("LevelUp").play();g.show((){FK.kB(()=>kL(),0.5);var h=new fB(MK,0.5,QB.FC);h.gB.y.cB(-210);FK.add(h);});}else{g=new FE(BK,FK,BK.ED("GENtimeup"));EL.q(g);BK.pB("GameOver").play();g.show((){FK.kB(()=>sL(),0.5);var h=new fB(MK,0.5,QB.FC);h.gB.y.cB(-210);FK.add(h);});}} bL( h){if(iK!=null&&zK>0){var g=iK.WG();if(g){zK=zK-1;vK.text="${zK}x";}}} dL( j){var h=new EB();h.q(new JB(new DB(800,600,false,0x000000)));h.alpha=0.6;FL.q(h);var g=new jG(BK,FK);g.x=235;g.y=150;FL.q(g);g.show(( i){FL.HC(g);if(i==false)FL.HC(h);else uL(false);});}sL(){var h=new EB();var j=new JB(BK.AB("ExitBox"));h.q(j);var g=new LC();g.OC=new aD("Arial",30,0xFFFFFF,bold:true,align:DC.WC);g.width=240;g.height=200;g.wordWrap=true;g.text=BK.ED("GENgameover");g.x=47;g.y=30+(g.height-g.rE)/2;g.VB=false;h.q(g);h.x=110;h.y=-h.height;EL.q(h);FK.kB(()=>BK.pB("Laugh").play(),0.3);var i=new fB(h,0.3,QB.FC);i.gB.y.cB(150);FK.add(i);FK.kB(()=>uL(true),5.0);h.OB(t.fC,( k)=>uL(true));}var vL=false; uL( g){DK.pause();if(vL==false){vL=true;}}}class NB{var BK;var FK;var JK;var LK;var TK;var YK;var bK;var dK;var hK;var lK;var pK;var uK;var wK;NB( i, j, h, g){BK=i;FK=j;JK=h;LK=g;TK=CB.WD;YK=-1000;bK=-1000;dK=false;hK=false;lK=false;pK=null;uK=null;wK=null;} get color=>JK; set color( g){JK=g;} get direction=>LK; set direction( g){LK=g;} get KB=>TK; set KB( g){TK=g;} get hB=>dK; set hB( g){dK=g;} get PC=>hK; set PC( g){hK=g;} get empty=>lK; set empty( g){lK=g;} vD( g){var h=g!=null&&(g.color==JK||g.KB==CB.SB||TK==CB.SB)&&g.KB!=CB.JC&&TK!=CB.JC;return h;} hC( g){var h=g!=null&&(g.color==JK||g.KB==CB.SB||TK==CB.SB)&&g.direction==0&&LK==0&&g.KB!=CB.JC&&TK!=CB.JC;return h;} tC( g){var h=g!=null&&(g.color==JK||g.KB==CB.SB||TK==CB.SB)&&g.direction==1&&LK==1&&g.KB!=CB.JC&&TK!=CB.JC;return h;} get x=>YK; set x( g){YK=g;if(pK!=null)pK.x=g;if(uK!=null)uK.x=g;if(wK!=null)wK.x=g;} get y=>bK; set y( g){bK=g;if(pK!=null)pK.y=g;if(uK!=null)uK.y=g;if(wK!=null)wK.y=g;} set XG( g){if(pK!=null){pK.lB=pK.rB=1+0.3*WB.sin(g*WB.PI);}} sB( g, h, i){if(pK!=null){pK.parent.HC(pK);pK=null;}if(uK!=null){uK.parent.HC(uK);uK=null;}if(wK!=null){wK.parent.HC(wK);wK=null;}if(empty==false){switch (TK){case CB.SB:pK=new WJ(BK,FK,LK);pK.x=YK;pK.y=bK;g.q(pK);break;case CB.JC:pK=tB.KE(BK,CB.JC);pK.x=YK;pK.y=bK;g.q(pK);break;default:pK=tB.GE(BK,JK,LK);pK.x=YK;pK.y=bK;g.q(pK);break;}if(dK){uK=hK?new XJ(BK,FK,LK):tB.oG(BK,JK,LK);uK.x=YK+((LK==0)?25:0);uK.y=bK+((LK==1)?25:0);h.q(uK);}switch (TK){case CB.WD:break;case CB.JC:break;case CB.SB:break;default:wK=new YJ(BK,FK,TK);wK.x=YK;wK.y=bK;i.q(wK);break;}}}}class CB{static const  WD="None";static const  SB="Joker";static const  JC="Block";static const  BF="Double";static const  CF="Quint";}class YJ extends EB implements mB{var GK;var KK;YJ( j, g, i){this.VB=false;KK=0.0;GK=tB.KE(j,i);q(GK);OB(BB.CD,(h)=>g.add(this));OB(BB.PD,(h)=>g.remove(this));} AC( g){KK+= g;this.TB=WB.sin(KK*7)*10*WB.PI/180;return true;}}class XJ extends EB implements mB{var GK;var OK;var KK;XJ( j, g, h){this.VB=false;KK=0.0;OK=tB.rG(j,h);GK=new JB(OK[0]);GK.x=-25;GK.y=-25;q(GK);OB(BB.CD,(i)=>g.add(this));OB(BB.PD,(i)=>g.remove(this));} AC( g){KK+= g;var h=(KK*10).toInt()%OK.length;GK.GC=OK[h];return true;}}class GD{var value=0; wD([ g=1])=>(value+= g); EG([ g=1])=>(value-= g);}class xE{var yF;var YG;var ZG;var angle;var bG;var TB;}class jG extends EB{var DK;var HK;var NK;var WK;jG( h, i){var o=new JB(h.AB("ExitBox"));q(o);var g=new LC();g.OC=new aD("Arial",24,0xFFFFFF,bold:true,align:DC.WC);g.width=240;g.height=100;g.wordWrap=true;g.text=h.ED("GENexitquery");g.x=47;g.y=150-g.rE/2;g.VB=false;q(g);DK=new UE(7,h.AB("ExitGauge"),bD.aE);DK.x=268;DK.y=25;DK.OB("TimeOver",YL);q(DK);DK.qD("TimeOver",0);DK.start();var k=new JB(h.AB("ExitYesButtonNormal"));var l=new JB(h.AB("ExitYesButtonPressed"));HK=new yC(k,k,l,l);HK.x=68;HK.y=239;HK.OB(t.fC,eL);q(HK);var j=new JB(h.AB("ExitNoButtonNormal"));var m=new JB(h.AB("ExitNoButtonPressed"));NK=new yC(j,j,m,m);NK.x=173;NK.y=232;NK.OB(t.fC,gL);q(NK);this.OB(BB.CD,(n)=>i.add(DK));this.OB(BB.PD,(n)=>i.remove(DK));} hL( g){if(WK!=null){WK(g);WK=null;}} eL( g){hL(true);} gL( g){hL(false);} YL( g){hL(false);}show( g){WK=g;}}class yE extends EB{yE( m, k, l){var g=new LC();g.OC=new aD("Arial",30,0xFFFFFF,bold:true,align:DC.WC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.VB=false;g.text=l.toString();g.x=-g.width/2;g.y=-g.height/2;var h=new EB();h.q(g);q(h);var j=new XC(0.0,1.0,1.5,QB.FC);j.QC=(i){h.alpha=1-i;h.y=-i*50;h.lB=1.0+0.1*WB.sin(i*10);h.rB=1.0+0.1*WB.cos(i*10);};j.onComplete=(){this.pE();};k.add(j);}}class kG extends EB{var CK;var EK;var IK;var PK;var VK;kG( h, i){q(new JB(h.AB("InfoBox")));EK=new LC();EK.OC=new aD("Arial",35,0xFFFFFF,bold:true,align:DC.WC);EK.width=220;EK.height=40;EK.wordWrap=false;EK.text="Level 1";EK.x=20;EK.y=115;EK.TB=-2*WB.PI/180;q(EK);PK=new LC();PK.OC=new aD("Arial",25,0xFFFFFF,bold:true,align:DC.WC);PK.width=220;PK.height=30;PK.wordWrap=false;PK.text="40";PK.x=-PK.width/2;PK.y=-PK.height/2;PK.TB=-2*WB.PI/180;VK=new EB();VK.q(PK);VK.x=150;VK.y=172;q(VK);var g=tB.GE(h,3,0);g.x=110;g.y=171;g.TB=-2*WB.PI/180;g.lB=g.rB=0.6;q(g);} set lI( g){CK=g;EK.text="Level ${CK}";} set zF( g){IK=g;PK.text="${IK}";}}class WJ extends EB implements mB{var GK;var OK;var KK;WJ( j, g, h){this.VB=false;KK=0.0;OK=tB.qG(j,h);GK=new JB(OK[0]);GK.x=-25;GK.y=-25;q(GK);OB(BB.CD,(i)=>g.add(this));OB(BB.PD,(i)=>g.remove(this));} AC( g){KK+= g;var h=(KK*10).toInt()%OK.length;GK.GC=OK[h];return true;}}class FE extends EB{var BK;var FK;var QK;var WK;FE( i, j, h){BK=i;FK=j;var k=new JB(BK.AB("MessageBox"));q(k);var g=new LC();g.OC=new aD("Arial",24,0xFFFFFF,bold:true,align:DC.WC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.rE/2;g.VB=false;q(g);QK=null;OB(t.fC,TL);}void show( h){this.parent.q(this);this.x=-this.width;this.y=150;WK=h;var g=new fB(this,0.3,QB.FC);g.gB.x.cB(110);g.onComplete=()=>QK=FK.kB(cL,10);FK.add(g);} cL(){if(QK!=null){FK.remove(QK);QK=null;WK();var g=new fB(this,0.4,QB.wF);g.gB.x.cB(800);g.onComplete=()=>this.parent.HC(this);FK.add(g);}} TL( g){cL();}}class IC{static const  HD=1;static const  HE=2;static const  IE=3;}class lG extends EB{var BK;var FK;var SK;var ZK;var eK;var kK;var nK;lG( g, h){BK=g;FK=h;SK=tB.uG(BK);ZK=new JB(SK[0]);eK=BK.pB("Warning");kK=null;q(ZK);} start(){kK=eK.play();FK.remove(nK);nK=new XC(0,80,9.0,QB.YC);nK.QC=(h){var g=h.toInt()%8;ZK.GC=SK[(g<=4)?g+1:8-g];};FK.add(nK);} stop(){if(kK!=null){kK.stop();kK=null;}FK.remove(nK);ZK.GC=SK[0];}}class mG extends EB{var jK;var sK;var xK;var CL;var GL;var JL;var KL;var BK;var FK;var ML;var NL;var OL;var PL;var QL;var RL;var SL;var UL;var VL;var WL;var XL;var ZL;var aL;mG( ZB, n, v, s, RB, m, o, GB, k){BK=ZB;FK=n;ML=new WB.Random();NL=IC.HD;OL=k;jK=v;sK=s;xK=RB;CL=m;GL=o;JL=GB;KL=k.length;SL=new List<LB>();VL=new EB();WL=new EB();XL=new EB();ZL=new EB();aL=new EB();q(VL);q(WL);q(XL);q(ZL);q(aL);WL.VB=false;XL.VB=false;ZL.VB=false;aL.VB=false;iI();jI();hI();UL=true;var l=new GD();this.mask=new ME.vJ(0.0,0.0,500.0,500.0);for(int i=0;i<10;i++ ){for(int g=0;g<10;g++ ){var h=QL[i+g*10];h.x=i*50+25;h.y=g*50+25-550;h.sB(VL,WL,XL);var j=new XC(h.y,g*50+25,0.4,QB.FC);j.bC=i*0.03;j.QC=(UB){h.y=UB;};j.onComplete=(){if(l.wD()==100){iL();UL=false;SL.clear();this.mask=null;}};FK.add(j);}}OB(t.hD,jL);} aG( g){if(g==IC.HE){NL=g;}if(g==IC.IE&&NL==IC.HD){NL=g;if(UL==false)dispatchEvent(new dB(dB.JE,null));}} FG(){this.mask=new ME.vJ(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=QL[i+h*10];g.hB=false;g.PC=false;g.KB=CB.WD;g.sB(VL,WL,XL);var j=new XC(g.y,500+h*50+25,0.5,QB.FC);j.bC=i*0.1;j.QC=(k){g.y=k;};FK.add(j);}}} iI(){RL=new List<VD>();for(int h=0;h<sK;h++ ){var g=new VD(BK,FK,h);g.TB=(ML.nextInt(30)-15)*WB.PI/180;g.x=300-(90*sK)/2+h*90+ML.nextInt(20)-10;g.y=550;RL.add(g);ZL.q(g);}} DG( g, h){var i=0;var j=QL[g+h*10];if(j.direction==0){var l=(g>0)?QL[g-1+h*10]:null;var m=(g<9)?QL[g+1+h*10]:null;if(j.hC(l))i++ ;if(j.hC(m))i++ ;}else{var k=(h>0)?QL[g+(h-1)*10]:null;var n=(h<9)?QL[g+(h+1)*10]:null;if(j.tC(k))i++ ;if(j.tC(n))i++ ;}return i;} BG(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=QL[g+h*10];var i=KL*2;while (DG(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<OL.length;j++ )if(k.color==OL[j])m=j;k.color=OL[(m+1)%OL.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){l=l||(DG(g,h)==2);}}return l;} RG(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(QL[(h-1)+g*10].vD(QL[h+g*10])&&QL[h+g*10].vD(QL[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(QL[h+(g-1)*10].vD(QL[h+g*10])&&QL[h+g*10].vD(QL[h+(g+1)*10]))return true;return false;} pL( j, l, k){for(int g=0;g<20;g++ ){var h=jK~/k;var i=l*h+ML.nextInt(h);if(PL[i].KB==CB.WD){PL[i].KB=j;return;}}} jI(){PL=new List<NB>();for(int g=0;g<jK;g++ ){var i=OL[ML.nextInt(OL.length)];var h=ML.nextInt(2);PL.add(new NB(BK,FK,i,h));}for(int g=0;g<sK*2;g++ )pL("Lock${(g%sK)+1}",g,sK*2);for(int g=0;g<xK;g++ )pL(CB.SB,g,xK);for(int g=0;g<CL;g++ )pL(CB.JC,g,CL);for(int g=0;g<GL;g++ )pL(CB.BF,g,GL);for(int g=0;g<JL;g++ )pL(CB.CF,g,JL);} hI(){QL=new List<NB>();var g=true;while (g){QL.clear();for(int h=0;h<100;h++ ){var j=OL[ML.nextInt(OL.length)];var i=ML.nextInt(2);QL.add(new NB(BK,FK,j,i));}g=BG();}} WG(){if(UL||NL!=IC.HD)return false;var l=true;UL=true;while (l){for(int k=0;k<QL.length;k++ ){var g=QL[k];g.hB=false;g.PC=false;g.sB(VL,WL,XL);g.color=OL[ML.nextInt(OL.length)];g.direction=ML.nextInt(2);}l=BG()||(RG()==false);}BK.pB("BonusUniversal").play();var m=new GD();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=QL[i+j*10];g.XG=0.0;var h=new XC(0.0,1.0,0.2,QB.YC);h.bC=i*0.06;h.QC=(n){g.XG=n;};h.onStart=(){g.sB(VL,WL,XL);};h.onComplete=(){if(m.wD()==100){iL();qL();SL.clear();}};FK.add(h);}}return true;} iL(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=QL[h+i*10];var l=(h<9)?QL[h+1+i*10]:null;var m=(i<9)?QL[h+(i+1)*10]:null;var j=false;var k=false;if(g.hC(l)){j=true;k=(g.KB==CB.SB||l.KB==CB.SB);}if(g.tC(m)){j=true;k=(g.KB==CB.SB||m.KB==CB.SB);}if(g.hB!=j||g.PC!=k){g.hB=j;g.PC=k;g.sB(VL,WL,XL);}}}} rL( s, l, n, k, m, o){UL=true;s.wD(k);var i=1;for(int g=0;g<k;g++ ){var h=QL[l+g*m+(n+g*o)*10];if(h.KB==CB.BF)i=i*2;if(h.KB==CB.CF)i=i*5;var v=l+g*m;var GB=n+g*o;FK.kB((){h.empty=true;h.sB(VL,WL,XL);BK.pB("ChainBlast").play();var j=new zE(BK,FK,h.color,h.direction);j.x=v*50;j.y=GB*50;FK.add(j);aL.q(j);yI(h);if(s.EG()==0)tL();},0.1+g*0.1);}dispatchEvent(new dB(dB.zE,{"Length":k,"Factor":i}));} qL(){UL=false;var j=new GD();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&QL[i+g-1+h*10].hC(QL[i+g+h*10]))g++ ;if(g>=3)rL(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&QL[i+(h+g-1)*10].tC(QL[i+(h+g)*10]))g++ ;if(g>=3)rL(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(NL==IC.HE)dispatchEvent(new dB(dB.AF,null));if(NL==IC.IE)dispatchEvent(new dB(dB.JE,null));if(NL==IC.HD&&RG()==false)WG();}} yI( h){if(h.KB.indexOf("Lock")==0){var k=int.parse(h.KB.substring(4,5))-1;var j=RL[k];var g=tB.KE(BK,h.KB);g.x=h.x;g.y=h.y;q(g);var i=new fB(g,0.5,QB.FC);i.gB.x.cB(j.x);i.gB.y.cB(j.y-10);i.onComplete=()=>HC(g);FK.add(i);FK.kB(()=>tI(k),0.5);}} tI( k){var h=RL[k];var i;if(h.UD){i=new dB(dB.XD,{"Type":"SingleLocked","Position":new LB(h.x+20,h.y)});BK.pB("Unlock").play();}else{i=new dB(dB.XD,{"Type":"SingleUnlocked","Position":new LB(h.x+20,h.y)});}dispatchEvent(i);h.UD=false;h.VG(false);var j=true;for(int g=0;g<RL.length;g++ ){j=j&&(RL[g].UD==false);}if(j){BK.pB("BonusAllUnlock").play();for(int g=0;g<RL.length;g++ ){RL[g].UD=true;FK.kB(()=>RL[(g+k)%RL.length].DJ(),g*0.2);}FK.kB(()=>dispatchEvent(new dB(dB.XD,{"Type":"All","Position":new LB(280,550)})),0.75);}} tL(){var n=new GD();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&QL[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&QL[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=QL[i+j*10];if(i>0){l=QL[i-1+j*10];if(h.hC(l)){l.hB=false;l.sB(VL,WL,XL);}}h.hB=false;h.empty=true;h.sB(VL,WL,XL);}else{if(PL.length>0){h=PL.removeAt(0);}else{var v=OL[ML.nextInt(OL.length)];var s=ML.nextInt(2);h=new NB(BK,FK,v,s);}}g=QL[i+k*10];g.color=h.color;g.direction=h.direction;g.KB=h.KB;g.hB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.sB(VL,WL,XL);n.wD();var m=new XC(g.y,50*k+25,0.1,QB.YC);m.QC=(o){g.y=o;};m.onComplete=(){if(n.EG()==0){iL();qL();wL();}};FK.add(m);}}}} jL( g){if(g.target==VL&&this.VB){var j=WB.min(g.mE/50,9).toInt();var h=WB.min(g.nE/50,9).toInt();var i=new LB(j,h);SL.add(i);wL();}} wL(){while (NL==IC.HD&&UL==false&&SL.length>0){var m=SL.removeAt(0);var j=m.x.toInt();var k=m.y.toInt();var g=QL[j+k*10];var i=(j>0)?QL[j-1+k*10]:null;var n=(j<9)?QL[j+1+k*10]:null;var h=(k>0)?QL[j+(k-1)*10]:null;var o=(k<9)?QL[j+(k+1)*10]:null;var l=false;if(g.KB==CB.JC){BK.pB("ChainError").play();continue;}if(g.tC(h)){h.hB=false;h.sB(VL,WL,XL);}if(g.hC(i)){i.hB=false;i.sB(VL,WL,XL);}g.direction=1-g.direction;g.hB=false;g.PC=false;BK.pB("ChainRotate").play();if(g.hC(n)){g.hB=true;g.PC=(g.KB==CB.SB||n.KB==CB.SB);}if(g.tC(o)){g.hB=true;g.PC=(g.KB==CB.SB||o.KB==CB.SB);}g.sB(VL,WL,XL);l=l||g.hB;if(g.tC(h)){h.hB=true;h.PC=(g.KB==CB.SB||h.KB==CB.SB);h.sB(VL,WL,XL);l=true;}if(g.hC(i)){i.hB=true;i.PC=(g.KB==CB.SB||i.KB==CB.SB);i.sB(VL,WL,XL);l=true;}if(l){BK.pB("ChainLink").play();}qL();}}}class zE extends EB implements mB{var mK;var KK;zE( s, RB, o, n){mK=new List<xE>();KK=0.0;this.VB=false;var v=tB.GE(s,o,n);var m=new WB.Random();var j;var l;var GB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){j=WB.PI*1.15;TB=-WB.PI*2;}if(g==1&&h==0){j=WB.PI*1.85;TB=WB.PI*2;}if(g==1&&h==1){j=WB.PI*0.15;TB=WB.PI*2;}if(g==0&&h==1){j=WB.PI*0.85;TB=-WB.PI*2;}j=j+0.2*WB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var k=new JB(v.GC);k.ZI=new IB(g*25,h*25,25,25);k.RC=12.5+g*25;k.SC=12.5+h*25;k.x=g*25;k.y=h*25;q(k);var i=new xE();i.yF=k;i.YG=g*25+12.5;i.ZG=h*25+12.5;i.angle=j;i.bG=l;i.TB=TB;mK.add(i);}}} AC( l){KK=WB.min(0.8,KK+l);var o=981.0;for(var g in mK){var h=g.yF;var i=g.angle;var j=g.bG;var k=g.TB;var m=g.YG+KK*(WB.cos(i)*j);var n=g.ZG+KK*(WB.sin(i)*j+KK*o*0.5);h.x=m;h.y=n;h.TB=KK*k;}if(KK>=0.6){this.alpha=(0.8-KK)/0.2;}if(KK>=0.8){this.pE();}return (KK<0.8);}}class ZJ extends EB{var BK;var FK;ZJ( g){BK=g;this.rI.listen(LL);}LL( h){FK=dC.TD;var g=new VJ(BK,FK);q(new JB(BK.AB("Background")));q(g);g.start();}}var mC;var YD;var eC;var ZD;var KC; main(){mC=new ZC("Stage",lC.query('#stage'));YD=new QE();YD.UI(mC);DB.jF.webp=true;DB.DD("images/Loading.png").then((g){eC=new JB(g);eC.RC=20;eC.SC=20;eC.x=400;eC.y=270;mC.q(eC);KC=new LC();KC.OC=new aD("Arial",20,0xA0A0A0,bold:true);KC.width=240;KC.height=40;KC.text="... loading ...";KC.x=400-KC.EJ/2;KC.y=320;KC.VB=false;mC.q(KC);ZD=new fB(eC,100,QB.YC);ZD.gB.TB.cB(100.0*2.0*WB.PI);YD.TD.add(ZD);vG();});} vG(){var g=new FB();g.nB("Background","images/Background.jpg");g.nB("ExitBox","images/ExitBox.png");g.nB("ExitButtonNormal","images/ExitButtonNormal.png");g.nB("ExitButtonPressed","images/ExitButtonPressed.png");g.nB("ExitGauge","images/ExitGauge.png");g.nB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.nB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.nB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.nB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.nB("InfoBox","images/InfoBox.png");g.nB("MessageBox","images/MessageBox.png");g.nB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.nB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.nB("TimeGauge","images/TimeGauge.png");g.RD("Alarm","images/AlarmTextureAtlas.json",oC.BD);g.RD("Head","images/HeadTextureAtlas.json",oC.BD);g.RD("Elements","images/ElementsTextureAtlas.json",oC.BD);g.RD("Levelup","images/LevelupTextureAtlas.json",oC.BD);g.RD("Locks","images/LocksTextureAtlas.json",oC.BD);g.bB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.bB("BonusUniversal","sounds/BonusUniversal.mp3");g.bB("ChainBlast","sounds/ChainBlast.mp3");g.bB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.bB("ChainError","sounds/ChainError.mp3");g.bB("ChainFall","sounds/ChainFall.mp3");g.bB("ChainHelp","sounds/ChainHelp.mp3");g.bB("ChainLink","sounds/ChainLink.mp3");g.bB("ChainRotate","sounds/ChainRotate.mp3");g.bB("Click","sounds/Click.mp3");g.bB("GameOver","sounds/GameOver.mp3");g.bB("Laugh","sounds/Laugh.mp3");g.bB("LevelUp","sounds/LevelUp.mp3");g.bB("PointsCounter","sounds/PointsCounter.mp3");g.bB("Unlock","sounds/Unlock.mp3");g.bB("Warning","sounds/Warning.mp3");g.bB("Intro","sounds/Intro.mp3");g.zB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.zB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.zB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.zB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.zB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.zB("ESCNoActionHint","Press on the chain links to twist them.");g.zB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.zB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.zB("ESCtogo","Chain links:");g.zB("GENexitquery","Do you really want to quit the game?");g.zB("GEN2ndchancetime","Time is up. Second chance!");g.zB("GENtimeup","Sorry! Your time is up.");g.zB("GENgameover","Game Over");g.load().then((j){mC.HC(eC);mC.HC(KC);YD.TD.remove(ZD);mC.q(new ZJ(g));}).catchError((i){for(var h in g.HG){print("Loading resouce failed: ${h.kind}.${h.name} - ${h.error}");}});}const aJ=const bJ();class bJ{const bJ();}class yG{}abstract class rC extends PB{final  nM=new List<u>();var CN=true;var SN=true; q( g){if(g.parent==this){var h=nM.indexOf(g);nM.removeAt(h);nM.add(g);}else{TI(g,nM.length);}} TI( g, h){if(h<0||h>nM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){nM.removeAt(nM.indexOf(g));if(h>nM.length)h-- ;nM.insert(h,g);}else{g.pE();g.FQ(this);nM.insert(h,g);g.dispatchEvent(new BB(BB.FH,true));if(this.dC!=null)MQ(g,new BB(BB.CD));}} HC( h){var g=nM.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");zI(g);} zI( g){if(g<0||g>=nM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=nM[g];h.dispatchEvent(new BB(BB.aH,true));if(this.dC!=null)MQ(h,new BB(BB.PD));h.FQ(null);nM.removeAt(g);} contains( g){for(;g!=null;g=g.MP)if(g==this)return true;return false;} oB( o,[ g]){if(g==null)g=new IB.tJ();if(nM.length==0)return super.oB(o,g);var i=double.INFINITY;var j=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var s=nM.length;for(int m=0;m<nM.length;m++ ){var n=nM[m];PP.jE(n.iP,o);var h=n.oB(PP,g);if(h.left<i)i=h.left;if(h.top<j)j=h.top;if(h.right>l)l=h.right;if(h.bottom>k)k=h.bottom;}g.x=i;g.y=j;g.width=l-i;g.height=k-j;return g;} qB( i, k){i=i.toDouble();k=k.toDouble();var n=null;for(int l=nM.length-1;l>=0;l-- ){var j=nM[l];if(j.rQ){var g=j.iP;var o=i-g.BC;var m=k-g.CC;var v=(g.d*o-g.c*m)/g.iC;var s=(g.a*m-g.b*o)/g.iC;var h=j.qB(v,s);if(h!=null){if(h is PB)if(h.VB)return CN?h:this;n=this;}}}return n;} iB( i){for(int g=0;g<nM.length;g++ ){var h=nM[g];if(h.rQ)i.UG(h);}}tQ( g, i){i.add(g);if(g is rC){var k=g as rC;var j=k.nM;for(int h=0;h<j.length;h++ ){tQ(j[h],i);}}}MQ( i, j){var g=mD.QG() as List<u>;tQ(i,g);for(int h=0;h<g.length;h++ ){g[h].dispatchEvent(j);}g.clear();mD.SG(g);}}class ID{static const  CH="exactFit";static const  KH="noBorder";static const  SH="noScale";static const  VF="showAll";}class RE{var gC;var uC;}class FF{final  tE;FF(this.tE);call( h, g){IN(h).cB(g);} get x=>IN("x"); get y=>IN("y"); get lB=>IN("scaleX"); get rB=>IN("scaleY"); get skewX=>IN("skewX"); get skewY=>IN("skewY"); get RC=>IN("pivotX"); get SC=>IN("pivotY"); get TB=>IN("rotation"); get alpha=>IN("alpha"); IN( h){var g=new yB(h);this.tE.IN(g);return g;}}class NC{var NM;var oM; OB( g, h(event),{ useCapture: false}){return mN(g,useCapture).listen(h);}dispatchEvent( g){OP(g,this,this,pC.fD);} rP( h, j, i){if(j&&oM!=null){var g=oM[h];if(g!=null&&g.BP)return true;}if(i&&NM!=null){var g=NM[h];if(g!=null&&g.BP)return true;}return false;} mN( h, g){if(g){if(oM==null)oM=new Map<String,wC>();}else{if(NM==null)NM=new Map<String,wC>();}var i=g?oM:NM;return i.putIfAbsent(h,(){return new wC(this,h,g);});}OP( g, k, l, j){var h=(j==pC.HF)?oM:NM;if(h==null)return;var i=h[g.type];if(i==null)return;g.hM=k;g.oP=l;g.mP=j;g.pP=false;g.tP=false;i.dispatchEvent(g);}}class QE{var zL;var OM;var YM;var lM;var ZN;var lN;var wN;var IO;QE(){zL=new MB();OM=new List<ZC>();YM=-1;ZN=false;lN=new PF(0);wN=new cF();IO=new iF();lM=GP;KP();} get TD=>zL;KP(){lC.window.requestAnimationFrame(lM);}GP( g){KP();g=g.toDouble();if(YM==-1)YM=g;if(YM>g)YM=g;var j=g-YM;var i=j/1000.0;var k=g/1000.0;var l=false;if(j>=1){YM=g;lN.TN=i;oF.dispatchEvent(lN);zL.AC(i);for(int h=0;h<OM.length;h++ ){OM[h].TD.AC(i);}if(ZN){ZN=false;tF.dispatchEvent(IO);}for(int h=0;h<OM.length;h++ ){OM[h].mI(k,i);}qF.dispatchEvent(wN);}} UI( g){if(g.qE!=null){g.qE.AJ(g);}OM.add(g);g.RQ=this;} AJ( g){if(g.qE==this){OM.remove(g);g.RQ=null;}}}class vB<MD extends BB>{final  XM;const vB(this.XM); forTarget( g,{ useCapture: false}){return g.mN(XM,useCapture);}}class EB extends rC{var gJ=false;var uE=false;var lE=null;var GN=null;var XN=null;nP(){var i=this.xD;var j=this.dC;var m=this.visible;if(i!=null&&this.dC!=null){var h=nC.WH;if(h!=null){var g=iP.EE(i);if(g.x<h.left)g.x=h.left;if(g.x>h.right)g.x=h.right;if(g.y<h.top)g.y=h.top;if(g.y>h.bottom)g.y=h.bottom;i=iP.CG().EE(g);}var l=new LB(RN,dN).add(i).subtract(nC.TH);var k=iP.EE(l);this.visible=false;XN=j.qB(j.nI,j.oI);this.x=k.x;this.y=k.y;this.visible=m;}} oB( h,[ g]){if(g==null)g=new IB.tJ();super.oB(h,g);if(GN!=null){g=GN.eQ(h).union(g);}return g;} qB( i, j){var h=null;if(this.lE!=null){var g=this.sE(this.lE);if(g!=null){var k=i*g.a+j*g.c+g.BC;var l=i*g.b+j*g.d+g.CC;if(this.lE.qB(k,l)!=null){h=this;}}}else{h=super.qB(i,j);if(h==null&&GN!=null){if(GN.iQ(i,j)){h=this;}}}return h;}iB( g){if(GN!=null)GN.iB(g);super.iB(g);}}class JB extends u{var MM;var aM;var qM;JB([ h=null, g="auto"]){this.GC=h;this.xI=g;qM=null;} get GC=>MM;set GC( g){if(g==null)MM=null;if(g is DB)MM=g;}set xI( g){if(g is String)aM=g;}set ZI( g){if(g==null)qM=null;if(g is IB)qM=g;} oB( k,[ j]){var g=MM;var h=0,i=0;if(g!=null){h=g.width;i=g.height;}return gE(k,h,i,j);} qB( h, i){var g=MM;if(g==null)return null;if(h<0.0||i<0)return null;if(h>=g.width||i>=g.height)return null;return this;} iB( h){var g=MM;if(g==null)return;if(qM==null){g.iB(h);}else{g.TG(h,qM);}}}class IB{var xL;var BM;var JM;var VM;IB( i, g, h, j):xL=i,BM=g,JM=h,VM=j;IB.tJ():this(0,0,0,0); clone()=>new IB(xL,BM,JM,VM); toString()=>"Rectangle [x=${xL}, y=${BM}, width=${JM}, height=${VM}]"; get x=>xL; get y=>BM; get width=>JM; get height=>VM; get left=>xL; get top=>BM; get right=>xL+JM; get bottom=>BM+VM; get size=>new LB(JM,VM);set x( g){xL=g;}set y( g){BM=g;}set width( g){JM=g;}set height( g){VM=g;}set bottom( g){this.height=g-BM;}set left( g){xL=g;}set right( g){JM=g-xL;}set top( g){BM=g;} contains( g, h){return xL<=g&&BM<=h&&xL+JM>=g&&BM+VM>=h;} GG( g){return xL==g.x&&BM==g.y&&JM==g.width&&VM==g.height;} get isEmpty{return JM==0&&VM==0;}uD( g){xL=g.x;BM=g.y;JM=g.width;VM=g.height;} union( g){var i=WB.min(this.left,g.left);var h=WB.min(this.top,g.top);var j=WB.max(this.right,g.right);var k=WB.max(this.bottom,g.bottom);return new IB(i,h,j-i,k-h);} align(){var h=this.left.floor();var g=this.top.floor();var i=this.right.ceil();var j=this.bottom.ceil();return new IB(h,g,i-h,j-g);}}class OE{var png;var jpg;var webp;var autoHiDpi;OE({this.png: true,this.jpg: true,this.webp: false,this.autoHiDpi: true});}abstract class PE{ iB( g);}class cD extends BB{cD( g):super(g,false); get sD=>false;}class pC{static const  HF=1;static const  fD=2;static const  OH=3;}class yC extends PB{var upState;var overState;var downState;var hitTestState;var uE=true;var enabled=true;var oN;yC([this.upState,this.overState,this.downState,this.hitTestState]){OB(t.eF,bO);OB(t.kD,bO);OB(t.hD,bO);OB(t.bE,bO);oN=this.upState;} oB( h,[ g]){if(oN!=null){PP.jE(oN.iP,h);return oN.oB(PP,g);}return super.oB(h,g);} qB( k, l){if(this.hitTestState!=null){var g=this.hitTestState.iP;var h=k-g.BC;var i=l-g.CC;var m=(g.d*h-g.c*i)/g.iC;var j=(g.a*i-g.b*h)/g.iC;if(this.hitTestState.qB(m,j)!=null)return this;}return null;} iB( g){if(oN!=null)g.UG(oN);} bO( g){if(g.type==t.kD){oN=upState;}else{oN=g.aC?downState:overState;}}}class xG{}abstract class wG{}abstract class ME{var kC=null;var border=false;var borderColor=0xFF000000;var borderWidth=1;var NN;ME();factory ME.vJ( i, g, h, j){return new eJ(i,g,h,j);}VI( h, g){NN=h.context;NN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);NN.beginPath();jP();NN.save();NN.clip();}dI(){NN.restore();if(border){NN.strokeStyle=bF(borderColor);NN.lineWidth=borderWidth;NN.lineCap="round";NN.lineJoin="round";NN.stroke();}}jP();}class HB{var yL,AM,DM,FM,HM,LM;var WM;HB( h, i, g, j, k, l):yL=h.toDouble(),AM=i.toDouble(),DM=g.toDouble(),FM=j.toDouble(),HM=k.toDouble(),LM=l.toDouble(),WM=(h*j-i*g).toDouble();HB.xJ():yL=1.0,AM=0.0,DM=0.0,FM=1.0,HM=0.0,LM=0.0,WM=1.0; clone(){return new HB(yL,AM,DM,FM,HM,LM);} CG(){var h=(FM/WM);var i=-(AM/WM);var g=-(DM/WM);var j=(yL/WM);var k=-(h*HM+g*LM);var l=-(i*HM+j*LM);return new HB(h,i,g,j,k,l);} get a=>yL; get b=>AM; get c=>DM; get d=>FM; get BC=>HM; get CC=>LM; get iC=>WM; EE( h){var i=h.x.toDouble();var g=h.y.toDouble();return new LB(i*yL+g*DM+HM,i*AM+g*FM+LM);} HQ( h){var i=h.x.toDouble();var g=h.y.toDouble();return new LB(i*yL+g*DM+HM,i*AM+g*FM+LM);} concat( g){var m=yL;var s=AM;var v=DM;var o=FM;var l=HM;var n=LM;var RB=WM;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var UB=g.BC;var GB=g.CC;var ZB=g.iC;yL=(m*j+s*i).toDouble();AM=(m*k+s*h).toDouble();DM=(v*j+o*i).toDouble();FM=(v*k+o*h).toDouble();HM=(l*j+n*i+UB).toDouble();LM=(l*k+n*h+GB).toDouble();WM=(RB*ZB).toDouble();} gI(){yL=1.0;AM=0.0;DM=0.0;FM=1.0;HM=0.0;LM=0.0;WM=1.0;} KG(){var j=yL;var m=AM;var l=DM;var k=FM;var h=HM;var i=LM;var g=WM;yL=(k/g).toDouble();AM=-(m/g).toDouble();DM=-(l/g).toDouble();FM=(j/g).toDouble();HM=-(yL*h+DM*i).toDouble();LM=-(AM*h+FM*i).toDouble();WM=(1.0/g).toDouble();} scale( h, g){yL=(yL*h).toDouble();AM=(AM*g).toDouble();DM=(DM*h).toDouble();FM=(FM*g).toDouble();HM=(HM*h).toDouble();LM=(LM*g).toDouble();WM=(WM*h*g).toDouble();} translate( g, h){HM=(HM+g).toDouble();LM=(LM+h).toDouble();} zD( h, i, g, k, j, l){yL=h.toDouble();AM=i.toDouble();DM=g.toDouble();FM=k.toDouble();HM=j.toDouble();LM=l.toDouble();WM=(yL*FM-AM*DM).toDouble();} uD( g){yL=g.a.toDouble();AM=g.b.toDouble();DM=g.c.toDouble();FM=g.d.toDouble();HM=g.BC.toDouble();LM=g.CC.toDouble();WM=g.iC.toDouble();} jE( h, g){var n=h.a;var v=h.b;var GB=h.c;var s=h.d;var m=h.BC;var o=h.CC;var UB=h.iC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var ZB=g.BC;var RB=g.CC;var TC=g.iC;yL=(n*k+v*j).toDouble();AM=(n*l+v*i).toDouble();DM=(GB*k+s*j).toDouble();FM=(GB*l+s*i).toDouble();HM=(m*k+o*j+ZB).toDouble();LM=(m*l+o*i+RB).toDouble();WM=(UB*TC).toDouble();}}class cJ extends UC{var RM;var gM;cJ( i, h, g){RM=h;gM=g;} get MC=>gM;set MC( g){gM=g;} stop(){}}class SE implements mB{final  UM;var cM=0.0;var rM=0.0;var yM=1;SE( g, h):UM=g{rM=WB.max(h,0.0001);} AC( h){var g=cM+h;while (g>=rM&&yM>0){cM=rM;yM-- ;UM();g-= rM;}cM=g;return (yM>0);} get FD=>rM; get currentTime=>cM;}final  VE=new Map<String,mF>();class bD extends u{static const  XE='DIRECTION_UP';static const  OF='DIRECTION_RIGHT';static const  aE='DIRECTION_DOWN';static const  jD='DIRECTION_LEFT';var FO;var LO;var MM;var qM;bD( h,[ g=jD]){if(g!=XE&&g!=aE&&g!=jD&&g!=OF){throw new ArgumentError('Invalid Gauge direction!');}FO=g;LO=1.0;MM=h;qM=new IB.tJ();TP();} get ratio=>LO;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;LO=g;TP();} get GC=>MM;set GC( g){MM=g;TP();}TP(){if(MM==null){qM.left=0;qM.top=0;qM.right=0;qM.bottom=0;}else{var h=MM.width;var g=MM.height;switch (FO){case jD:qM.left=((1.0-LO)*h).toInt();qM.top=0;qM.right=h;qM.bottom=g;break;case XE:qM.left=0;qM.top=((1.0-LO)*g).toInt();qM.right=h;qM.bottom=g;break;case OF:qM.left=0;qM.top=0;qM.right=(LO*h).toInt();qM.bottom=g;break;case aE:qM.left=0;qM.top=0;qM.right=h;qM.bottom=(LO*g).toInt();break;}}} oB( i,[ g]){var h=(MM!=null)?MM.width:0;var j=(MM!=null)?MM.height:0;return gE(i,h,j,g);} qB( g, h){if(MM!=null&&g>=0.0&&h>=0.0&&g<MM.width&&h<MM.height)return this;return null;} iB( g){if(MM!=null)MM.TG(g,qM);}}class vC{final  matrix=new HB.xJ();var alpha=1.0;var tD=gD.iD;var UN; get pI{if(UN==null)UN=new vC();return UN;}}abstract class mB{ AC( g);}abstract class eB{static  DD( g,[ h=null]){switch (xC.eH){case "WebAudioApi":return TE.DD(g,h);case "AudioElement":return NE.DD(g,h);default:return sC.DD(g,h);}}static var jF=new qC(mp3:true,mp4:true,ogg:true,wav:true); get length; play([ h=false, g]);}abstract class UC extends NC{ get MC; set MC( g); stop();}class qC{var mp3;var mp4;var ogg;var wav;var ignoreErrors;qC({this.mp3: false,this.mp4: false,this.ogg: false,this.wav: false,this.ignoreErrors: true});}class YB{var volume;var pan;var nJ=1;var oJ=0;var rJ=1;var qJ=0;YB([this.volume=1,this.pan=0]);}class xC{static var eH=tH();static var lD=BI();static var kF=DI();static  tH(){var h=(lD!=null)?"WebAudioApi":"AudioElement";var g=lC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0")||g.contains("10.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(kF.length==0)h="Mock";print("StageXL: supported audio engine is: ${h}");return h;}static  BI(){if(wE.AudioContext.supported)return new wE.AudioContext();return null;}static  DI(){var g=new List<String>();var h=new lC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/mp4",""))!=-1)g.add("mp4");if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("StageXL: supported audio types are: ${g}");return g;}static  xF( i, h){var l=new RegExp(r"(mp3|mp4|ogg|wav)$",multiLine:false,caseSensitive:true);var g=kF.toList();var k=l.firstMatch(i);var j=new List<String>();if(k==null){throw new ArgumentError("Unsupported file extension.");}if(g.length==0){throw new UnsupportedError("This browser supports no known audio codec.");}if(!h.mp3)g.remove("mp3");if(!h.mp4)g.remove("mp4");if(!h.ogg)g.remove("ogg");if(!h.wav)g.remove("wav");var m=k.group(1);if(g.contains(m)){j.add(i);g.remove(m);}for(var n in g){j.add(i.replaceAll(l,n));}return j;}}class NE extends eB{var SM;var iM;var BN;NE(){BN=new List<dD>();SM=new lC.AudioElement();SM.onEnded.listen(OO);iM=new List<lC.AudioElement>();iM.add(SM);lC.document.body.children.add(SM);}static  DD( l,[ g=null]){if(g==null)g=eB.jF;var n=new NE();var h=n.SM;var i=xC.xF(l,g);var j=new aB.Completer<eB>();if(i.length==0){return sC.DD(l,g);}var k;var m;GB(s){k.cancel();m.cancel();j.complete(n);}o(s){if(i.length>0){h.src=i.removeAt(0);h.load();}else{k.cancel();m.cancel();if(g.ignoreErrors){sC.DD(l,g).then((v)=>j.complete(v));}else{j.completeError(new StateError("Failed to load audio."));}}}k=h.onCanPlayThrough.listen(GB);m=h.onError.listen(o);h.src=i.removeAt(0);h.load();return j.future;} get length{return SM.duration;} play([ h=false, g]){if(g==null)g=new YB();return new dD(this,h,g);} gO( h){var g;if(iM.length==0){g=SM.clone(true);g.onEnded.listen(OO);}else{g=iM.removeAt(0);}BN.add(h);return g;} uP( g){var h=g.SM;var i=BN.indexOf(g);BN.removeAt(i);iM.add(h);if(SM.currentTime>0&&SM.ended==false)SM.currentTime=0;} OO( j){var i=j.target;var g=null;for(int h=0;h<BN.length&&g==null;h++ )if(BN[h].SM==i)g=BN[h];if(g!=null)g.stop();}}class dD extends UC{var dM;var SM;var RM;var gM;dD( g, i, h){dM=g;RM=i;gM=h;SM=g.gO(this);SM.loop=RM;this.MC=h;SM.play();} get MC=>gM; set MC( g){gM=g;if(SM!=null)SM.volume=(gM!=null)?gM.volume:1;} stop(){if(SM!=null){if(SM.ended==false)SM.pause();dM.uP(this);SM=null;}}}class TE extends eB{var QM;TE(){if(xC.lD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  DD( i,[ g=null]){if(g==null)g=eB.jF;var m=new TE();var h=new aB.Completer<eB>();var j=xC.xF(i,g);var v=xC.lD;if(j.length==0){return sC.DD(i,g);}GB(n){v.decodeAudioData(n.response).then(( s){m.QM=s;h.complete(m);}).catchError((o){if(g.ignoreErrors){sC.DD(i,g).then((k)=>h.complete(k));}else{h.completeError(new StateError("Failed to decode audio."));}});}l(o){if(j.length>0){lC.HttpRequest.request(j.removeAt(0),responseType:'arraybuffer').then(GB).catchError(l);}else{if(g.ignoreErrors){sC.DD(i,g).then((k)=>h.complete(k));}else{h.completeError(new StateError("Failed to load audio."));}}}l(null);return h.future;} get length{return QM.duration;} play([ h=false, g]){if(g==null)g=new YB();return new dJ(this,h,g);}}class dJ extends UC{var ZM;var gM;var RM;var JN;var bN;dJ( j, h, i){ZM=j;RM=h;gM=i;var g=xC.lD;JN=g.createGain();JN.connectNode(g.destination,0,0);JN.gain.value=(gM!=null)?WB.pow(gM.volume,2):1;bN=g.createBufferSource();bN.buffer=ZM.QM;bN.loop=h;bN.connectNode(JN,0,0);bN.start(0);} get MC=>gM; set MC( g){gM=g;JN.gain.value=(gM!=null)?WB.pow(gM.volume,2):1;} stop(){bN.stop(0);}}class sC extends eB{sC(){}static  DD( g,[ h=null]){return new aB.Future<eB>.value(new sC());} get length{return double.NAN;} play([ h=false, g]){if(g==null){g=new YB();}return new cJ(this,h,g);}}class t extends BB{static const  fC="click";static const  MH="doubleClick";static const  hD="mouseDown";static const  bE="mouseUp";static const  ZF="mouseMove";static const  kD="mouseOut";static const  eF="mouseOver";static const  fF="mouseWheel";static const  lF="middleClick";static const  jH="middleMouseDown";static const  nH="middleMouseUp";static const  nF="rightClick";static const  sH="rightMouseDown";static const  uH="rightMouseUp";var WP,XP;var ZP,bP;var qP;var rN;var WO;var zN;var HO;var xP;var yP;var zP;t( g,[ h=false]):super(g,h){kP(g,h);} kP( g,[ h=false]){super.kP(g,h);WP=XP=0;ZP=bP=0;qP=false;rN=false;WO=false;zN=false;HO=false;xP=0;yP=0;zP=0;}set DQ( g){WP=g.x;XP=g.y;}set EQ( g){ZP=g.x;bP=g.y;} get mE=>WP; get nE=>XP; get aC=>qP; get altKey=>rN; get ctrlKey=>zN; get shiftKey=>HO; get SD=>xP; get deltaX=>yP; get deltaY=>zP;}class VC extends BB{static const  KF="keyDown";static const  MF="keyUp";var rN=false;var zN=false;var HO=false;var PO=false;var WO=false;var eO=0;var jO=0;var nO=0;VC( g,[ h=false]):super(g,h); get altKey=>rN; get ctrlKey=>zN; get shiftKey=>HO; get charCode=>eO; get keyCode=>jO; get keyLocation=>nO;}class LC extends PB{var CM="";var eM=null;var wM=eD.cE;var MN=zC.DH;var eN=0;var nN=0;var uN=0.0;var BO=0.0;var JO=0.0;var RO=0.0;var UO=0.0;var ZO=false;var dO=false;var hO=false;var pO=false;var tO=false;var wO="•";var zO=0xFFFFFF;var DP=0x000000;var IP=0;var JM=100;var VM=100;var LP=0.0;var NP=0.0;final  QP=new List<KD>();var cP=3;var dP=null;var NN=null;LC([ h, g]){this.text=(h!=null)?h:"";this.OC=(g!=null)?g:new aD("Arial",12,0x000000);this.onKeyDown.listen(wP);this.sI.listen(AQ);this.onMouseDown.listen(BQ);} get text=>CM; get type=>MN; get border=>tO; get borderColor=>DP; set width( g){JM=g.toDouble();cP|= 3;} set height( g){VM=g.toDouble();cP|= 3;} set text( g){CM=g.replaceAll('\r\n','\n').replaceAll('\r','\n');eN=CM.length;cP|= 3;} set OC( g){eM=g.clone();cP|= 3;} set wordWrap( g){ZO=g;cP|= 3;} get x{kQ();return super.x;} get width{kQ();return JM;} get height{kQ();return VM;} get EJ{kQ();return LP;} get rE{kQ();return NP;} oB( h,[ g]){return gE(h,JM,VM,g);} qB( g, h){if(g>=0&&h>=0&&g<JM&&h<VM)return this;return null;} iB( i){kQ();pQ();uN+= i.aI;var g=i.NN;g.drawImageScaled(dP,0.0,0.0,JM,VM);if(MN==zC.ND){var h=this.dC;if(h!=null&&h.focus==this&&uN.remainder(0.8)<0.4){g.fillStyle=OD(eM.color);g.fillRect(BO,JO,RO,UO);}}}kQ(){if((cP&1)==0){return;}else{cP&= 255-1;}QP.clear();var j=0;var i='';var o='';var cG=0;var k=eM.size.toDouble();var ZB=eM.leftMargin.toDouble();var dG=eM.rightMargin.toDouble();var eG=eM.topMargin.toDouble();var GJ=eM.bottomMargin.toDouble();var HJ=eM.align.toString();var TC=JM-ZB-dG;var fG=eM.sP;var gG=NH(fG);var hG=gG.rD.toDouble();var iG=gG.kE.toDouble();var l=nD;l.font=fG;l.textAlign="start";l.textBaseline="alphabetic";l.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);for(var vE in CM.split('\n')){if(ZO==false){QP.add(new KD.uJ(vE,j));j+= vE.length+1;}else{i=null;for(var UB in vE.split(' ')){o=i;i=(o==null)?UB:"${o} ${UB}";i=sQ(i);cG=l.measureText(i).width.toDouble();if(cG>=TC){if(o==null){QP.add(new KD.uJ(i,j));j+= i.length+1;i=null;}else{QP.add(new KD.uJ(o,j));j+= o.length+1;i=sQ(UB);}}}if(i!=null){QP.add(new KD.uJ(i,j));j+= i.length+1;}}}LP=0.0;NP=0.0;for(int h=0;h<QP.length;h++ ){var g=QP[h];if(g is !KD)continue;var RB=ZB;var IJ=eG+h*k+k;var GB=l.measureText(g.CM).width.toDouble();switch (HJ){case DC.WC:case DC.PH:RB+= (TC-GB)/2;break;case DC.gF:case DC.JH:RB+= (TC-GB);break;}g.xL=RB;g.BM=IJ;g.JM=GB;g.VM=k;g.ON=hG;g.aN=iG;g.iN=0.0;LP=WB.max(LP,GB);NP=NP+k;}if(QP.length>0){NP+= eG+GJ+iG;LP+= ZB+dG;}if(MN==zC.ND){for(int h=QP.length-1;h>=0;h-- ){var g=QP[h];if(g is !KD)continue;if(eN>=g.IM){var JJ=eN-g.IM;var KJ=g.CM.substring(0,JJ);nN=h;BO=g.xL+l.measureText(KJ).width.toDouble();JO=g.BM-hG*0.9;RO=1.0;UO=k;break;}}var m=0.0;var s=0.0;while (m+BO>JM)m-= JM*0.2;while (m+BO<0)m+= JM*0.2;while (s+JO+UO>VM)s-= k;while (s+JO<0)s+= k;BO+= m;JO+= s;for(int h=0;h<QP.length;h++ ){var g=QP[h];if(g is !KD)continue;g.xL+= m;g.BM+= s;}}var n=ZO?JM:LP.ceil();var v=NP.ceil();if(JM!=n||VM!=v){switch (wM){case eD.GH:this.width=n;this.height=v;break;case eD.gF:this.x=this.x-(n-JM);this.width=n;this.height=v;break;case eD.WC:this.x=this.x-(n-JM)/2;this.width=n;this.height=v;break;}}}pQ(){if((cP&2)==0){return;}else{cP&= 255-2;}var g=(ZC.eE?pD:1.0)/oD;var j=(JM*g).ceil();var h=(VM*g).ceil();if(dP==null){dP=new lC.CanvasElement(width:j,height:h);NN=dP.context2D;}if(dP.width!=j)dP.width=j;if(dP.height!=h)dP.height=h;NN.font=eM.sP;NN.textAlign="start";NN.textBaseline="alphabetic";NN.setTransform(g,0.0,0.0,g,0.0,0.0);if(pO){NN.fillStyle=OD(zO);NN.fillRect(0,0,JM,VM);}else{NN.clearRect(0,0,JM,VM);}NN.fillStyle=OD(eM.color);for(int k=0;k<QP.length;k++ ){var i=QP[k];NN.fillText(i.CM,i.xL,i.BM);}if(tO){NN.strokeStyle=OD(DP);NN.lineWidth=1;NN.strokeRect(0,0,JM,VM);}} sQ( g){if(g is !String)return g;if(hO==false)return g;var h="";for(int i=0;i<g.length;i++ ){h="${h}${wO}";}return h;}wP( v){if(MN==zC.ND){kQ();var l=CM;var n=l.length;var j=QP;var g=eN;var i=nN;var h=-1;switch (v.keyCode){case lC.KeyCode.BACKSPACE:if(g>0){CM=l.substring(0,g-1)+l.substring(g);h=g-1;}break;case lC.KeyCode.END:var m=j[i];h=m.IM+m.CM.length;break;case lC.KeyCode.HOME:var m=j[i];h=m.IM;break;case lC.KeyCode.LEFT:if(g>0){h=g-1;}break;case lC.KeyCode.UP:if(i>0&&i<j.length){var o=j[i];var k=j[i-1];var s=WB.min(g-o.IM,k.CM.length);h=k.IM+s;}else{h=0;}break;case lC.KeyCode.RIGHT:if(g<n){h=g+1;}break;case lC.KeyCode.DOWN:if(i>=0&&i<j.length-1){var o=j[i];var k=j[i+1];var s=WB.min(g-o.IM,k.CM.length);h=k.IM+s;}else{h=n;}break;case lC.KeyCode.DELETE:if(g<n){CM=l.substring(0,g)+l.substring(g+1);h=g;}break;}if(h!=-1){eN=h;uN=0.0;cP|= 3;}}}AQ( j){if(MN==zC.ND){var i=CM.length;var h=eN;var g=j.text;if(g=='\r')g='\n';if(g=='\n'&&dO==false)g='';if(g=='')return;if(IP!=0&&i>=IP)return;CM=CM.substring(0,h)+g+CM.substring(h);eN=eN+g.length;uN=0.0;cP|= 3;}}BQ( o){var ZB=o.mE.toDouble();var l=o.nE.toDouble();var n=nD;n.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);for(int i=0;i<QP.length;i++ ){var g=QP[i];if(g is !KD)continue;var m=g.CM;var UB=g.xL;var GB=g.BM-g.ON;var RB=g.BM+g.aN;if(GB<=l&&RB>=l){var s=double.INFINITY;var j=0;for(var h=0;h<=m.length;h++ ){var v=n.measureText(m.substring(0,h)).width.toDouble();var k=(UB+v-ZB).abs();if(k<s){s=k;j=h;}}eN=g.IM+j;uN=0.0;cP|= 3;}}}}class eD{static const  WC="center";static const  GH="left";static const  cE="none";static const  gF="right";}class zC{static const  DH="dynamic";static const  ND="input";}class aD{var font;var size;var color;var bold;var italic;var underline;var align;var topMargin;var bottomMargin;var leftMargin;var rightMargin;var indent;var leading;aD(this.font,this.size,this.color,{this.bold: false,this.italic: false,this.underline: false,this.align: "left",this.topMargin: 0.0,this.bottomMargin: 0.0,this.leftMargin: 0.0,this.rightMargin: 0.0,this.indent: 0.0,this.leading: 0.0}); clone(){return new aD(font,size,color,bold:bold,italic:italic,underline:underline,align:align,topMargin:topMargin,bottomMargin:bottomMargin,leftMargin:leftMargin,rightMargin:rightMargin,indent:indent,leading:leading);} get sP{var g="${size}px ${font}, sans-serif";if(bold)g="bold ${g}";if(italic)g="italic ${g}";return g;}}class DC{static const  WC="center";static const  JH="end";static const  PH="justify";static const  gF="right";}class KD{var CM;var IM;var xL=0.0;var BM=0.0;var JM=0.0;var VM=0.0;var ON=0.0;var aN=0.0;var iN=0.0;KD.uJ(this.CM,this.IM); get x=>xL; get y=>BM; get width=>JM; get height=>VM; get rD=>ON; get kE=>aN; get leading=>iN;}class AD{static const  BH=0;static const  GH=1;static const  gF=2;static const  RH=3;static const  UF=4;}class nC{static var GF=uB.WE;static var HH=false;static var QF=null;static var TH=null;static var WH=null;static var bH=new aB.StreamController<String>();static var fH=bH.stream.asBroadcastStream();static  uF( i){var h=i;var g="auto";if(GF!=uB.WE){h=GF;}switch (h){case uB.WE:g="auto";break;case uB.YE:g="default";break;case uB.ZE:g="pointer";break;case uB.UH:g="move";break;case uB.WF:g="text";break;case uB.XH:g="wait";break;}if(HH){g="none";}return g;}}class uB{static const  WE="auto";static const  YE="arrow";static const  ZE="button";static const  UH="hand";static const  WF="ibeam";static const  XH="wait";}class DF{static const  cE="none";static const  QH="touchPoint";}class JD extends BB{static const  LF="textInput";var CM="";JD( g,[ h=false]):super(g,h); get text=>CM;}class FB extends NC{final  mM=new Map<String,LE>();static const  VH=const vB<BB>(BB.sF); get onProgress=>FB.VH.forTarget(this);mO( i, g, k, l){var j="${i}.${g}";var h=new LE(i,g,k,l);if(mM.containsKey(j)){throw new StateError("ResourceManager already contains a resource called '${g}'");}else{mM[j]=h;}h.complete.then((aP){this.dispatchEvent(new BB(BB.sF));});} eP( i, h){var j="${i}.${h}";var g=mM[j];if(g==null){throw new StateError("Resource '${h}' does not exist.");}else if(g.value!=null){return g.value;}else if(g.error!=null){throw g.error;}else{throw new StateError("Resource '${h}' has not finished loading yet.");}} load(){var i=this.wI.map((h)=>h.complete);return aB.Future.wait(i).then((j){var g=this.HG.length;if(g>0){throw new StateError("Failed to load ${g} resource(s).");}else{return this;}});} get wI{return mM.values.where((g)=>g.value==null&&g.error==null).toList();} get HG{return mM.values.where((g)=>g.error!=null).toList();} nB( h, g,[ i=null]){mO("BitmapData",h,g,DB.DD(g,i));} bB( i, g,[ h=null]){mO("Sound",i,g,eB.DD(g,h));} RD( i, g, h){mO("TextureAtlas",i,g,jB.DD(g,h));} zB( h, g){mO("Text",h,"",new aB.Future.value(g));} AB( h){var g=eP("BitmapData",h);if(g is !DB)throw "dart2js_hint";return g;} pB( h){var g=eP("Sound",h);if(g is !eB)throw "dart2js_hint";return g;} cC( h){var g=eP("TextureAtlas",h);if(g is !jB)throw "dart2js_hint";return g;} ED( h){var g=eP("Text",h);if(g is !String)throw "dart2js_hint";return g;}}class LE{var GM;var TM;var bM;var kM=null;var uM=null;var DN=new aB.Completer();LE( h, i, j, k):GM=h,TM=i,bM=j{k.then((g){kM=g;}).catchError((l){uM=l;}).whenComplete((){DN.complete(this);});} toString()=>"ResourceManagerResource [kind=${GM}, name=${TM}, url = ${bM}]"; get kind=>GM; get name=>TM; get value=>kM; get error=>uM; get complete=>DN.future;}class jB{final  PM=new List<EF>();var MM;static  DD( n, UB){var k=new aB.Completer<jB>();var g=new jB();switch (UB){case oC.EH:case oC.BD:lC.HttpRequest.getString(n).then((GB){var o=LJ.parse(GB);var h=o["frames"];var s=o["meta"];var TC=CI(n,s["image"]);if(h is List){for(var v in h){var j=v as Map;var i=j["filename"] as String;var l=vF(i);var m=new EF.wJ(g,l,j);g.PM.add(m);}}if(h is Map){for(String i in h.keys){var j=h[i] as Map;var l=vF(i);var m=new EF.wJ(g,l,j);g.PM.add(m);}}DB.DD(TC).then(( ZB){g.MM=ZB;k.complete(g);}).catchError((RB){k.completeError(new StateError("Failed to load image."));});}).catchError((RB){k.completeError(new StateError("Failed to load json file."));});break;}return k.future;} AB( h){for(int g=0;g<PM.length;g++ ){var i=PM[g];if(i.name==h){return new DB.AK(i);}}throw new ArgumentError("TextureAtlasFrame not found: '${h}'");}}class oC{static const  EH="json";static const  BD="jsonarray";}class XB extends BB{static const  JF="touchBegin";static const  NF="touchEnd";static const  RF="touchCancel";static const  XF="touchMove";static const  ZH="touchOver";static const  dH="touchOut";var RP;var VP;var WP,XP;var ZP,bP;var rN;var WO;var zN;var HO;var fP;var gP;var hP;XB( g,[ h=false]):super(g,h){kP(g,h);} kP( g,[ h=false]){super.kP(g,h);RP=0;VP=false;WP=XP=0;ZP=bP=0;rN=false;WO=false;zN=false;HO=false;fP=1.00;gP=0;hP=0;}set DQ( g){WP=g.x;XP=g.y;}set EQ( g){ZP=g.x;bP=g.y;} get DE=>RP; get mE=>WP; get nE=>XP; get altKey=>rN; get ctrlKey=>zN; get shiftKey=>HO;}class zG<MD>{final  EM=new List<MD>();final  fM;var sM=0;zG( g()):fM=g; QG(){if(sM==0){return fM();}else{sM-- ;return EM[sM];}}SG( g){if(sM==EM.length){EM.add(g);}else{EM[sM]=g;}sM++ ;}reset(){EM.clear();sM=0;}}class BB{static const  FH="added";static const  CD="addedToStage";static const  SF="enterFrame";static const  YF="exitFrame";static const  aH="removed";static const  PD="removedFromStage";static const  gH="resize";static const  hF="render";static const  sF="progress";var MN;var lP;var mP;var hM;var oP;var pP;var tP;BB( g,[ h=false]){kP(g,h);} kP( g,[ h=false]){MN=g;lP=h;mP=pC.fD;hM=null;oP=null;pP=false;tP=false;} get BE=>pP; get type=>MN; get bubbles=>lP; get sD=>true; get target=>hM;}class LB{var xL;var BM;LB( h, g):xL=h,BM=g;LB.tJ():this(0,0); clone()=>new LB(xL,BM); toString()=>"Point [x=${xL}, y=${BM}]"; get x=>xL; get y=>BM; get length=>WB.sqrt(xL*xL+BM*BM);set x( g){xL=g;}set y( g){BM=g;} add( g){return new LB(xL+g.x,BM+g.y);} subtract( g){return new LB(xL-g.x,BM-g.y);}uD( g){xL=g.x;BM=g.y;} GG( g){return xL==g.x&&BM==g.y;}}class wC<MD extends BB> extends aB.Stream<MD>{final  hM;final  XM;final  AN;var VN=[] ;wC(this.hM,this.XM,this.AN); get isBroadcast=>true; asBroadcastStream({ onListen( subscription), onCancel( subscription)})=>this; get BP=>VN.length>0; listen( i( event),{ onError(error), onDone(), cancelOnError: false}){var h=new IF<MD>(this,i);VN.add(h);if(AN==false){var g=this;switch (XM){case BB.SF:oF.hE(g);break;case BB.YF:qF.hE(g);break;case BB.hF:tF.hE(g);break;}}return h;}YI( j){if(j.QN)return;var i=[] ;for(var g=0;g<VN.length;g++ ){var h=VN[g];if(identical(h,j)){h.QN=true;}else{i.add(h);}}VN=i;}dispatchEvent( j){var k=VN;var i=VN.length;for(var g=0;g<i;g++ ){var h=k[g];if(h.QN==false){h.tN(j);}}}}abstract class u extends NC implements PE{static var LH=0;var vM=LH++ ;var xL=0.0;var BM=0.0;var RN=0.0;var dN=0.0;var jN=1.0;var sN=1.0;var yN=0.0;var DO=0.0;var MO=0.0;var SO=1.0;var VO=true;var YO=false;var fO=null;var kO=null;var qO=null;var uO=false;var AP=null;var CP=null;var FP=null;var TM="";var MP=null;final  PP=new HB.xJ();final  SP=new HB.xJ();var YP=true;static const  AI=const vB<BB>(BB.CD); get rI=>u.AI.forTarget(this); get x=>xL; get y=>BM; get RC=>RN; get SC=>dN; get lB=>jN; get rB=>sN; get skewX=>yN; get skewY=>DO; get TB=>MO; get visible=>VO; get alpha=>SO; get XI=>kO!=null; get tD=>FP; get name=>TM; get parent=>MP; get xD{var g=this.dC;return (g!=null)?this.jC(g.YQ):null;} get nI{var g=this.xD;return (g!=null)?g.x:0.0;} get oI{var g=this.xD;return (g!=null)?g.y:0.0;} get root{var g=this;while (g.MP!=null)g=g.MP;return g;} get dC{var g=this.root;return (g is ZC)?g:null;}set x( g){if(g is num)xL=g;YP=true;}set y( g){if(g is num)BM=g;YP=true;}set RC( g){if(g is num)RN=g;YP=true;}set SC( g){if(g is num)dN=g;YP=true;}set lB( g){if(g is num)jN=g;YP=true;}set rB( g){if(g is num)sN=g;YP=true;}set skewX( g){if(g is num)yN=g;YP=true;}set skewY( g){if(g is num)DO=g;YP=true;}set TB( g){if(g is num)MO=g;YP=true;}set visible( g){if(g is bool)VO=g;}set alpha( g){if(g is num)SO=g;}set mask( g){fO=g;}set tD( g){FP=g;} setTransform( k, l,[ n, g, h, o, j, i, m]){if(k is num)xL=k;if(l is num)BM=l;if(n is num)jN=n;if(g is num)sN=g;if(h is num)MO=h;if(o is num)yN=o;if(j is num)DO=j;if(i is num)RN=i;if(m is num)dN=m;YP=true;} get width=>oB(iP).width; get height=>oB(iP).height; set width( h){this.lB=1;var g=this.width;this.lB=(g!=0.0)?h/g:1.0;} set height( h){this.rB=1;var g=this.height;this.rB=(g!=0.0)?h/g:1.0;} pE(){if(MP!=null)MP.HC(this);} get rQ=>VO&&!YO; get iP{if(YP){YP=false;var j=yN+MO;var i=DO+MO;if(j==0.0&&i==0.0){SP.zD(jN,0.0,0.0,sN,xL-RN*jN,BM-dN*sN);}else{var g,l,k,h;var m=WB.cos(j);var n=WB.sin(j);if(j==i){g=jN*m;l=jN*n;k=-sN*n;h=sN*m;}else{g=jN*WB.cos(i);l=jN*WB.sin(i);k=-sN*n;h=sN*m;}var s=xL-(RN*g+dN*k);var o=BM-(RN*l+dN*h);SP.zD(g,l,k,h,s,o);}}return SP;} sE( h){if(h==MP)return iP.clone();if(h.MP==this)return h.iP.CG();var j=new HB.xJ();var g=this;while (g!=h&&g.MP!=null){j.concat(g.iP);g=g.MP;}if(h==null&&g!=null){j.concat(g.iP);g=null;}if(g==h)return j;var k=new HB.xJ();var i=h;while (i!=this&&i.MP!=null){k.concat(i.iP);i=i.MP;}k.KG();if(i==this)return k;if(i!=g)return null;j.concat(k);return j;} oB( h,[ g]){if(g==null)g=new IB.tJ();g.x=h.BC;g.y=h.CC;g.width=0;g.height=0;return g;} qB( g, h){if(oB(fE).contains(g,h))return this;return null;} jC( h){PP.gI();for(u g=this;g!=null;g=g.MP)PP.concat(g.iP);PP.KG();return PP.EE(h);} lQ( g){g.context.translate(qO.x,qO.y);kO.iB(g);} dispatchEvent( h){var g=null;if(h.sD||h.bubbles){for(u j=MP;j!=null;j=j.MP){if(j.rP(h.type,h.sD,h.bubbles)){if(g==null)g=mD.QG() as List<u>;g.add(j);}}}if(h.sD&&g!=null){for(int i=g.length-1;i>=0&&h.BE==false;i-- ){g[i].OP(h,this,g[i],pC.HF);}}if(h.BE==false){OP(h,this,this,pC.fD);}if(h.bubbles&&g!=null){for(int i=0;i<g.length&&h.BE==false;i++ ){g[i].OP(h,this,g[i],pC.OH);}}if(g!=null){g.clear();mD.SG(g);}} FQ( h){for(var g=h;g!=null;g=g.MP)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");MP=h;} iB( g);}abstract class PB extends u{var bI=false;var VB=true;var sJ=true;var tabIndex=0;static const  YH=const vB<t>(t.kD);static const  kH=const vB<t>(t.ZF);static const  pH=const vB<t>(t.hD);static const  vH=const vB<t>(t.bE);static const  EI=const vB<t>(t.fF); get onMouseOut=>PB.YH.forTarget(this); get onMouseMove=>PB.kH.forTarget(this); get onMouseDown=>PB.pH.forTarget(this); get onMouseUp=>PB.vH.forTarget(this); get onMouseWheel=>PB.EI.forTarget(this);static const  GI=const vB<XB>(XB.XF);static const  HI=const vB<XB>(XB.NF);static const  II=const vB<XB>(XB.RF); get onTouchMove=>PB.GI.forTarget(this); get onTouchEnd=>PB.HI.forTarget(this); get onTouchCancel=>PB.II.forTarget(this);static const  LI=const vB<VC>(VC.MF);static const  NI=const vB<VC>(VC.KF); get onKeyUp=>PB.LI.forTarget(this); get onKeyDown=>PB.NI.forTarget(this);static const  QI=const vB<JD>(JD.LF); get sI=>PB.QI.forTarget(this);}class EF{final  KM;final  TM;final  pM;final  xM;final  KN;final  YN;final  gN;final  pN;final  vN;final  CO;final  NO;EF.wJ( i, h, g):KM=i,TM=h,pM=oH(g["rotated"]),xM=EC(g["sourceSize"]["w"]),KN=EC(g["sourceSize"]["h"]),YN=EC(g["spriteSourceSize"]["x"]),gN=EC(g["spriteSourceSize"]["y"]),pN=EC(g["frame"]["x"]),vN=EC(g["frame"]["y"]),CO=EC(g["frame"]["w"]),NO=EC(g["frame"]["h"]); get FJ=>KM; get name=>TM; get CJ=>pM; get eI=>pN; get fI=>vN; get JG=>CO; get IG=>NO; get offsetX=>YN; get offsetY=>gN; get vI=>xM; get uI=>KN;}class UE extends bD implements mB{static const  IH='TIME_OUT';var PN=false;var cM=0.0;var rM=0.0;var AO;var GO=true;UE( g, i,[ h=bD.jD]):super(i,h){if(g<=0)throw new ArgumentError('Time must be greater than zero');rM=g;AG();} AC( g){if(PN&&ratio>0.0){ratio=ratio-g/FD;if(ratio==0.0)pause();}return true;} start(){PN=true;} pause(){PN=false;} reset([ g=0.0]){pause();g=WB.max(g,0.0);if(g!=0.0){rM=g;AG();}ratio=1.0;} qD( g, h){AO[g]=h/FD;} AG(){AO=new Map<String,num>();qD(UE.IH,0);} get FD=>rM; get BJ=>ratio*FD; set ratio( i){var h=ratio;super.ratio=i;if(GO){AO.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new BB(j));});}}}class DB implements PE{var JM;var VM;var jM;var tM;var zM;var LN;var WN;var fN;var qN;var xN;var EO;var KO;var QO;var TO;var aO;var NN;static var jF=new OE();DB( i, l,[ j=true, g=0xFFFFFFFF,k=1.0]){JM=EC(i);VM=EC(l);jM=j;tM=k.toDouble();zM=tM/oD;LN=((1.0-zM).abs()<0.001)?0:1;qN=0;xN=0;WN=JM;fN=VM;EO=0;KO=0;QO=(JM*zM).ceil();TO=(VM*zM).ceil();var h=new lC.CanvasElement(width:QO,height:TO);aO=h;NN=h.context2D;NN.fillStyle=jM?bF(g):OD(g);NN.fillRect(0,0,QO,TO);}DB.zJ( g,[ j=1.0]){var h=EC(g.naturalWidth);var i=EC(g.naturalHeight);jM=true;tM=wH(j);zM=tM;JM=(h/tM).round();VM=(i/tM).round();LN=((1.0-zM).abs()<0.001)?0:1;qN=0;xN=0;WN=JM;fN=VM;EO=0;KO=0;QO=h;TO=i;aO=g;}DB.AK( g){var h=g.FJ.MM;JM=g.vI.toInt();VM=g.uI.toInt();jM=true;tM=h.tM;zM=h.zM;LN=g.CJ?3:2;qN=g.offsetX;xN=g.offsetY;WN=g.JG;fN=g.IG;EO=(g.eI*zM).floor();KO=(g.fI*zM).floor();QO=(g.JG*zM).ceil();TO=(g.IG*zM).ceil();aO=h.aO;}static  DD( g,[ i=null, l=1.0]){if(i==null){i=DB.jF;}if(ZC.eE&&i.autoHiDpi){if(g.contains("@1x.")&&pD>=1.5){l=l*2.0;g=g.replaceAll("@1x.","@2x.");}}var j=new aB.Completer<DB>();var h=new lC.ImageElement();var k;var m;k=h.onLoad.listen((v){k.cancel();m.cancel();j.complete(new DB.zJ(h,l));});m=h.onError.listen((v){k.cancel();m.cancel();j.completeError(new StateError("Failed to load image."));});if(i.webp==false){h.src=g;return j.future;}JI.then(( o){var s=new RegExp(r"(png|jpg|jpeg)$",multiLine:false,caseSensitive:true);var n=s.firstMatch(g);if(o==false||n==null){h.src=g;}else{h.src=g.substring(0,g.length-n.group(1).length)+"webp";}});return j.future;} get width=>JM; get height=>VM; clone([ g]){g=(g!=null)?g:tM;var h=new DB(JM,VM,true,0,g);h.cI(this);return h;} cI( h,[ g=null]){uQ();g=(g==null)?new HB.xJ():g.clone();g.scale(zM,zM);var i=new xB.yJ(NN,g);h.iB(i);NN.globalAlpha=1.0;NN.globalCompositeOperation=gD.iD;} clear(){uQ();NN.setTransform(zM,0.0,0.0,zM,0.0,0.0);NN.clearRect(0,0,JM,VM);} iB( h){var g=h.context;switch (LN){case 0:g.drawImage(aO,qN,xN);break;case 1:g.drawImageScaled(aO,qN,xN,WN,fN);break;case 2:g.drawImageScaledFromSource(aO,EO,KO,QO,TO,qN,xN,WN,fN);break;case 3:g.transform(0.0,-1.0,1.0,0.0,qN,xN+fN);g.drawImageScaledFromSource(aO,EO,KO,TO,QO,0.0,0.0,fN,WN);break;}} TG( o, g){if(g.width==0||g.height==0)return;var i=o.context;if(LN!=0){uQ();}var h=(g.x-qN)*zM;var n=(g.y-xN)*zM;var s=g.width*zM;var k=g.height*zM;var l=g.x+qN;var j=g.y+xN;var v=g.width;var m=g.height;i.drawImageScaledFromSource(aO,h,n,s,k,l,j,v,m);} uQ(){if(NN==null){var g=tM/oD;var j=(JM*g).ceil();var i=(VM*g).ceil();var h=new lC.CanvasElement(width:j,height:i);var k=new HB(g,0.0,0.0,g,0.0,0.0);var l=new xB.yJ(h.context2D,k);this.iB(l);tM=tM;zM=g;LN=((1.0-zM).abs()<0.001)?0:1;qN=0;xN=0;WN=JM;fN=VM;EO=0;KO=0;QO=j;TO=i;aO=h;NN=h.context2D;}}}typedef  LD( ratio);typedef  AH<MD extends BB>( event);class IF<MD extends BB> extends aB.StreamSubscription<MD>{var EN=0;var QN=false;var hN;var tN;IF(this.hN,this.tN); get isPaused=>EN>0; onError( g(error)){} cancel(){hN.YI(this);} pause([ g]){EN++ ;if(g!=null){g.whenComplete(resume);}} resume(){if(EN==0){throw new StateError("Subscription is not paused.");}EN-- ;}}class MB implements mB{var HN;var cN;var kN=0.0;MB(){HN=new RE();cN=HN;} add( g){if(g is !mB){throw new ArgumentError("The supplied animatable does not extend type Animatable.");}if(this.contains(g)==false){var h=new RE();cN.gC=g;cN.uC=h;cN=h;}} remove( h){if(h!=null){var g=HN;while (identical(g,cN)==false){if(identical(g.gC,h)){g.gC=null;break;}g=g.uC;}}} contains( h){if(h!=null){var g=HN;while (identical(g,cN)==false){if(identical(g.gC,h))return true;g=g.uC;}}return false;} tE( g, i,[ h]){var j=h!=null?new fB(g,i,h):new fB(g,i);add(j);return j;} kB( h, i){var g=new SE(h,i);add(g);return g;} AC( j){kN+= j;var g=HN;var i=cN;while (identical(g,i)==false){var k=g.gC;if(k==null){var h=g.uC;g.gC=h.gC;g.uC=h.uC;if(identical(h,i))i=g;if(identical(h,cN))cN=g;}else if(k.AC(j)==false){g.gC=null;}else{g=g.uC;}}return true;}}class gD{static const  iD="source-over";} OD( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";} NH( g){if(VE.containsKey(g)==false){VE[g]=new mF(g);}return VE[g];}class PF extends cD{var TN;PF( g):super(BB.SF),TN=g;}class TF{static var iH=DF.cE;static var mH=new aB.StreamController<String>();static var qH=mH.stream.asBroadcastStream();static  get xH=>iH;}class wB{static const  aF="B";static const  cH="BL";static const  dF="BR";static const  GH="L";static const  gF="R";static const  hH="T";static const  lH="TR";static const  cE="";} bF( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class XC extends mB{final  XO;final  cO;final  iO;var oO;var sO;var vO;var yO;var rM;var cM;var EP;var HP;var JP;XC( h, i, j,[ g]):XO=h,cO=i,iO=(g!=null)?g:QB.YC{oO=h;cM=0.0;rM=WB.max(0.0001,j);EP=0.0;HP=false;JP=false;} AC( i){if(cM<rM||JP==false){cM=cM+i;if(cM>rM)cM=rM;if(cM>=0.0){if(JP==false){JP=true;if(sO!=null)sO();}var g=cM/rM;var h=iO(g);oO=XO+h*(cO-XO);if(vO!=null)vO(HP?oO.round():oO);if(yO!=null&&cM==rM)yO();}}return cM<rM;} get AE=>XO; get CE=>cO; get FD=>rM; get currentTime=>cM;set bC( g){if(JP==false)cM=cM+EP-g;EP=g;} set onStart( g()){sO=g;} set QC( g( value)){vO=g;} set onComplete( g()){yO=g;}}class cF extends cD{cF():super(BB.YF);}class xB{final  NN;var cM=0.0;var lO=0.0;var rO;var xO;xB.yJ( i,[ h]):NN=i{rO=new vC();xO=rO;var g=rO.matrix;if(h is HB){g.uD(h);}NN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);NN.globalAlpha=1.0;NN.globalCompositeOperation=gD.iD;} get context=>NN; get currentTime=>cM; get aI=>lO; reset([ i, h, j]){cM=(h is num)?h:0.0;lO=(j is num)?j:0.0;xO=rO;var g=rO.matrix;if(i is HB){g.uD(i);}NN.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);NN.clearRect(0,0,NN.canvas.width,NN.canvas.height);NN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);NN.globalAlpha=1.0;NN.globalCompositeOperation=gD.iD;} UG( h){var g=h.iP;var GB=h.SO;var k=h.fO;var j=h.CP;var o=h.FP;var m=xO as vC;var i=xO.pI as vC;xO=i;var n=i.matrix;var v=m.alpha.toDouble()*GB;var s=(o!=null)?o:m.tD;n.jE(g,m.matrix);i.alpha=v;i.tD=s;if(k!=null){if(k.kC==null){g=i.matrix;}else if(identical(k.kC,h)){g=i.matrix;}else if(identical(k.kC,h.parent)){g=m.matrix;}else{g=k.kC.sE(h);if(g==null)g=fE;else g.concat(i.matrix);}k.VI(this,g);}if(j!=null){if(j.kC==null){g=i.matrix;}else if(identical(j.kC,h)){g=i.matrix;}else if(identical(j.kC,h.parent)){g=m.matrix;}else{g=j.kC.sE(h);if(g==null)g=fE;else g.concat(i.matrix);}j.fJ(this,g);}var l=n;NN.setTransform(l.a,l.b,l.c,l.d,l.BC,l.CC);NN.globalCompositeOperation=s;NN.globalAlpha=v;if(h.XI){h.lQ(this);}else{h.iB(this);}if(j!=null){j.hJ();}if(k!=null){k.dI();}xO=m;}}class iF extends cD{iF():super(BB.hF);}class mF{var fontStyle;var rD=0;var kE=0;var height=0;mF( j){this.fontStyle=j;var h=new lC.Element.tag("span");h.style.font=this.fontStyle;h.text="Hg";var g=new lC.Element.tag("div");g.style.display="inline-block";g.style.width="1px";g.style.height="0px";var i=new lC.Element.tag("div");i.append(g);i.append(h);lC.document.body.append(i);try {g.style.verticalAlign="baseline";this.rD=g.offsetTop-h.offsetTop;g.style.verticalAlign="bottom";this.height=g.offsetTop-h.offsetTop;this.kE=height-rD;}catch (k){}finally {i.remove();}}}class QB{static  YC( g){return g;}static  wF( g){return g*g*g;}static  FC( g){g=1.0-g;return 1.0-g*g*g;}static  SI( g){if(g==0.0||g==1.0)return g;return WB.pow(2.0,-10.0*g)*WB.sin((g-0.3/4.0)*(2.0*WB.PI)/0.3)+1;}}class QD{static const  WE="auto";static const  rH="stop";static const  pF="once";} oH( g){if(g is bool){return g;}else{throw new ArgumentError("The supplied value (${g}) is not a bool.");}}final  oF=new dE<PF>();final  qF=new dE<cF>(); EC( g){if(g is int){return g;}else{throw new ArgumentError("The supplied value (${g}) is not an int.");}}class rF{var target=null;var aC=false;var iE=0;var SD=0;var NG,OG;var LG,MG;rF(this.NG,this.OG,this.LG,this.MG);}final  tF=new dE<iF>(); wH( g){if(g is num){return g;}else{throw new ArgumentError("The supplied value (${g}) is not a number.");}}class dE<MD extends cD>{final  NM=[] ;hE( g){NM.add(g);}dispatchEvent( g){var j=NM;var k=NM.length;for(int h=0;h<k;h++ ){var i=j[h];if(i.BP){g.hM=i.hM;g.oP=i.hM;g.mP=pC.fD;g.pP=false;g.tP=false;i.dispatchEvent(g);}else{j.removeAt(h);k-- ;h-- ;}}}}class yB{final  oE;var AE=double.NAN;var CE=double.NAN;yB(this.oE); cB( g){this.CE=g.toDouble();} get kI=>!AE.isNaN&&!CE.isNaN; vP( g){switch (oE){case 'x':return g.x;case 'y':return g.y;case 'pivotX':return g.RC;case 'pivotY':return g.SC;case 'scaleX':return g.lB;case 'scaleY':return g.rB;case 'skewX':return g.skewX;case 'skewY':return g.skewY;case 'rotation':return g.TB;case 'alpha':return g.alpha;default:return 0.0;}} KQ( g, h){switch (oE){case 'x':g.x=h;break;case 'y':g.y=h;break;case 'pivotX':g.RC=h;break;case 'pivotY':g.SC=h;break;case 'scaleX':g.lB=h;break;case 'scaleY':g.rB=h;break;case 'skewX':g.skewX=h;break;case 'skewY':g.skewY=h;break;case 'rotation':g.TB=h;break;case 'alpha':g.alpha=h;break;}}}class yH{static var zH=0;var DE=zH++ ;var target=null;var yD=false;yH(this.target,this.yD);} vF( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);var i=h.firstMatch(g);return i.group(1);}class eJ extends ME{final  CQ;eJ( i, g, h, j):CQ=new IB(i,g,h,j);jP(){NN.rect(CQ.x,CQ.y,CQ.width,CQ.height);}}class ZC extends rC{static var eE=RI;var dP;var NN;var GQ,IQ;var JQ;var LQ,NQ;var OQ;var PQ;var QQ;var RQ;var zL;var SQ;var TQ;var UQ;var VQ;var WQ;var XQ;var YQ;var ZQ;var aQ;var bQ;var cQ;var dQ;ZC( k, g,[ j, i, h]){if(g is !lC.CanvasElement){throw new ArgumentError("The canvas argument is not a CanvasElement");}if(g.tabIndex==-1)g.tabIndex=0;if(g.style.outline=="")g.style.outline="none";TM=k;dP=g;NN=g.context2D;GQ=(j!=null)?j:g.width;IQ=(i!=null)?i:g.height;JQ=(h!=null)?h:30;LQ=-1;NQ=-1;OQ=new IB.tJ();PQ=new HB.xJ();QQ=new HB.xJ();jQ();RQ=null;zL=new MB();TQ=new xB.yJ(NN);UQ=QD.WE;VQ=ID.VF;WQ=wB.cE;aQ=[new rF(t.hD,t.bE,t.fC,t.MH),new rF(t.jH,t.nH,t.lF,t.lF),new rF(t.sH,t.uH,t.nF,t.nF)];XQ=uB.YE;ZQ=null;YQ=new LB(0,0);cQ=new t(t.fC,true);nC.fH.listen(fH);dP.onMouseDown.listen(bO);dP.onMouseUp.listen(bO);dP.onMouseMove.listen(bO);dP.onMouseOut.listen(bO);dP.onMouseWheel.listen(mQ);bQ=new Map<int,yH>();dQ=new XB(XB.JF,true);TF.qH.listen(nQ);nQ(null);dP.onKeyDown.listen(oQ);dP.onKeyUp.listen(oQ);dP.onKeyPress.listen(oQ);} get qE=>RQ; get TD=>zL; get xD=>YQ; get focus=>SQ; get align=>WQ;qQ(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");}set x( g){qQ();}set y( g){qQ();}set RC( g){qQ();}set SC( g){qQ();}set lB( g){qQ();}set rB( g){qQ();}set skewX( g){qQ();}set skewY( g){qQ();}set TB( g){qQ();}set alpha( g){qQ();}set width( g){qQ();}set height( g){qQ();}mI( g, h){if(UQ==QD.WE||UQ==QD.pF){jQ();TQ.reset(QQ,g,h);iB(TQ);if(UQ==QD.pF)UQ=QD.rH;}}jQ(){var RB=dP.getBoundingClientRect();var ZB=dP.clientLeft+RB.left;var UB=dP.clientTop+RB.top;var h=dP.clientWidth;var j=dP.clientHeight;var o=GQ;var GB=IQ;if(h is !num)throw "dart2js_hint";if(j is !num)throw "dart2js_hint";if(o is !num)throw "dart2js_hint";if(GB is !num)throw "dart2js_hint";if(h==0||j==0)return;var i=1.0;var g=1.0;var k=0.0;var m=0.0;var n=h/o;var l=j/GB;switch (VQ){case ID.CH:i=n;g=l;break;case ID.KH:i=g=(n>l)?n:l;break;case ID.SH:i=g=1.0;break;case ID.VF:i=g=(n<l)?n:l;break;}switch (WQ){case wB.lH:case wB.gF:case wB.dF:k=(h-o*i);break;case wB.hH:case wB.cE:case wB.aF:k=(h-o*i)/2;break;}switch (WQ){case wB.cH:case wB.aF:case wB.dF:m=(j-GB*g);break;case wB.GH:case wB.cE:case wB.gF:m=(j-GB*g)/2;break;}var s=OQ;s.x=-k/i;s.y=-m/g;s.width=h/i;s.height=j/g;var v=(ZC.eE?pD:1.0)/oD;QQ.zD(i,0.0,0.0,g,k,m);QQ.scale(v,v);PQ.zD(1.0,0.0,0.0,1.0,-ZB-k,-UB-m);PQ.scale(1.0/i,1.0/g);if(LQ!=h||NQ!=j){LQ=h;NQ=j;dP.width=(LQ*v).round();dP.height=(NQ*v).round();if(dP.clientWidth!=h||dP.clientHeight!=j){dP.style.width="${h}px";dP.style.height="${j}px";}dispatchEvent(new BB(BB.gH));}}fH( g){dP.style.cursor=nC.uF(XQ);}bO( j){j.preventDefault();var n=new DateTime.now().millisecondsSinceEpoch;var s=j.button;var g=null;var i=PQ.HQ(j.client);var m=null;if(s<0||s>2)return;if(j.type=="mousemove"&&YQ.GG(i))return;var h=aQ[s];YQ=i;if(nC.QF!=null)nC.QF.nP();if(j.type!="mouseout")g=qB(i.x,i.y) as PB;var k=uB.YE;if(g is EB&&(g as EB).uE){k=uB.ZE;}if(g is yC&&(g as yC).uE){k=uB.ZE;}if(g is LC&&(g as LC).type==zC.ND){k=uB.WF;}if(XQ!=k){XQ=k;dP.style.cursor=nC.uF(k);}if(ZQ!=null&&ZQ!=g){ZQ.dispatchEvent(cQ..kP(t.kD,true)..DQ=(ZQ.dC!=null)?ZQ.jC(i):new LB.tJ()..EQ=i..qP=h.aC);ZQ=null;}if(g!=null&&g!=ZQ){g.dispatchEvent(cQ..kP(t.eF,true)..DQ=g.jC(i)..EQ=i..qP=h.aC);ZQ=g;}var l=null;var o=false;var v=false;if(j.type=="mousedown"){dP.focus();l=h.NG;if(g!=h.target||n>h.iE+500)h.SD=0;h.aC=true;h.target=g;h.iE=n;h.SD++ ;}if(j.type=="mouseup"){l=h.OG;h.aC=false;o=(h.target==g);v=o&&h.SD.isEven&&(n<h.iE+500);}if(j.type=="mousemove"){l=t.ZF;}if(l!=null&&g!=null){m=g.jC(i);g.dispatchEvent(cQ..kP(l,true)..DQ=m..EQ=i..qP=h.aC..xP=h.SD);if(o){if(v&&g.bI){g.dispatchEvent(cQ..kP(h.MG,true)..DQ=m..EQ=i..qP=h.aC);}else{g.dispatchEvent(cQ..kP(h.LG,true)..DQ=m..EQ=i..qP=h.aC);}}}}mQ( h){var g=PQ.HQ(h.client);var i=qB(g.x,g.y) as PB;if(i!=null){i.dispatchEvent(cQ..kP(t.fF,true)..DQ=i.jC(g)..EQ=g..yP=h.deltaX..zP=h.deltaY);if(cQ.BE)h.preventDefault();}}var vQ=[] ;nQ( h){vQ.forEach((g)=>g.cancel());if(TF.xH==DF.QH){vQ=[dP.onTouchStart.listen(wQ),dP.onTouchEnd.listen(wQ),dP.onTouchMove.listen(wQ),dP.onTouchEnter.listen(wQ),dP.onTouchLeave.listen(wQ),dP.onTouchCancel.listen(wQ)];}}wQ( j){j.preventDefault();for(var m in j.changedTouches){var l=m.identifier;var i=PQ.HQ(m.client);var h=qB(i.x,i.y) as PB;var g=bQ.containsKey(l)?bQ[l]:new yH(h,bQ.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(dQ..kP(XB.dH,true)..DQ=(g.target.dC!=null)?g.target.jC(i):new LB.tJ()..EQ=i..RP=g.DE..VP=g.yD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(dQ..kP(XB.ZH,true)..DQ=h.jC(i)..EQ=i..RP=g.DE..VP=g.yD);g.target=h;}var k=null;if(j.type=="touchstart"){dP.focus();bQ[l]=g;k=XB.JF;}if(j.type=="touchend"){bQ.remove(l);k=XB.NF;}if(j.type=="touchcancel"){bQ.remove(l);k=XB.RF;}if(j.type=="touchmove"){k=XB.XF;}if(k!=null&&h!=null){h.dispatchEvent(dQ..kP(k,true)..DQ=h.jC(i)..EQ=i..RP=g.DE..VP=g.yD);}}}oQ( g){if(g.keyCode==8){g.preventDefault();}if(SQ==null){return;}if(g.type=="keypress"){var j=g.charCode;var k=g.keyCode;if(k==13)j=13;if(j==0)return;var l=new JD(JD.LF,true)..CM=new String.fromCharCodes([j]);SQ.dispatchEvent(l);}else{var h=AD.BH;var i="";if(g.type=="keyup")i=VC.MF;if(g.type=="keydown")i=VC.KF;if(g.keyLocation==lC.KeyLocation.LEFT)h=AD.GH;if(g.keyLocation==lC.KeyLocation.RIGHT)h=AD.gF;if(g.keyLocation==lC.KeyLocation.NUMPAD)h=AD.RH;if(g.keyLocation==lC.KeyLocation.JOYSTICK)h=AD.UF;if(g.keyLocation==lC.KeyLocation.MOBILE)h=AD.UF;var m=new VC(i,true)..rN=g.altKey..zN=g.ctrlKey..HO=g.shiftKey..eO=g.charCode..jO=g.keyCode..nO=h;SQ.dispatchEvent(m);}}} CI( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";} FI(){var i=new aB.Completer<bool>();var g=new lC.ImageElement(); h(){i.complete(g.width==2&&g.height==2);}g.onLoad.listen((j)=>h());g.onError.listen((j)=>h());g.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";return i.future;}class fB implements mB{final  fQ;final  iO;final  gQ=new List<yB>();var sO;var vO;var yO;var hQ;var rM;var cM;var EP;var HP;var JP;fB( g, i,[ h=QB.YC]):fQ=g,iO=h{hQ=new FF(this);cM=0.0;rM=WB.max(0.0001,i);EP=0.0;HP=false;JP=false;} get gB=>hQ; IN( g){if(fQ!=null&&JP==false){gQ.add(g);}} complete(){if(rM>=cM)AC(rM-cM);} AC( m){if(cM<rM||JP==false){cM=cM+m;if(cM>rM){cM=rM;}if(cM>=0.0){if(JP==false){JP=true;for(int h=0;h<gQ.length;h++ ){var g=gQ[h];g.AE=g.vP(fQ);}if(sO!=null){sO();}}var k=cM/rM;var l=iO(k).toDouble();for(int h=0;h<gQ.length;h++ ){var g=gQ[h];if(g.kI){var i=g.AE.toDouble();var n=g.CE.toDouble();var j=i+l*(n-i);g.KQ(fQ,HP?j.round():j);}}if(vO!=null){vO();}if(yO!=null&&cM==rM){yO();}}}return cM<rM;} get FD=>rM; get currentTime=>cM;set bC( g){if(JP==false)cM=cM+EP-g;EP=g;} set onStart( g()){sO=g;} set QC( g()){vO=g;} set onComplete( g()){yO=g;}}final  JI=FI();final  mD=new zG<List<u>>(()=>new List<u>());final  fE=new HB.xJ();final  KI=new lC.CanvasElement(width:16,height:16); gE( g, m, n, j){m=m.toDouble();n=n.toDouble();var TC=0.0;var ZB=0.0;var v=m*g.a;var UB=m*g.b;var GB=m*g.a+n*g.c;var s=m*g.b+n*g.d;var RB=n*g.c;var o=n*g.d;var h=TC;if(h>v)h=v;if(h>GB)h=GB;if(h>RB)h=RB;var i=ZB;if(i>UB)i=UB;if(i>s)i=s;if(i>o)i=o;var l=TC;if(l<v)l=v;if(l<GB)l=GB;if(l<RB)l=RB;var k=ZB;if(k<UB)k=UB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new IB.tJ();j.x=g.BC+h;j.y=g.CC+i;j.width=l-h;j.height=k-i;return j;}final  nD=KI.context2D;final  oD=nD.backingStorePixelRatio==null?1.0:nD.backingStorePixelRatio.toDouble();final  pD=lC.window.devicePixelRatio==null?1.0:lC.window.devicePixelRatio;final  MI=((){var g=lC.window.navigator.userAgent.toLowerCase();return g.indexOf("iphone")>=0||g.indexOf("ipad")>=0||g.indexOf("ipod")>=0||g.indexOf("android")>=0||g.indexOf("webos")>=0||g.indexOf("windows phone")>=0;})();final  OI=lC.window.screen==null?1024:WB.max(lC.window.screen.width,lC.window.screen.height);final  RI=pD>1.0&&(!MI||OI>480);
//# sourceMappingURL=escape.dart.map
//@ sourceMappingURL=escape.dart.map
