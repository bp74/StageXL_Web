import "dart:html" as cC;import "dart:web_audio" as VF;import "dart:async" as FC;import "dart:json" as aH;import "dart:math" as RB;class bH{static const  cH="Chrome";static const  dH="Firefox";static const  eH="Internet Explorer";static const  fH="Safari";final  oG;final  GH;const bH(this.oG,[this.GH]);}class gH{final  name;const gH(this.name);}class vB{static const  sC=1;static const  dD=2;static const  eD=3;}class WF extends AB{var MI;var VI;var fI;var oI;var NI;var tI;var vI;var xI;var AJ;var KI;var EJ;var FJ;var GJ;var HJ;var JJ;var KJ;var LJ;var NJ;var OJ;WF(){var j=new CB(GB.KB.s("ShuffleButtonNormal"));var h=new CB(GB.KB.s("ShuffleButtonPressed"));VI=new tC(j,j,h,h);VI.addEventListener(v.XC,bJ);VI.x=530;VI.y=525;n(VI);var g=new CB(GB.KB.s("ExitButtonNormal"));var i=new CB(GB.KB.s("ExitButtonPressed"));fI=new tC(g,g,i,i);fI.addEventListener(v.XC,jJ);fI.x=700;fI.y=500;n(fI);MI=new ZF();MI.x=540;MI.y=-1000;n(MI);NI=new oD(10,GB.KB.s("TimeGauge"),KD.rD);NI.x=659;NI.y=244;NI.addEventListener("TimeShort",lJ);NI.addEventListener("TimeOver",gJ);n(NI);p.add(NI);tI=new XF();tI.x=640;tI.y=230;n(tI);vI=new aF();vI.x=665;vI.y=160;n(vI);xI=new LC();xI.QC=new WE("Arial",30,0xD0D0D0,AC:true,align:nB.MC);xI.width=140;xI.height=36;xI.wordWrap=false;xI.x=646;xI.y=130;xI.TB=false;xI.text="0";xI.tB=0.9;n(xI);AJ=new LC();AJ.QC=new WE("Arial",20,0xFFFFFF,AC:true,align:nB.MC);AJ.width=44;AJ.height=30;AJ.wordWrap=false;AJ.x=610;AJ.y=559;AJ.TB=false;AJ.text="3x";n(AJ);JJ=new AB();n(JJ);KJ=new AB();n(KJ);LJ=new AB();n(LJ);NJ=cB.KB.fB("Intro");OJ=NJ.play();} start(){KI=1;EJ=1;HJ=0;FJ=3;var g=new bD(dC.KB.pC("ESCStartText"));KJ.n(g);p.dB(()=>tI.IF(21),1);g.show(()=>p.dB(()=>qJ(),0.5));} qJ(){if(oI!=null&&this.contains(oI))JJ.sB(oI);var m=KI;var g=0;var h=0;switch (KI){case 01:h=50;oI=new bF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;oI=new bF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;oI=new bF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;oI=new bF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;oI=new bF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;oI=new bF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;oI=new bF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;oI=new bF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;oI=new bF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;oI=new bF(g=80+(KI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}GJ=g;if(FJ<3){FJ++ ;AJ.text="${FJ}x";}oI.addEventListener(ZB.PE,rJ);oI.addEventListener(ZB.DD,sJ);oI.addEventListener(ZB.QE,tJ);oI.addEventListener(ZB.gD,uJ);oI.x=20;oI.y=16;oI.TB=false;JJ.n(oI);NI.reset(h);NI.QD("TimeShort",9);NI.QD("TimeOver",0);NI.pause();MI.level=m;MI.tE=g;MI.y=-210;var k=new jB(MI,0.4,LB.qB);k.VB("y",-90);p.add(k);var j=new bD(dC.KB.pC("ESCLevelBoxText").replaceAll("{0}","${g}"));KJ.n(j);j.show((){oI.TB=true;NI.start();if(NJ!=null){var i=new NC(1.0,0.0,4.0,LB.OC);i.HC=(l){OJ.CC.volume=l;OJ.CC=OJ.CC;};i.onComplete=(){OJ.stop();tI.HH();};p.add(i);NJ=null;}});} lJ( g){vI.start();} gJ( g){oI.TF(vB.eD);} sJ( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new OE(g);i.x=k.x;i.y=k.y;JJ.n(i);HJ=HJ+g;xI.text="${HJ}";} rJ( j){var g=GJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;GJ=g;MI.tE=g;if(g==0)oI.TF(vB.dD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}HJ=HJ+h*k;xI.text="${HJ}";} tJ( m){NI.pause();vI.stop();var l=cB.KB.fB("Laugh");var k=cB.KB.fB("LevelUp");l.play();tI.IF(3);var g=GB.dF();g.x=55;g.y=260;JJ.n(g);p.dB((){oI.zE();k.play();},2.0);p.dB((){var j=(NI.QH*1000).toInt();var h=new OE(j);h.x=704;h.y=360;JJ.n(h);HJ=HJ+j;xI.text="${HJ}";},2.5);var i=new jB(MI,0.5,LB.qB);i.VB("y",-210);i.RC=3.0;p.add(i);p.dB((){JJ.sB(g);},3.5);p.dB((){KI++ ;qJ();},4.0);} uJ( j){vI.stop();oI.zE();var g;var i;if(EJ>0){EJ-- ;g=new bD(dC.KB.pC("GEN2ndchancetime"));KJ.n(g);i=cB.KB.fB("LevelUp");i.play();g.show((){p.dB(()=>qJ(),0.5);var h=new jB(MI,0.5,LB.qB);h.VB("y",-210);p.add(h);});}else{g=new bD(dC.KB.pC("GENtimeup"));KJ.n(g);i=cB.KB.fB("GameOver");i.play();g.show((){p.dB(()=>xJ(),0.5);var h=new jB(MI,0.5,LB.qB);h.VB("y",-210);p.add(h);});}} bJ( h){if(oI!=null&&FJ>0){var g=oI.PF();if(g){FJ=FJ-1;AJ.text="${FJ}x";}}} jJ( j){var h=new AB();h.n(new CB(new DB(800,600,false,0x000000)));h.alpha=0.6;LJ.n(h);var g=new YF();g.x=235;g.y=150;LJ.n(g);g.show(( i){LJ.sB(g);if(i==false)LJ.sB(h);else zJ(false);});}xJ(){var h=new AB();var j=new CB(GB.KB.s("ExitBox"));h.n(j);var g=new LC();g.QC=new WE("Arial",30,0xFFFFFF,AC:true,align:nB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=dC.KB.pC("GENgameover");g.x=47;g.y=30+(g.height-g.KE)/2;g.TB=false;h.n(g);h.x=110;h.y=-h.height;KJ.n(h);var k=cB.KB.fB("Laugh");p.dB(()=>k.play(),0.3);var i=new jB(h,0.3,LB.qB);i.VB("y",150);p.add(i);p.dB(()=>zJ(true),5.0);h.addEventListener(v.XC,( l)=>zJ(true));}var BK=false; zJ( g){NI.pause();if(BK==false){BK=true;}}}class GB{static var KB;static  fD( i, h){var g=new CB(KB.SC("Elements").s("Chain${i}${h}"));g.UC=25;g.VC=25;return g;}static  cF( i, h){var g=new CB(KB.SC("Elements").s("Link${i}${h}"));g.UC=25;g.VC=25;return g;}static  hD( h){var g=new CB(KB.SC("Elements").s(h));g.UC=25;g.VC=25;return g;}static  dF(){var m=new AB();var l=0;var o=KB.SC("Levelup");for(int k=0;k<7;k++ ){var g=new CB(o.s("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new AB();h.n(g);h.x=l+g.width/2;h.tB=0;h.BC=0;m.n(h);var i=new jB(h,2.0,LB.lG);i.VB("scaleX",1.0);i.VB("scaleY",1.0);i.RC=k*0.05;var j=new jB(h,0.4,LB.OC);j.VB("scaleX",0.0);j.VB("scaleY",0.0);j.RC=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  fF( h){var i=KB.SC("Elements");var g=new List<DB>();g.add(i.s("JokerChain${h}0"));g.add(i.s("JokerChain${h}1"));g.add(i.s("JokerChain${h}2"));g.add(i.s("JokerChain${h}3"));g.add(i.s("JokerChain${h}4"));return g;}static  gF( h){var i=KB.SC("Elements");var g=new List<DB>();g.add(i.s("JokerLink${h}0"));g.add(i.s("JokerLink${h}1"));g.add(i.s("JokerLink${h}2"));g.add(i.s("JokerLink${h}3"));g.add(i.s("JokerLink${h}4"));return g;}static  hF( h){var i=KB.SC("Locks");var g=new List<DB>();g.add(i.s("Lock${h}0"));g.add(i.s("Lock${h}1"));g.add(i.s("Lock${h}2"));g.add(i.s("Lock${h}3"));g.add(i.s("Lock${h}4"));return g;}static  iF(){var h=KB.SC("Head");var g=new List<DB>();g.add(h.s("Head1"));g.add(h.s("Head2"));g.add(h.s("Head3"));g.add(h.s("Head2"));g.add(h.s("Head1"));return g;}static  jF(){var h=KB.SC("Alarm");var g=new List<DB>();g.add(h.s("Alarm0"));g.add(h.s("Alarm1"));g.add(h.s("Alarm2"));g.add(h.s("Alarm3"));g.add(h.s("Alarm4"));g.add(h.s("Alarm5"));return g;}}class JB{var II;var JI;var TI;var ZI;var eI;var gI;var nI;var rI;var uI;var yI;var BJ;JB( h, g){II=h;JI=g;TI=t.CD;ZI=-1000;eI=-1000;gI=false;nI=false;rI=false;uI=null;yI=null;BJ=null;} get color=>II; set color( g){II=g;} get direction=>JI; set direction( g){JI=g;} get FB=>TI; set FB( g){TI=g;} get aB=>gI; set aB( g){gI=g;} get GC=>nI; set GC( g){nI=g;} get empty=>rI; set empty( g){rI=g;} SD( g){var h=g!=null&&(g.color==II||g.FB==t.OB||TI==t.OB)&&g.FB!=t.wB&&TI!=t.wB;return h;} aC( g){var h=g!=null&&(g.color==II||g.FB==t.OB||TI==t.OB)&&g.direction==0&&JI==0&&g.FB!=t.wB&&TI!=t.wB;return h;} hC( g){var h=g!=null&&(g.color==II||g.FB==t.OB||TI==t.OB)&&g.direction==1&&JI==1&&g.FB!=t.wB&&TI!=t.wB;return h;} get x=>ZI; set x( g){ZI=g;if(uI!=null)uI.x=g;if(yI!=null)yI.x=g;if(BJ!=null)BJ.x=g;} get y=>eI; set y( g){eI=g;if(uI!=null)uI.y=g;if(yI!=null)yI.y=g;if(BJ!=null)BJ.y=g;} set QF( h){if(uI!=null){var g=1+0.3*RB.sin(h*RB.PI);uI.tB=g;uI.BC=g;}} gB( g, h, i){if(uI!=null){uI.parent.sB(uI);uI=null;}if(yI!=null){yI.parent.sB(yI);yI=null;}if(BJ!=null){BJ.parent.sB(BJ);BJ=null;}if(empty==false){switch (TI){case t.OB:uI=new hH(JI);uI.x=ZI;uI.y=eI;g.n(uI);break;case t.wB:uI=GB.hD(t.wB);uI.x=ZI;uI.y=eI;g.n(uI);break;default:uI=GB.fD(II,JI);uI.x=ZI;uI.y=eI;g.n(uI);break;}if(gI){yI=nI?new iH(JI):GB.cF(II,JI);yI.x=ZI+((JI==0)?25:0);yI.y=eI+((JI==1)?25:0);h.n(yI);}switch (TI){case t.CD:break;case t.wB:break;case t.OB:break;default:BJ=new jH(TI);BJ.x=ZI;BJ.y=eI;i.n(BJ);break;}}}}class XF extends AB{var OI;var YI;var lI;XF(){OI=GB.iF();YI=new CB(OI[0]);YI.x=-YI.width/2;YI.y=-YI.height/2;n(YI);lI=null;} IF( g){p.remove(lI);lI=new NC(0,g,0.5*g,LB.OC);lI.HC=(h){var i=((h*OI.length)%OI.length).toInt();YI.QB=OI[i];YI.y=RB.sin(h*2*RB.PI)*3-YI.height/2;};p.add(lI);} HH(){p.remove(lI);YI.QB=OI[0];}}class BD extends AB{var II;var SI;var cI;var mI;BD( g){II=g;cI=GB.hF(g);mI=true;SI=new CB(cI[0]);SI.x=-34;SI.y=-50;n(SI);} get AD=>mI; set AD( g){mI=g;} OF( g){SI.QB=cI[g?0:4];} TH(){var i=new NC(0.0,1.0,2.0,LB.qB);i.HC=(j){tB=BC=1.0+0.2*RB.sin(j*4*RB.PI);};var g=new jB(this,0.2,LB.qB);g.VB("alpha",0.0);g.RC=2.0;g.onComplete=()=>OF(mI);var h=new jB(this,0.2,LB.pE);h.VB("alpha",1);h.RC=2.2;p.add(i);p.add(g);p.add(h);}}class bD extends AB{var QI;var XI;bD( h){var i=new CB(GB.KB.s("MessageBox"));n(i);var g=new LC();g.QC=new WE("Arial",24,0xFFFFFF,AC:true,align:nB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.KE/2;g.TB=false;n(g);QI=null;addEventListener(v.XC,UJ);}void show( h){this.parent.n(this);this.x=-this.width;this.y=150;XI=h;var g=new jB(this,0.3,LB.qB);g.VB("x",110);g.onComplete=()=>QI=p.dB(iJ,10);p.add(g);} iJ(){if(QI!=null){p.remove(QI);QI=null;XI();var g=new jB(this,0.4,LB.pE);g.VB("x",800);g.onComplete=()=>this.parent.sB(this);p.add(g);}} UJ( g){iJ();}}class cD{var sE;var RF;var SF;var angle;var UF;var WB;}class hH extends AB implements hB{var SI;var iI;var dI;hH( g){this.TB=false;dI=0.0;iI=GB.fF(g);SI=new CB(iI[0]);SI.x=-25;SI.y=-25;n(SI);addEventListener(BB.uC,(h)=>p.add(this));addEventListener(BB.wC,(h)=>p.remove(this));} zB( g){dI+= g;var h=(dI*10).toInt()%iI.length;SI.QB=iI[h];return true;}}class iH extends AB implements hB{var SI;var iI;var dI;iH( g){this.TB=false;dI=0.0;iI=GB.gF(g);SI=new CB(iI[0]);SI.x=-25;SI.y=-25;n(SI);addEventListener(BB.uC,(h)=>p.add(this));addEventListener(BB.wC,(h)=>p.remove(this));} zB( g){dI+= g;var h=(dI*10).toInt()%iI.length;SI.QB=iI[h];return true;}}class jH extends AB implements hB{var SI;var dI;jH( h){this.TB=false;dI=0.0;SI=GB.hD(h);n(SI);addEventListener(BB.uC,(g)=>p.add(this));addEventListener(BB.wC,(g)=>p.remove(this));} zB( g){dI+= g;this.WB=RB.sin(dI*7)*10*RB.PI/180;return true;}}class rC{var value=0; VD([ inc=1])=>(value+= inc); xE([ dec=1])=>(value-= dec);}class ZF extends AB{var KI;var UI;var bI;var jI;var pI;ZF(){n(new CB(GB.KB.s("InfoBox")));UI=new LC();UI.QC=new WE("Arial",35,0xFFFFFF,AC:true,align:nB.MC);UI.width=220;UI.height=40;UI.wordWrap=false;UI.text="Level 1";UI.x=20;UI.y=115;UI.WB=-2*RB.PI/180;n(UI);jI=new LC();jI.QC=new WE("Arial",25,0xFFFFFF,AC:true,align:nB.MC);jI.width=220;jI.height=30;jI.wordWrap=false;jI.text="40";jI.x=-jI.width/2;jI.y=-jI.height/2;jI.WB=-2*RB.PI/180;pI=new AB();pI.n(jI);pI.x=150;pI.y=172;n(pI);var g=GB.fD(3,0);g.x=110;g.y=171;g.WB=-2*RB.PI/180;g.tB=g.BC=0.6;n(g);} set level( g){KI=g;UI.text="Level ${KI}";} set tE( g){bI=g;jI.text="${bI}";}}class dC{static var KB;}class cB{static var KB;}class ZB extends BB{static const  PE="Explosion";static const  DD="Unlocked";static const  QE="Finalized";static const  gD="Timeouted";var CJ;ZB( h, g,[ bubbles=false]):super(h,bubbles){CJ=g;} get info{return CJ;}}class aF extends AB{var RI;var aI;var kI;var qI;var sI;aF(){kI=cB.KB.fB("Warning");qI=null;RI=GB.jF();aI=new CB(RI[0]);n(aI);} start(){qI=kI.play();p.remove(sI);sI=new NC(0,80,9.0,LB.OC);sI.HC=(h){var g=h.toInt()%8;aI.QB=RI[(g<=4)?g+1:8-g];};p.add(sI);} stop(){if(qI!=null){qI.stop();qI=null;}p.remove(sI);aI.QB=RI[0];}}class bF extends AB{var wI;var DJ;var IJ;var MJ;var PJ;var QJ;var RJ;var SJ;var TJ;var VJ;var WJ;var XJ;var YJ;var ZJ;var aJ;var cJ;var dJ;var eJ;var fJ;var hJ;bF( u, q, HB, m, o, EB, k){SJ=new RB.Random();TJ=vB.sC;VJ=k;wI=u;DJ=q;IJ=HB;MJ=m;PJ=o;QJ=EB;RJ=k.length;ZJ=new List<MB>();cJ=new AB();dJ=new AB();eJ=new AB();fJ=new AB();hJ=new AB();n(cJ);n(dJ);n(eJ);n(fJ);n(hJ);dJ.TB=false;eJ.TB=false;fJ.TB=false;hJ.TB=false;AH();BH();zG();aJ=true;var l=new rC();this.mask=new pF.DI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=XJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.gB(cJ,dJ,eJ);var j=new NC(i.y,h*50+25,0.4,LB.qB);j.RC=g*0.03;j.HC=(NB){i.y=NB;};j.onComplete=(){if(l.VD()==100){oJ();aJ=false;ZJ.clear();this.mask=null;}};p.add(j);}}addEventListener(v.vD,pJ);} TF( g){if(g==vB.dD)TJ=g;if(g==vB.eD&&TJ==vB.sC){TJ=g;if(aJ==false)dispatchEvent(new ZB(ZB.gD,null));}} zE(){this.mask=new pF.DI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=XJ[i+h*10];g.aB=false;g.GC=false;g.FB=t.CD;g.gB(cJ,dJ,eJ);var j=new NC(g.y,500+h*50+25,0.5,LB.qB);j.RC=i*0.1;j.HC=(k){g.y=k;};p.add(j);}}} AH(){YJ=new List<BD>();for(int h=0;h<DJ;h++ ){var g=new BD(h);g.WB=(SJ.nextInt(30)-15)*RB.PI/180;g.x=300-(90*DJ)/2+h*90+SJ.nextInt(20)-10;g.y=550;YJ.add(g);fJ.n(g);}} wE( g, h){var i=0;var j=XJ[g+h*10];if(j.direction==0){var l=(g>0)?XJ[g-1+h*10]:null;var m=(g<9)?XJ[g+1+h*10]:null;if(j.aC(l))i++ ;if(j.aC(m))i++ ;}else{var k=(h>0)?XJ[g+(h-1)*10]:null;var o=(h<9)?XJ[g+(h+1)*10]:null;if(j.hC(k))i++ ;if(j.hC(o))i++ ;}return i;} vE(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=XJ[g+h*10];var i=RJ*2;while (wE(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<VJ.length;j++ )if(k.color==VJ[j])m=j;k.color=VJ[(m+1)%VJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(wE(g,h)==2);return l;} KF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(XJ[(h-1)+g*10].SD(XJ[h+g*10])&&XJ[h+g*10].SD(XJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(XJ[h+(g-1)*10].SD(XJ[h+g*10])&&XJ[h+g*10].SD(XJ[h+(g+1)*10]))return true;return false;} vJ( k, l, j){for(int h=0;h<20;h++ ){var g=wI~/j;var i=l*g+SJ.nextInt(g);if(WJ[i].FB==t.CD){WJ[i].FB=k;return;}}} BH(){WJ=new List<JB>();for(int g=0;g<wI;g++ ){var i=VJ[SJ.nextInt(VJ.length)];var h=SJ.nextInt(2);WJ.add(new JB(i,h));}for(int g=0;g<DJ*2;g++ )vJ("Lock${(g%DJ)+1}",g,DJ*2);for(int g=0;g<IJ;g++ )vJ(t.OB,g,IJ);for(int g=0;g<MJ;g++ )vJ(t.wB,g,MJ);for(int g=0;g<PJ;g++ )vJ(t.RE,g,PJ);for(int g=0;g<QJ;g++ )vJ(t.SE,g,QJ);} zG(){XJ=new List<JB>();var g=true;while (g){XJ.clear();for(int h=0;h<100;h++ ){var j=VJ[SJ.nextInt(VJ.length)];var i=SJ.nextInt(2);XJ.add(new JB(j,i));}g=vE();}} PF(){if(aJ||TJ!=vB.sC)return false;var l=true;aJ=true;while (l){for(int k=0;k<XJ.length;k++ ){var g=XJ[k];g.aB=false;g.GC=false;g.gB(cJ,dJ,eJ);g.color=VJ[SJ.nextInt(VJ.length)];g.direction=SJ.nextInt(2);}l=vE()||(KF()==false);}var q=cB.KB.fB("BonusUniversal");q.play();var m=new rC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=XJ[i+j*10];g.QF=0.0;var h=new NC(0.0,1.0,0.2,LB.OC);h.RC=i*0.06;h.HC=(o){g.QF=o;};h.onStart=(){g.gB(cJ,dJ,eJ);};h.onComplete=(){if(m.VD()==100){oJ();wJ();ZJ.clear();}};p.add(h);}}return true;} oJ(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=XJ[h+i*10];var l=(h<9)?XJ[h+1+i*10]:null;var m=(i<9)?XJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.aC(l)){j=true;k=(g.FB==t.OB||l.FB==t.OB);}if(g.hC(m)){j=true;k=(g.FB==t.OB||m.FB==t.OB);}if(g.aB!=j||g.GC!=k){g.aB=j;g.GC=k;g.gB(cJ,dJ,eJ);}}}} yJ( o, l, q, k, m, u){aJ=true;o.VD(k);var i=1;for(int h=0;h<k;h++ ){var g=XJ[l+h*m+(q+h*u)*10];if(g.FB==t.RE)i=i*2;if(g.FB==t.SE)i=i*5;var HB=l+h*m;var NB=q+h*u;p.dB((){g.empty=true;g.gB(cJ,dJ,eJ);var EB=cB.KB.fB("ChainBlast");EB.play();var j=new PE(g.color,g.direction);j.x=HB*50;j.y=NB*50;p.add(j);hJ.n(j);NH(g);if(o.xE()==0)AK();},0.1+h*0.1);}dispatchEvent(new ZB(ZB.PE,{"Length":k,"Factor":i}));} wJ(){aJ=false;var j=new rC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&XJ[i+g-1+h*10].aC(XJ[i+g+h*10]))g++ ;if(g>=3)yJ(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&XJ[i+(h+g-1)*10].hC(XJ[i+(h+g)*10]))g++ ;if(g>=3)yJ(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(TJ==vB.dD)dispatchEvent(new ZB(ZB.QE,null));if(TJ==vB.eD)dispatchEvent(new ZB(ZB.gD,null));if(TJ==vB.sC&&KF()==false)PF();}} NH( h){if(h.FB.indexOf("Lock")==0){var k=int.parse(h.FB.substring(4,5))-1;var j=YJ[k];var g=GB.hD(h.FB);g.x=h.x;g.y=h.y;n(g);var i=new jB(g,0.5,LB.qB);i.VB("x",j.x);i.VB("y",j.y-10);i.onComplete=()=>sB(g);p.add(i);p.dB(()=>IH(k),0.5);}} IH( k){var h=YJ[k];var i;if(h.AD){i=new ZB(ZB.DD,{"Type":"SingleLocked","Position":new MB(h.x+20,h.y)});var m=cB.KB.fB("Unlock");m.play();}else{i=new ZB(ZB.DD,{"Type":"SingleUnlocked","Position":new MB(h.x+20,h.y)});}dispatchEvent(i);h.AD=false;h.OF(false);var j=true;for(int g=0;g<YJ.length;g++ )j=j&&(YJ[g].AD==false);if(j){var l=cB.KB.fB("BonusAllUnlock");l.play();for(int g=0;g<YJ.length;g++ ){YJ[g].AD=true;p.dB(()=>YJ[(g+k)%YJ.length].TH(),g*0.2);}p.dB(()=>dispatchEvent(new ZB(ZB.DD,{"Type":"All","Position":new MB(280,550)})),0.75);}} AK(){var o=new rC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&XJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&XJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=XJ[i+j*10];if(i>0){l=XJ[i-1+j*10];if(h.aC(l)){l.aB=false;l.gB(cJ,dJ,eJ);}}h.aB=false;h.empty=true;h.gB(cJ,dJ,eJ);}else{if(WJ.length>0){h=WJ[0];WJ.removeRange(0,1);}else{h=new JB(VJ[SJ.nextInt(VJ.length)],SJ.nextInt(2));}}g=XJ[i+k*10];g.color=h.color;g.direction=h.direction;g.FB=h.FB;g.aB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.gB(cJ,dJ,eJ);o.VD();var m=new NC(g.y,50*k+25,0.1,LB.OC);m.HC=(q){g.y=q;};m.onComplete=(){if(o.xE()==0){oJ();wJ();CK();}};p.add(m);}}}} pJ( g){if(g.target==cJ&&this.TB){var j=RB.min(g.CF/50,9).toInt();var h=RB.min(g.DF/50,9).toInt();var i=new MB(j,h);ZJ.add(i);CK();}} CK(){while (TJ==vB.sC&&aJ==false&&ZJ.length>0){var q=ZJ[0];ZJ.removeRange(0,1);var j=q.x.toInt();var k=q.y.toInt();var g=XJ[j+k*10];var h=(j>0)?XJ[j-1+k*10]:null;var o=(j<9)?XJ[j+1+k*10]:null;var i=(k>0)?XJ[j+(k-1)*10]:null;var m=(k<9)?XJ[j+(k+1)*10]:null;var l=false;if(g.FB==t.wB){var u=cB.KB.fB("ChainError");u.play();continue;}if(g.hC(i)){i.aB=false;i.gB(cJ,dJ,eJ);}if(g.aC(h)){h.aB=false;h.gB(cJ,dJ,eJ);}g.direction=1-g.direction;g.aB=false;g.GC=false;var EB=cB.KB.fB("ChainRotate");EB.play();if(g.aC(o)){g.aB=true;g.GC=(g.FB==t.OB||o.FB==t.OB);}if(g.hC(m)){g.aB=true;g.GC=(g.FB==t.OB||m.FB==t.OB);}g.gB(cJ,dJ,eJ);l=l||g.aB;if(g.hC(i)){i.aB=true;i.GC=(g.FB==t.OB||i.FB==t.OB);i.gB(cJ,dJ,eJ);l=true;}if(g.aC(h)){h.aB=true;h.GC=(g.FB==t.OB||h.FB==t.OB);h.gB(cJ,dJ,eJ);l=true;}if(l){var HB=cB.KB.fB("ChainLink");HB.play();}wJ();}}}class YF extends AB{var NI;var WI;var hI;var XI;YF(){var m=new CB(GB.KB.s("ExitBox"));n(m);var g=new LC();g.QC=new WE("Arial",24,0xFFFFFF,AC:true,align:nB.MC);g.width=240;g.height=100;g.wordWrap=true;g.text=dC.KB.pC("GENexitquery");g.x=47;g.y=150-g.KE/2;g.TB=false;n(g);NI=new oD(7,GB.KB.s("ExitGauge"),KD.xD);NI.x=268;NI.y=25;NI.addEventListener("TimeOver",gJ);n(NI);NI.QD("TimeOver",0);NI.start();var i=new CB(GB.KB.s("ExitYesButtonNormal"));var j=new CB(GB.KB.s("ExitYesButtonPressed"));WI=new tC(i,i,j,j);WI.x=68;WI.y=239;WI.addEventListener(v.XC,kJ);n(WI);var h=new CB(GB.KB.s("ExitNoButtonNormal"));var k=new CB(GB.KB.s("ExitNoButtonPressed"));hI=new tC(h,h,k,k);hI.x=173;hI.y=232;hI.addEventListener(v.XC,mJ);n(hI);this.addEventListener(BB.uC,(l)=>p.add(NI));this.addEventListener(BB.wC,(l)=>p.remove(NI));} nJ( g){if(XI!=null){XI(g);XI=null;}} kJ( g){nJ(true);} mJ( g){nJ(false);} gJ( g){nJ(false);}show( g){XI=g;}}class t{static const  CD="None";static const  OB="Joker";static const  wB="Block";static const  RE="Double";static const  SE="Quint";}class OE extends AB{var LI;OE( j){var g=new LC();g.QC=new WE("Arial",30,0xFFFFFF,AC:true,align:nB.MC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.TB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;LI=new AB();LI.n(g);n(LI);var i=new NC(0.0,1.0,1.5,LB.qB);i.HC=(h){LI.alpha=1-h;LI.y=-h*50;LI.tB=1.0+0.1*RB.sin(h*10);LI.BC=1.0+0.1*RB.cos(h*10);};i.onComplete=(){this.HE();};p.add(i);}}class PE extends AB implements hB{var zI;var dI;PE( q, o){zI=new List<cD>();dI=0.0;this.TB=false;var u=GB.fD(q,o);var m=new RB.Random();var i;var l;var EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=RB.PI*1.15;WB=-RB.PI*2;}if(g==1&&h==0){i=RB.PI*1.85;WB=RB.PI*2;}if(g==1&&h==1){i=RB.PI*0.15;WB=RB.PI*2;}if(g==0&&h==1){i=RB.PI*0.85;WB=-RB.PI*2;}i=i+0.2*RB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new CB(u.QB);j.RD=new PB(g*25,h*25,25,25);j.UC=12.5+g*25;j.VC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);var k=new cD();k.sE=j;k.RF=g*25+12.5;k.SF=h*25+12.5;k.angle=i;k.UF=l;k.WB=WB;zI.add(k);}}} zB( m){dI=RB.min(0.8,dI+m);var u=981.0;for(int h=0;h<zI.length;h++ ){var g=zI[h];var i=g.sE;var j=g.angle;var k=g.UF;var l=g.WB;var o=g.RF+dI*(RB.cos(j)*k);var q=g.SF+dI*(RB.sin(j)*k+dI*u*0.5);i.x=o;i.y=q;i.WB=dI*l;}if(dI>=0.6)this.alpha=(0.8-dI)/0.2;if(dI>=0.8)this.HE();return (dI<0.8);}}var ED;var eC;var FD;var p;var WC;var GD;var xB; main(){ED=new oC("StageBackground",cC.query('#stageBackground'));eC=new oC("StageForeground",cC.query('#stageForeground'));FD=new mF();FD.rE(ED);FD.rE(eC);p=FD.DH;var g=DB.qE("images/Loading.png");g.then((h){WC=new CB(h);WC.UC=20;WC.VC=20;WC.x=400;WC.y=270;eC.n(WC);GD=new jB(WC,100,LB.OC);GD.VB("rotation",100.0*2.0*RB.PI);p.add(GD);xB=new LC();xB.QC=new WE("Arial",20,0xA0A0A0,AC:true);xB.width=240;xB.height=40;xB.text="... loading ...";xB.x=400-xB.VH/2;xB.y=320;xB.TB=false;eC.n(xB);eF();});} eF(){var g=new jC();g.eB("Background","images/Background.jpg");g.eB("ExitBox","images/ExitBox.png");g.eB("ExitButtonNormal","images/ExitButtonNormal.png");g.eB("ExitButtonPressed","images/ExitButtonPressed.png");g.eB("ExitGauge","images/ExitGauge.png");g.eB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.eB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.eB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.eB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.eB("InfoBox","images/InfoBox.png");g.eB("MessageBox","images/MessageBox.png");g.eB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.eB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.eB("TimeGauge","images/TimeGauge.png");g.yC("Alarm","images/AlarmTextureAtlas.json",gC.nC);g.yC("Head","images/HeadTextureAtlas.json",gC.nC);g.yC("Elements","images/ElementsTextureAtlas.json",gC.nC);g.yC("Levelup","images/LevelupTextureAtlas.json",gC.nC);g.yC("Locks","images/LocksTextureAtlas.json",gC.nC);g.YB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.YB("BonusUniversal","sounds/BonusUniversal.mp3");g.YB("ChainBlast","sounds/ChainBlast.mp3");g.YB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.YB("ChainError","sounds/ChainError.mp3");g.YB("ChainFall","sounds/ChainFall.mp3");g.YB("ChainHelp","sounds/ChainHelp.mp3");g.YB("ChainLink","sounds/ChainLink.mp3");g.YB("ChainRotate","sounds/ChainRotate.mp3");g.YB("Click","sounds/Click.mp3");g.YB("GameOver","sounds/GameOver.mp3");g.YB("Laugh","sounds/Laugh.mp3");g.YB("LevelUp","sounds/LevelUp.mp3");g.YB("PointsCounter","sounds/PointsCounter.mp3");g.YB("Unlock","sounds/Unlock.mp3");g.YB("Warning","sounds/Warning.mp3");g.YB("Intro","sounds/Intro.mp3");g.kB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.kB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.kB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.kB("ESCBlockErrorHint","Sorry but block chains canÂ´t be twisted!");g.kB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.kB("ESCNoActionHint","Press on the chain links to twist them.");g.kB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.kB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.kB("ESCtogo","Chain links:");g.kB("GENexitquery","Do you really want to quit the game?");g.kB("GEN2ndchancetime","Time is up. Second chance!");g.kB("GENtimeup","Sorry! Your time is up.");g.kB("GENgameover","Game Over");g.load().then((j){eC.sB(WC);eC.sB(xB);p.remove(GD);GB.KB=g;cB.KB=g;dC.KB=g;var i=new CB(GB.KB.s("Background"));ED.n(i);ED.PH=kC.uD;var h=new WF();eC.n(h);h.start();});}class oF{static const  AG="pixel";}class qF{static const  FG="none";}class nB{static const  MC="center";static const  DG="end";static const  LG="justify";static const  HG="right";}class lH extends JC{var WK;var lK;lH( i, h, g){WK=h;lK=g;} get CC=>lK; set CC( g){lK=g;} stop(){}}class rF{static const  uF="dynamic";}class oB{static const  pD="auto";static const  sD="arrow";static const  tD="button";static const  QG="hand";static const  RG="ibeam";static const  UG="wait";}class mD{static var aE=oB.pD;static var zF=false;static var MG=new pB();static  oE( i){var h=i;var g="auto";if(aE!=oB.pD)h=aE;switch (h){case oB.pD:g="auto";break;case oB.sD:g="default";break;case oB.tD:g="pointer";break;case oB.QG:g="move";break;case oB.RG:g="text";break;case oB.UG:g="wait";break;}if(zF)g="none";return g;}}class lC{static const  tF=0;static const  yF=1;static const  HG=2;static const  OG=3;static const  gE=4;}class VE{static const  FG="none";static const  NG="touchPoint";}class XB{var KK;var nK;XB(){KK=new cC.ImageElement();nK=new List<YE>();}static  YG( m, NB){var l=new FC.Completer<XB>();var j=new XB();switch (NB){case gC.wF:case gC.nC: o( k, g){var EB=jG(k);var h=new YE(EB,j);h.oK=g["frame"]["x"].toInt();h.uK=g["frame"]["y"].toInt();h.CL=g["frame"]["w"].toInt();h.IL=g["frame"]["h"].toInt();h.PL=g["spriteSourceSize"]["x"].toInt();h.TL=g["spriteSourceSize"]["y"].toInt();h.WL=g["sourceSize"]["w"].toInt();h.dL=g["sourceSize"]["h"].toInt();h.iL=g["rotated"] as bool;j.nK.add(h);} mB(u){var q=aH.parse(u.target.responseText);var i=q["frames"];var HB=q["meta"];if(i is List)for(var g in i)o(g["filename"],g);if(i is Map)for(String k in i.keys)o(k,i[k]);j.KK..onLoad.listen((bB)=>l.complete(j))..onError.listen((bB)=>l.completeError(new StateError("Failed to load image.")))..src=kG(m,HB["image"]);} IC(u){l.completeError(new StateError("Failed to load json file."));}var aD=new cC.HttpRequest()..onLoad.listen(mB)..onError.listen(IC)..open('GET',m,true)..send();break;}return l.future;} get xG=>KK; s( i){var h;for(int g=0;g<nK.length&&h==null;g++ )if(nK[g].name==i)h=new DB.HI(nK[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}static  jG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);var i=h.firstMatch(g);return i.group(1);}static  kG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";}}class YE{var JK;var ZK;var oK;var uK;var CL;var IL;var PL;var TL;var WL;var dL;var iL;YE( g, h){JK=g;ZK=h;} get WH=>ZK; get name=>JK; get tG=>oK; get uG=>uK; get sG=>CL; get rG=>IL; get offsetX=>PL; get offsetY=>TL; get KH=>WL; get JH=>dL; get SH=>iL;}class gC{static const  wF="json";static const  nC="jsonarray";}class jC{var OK;var iK;var DL;var OL;var VL;var bL;var gL;jC(){OK=new Map<String,DB>();iK=new Map<String,IB>();DL=new Map<String,XB>();OL=new Map<String,String>();VL=null;bL=0;gL=0;} eB( h, i){var g=DB.qE(i);bL++ ;g.then(( j){OK[h]=j;bL-- ;CN();});g.catchError(( k){gL++ ;bL-- ;CN();});} YB( h, i){var g=IB.vF(i);bL++ ;g.then(( j){iK[h]=j;bL-- ;CN();});g.catchError(( k){gL++ ;bL-- ;CN();});} yC( i, k, h){var g=XB.YG(k,h);bL++ ;g.then(( j){DL[i]=j;bL-- ;CN();});g.catchError(( l){gL++ ;bL-- ;CN();});} kB( h, g){OL[h]=g;} load(){VL=new FC.Completer<jC>();CN();return VL.future;} s( g){if(OK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return OK[g];} fB( g){if(iK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return iK[g];} SC( g){if(DL.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return DL[g];} pC( g){if(OL.containsKey(g)==false)return "[[${g}]]";return OL[g];}CN(){if(VL!=null&&bL==0){if(gL==0)VL.complete(this);else VL.completeError(new StateError("Error loading resources."));}}}class jD implements hB{var RK=0.0;var kK=0.0;var vK=1;var HL;jD( g, h){HL=g;kK=RB.max(h,0.0001);} zB( h){var g=RK+h;while (g>=kK&&vK>0){RK=kK;vK-- ;HL();g-= kK;}if(vK==0)return false;RK=g;return true;} get totalTime=>kK; get currentTime=>RK;}abstract class hB{ zB( g);}class kD implements hB{var bK;var mK;var xK;kD(){xK=0.0;bK=new List<hB>();mK=0;} add( g){if(g==null)return;if(mK>=bK.length)bK.add(g);else bK[mK]=g;mK++ ;} remove( h){if(h==null)return;for(int g=0;g<mK;g++ )if(bK[g]==h)bK[g]=null;} dB( h, i){var g=new jD(h,i);add(g);return g;} zB( j){xK+= j;var k=mK;var h=0;for(int g=0;g<k;g++ ){var i=bK[g];if(i!=null&&i.zB(j)){if(h!=g)bK[h]=i;h++ ;}}for(int g=k;g<mK;g++ )bK[h++ ]=bK[g];for(int g=h;g<mK;g++ )bK[g]=null;mK=h;return true;}}class UE extends IB{UE(){}static  vF( i){var h=new UE();var g=new FC.Completer<IB>();cC.window.setTimeout(()=>g.complete(h),1);return g.future;} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new UB();return new lH(this,loop,soundTransform);}}class kF{var name;var uB;var JE;kF(this.name,this.uB,this.JE);}class kH extends JC{var gK;var lK;var WK;var QL;var YL;kH( j, h, i){gK=j;WK=h;lK=i;var g=ID.PD;QL=g.createGain();QL.connect(g.destination,0,0);QL.gain.value=(lK!=null)?RB.pow(lK.volume,2):1;YL=g.createBufferSource();YL.buffer=gK.SK;YL.loop=h;YL.connect(QL,0,0);YL.start(0);} get CC=>lK; set CC( g){lK=g;QL.gain.value=(lK!=null)?RB.pow(lK.volume,2):1;} stop(){YL.stop(0);}}class iD extends IB{var SK;iD(){if(ID.PD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  vF( u){var k=new iD();var h=new FC.Completer<IB>();var g=new cC.HttpRequest();var i=null;var j=null; NB(EB){i.cancel();j.cancel(); o( m){k.SK=m;h.complete(k);} HB(bB){h.completeError(new StateError("Failed to decode audio."));}var q=ID.PD;q.decodeAudioData(g.response,o,HB);} l(EB){i.cancel();j.cancel();h.completeError(new StateError("Failed to load audio."));}i=g.onLoad.listen(NB);j=g.onError.listen(l);g.open('GET',IB.nE(u),true);g.responseType='arraybuffer';g.send();return h.future;} get length{return SK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new UB();return new kH(this,loop,soundTransform);}}class MB{var x;var y;MB(this.x,this.y);MB.CI():this(0,0); get length=>RB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new MB(this.x+g.x,this.y+g.y); EE( g){this.x=g.x;this.y=g.y;} equals( g)=>this.x==g.x&&this.y==g.y;}class PB{var x;var y;var width;var height;PB(this.x,this.y,this.width,this.height);PB.CI():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new MB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0); EE( g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class HD extends JC{var jK;var YK;var WK;var lK;HD( g, i, h){jK=g;WK=i;lK=h;YK=g.IM(this);YK.loop=WK;this.CC=h;YK.play();} get CC=>lK; set CC( g){lK=g;if(YK!=null)YK.volume=(lK!=null)?lK.volume:1;} stop(){if(YK!=null){if(YK.ended==false)YK.pause();jK.RN(this);YK=null;}}}class SB{var EK,FK,HK,IK,LK,NK;var TK;SB.FI():EK=1.0,FK=0.0,HK=0.0,IK=1.0,LK=0.0,NK=0.0,TK=1.0; get a=>EK; get b=>FK; get c=>HK; get d=>IK; get DC=>LK; get EC=>NK; get bC=>TK; XH( g){return new MB(g.x*EK+g.y*HK+LK,g.x*FK+g.y*IK+NK);} concat( g){var m=EK;var u=FK;var EB=HK;var q=IK;var l=LK;var o=NK;var NB=TK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var bB=g.DC;var HB=g.EC;var mB=g.bC;EK=(m*j+u*i);FK=(m*k+u*h);HK=(EB*j+q*i);IK=(EB*k+q*h);LK=(l*j+o*i+bB);NK=(l*k+o*h+HB);TK=(NB*mB);} wG(){EK=1.0;FK=0.0;HK=0.0;IK=1.0;LK=0.0;NK=0.0;TK=1.0;} CH(){var j=EK;var m=FK;var l=HK;var k=IK;var h=LK;var i=NK;var g=TK;EK=(k/g);FK=-(m/g);HK=-(l/g);IK=(j/g);LK=-(EK*h+HK*i);NK=-(FK*h+IK*i);TK=(1.0/g);} NF( g, j, i, h, k, l){EK=g;FK=j;HK=i;IK=h;LK=k;NK=l;TK=(g*h-j*i);} EE( g){EK=g.a;FK=g.b;HK=g.c;IK=g.d;LK=g.DC;NK=g.EC;TK=g.bC;} FE( h, g){var o=h.a;var EB=h.b;var HB=h.c;var u=h.d;var m=h.DC;var q=h.EC;var bB=h.bC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var mB=g.DC;var NB=g.EC;var IC=g.bC;EK=(o*k+EB*j);FK=(o*l+EB*i);HK=(HB*k+u*j);IK=(HB*l+u*i);LK=(m*k+q*j+mB);NK=(m*l+q*i+NB);TK=(bB*IC);}}class nD extends IB{var YK;var qK;var JL;nD(){JL=new List<HD>();YK=new cC.AudioElement();YK.onEnded.listen(qL);qK=new List<cC.AudioElement>();qK.add(YK);cC.document.body.children.add(YK);}static  vF( q){var k=new nD();var g=k.YK;var i=new FC.Completer<IB>();var h;var j;o(m){h.cancel();j.cancel();i.complete(k);}l(m){h.cancel();j.cancel();i.completeError(new StateError("Failed to load audio."));}h=g.onCanPlayThrough.listen(o);j=g.onError.listen(l);g.src=IB.nE(q);g.load();return i.future;} get length{return YK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new UB();return new HD(this,loop,soundTransform);} IM( h){var g;if(qK.length==0){g=YK.clone(true);g.onEnded.listen(qL);}else{g=qK.removeAt(0);}JL.add(h);return g;} RN( g){var h=g.YK;var i=JL.indexOf(g);JL.removeAt(i);qK.add(h);if(YK.currentTime>0&&YK.ended==false)YK.currentTime=0;} qL(j){var i=j.target;var g=null;for(int h=0;h<JL.length&&g==null;h++ )if(JL[h].YK==i)g=JL[h];if(g!=null)g.stop();}}class mF{var GK;var UK;var dK;var BL;var ML;mF(){GK=new kD();UK=new List<oC>();dK=double.NAN;BL=JD.qD;ML=new sF(0);cC.window.requestAnimationFrame(LM);} get DH=>GK; LM( g){cC.window.requestAnimationFrame(LM);if(dK.isNaN)dK=g;if(dK>g)dK=g;var j=g-dK;var i=j/1000.0;if(j>=1){dK=g;ML.PK=i;BL.dispatchEvent(ML);GK.zB(i);for(int h=0;h<UK.length;h++ ){var k=UK[h];k.FH();}}} rE( g){UK.add(g);}}class yB{var QK;var hK;var wK;var FL;yB.EI( j,[ matrix]){QK=j;hK=new List<SB>.fixedLength(100);wK=new List<double>.fixedLength(100);for(int h=0;h<100;h++ ){hK[h]=new SB.FI();wK[h]=1.0;}FL=0;if(matrix!=null)hK[0].EE(matrix);var g=hK[0];var i=wK[0];QK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);QK.globalAlpha=i;} get context=>QK; reset(){FL=0;var g=hK[0];var h=wK[0];QK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);QK.globalAlpha=h;QK.clearRect(0,0,QK.canvas.width,QK.canvas.height);} MF( h){var i=FL;var j=FL+1;var l=hK[i];var g=hK[j];var m=wK[i];var k=wK[j]=h.sL*m;g.FE(h.DN,l);QK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);QK.globalAlpha=k;FL=j;if(h.mask==null){h.lB(this);}else{QK.save();h.mask.lB(this);h.lB(this);QK.restore();}FL=i;}}class kC{static const  pD="auto";static const  CG="stop";static const  uD="once";}class BB{static const  xF="added";static const  uC="addedToStage";static const  wD="enterFrame";static const  TG="removed";static const  wC="removedFromStage";var DK;var yM;var AN;var GN;var HN;var JN;var LN;BB( g,[ bubbles=false]){gM(g,bubbles);} gM( g,[ bubbles=false]){DK=g;yM=bubbles;AN=fC.MD;GN=null;HN=null;JN=false;LN=false;} get IE=>JN; get UH=>LN; get type=>DK; get eventPhase=>AN; get bubbles=>yM; get CE=>true; get target=>GN;}class fC{static const  bE=1;static const  MD=2;static const  KG=3;}class pB{var aK; vG( g){return aK!=null&&aK.containsKey(g);} addEventListener( g, h,[ useCapture=false]){YM(g).add(h,useCapture);} dispatchEvent( g){nM(g,this,this,fC.MD);} nM( g, i, k, j){if(aK!=null){var h=aK[g.type];if(h!=null){g.GN=i;g.HN=k;g.AN=j;g.JN=false;g.LN=false;h.dispatchEvent(g);}}} YM( h){if(aK==null)aK=new Map<String,YC>();var g=aK[h];if(g==null)g=aK[h]=new YC(this,h);return g;}}class nF{var TD;var ZD;nF(this.TD,this.ZD);}class ID{static var OD;static  get PD{if(OD==null){try {OD=new VF.AudioContext();}catch (g){OD=null;}}return OD;}static var xC;static  get hG{if(xC==null){xC=(PD!=null)?"WebAudioApi":"AudioElement";var g=cC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))xC="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))xC="Mock";}return xC;}}class JD{static final qD=new JD();var fL;JD(){fL=new List<YC>();} add( g){fL.add(g);} remove( h){var g=fL.indexOf(h);if(g!=-1)fL[g]=null;} dispatchEvent( j){var k=fL.length;var h=0;for(int g=0;g<k;g++ ){var i=fL[g];if(i!=null){j.GN=i.AF;j.HN=i.AF;j.AN=fC.MD;i.dispatchEvent(j);if(h!=g)fL[h]=i;h++ ;}}for(int g=k;g<fL.length;g++ )fL[h++ ]=fL[g];fL.length=h;}}class LC extends iB{var VK="";var fK=0x000000;var AL=null;var NL=qF.FG;var ZL=oF.AG;var DK=rF.uF;var mL=false;var rL=false;var uL=0x000000;var AM=false;var FM=0x000000;var JM=0;var OM=0;var SM;var XM;var ZM=true;var bM=100;var eM=100;var iM=null;var QK=null;LC(){AL=new WE("Arial",12,0x000000);SM=new List<String>();XM=new List<lD>();} get type=>DK; get width=>bM; get height=>eM; set text( g){VK=g;ZM=true;} set QC( g){AL=g;fK=AL.color;ZM=true;} set wordWrap( g){mL=g;ZM=true;} set width( g){bM=g;ZM=true;} set height( g){eM=g;ZM=true;} get VH{eN();return JM;} get KE{eN();return OM;} rB( g,[ returnRectangle]){return BE(g,bM,eM,returnRectangle);} TC( g, h){if(g>=0&&h>=0&&g<bM&&h<eM)return this;return null;} lB( g){eN();g.QK.drawImage(iM,0.0,0.0);} iN(){SM.clear();XM.clear();if(mL==false){SM.add(VK);}else{var g=new StringBuffer();var i;var h;for(String o in VK.replaceAll('\r','').split('\n')){for(String j in o.split(' ')){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(QK.measureText(h).width>bM){if(i>0)h=h.substring(0,i);else j="";SM.add(h);g.clear();g.add(j);}}if(g.isEmpty==false){SM.add(g.toString());g.clear();}}}JM=0;OM=0;for(String h in SM){var l=QK.measureText(h);var m=0;if(AL.align==nB.MC||AL.align==nB.LG)m=(bM-l.width)/2;if(AL.align==nB.HG||AL.align==nB.DG)m=bM-l.width;var k=new lD(m,l.width,AL.size,0,0,0);XM.add(k);JM=RB.max(JM,k.width);OM=OM+k.height;}} eN(){if(ZM){ZM=false;var i=bM.ceil().toInt();var j=eM.ceil().toInt();if(iM==null){iM=new cC.CanvasElement(width:i,height:j);QK=iM.context2d;}if(iM.width!=i)iM.width=i;if(iM.height!=j)iM.height=j;var g=new StringBuffer();g.add(AL.BF?"italic ":"normal ");g.add("normal ");g.add(AL.AC?"bold ":"normal ");g.add("${AL.size}px ");g.add("${AL.font},sans-serif");QK.font=g.toString();QK.textAlign="start";QK.textBaseline="top";QK.fillStyle=vC(fK);iN();if(rL){QK.fillStyle=vC(uL);QK.fillRect(0,0,bM,eM);}else{QK.clearRect(0,0,bM,eM);}var k=0;for(int h=0;h<SM.length;h++ ){var l=XM[h];QK.fillStyle=vC(fK);QK.fillText(SM[h],l.x,k);k+= l.height;}if(AM){QK.strokeStyle=vC(FM);QK.lineWidth=1;QK.strokeRect(0,0,bM,eM);}}}}class v extends BB{static const  XC="click";static const  GG="doubleClick";static const  vD="mouseDown";static const  iE="mouseUp";static const  VG="mouseMove";static const  zD="mouseOut";static const  jE="mouseOver";static const  lE="middleClick";static const  cG="middleMouseDown";static const  eG="middleMouseUp";static const  mE="rightClick";static const  fG="rightMouseDown";static const  gG="rightMouseUp";var oM,qM;var rM,sM;var QN;var wL;var NM;var yL;var BM;var UN;var VN;var WN;v( g,[ bubbles=false]):super(g,bubbles){gM(g,bubbles);} gM( g,[ bubbles=false]){super.gM(g,bubbles);oM=qM=0;rM=sM=0;QN=false;wL=false;NM=false;yL=false;BM=false;UN=0;VN=0;WN=0;}set XN( g){oM=g.x;qM=g.y;}set YN( g){rM=g.x;sM=g.y;} get CF=>oM; get DF=>qM; get PC=>QN; get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM; get zC=>UN;}class LD extends BB{static const  dE="keyDown";static const  IG="keyUp";var wL;var yL;var BM;var EM;var NM;var QM;var UM;var WM;LD( g,[ bubbles=false]):super(g,bubbles){gM(g,bubbles);} gM( g,[ bubbles=false]){super.gM(g,bubbles);wL=false;yL=false;BM=false;EM=false;NM=false;QM=0;UM=0;WM=0;} get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM; get charCode=>QM; get keyCode=>UM; get keyLocation=>WM;}class ZE extends BB{static const  EG="textInput";var VK="";ZE( g,[ bubbles=false]):super(g,bubbles){}}class KC extends BB{static const  cE="touchBegin";static const  JG="touchEnd";static const  PG="touchCancel";static const  SG="touchMove";static const  WG="touchOver";static const  XG="touchOut";var kM;var mM;var oM,qM;var rM,sM;var wL;var NM;var yL;var BM;var uM;var wM;var xM;KC( g,[ bubbles=false]):super(g,bubbles){gM(g,bubbles);} gM( g,[ bubbles=false]){super.gM(g,bubbles);kM=0;mM=false;oM=qM=0;rM=sM=0;wL=false;NM=false;yL=false;BM=false;uM=1.00;wM=0;xM=0;}set XN( g){oM=g.x;qM=g.y;}set YN( g){rM=g.x;sM=g.y;} get YD=>kM; get CF=>oM; get DF=>qM; get altKey=>wL; get ctrlKey=>yL; get shiftKey=>BM;}class lF{lF();}abstract class w extends pB implements TE{var rK=0.0;var yK=0.0;var GL=0.0;var LL=0.0;var RL=1.0;var XL=1.0;var cL=0.0;var jL;var lL;var sL=1.0;var vL=true;var JK="";var GM=null;var mask;var fM;var hM;w(){jL=new SB.FI();lL=true;fM=new SB.FI();hM=new SB.FI();} get x=>rK; get y=>yK; get UC=>GL; get VC=>LL; get tB=>RL; get BC=>XL; get WB=>cL; get alpha=>sL; get visible=>vL; get name=>JK; get parent=>GM; get root{var g=this;while (g.GM!=null)g=g.GM;return g;} get XD{var g=this.root;if(g is oC)return g;return null;} set x( g){rK=g;lL=true;} set y( g){yK=g;lL=true;} set UC( g){GL=g;lL=true;} set VC( g){LL=g;lL=true;} set tB( g){RL=g;lL=true;} set BC( g){XL=g;lL=true;} set WB( g){cL=g;lL=true;} set alpha( g){sL=g;lL=true;} get width=>rB(DN).width; get height=>rB(DN).height; set width( h){this.tB=1;var g=this.width;this.tB=(g!=0.0)?h/g:1.0;} set height( h){this.BC=1;var g=this.height;this.BC=(g!=0.0)?h/g:1.0;} HE(){if(GM!=null)GM.sB(this);} get DN{if(lL){lL=false;if(cL==0.0){jL.NF(RL,0.0,0.0,XL,rK-GL*RL,yK-LL*XL);}else{var g=RB.cos(cL);var h=RB.sin(cL);var i=RL*g;var l=RL*h;var k=-XL*h;var j=XL*g;var m=rK-GL*i-LL*k;var o=yK-GL*l-LL*j;jL.NF(i,l,k,j,m,o);}}return jL;} rB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.CI();returnRectangle.x=g.DC;returnRectangle.y=g.EC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} TC( g, h){if(rB(hM).contains(g,h))return this;return null;} qC( h){fM.wG();for(w g=this;g!=null;g=g.GM)fM.concat(g.DN);fM.CH();return fM.XH(h);} dispatchEvent( h){var g=null;if(h.CE||h.bubbles)for(w j=GM;j!=null;j=j.GM)if(j.vG(h.type)){if(g==null)g=new List<w>();g.add(j);}if(h.CE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.IE==false)g[i].nM(h,this,g[i],fC.bE);if(h.IE==false)nM(h,this,this,fC.MD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.IE==false)g[i].nM(h,this,g[i],fC.KG);} aN( h){for(var g=h;g!=null;g=g.GM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");GM=h;} lB( g);}abstract class iB extends w{var qG=false;var TB=true;var BI=true;var tabIndex=0;}abstract class iC extends iB{var tK;var zK=true;var KL=true;iC(){tK=new List<w>();} n( g){if(g.parent==this){var h=tK.indexOf(g);tK.removeAt(h);tK.add(g);}else{mG(g,tK.length);}} mG( g, h){if(h<0&&h>tK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){tK.removeAt(tK.indexOf(g));if(h>tK.length)h-- ;tK.insertRange(h,1,g);}else{g.HE();g.aN(this);tK.insertRange(h,1,g);g.dispatchEvent(new BB(BB.xF,true));if(this.XD!=null)bN(g,new BB(BB.uC));}} sB( h){var g=tK.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");OH(g);} OH( g){if(g<0&&g>=tK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=tK[g];h.dispatchEvent(new BB(BB.TG,true));if(this.XD!=null)bN(h,new BB(BB.wC));h.aN(null);tK.removeAt(g);} contains( g){for(;g!=null;g=g.GM)if(g==this)return true;return false;} rB( m,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.CI();if(tK.length==0)return super.rB(m,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var o=tK.length;for(int j=0;j<o;j++ ){fM.FE(tK[j].DN,m);var g=tK[j].rB(fM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>l)l=g.right;if(g.bottom>k)k=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=l-h;returnRectangle.height=k-i;return returnRectangle;} TC( q, u){var l=null;for(int j=tK.length-1;j>=0;j-- ){var i=tK[j];if(i.visible){var g=i.DN;var m=q-g.DC;var k=u-g.EC;var EB=(g.d*m-g.c*k)/g.bC;var o=(g.a*k-g.b*m)/g.bC;var h=i.TC(EB,o);if(h!=null){if(h is iB)if(h.TB)return zK?h:this;l=this;}}}return l;} lB( i){for(int g=0;g<tK.length;g++ ){var h=tK[g];if(h.visible)i.MF(h);}} bN( g, j){g.dispatchEvent(j);if(g is iC){var i=new List<w>.from(g.tK);var k=i.length;for(int h=0;h<k;h++ )bN(i[h],j);}}}class XE{var target=null;var PC=false;var DE=0;var zC=0;var GF,HF;var EF,FF;XE(this.GF,this.HF,this.EF,this.FF);}class UB{var volume;var LH;var vH=1;var wH=0;var AI=1;var zH=0;UB([this.volume=1,this.LH=0]);}abstract class JC extends pB{ get CC; set CC( g); stop();}class AB extends iC{var pH=false;var ME=false;}class lD{var nG;var pG;var height;var GE;var width;var x;lD(this.x,this.width,this.height,this.nG,this.pG,this.GE);}class CB extends w{var QB;var MH;var RD;CB([this.QB=null,this.MH="auto"]){RD=null;} rB( h,[ returnRectangle]){var g=(QB!=null)?QB.width:0;var i=(QB!=null)?QB.height:0;return BE(h,g,i,returnRectangle);} TC( g, h){if(QB!=null&&g>=0.0&&h>=0.0&&g<QB.width&&h<QB.height)return this;return null;} lB( g){if(QB!=null){if(RD==null)QB.lB(g);else QB.LF(g,RD);}}}abstract class TE{ lB( g);}class WE{var font;var size;var color;var AC;var BF;var YH;var align;var EH;var RH;var yG;var GE;var letterSpacing=0;var nH=0;var oH=false;var uH=false;WE(this.font,this.size,this.color,{this.AC: false,this.BF: false,this.YH: false,this.align: "left",this.EH: 0,this.RH: 0,this.yG: 0,this.GE: 0});}abstract class IB{static  vF( g){var h=ID.hG;if(h=="WebAudioApi")return iD.vF(g);if(h=="AudioElement")return nD.vF(g);return UE.vF(g);} get length; play([ loop=false, soundTransform]);static var ZC;static  nE( g){if(ZC==null){ZC=new List<String>();var i=new cC.AudioElement();var h=["maybe","probably"];if(h.indexOf(i.canPlayType("audio/ogg",""))!=-1)ZC.add("ogg");if(h.indexOf(i.canPlayType("audio/mp3",""))!=-1)ZC.add("mp3");if(h.indexOf(i.canPlayType("audio/wav",""))!=-1)ZC.add("wav");}var k=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,caseSensitive:false);var j=k.firstMatch(g);if(j==null)throw new ArgumentError("Unsupported file extension.");var l=j.group(1).toLowerCase();if(ZC.indexOf(l)==-1&&ZC.length>0)g="${g.substring(0,g.length-3)}${ZC[0]}";return g;}}class tC extends iB{var LE;var JF;var yE;var UD;var ME=true;var enabled=true;var hL;tC([this.LE,this.JF,this.yE,this.UD]){addEventListener(v.jE,CM);addEventListener(v.zD,CM);addEventListener(v.vD,CM);addEventListener(v.iE,CM);hL=this.LE;} rB( g,[ returnRectangle]){if(hL!=null){fM.FE(hL.DN,g);return hL.rB(fM,returnRectangle);}return super.rB(g,returnRectangle);} TC( k, l){if(this.UD!=null){var g=this.UD.DN;var h=k-g.DC;var i=l-g.EC;var m=(g.d*h-g.c*i)/g.bC;var j=(g.a*i-g.b*h)/g.bC;if(this.UD.TC(m,j)!=null)return this;}return null;} lB( g){if(hL!=null)g.MF(hL);} CM( g){if(g.type==v.zD){hL=LE;}else{hL=g.PC?yE:JF;}}}class KD extends w{static const  rD='DIRECTION_UP';static const  eE='DIRECTION_RIGHT';static const  xD='DIRECTION_DOWN';static const  ND='DIRECTION_LEFT';var nL;var pL;var tL;var xL;KD( g,[ direction=ND]){if(direction!=rD&&direction!=xD&&direction!=ND&&direction!=eE){throw new ArgumentError('Invalid Gauge direction!');}nL=direction;pL=1.0;tL=g;xL=new PB.CI();lM();} get ratio=>pL;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;pL=g;lM();} get QB=>tL;set QB( g){tL=g;lM();}lM(){if(tL==null){xL.left=0;xL.top=0;xL.right=0;xL.bottom=0;}else{var h=tL.width;var g=tL.height;switch (nL){case ND:xL.left=((1.0-pL)*h).toInt();xL.top=0;xL.right=h;xL.bottom=g;break;case rD:xL.left=0;xL.top=((1.0-pL)*g).toInt();xL.right=h;xL.bottom=g;break;case eE:xL.left=0;xL.top=0;xL.right=(pL*h).toInt();xL.bottom=g;break;case xD:xL.left=0;xL.top=0;xL.right=h;xL.bottom=(pL*g).toInt();break;}}} rB( h,[ returnRectangle]){var g=(tL!=null)?tL.width:0;var i=(tL!=null)?tL.height:0;return BE(h,g,i,returnRectangle);} TC( g, h){if(tL!=null&&g>=0.0&&h>=0.0&&g<tL.width&&h<tL.height)return this;return null;} lB( g){if(tL!=null)tL.LF(g,xL);}}class pF{var DK;var MK;var cK;var pK;pF.DI( i, g, h, j){DK=0;MK=new PB(i,g,h,j);} lB( i){var g=i.context;g.beginPath();switch (DK){case 0:g.rect(MK.x,MK.y,MK.width,MK.height);break;case 1:g.arc(cK.x,cK.y,cK.xH,0,RB.PI*2.0,false);break;case 2:g.moveTo(pK[0].x,pK[0].y);for(int h=1;h<pK.length;h++ )g.lineTo(pK[h].x,pK[h].y);break;}g.clip();}}class sF extends BB{var PK;sF( g):super(BB.wD,false){PK=g;} get CE=>false;}class oD extends KD implements hB{static const  BG='TIME_OUT';var SL=false;var RK=0.0;var kK=0.0;var kL;var oL=true;oD( g, h,[ direction=KD.ND]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');kK=g;uE();} zB( g){if(SL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){SL=true;} pause(){SL=false;} reset([ time=0.0]){pause();time=RB.max(time,0.0);if(time!=0.0){kK=time;uE();}ratio=1.0;} QD( g, h){kL[g]=h/totalTime;} uE(){kL=new Map<String,num>();QD(oD.BG,0);} get totalTime=>kK; get QH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(oL){kL.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new BB(j));});}}}class DB implements TE{var XK;var eK;var sK;var EL;var QK;var UL;var aL;var eL;var oK;var uK;var CL;var IL;DB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){XK=g;eK=h;sK=transparent;var i=new cC.CanvasElement(width:XK,height:eK);QK=i.context2d;QK.fillStyle=sK?ZG(fillColor):vC(fillColor);QK.fillRect(0,0,g,h);EL=i;UL=0;}DB.GI( g){XK=g.naturalWidth;eK=g.naturalHeight;sK=true;EL=g;UL=0;}DB.HI( g){XK=g.KH;eK=g.JH;sK=true;EL=g.WH.xG;UL=g.SH?2:1;aL=g.offsetX.toDouble();eL=g.offsetY.toDouble();oK=g.tG.toDouble();uK=g.uG.toDouble();CL=g.sG.toDouble();IL=g.rG.toDouble();}static  qE( i){var h=new FC.Completer<DB>();var g=new cC.ImageElement();g.onLoad.listen((j)=>h.complete(new DB.GI(g)));g.onError.listen((j)=>h.completeError(new StateError("Error loading image.")));g.src=i;return h.future;} get width=>XK; get height=>eK; lB( g){switch (UL){case 0:g.context.drawImage(EL,0.0,0.0);break;case 1:g.context.drawImage(EL,oK,uK,CL,IL,aL,eL,CL,IL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,aL,eL+IL);g.context.drawImage(EL,oK,uK,IL,CL,0.0,0.0,IL,CL);break;}} LF( bB, g){if(g.width<=0.0||g.height<=0.0)return;switch (UL){case 0:bB.context.drawImage(EL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=oK;double h=uK;double u=j+CL;double EB=h+IL;double l=oK-aL+g.x;double m=uK-eL+g.y;double NB=l+g.width;double HB=m+g.height;double q=(j>l)?j:l;double o=(h>m)?h:m;double mB=(u<NB)?u:NB;double NE=(EB<HB)?EB:HB;double aD=aL-j+q;double IC=eL-h+o;double k=mB-q;double i=NE-o;if(k>0.0&&i>0.0){bB.context.drawImage(EL,q,o,k,i,aD,IC,k,i);}break;case 2:double j=oK;double h=uK;double u=j+IL;double EB=h+CL;double l=oK+eL-g.y+IL-g.height;double m=uK-aL+g.x;double NB=l+g.height;double HB=m+g.width;double q=(j>l)?j:l;double o=(h>m)?h:m;double mB=(u<NB)?u:NB;double NE=(EB<HB)?EB:HB;double aD=aL-h+o;double IC=eL+u-mB;double k=NE-o;double i=mB-q;if(k>0.0&&i>0.0){bB.context.transform(0.0,-1.0,1.0,0.0,aD,IC+i);bB.context.drawImage(EL,q,o,i,k,0.0,0.0,i,k);}break;}}}typedef  mC(event); vC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class fE{static var hE=false;static var yD=false;static var AE=0;static var bG=VE.FG;static var MG=new pB();static dG(){if(hE==false){hE=true;var g=cC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){yD=true;AE=10;}if(g.contains("Android")){yD=true;AE=10;}if(g.contains("IEMobile")){yD=true;AE=10;}}}static  get iG{dG();return bG;}}class NC extends hB{var zL;var DM;var HM;var KM;var PM;var TM;var VM;var kK;var RK;var aM;var cM;var dM;NC( g, h, i,[ transitionFunction( ratio)]){zL=g;DM=h;HM=g;KM=(transitionFunction!=null)?transitionFunction:LB.OC;RK=0.0;kK=RB.max(0.0001,i);aM=0.0;cM=false;dM=false;} zB( i){if(RK<kK||dM==false){RK=RK+i;if(RK>kK)RK=kK;if(RK>=0.0){if(dM==false){dM=true;if(PM!=null)PM();}var g=RK/kK;var h=KM(g);HM=zL+h*(DM-zL);if(TM!=null)TM(cM?HM.round():HM);if(VM!=null&&RK==kK)VM();}}return RK<kK;} get uB=>zL; get JE=>DM; get totalTime=>kK; get currentTime=>RK;set RC( g){if(dM==false)RK=RK+aM-g;aM=g;} set onStart( g()){PM=g;} set HC( g( value)){TM=g;} set onComplete( g()){VM=g;}}class YC{var MG;var MM;var RM;YC( h, g){MG=h;MM=g;RM=new List<nF>();} get AF=>MG; add( h,[ useCapture=false]){for(int g=0;g<RM.length;g++ )if(RM[g].TD==h&&RM[g].ZD==useCapture)return;if(MM==BB.wD&&RM.length==0)JD.qD.add(this);RM.add(new nF(h,useCapture));} remove( h,[ useCapture=false]){for(int g=0;g<RM.length;g++ ){if(RM[g].TD==h&&RM[g].ZD==useCapture){RM=new List<nF>.from(RM);RM.removeAt(g);if(MM==BB.wD&&RM.length==0)JD.qD.remove(this);break;}}} operator+( g){this.add(g,false);} operator-( g){this.remove(g,false);} dispatchEvent( h){for(int g=0;g<RM.length;g++ )if(h.eventPhase!=fC.bE||RM[g].ZD)if(h.UH==false)RM[g].TD(h);}}class kE{static var aG=0;var YD=aG++ ;var target=null;var WD=false;kE(this.target,this.WD);} ZG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class LB{static  OC( g){return g;}static  pE( g){return g*g*g;}static  qB( g){g=1.0-g;return 1.0-g*g*g;}static  lG( g){if(g==0.0||g==1.0)return g;return RB.pow(2.0,-10.0*g)*RB.sin((g-0.3/4.0)*(2.0*RB.PI)/0.3)+1;}}class jB implements hB{var jM;var KM;var pM;var PM;var TM;var VM;var kK;var RK;var aM;var cM;var dM;jB( g, h,[ transitionFunction( ratio)]){jM=g;KM=(transitionFunction!=null)?transitionFunction:LB.OC;RK=0.0;kK=RB.max(0.0001,h);aM=0.0;cM=false;dM=false;pM=new List<kF>();} VB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(jM!=null&&dM==false)pM.add(new kF(g,0.0,h));} moveTo( h, g){VB('x',h);VB('y',g);} zB( l){if(RK<kK||dM==false){RK=RK+l;if(RK>kK)RK=kK;if(RK>=0.0){if(dM==false){dM=true;for(int i=0;i<pM.length;i++ ){var g=pM[i];switch (g.name){case 'x':g.uB=jM.x;break;case 'y':g.uB=jM.y;break;case 'pivotX':g.uB=jM.UC;break;case 'pivotY':g.uB=jM.VC;break;case 'scaleX':g.uB=jM.tB;break;case 'scaleY':g.uB=jM.BC;break;case 'rotation':g.uB=jM.WB;break;case 'alpha':g.uB=jM.alpha;break;}}if(PM!=null)PM();}var j=RK/kK;var k=KM(j);for(int i=0;i<pM.length;i++ ){var g=pM[i];var h=g.uB+k*(g.JE-g.uB);h=cM?h.round():h;switch (g.name){case 'x':jM.x=h;break;case 'y':jM.y=h;break;case 'pivotX':jM.UC=h;break;case 'pivotY':jM.VC=h;break;case 'scaleX':jM.tB=h;break;case 'scaleY':jM.BC=h;break;case 'rotation':jM.WB=h;break;case 'alpha':jM.alpha=h;break;}}if(TM!=null)TM();if(VM!=null&&RK==kK)VM();}}return RK<kK;} get totalTime=>kK; get currentTime=>RK;set RC( g){if(dM==false)RK=RK+aM-g;aM=g;} set onStart( g()){PM=g;} set HC( g()){TM=g;} set onComplete( g()){VM=g;}}class oC extends iC{var iM;var QK;var tM;var vM;var zM;var BN;var EN;var IN;var KN;var MN;var NN;var ON;var PN;var SN;var TN;oC( h, g){JK=h;iM=g;iM.focus();QK=g.context2d;vM=new yB.EI(QK);zM=kC.pD;BN=oB.sD;mD.MG.addEventListener("mouseCursorChanged",ZN);KN=[new XE(v.vD,v.iE,v.XC,v.GG),new XE(v.cG,v.eG,v.lE,v.lE),new XE(v.fG,v.gG,v.mE,v.mE)];IN=null;EN=new MB(0,0);NN=new v(v.XC,true);SN=CM;iM.onMouseDown.listen(SN);iM.onMouseUp.listen(SN);iM.onMouseMove.listen(SN);iM.onMouseOut.listen(SN);iM.onMouseWheel.listen(SN);MN=new Map<int,kE>();PN=new KC(KC.cE,true);TN=cN;fE.MG.addEventListener("inputModeChanged",dN);dN(null);ON=new LD(LD.dE,true);iM.onKeyDown.listen(fN);iM.onKeyUp.listen(fN);iM.onKeyPress.listen(gN);} get focus=>tM; set PH( g){zM=g;} hN(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){hN();} set y( g){hN();} set UC( g){hN();} set VC( g){hN();} set tB( g){hN();} set BC( g){hN();} set WB( g){hN();} set alpha( g){hN();} set width( g){hN();} set height( g){hN();} FH(){if(zM==kC.pD||zM==kC.uD){vM.reset();lB(vM);if(zM==kC.uD)zM=kC.CG;}} ZN( g){iM.style.cursor=mD.oE(BN);} CM( j){j.preventDefault();var HB=iM.getBoundingClientRect();var o=new Date.now().millisecondsSinceEpoch;var u=j.button;var h=null;var i=new MB(j.clientX-HB.left,j.clientY-HB.top);var m=null;if(u<0||u>2)return;if(j.type=="mousemove"&&EN.equals(i))return;var g=KN[u];EN=i;if(j.type!="mouseout")h=TC(i.x,i.y) as iB;var k=oB.sD;if(h is AB)if(h.ME)k=oB.tD;if(h is tC)if(h.ME)k=oB.tD;if(BN!=k){BN=k;iM.style.cursor=mD.oE(k);}if(IN!=null&&IN!=h){IN.dispatchEvent(NN..gM(v.zD,true)..XN=(IN.XD!=null)?IN.qC(i):new MB.CI()..YN=i..QN=g.PC);IN=null;}if(h!=null&&h!=IN){h.dispatchEvent(NN..gM(v.jE,true)..XN=h.qC(i)..YN=i..QN=g.PC);IN=h;}var l=null;var q=false;var EB=false;if(j.type=="mousedown"){l=g.GF;if(h!=g.target||o>g.DE+500)g.zC=0;g.PC=true;g.target=h;g.DE=o;g.zC++ ;}if(j.type=="mouseup"){l=g.HF;g.PC=false;q=(g.target==h);EB=q&&g.zC.isEven&&(o<g.DE+500);}if(j.type=="mousemove"){l=v.VG;}if(l!=null&&h!=null){m=h.qC(i);h.dispatchEvent(NN..gM(l,true)..XN=m..YN=i..QN=g.PC..UN=g.zC);if(q){if(EB&&h.qG){h.dispatchEvent(NN..gM(g.FF,true)..XN=m..YN=i..QN=g.PC);}else{h.dispatchEvent(NN..gM(g.EF,true)..XN=m..YN=i..QN=g.PC);}}}}var jN=[] ; dN( h){jN.forEach((g)=>g.cancel());if(fE.iG==VE.NG){jN=[iM.onTouchStart.listen(TN),iM.onTouchEnd.listen(TN),iM.onTouchMove.listen(TN),iM.onTouchEnter.listen(TN),iM.onTouchLeave.listen(TN),iM.onTouchCancel.listen(TN)];}} cN( j){j.preventDefault();var o=iM.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var h=null;var i=new MB(m.clientX-o.left,m.clientY-o.top);var q=null;h=TC(i.x,i.y) as iB;var g=MN.containsKey(l)?MN[l]:new kE(h,MN.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(PN..gM(KC.XG,true)..XN=(g.target.XD!=null)?g.target.qC(i):new MB.CI()..YN=i..kM=g.YD..mM=g.WD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(PN..gM(KC.WG,true)..XN=h.qC(i)..YN=i..kM=g.YD..mM=g.WD);g.target=h;}var k=null;if(j.type=="touchstart"){MN[l]=g;k=KC.cE;}if(j.type=="touchend"){MN.remove(l);k=KC.JG;}if(j.type=="touchcancel"){MN.remove(l);k=KC.PG;}if(j.type=="touchmove"){k=KC.SG;}if(k!=null&&h!=null){h.dispatchEvent(PN..gM(k,true)..XN=h.qC(i)..YN=i..kM=g.YD..mM=g.WD);}}} fN( g){g.preventDefault();var h=null;if(g.type=="keyup")h=LD.IG;if(g.type=="keydown")h=LD.dE;ON..gM(h,true)..wL=g.altKey..yL=g.ctrlKey..BM=g.shiftKey..QM=g.charCode..UM=g.keyCode..WM=lC.tF;if(g.keyLocation==cC.KeyLocation.LEFT)ON.WM=lC.yF;if(g.keyLocation==cC.KeyLocation.RIGHT)ON.WM=lC.HG;if(g.keyLocation==cC.KeyLocation.NUMPAD)ON.WM=lC.OG;if(g.keyLocation==cC.KeyLocation.JOYSTICK)ON.WM=lC.gE;if(g.keyLocation==cC.KeyLocation.MOBILE)ON.WM=lC.gE;if(tM!=null)tM.dispatchEvent(ON);} gN( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new ZE(ZE.EG,true);h.VK=new String.fromCharCodes([i]);if(tM!=null)tM.dispatchEvent(h);}} BE( g, m, EB, j){var IC=0.0;var mB=0.0;var u=m*g.a;var bB=m*g.b;var HB=m*g.a+EB*g.c;var q=m*g.b+EB*g.d;var NB=EB*g.c;var o=EB*g.d;var h=IC;if(h>u)h=u;if(h>HB)h=HB;if(h>NB)h=NB;var i=mB;if(i>bB)i=bB;if(i>q)i=q;if(i>o)i=o;var l=IC;if(l<u)l=u;if(l<HB)l=HB;if(l<NB)l=NB;var k=mB;if(k<bB)k=bB;if(k<q)k=q;if(k<o)k=o;if(j==null)j=new PB.CI();j.x=g.DC+h;j.y=g.EC+i;j.width=l-h;j.height=k-i;return j;}
//@ sourceMappingURL=escape.dart.map