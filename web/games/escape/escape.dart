import "dart:math" as SB;import "dart:html" as bC;import "dart:json" as dH;import "dart:web_audio" as dF;class jF extends AB{var NI;var XI;var hI;var nI;var pI;jF(){hI=eB.LB.iB("Warning");nI=null;NI=GB.rF();XI=new CB(NI[0]);n(XI);} start(){nI=hI.play();p.remove(pI);pI=new NC(0,80,9.0,MB.OC);pI.JC=(h){var g=h.toInt()%8;XI.QB=NI[(g<=4)?g+1:8-g];};p.add(pI);} stop(){if(nI!=null){nI.stop();nI=null;}p.remove(pI);XI.QB=NI[0];}}class gF extends AB{var tI;var AJ;var FJ;var JJ;var MJ;var NJ;var OJ;var PJ;var QJ;var SJ;var TJ;var UJ;var VJ;var WJ;var XJ;var ZJ;var aJ;var bJ;var cJ;var eJ;gF( v, s, IB, m, o, EB, k){PJ=new SB.Random();QJ=xB.sC;SJ=k;tI=v;AJ=s;FJ=IB;JJ=m;MJ=o;NJ=EB;OJ=k.length;WJ=new List<NB>();ZJ=new AB();aJ=new AB();bJ=new AB();cJ=new AB();eJ=new AB();n(ZJ);n(aJ);n(bJ);n(cJ);n(eJ);aJ.VB=false;bJ.VB=false;cJ.VB=false;eJ.VB=false;EH();FH();DH();XJ=true;var l=new rC();this.mask=new zF.AI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=UJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.jB(ZJ,aJ,bJ);var j=new NC(i.y,h*50+25,0.4,MB.sB);j.delay=g*0.03;j.JC=(RB){i.y=RB;};j.onComplete=(){if(l.WD()==100){lJ();XJ=false;WJ.clear();this.mask=null;}};p.add(j);}}addEventListener(t.MD,mJ);} bF( g){if(g==xB.dD)QJ=g;if(g==xB.eD&&QJ==xB.sC){QJ=g;if(XJ==false)KB(new cB(cB.gD,null));}} GF(){this.mask=new zF.AI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=UJ[i+h*10];g.dB=false;g.IC=false;g.FB=u.CD;g.jB(ZJ,aJ,bJ);var j=new NC(g.y,500+h*50+25,0.5,MB.sB);j.delay=i*0.1;j.JC=(k){g.y=k;};p.add(j);}}} EH(){VJ=new List<BD>();for(int h=0;h<AJ;h++ ){var g=new BD(h);g.YB=(PJ.nextInt(30)-15)*SB.PI/180;g.x=300-(90*AJ)/2+h*90+PJ.nextInt(20)-10;g.y=550;VJ.add(g);cJ.n(g);}} DF( g, h){var i=0;var j=UJ[g+h*10];if(j.direction==0){var l=(g>0)?UJ[g-1+h*10]:null;var m=(g<9)?UJ[g+1+h*10]:null;if(j.YC(l))i++ ;if(j.YC(m))i++ ;}else{var k=(h>0)?UJ[g+(h-1)*10]:null;var o=(h<9)?UJ[g+(h+1)*10]:null;if(j.gC(k))i++ ;if(j.gC(o))i++ ;}return i;} CF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=UJ[g+h*10];var i=OJ*2;while (DF(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<SJ.length;j++ )if(k.color==SJ[j])m=j;k.color=SJ[(m+1)%SJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(DF(g,h)==2);return l;} SF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(UJ[(h-1)+g*10].TD(UJ[h+g*10])&&UJ[h+g*10].TD(UJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(UJ[h+(g-1)*10].TD(UJ[h+g*10])&&UJ[h+g*10].TD(UJ[h+(g+1)*10]))return true;return false;} sJ( k, l, j){for(int h=0;h<20;h++ ){var g=tI~/j;var i=l*g+PJ.nextInt(g);if(TJ[i].FB==u.CD){TJ[i].FB=k;return;}}} FH(){TJ=new List<JB>();for(int g=0;g<tI;g++ ){var i=SJ[PJ.nextInt(SJ.length)];var h=PJ.nextInt(2);TJ.add(new JB(i,h));}for(int g=0;g<AJ*2;g++ )sJ("Lock${(g%AJ)+1}",g,AJ*2);for(int g=0;g<FJ;g++ )sJ(u.OB,g,FJ);for(int g=0;g<JJ;g++ )sJ(u.yB,g,JJ);for(int g=0;g<MJ;g++ )sJ(u.SE,g,MJ);for(int g=0;g<NJ;g++ )sJ(u.TE,g,NJ);} DH(){UJ=new List<JB>();var g=true;while (g){UJ.clear();for(int h=0;h<100;h++ ){var j=SJ[PJ.nextInt(SJ.length)];var i=PJ.nextInt(2);UJ.add(new JB(j,i));}g=CF();}} XF(){if(XJ||QJ!=xB.sC)return false;var l=true;XJ=true;while (l){for(int k=0;k<UJ.length;k++ ){var g=UJ[k];g.dB=false;g.IC=false;g.jB(ZJ,aJ,bJ);g.color=SJ[PJ.nextInt(SJ.length)];g.direction=PJ.nextInt(2);}l=CF()||(SF()==false);}var s=eB.LB.iB("BonusUniversal");s.play();var m=new rC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=UJ[i+j*10];g.YF=0.0;var h=new NC(0.0,1.0,0.2,MB.OC);h.delay=i*0.06;h.JC=(o){g.YF=o;};h.QF=(){g.jB(ZJ,aJ,bJ);};h.onComplete=(){if(m.WD()==100){lJ();tJ();WJ.clear();}};p.add(h);}}return true;} lJ(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=UJ[h+i*10];var l=(h<9)?UJ[h+1+i*10]:null;var m=(i<9)?UJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.YC(l)){j=true;k=(g.FB==u.OB||l.FB==u.OB);}if(g.gC(m)){j=true;k=(g.FB==u.OB||m.FB==u.OB);}if(g.dB!=j||g.IC!=k){g.dB=j;g.IC=k;g.jB(ZJ,aJ,bJ);}}}} vJ( o, l, s, k, m, v){XJ=true;o.WD(k);var i=1;for(int h=0;h<k;h++ ){var g=UJ[l+h*m+(s+h*v)*10];if(g.FB==u.SE)i=i*2;if(g.FB==u.TE)i=i*5;var IB=l+h*m;var RB=s+h*v;p.fB((){g.empty=true;g.jB(ZJ,aJ,bJ);var EB=eB.LB.iB("ChainBlast");EB.play();var j=new QE(g.color,g.direction);j.x=IB*50;j.y=RB*50;p.add(j);eJ.n(j);QH(g);if(o.EF()==0)xJ();},0.1+h*0.1);}KB(new cB(cB.QE,{"Length":k,"Factor":i}));} tJ(){XJ=false;var j=new rC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&UJ[i+g-1+h*10].YC(UJ[i+g+h*10]))g++ ;if(g>=3)vJ(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&UJ[i+(h+g-1)*10].gC(UJ[i+(h+g)*10]))g++ ;if(g>=3)vJ(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(QJ==xB.dD)KB(new cB(cB.RE,null));if(QJ==xB.eD)KB(new cB(cB.gD,null));if(QJ==xB.sC&&SF()==false)XF();}} QH( h){if(h.FB.indexOf("Lock")==0){var k=int.parse(h.FB.substring(4,5))-1;var j=VJ[k];var g=GB.hD(h.FB);g.x=h.x;g.y=h.y;n(g);var i=new mB(g,0.5,MB.sB);i.XB("x",j.x);i.XB("y",j.y-10);i.onComplete=()=>uB(g);p.add(i);p.fB(()=>LH(k),0.5);}} LH( k){var h=VJ[k];var i;if(h.AD){i=new cB(cB.DD,{"Type":"SingleLocked","Position":new NB(h.x+20,h.y)});var m=eB.LB.iB("Unlock");m.play();}else{i=new cB(cB.DD,{"Type":"SingleUnlocked","Position":new NB(h.x+20,h.y)});}KB(i);h.AD=false;h.WF(false);var j=true;for(int g=0;g<VJ.length;g++ )j=j&&(VJ[g].AD==false);if(j){var l=eB.LB.iB("BonusAllUnlock");l.play();for(int g=0;g<VJ.length;g++ ){VJ[g].AD=true;p.fB(()=>VJ[(g+k)%VJ.length].WH(),g*0.2);}p.fB(()=>KB(new cB(cB.DD,{"Type":"All","Position":new NB(280,550)})),0.75);}} xJ(){var o=new rC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&UJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&UJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=UJ[i+j*10];if(i>0){l=UJ[i-1+j*10];if(h.YC(l)){l.dB=false;l.jB(ZJ,aJ,bJ);}}h.dB=false;h.empty=true;h.jB(ZJ,aJ,bJ);}else{if(TJ.length>0){h=TJ[0];TJ.removeRange(0,1);}else{h=new JB(SJ[PJ.nextInt(SJ.length)],PJ.nextInt(2));}}g=UJ[i+k*10];g.color=h.color;g.direction=h.direction;g.FB=h.FB;g.dB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.jB(ZJ,aJ,bJ);o.WD();var m=new NC(g.y,50*k+25,0.1,MB.OC);m.JC=(s){g.y=s;};m.onComplete=(){if(o.EF()==0){lJ();tJ();zJ();}};p.add(m);}}}} mJ( g){if(g.target==ZJ&&this.VB){var j=SB.min(g.JF/50,9).toInt();var h=SB.min(g.KF/50,9).toInt();var i=new NB(j,h);WJ.add(i);zJ();}} zJ(){while (QJ==xB.sC&&XJ==false&&WJ.length>0){var s=WJ[0];WJ.removeRange(0,1);var j=s.x.toInt();var k=s.y.toInt();var g=UJ[j+k*10];var h=(j>0)?UJ[j-1+k*10]:null;var o=(j<9)?UJ[j+1+k*10]:null;var i=(k>0)?UJ[j+(k-1)*10]:null;var m=(k<9)?UJ[j+(k+1)*10]:null;var l=false;if(g.FB==u.yB){var v=eB.LB.iB("ChainError");v.play();continue;}if(g.gC(i)){i.dB=false;i.jB(ZJ,aJ,bJ);}if(g.YC(h)){h.dB=false;h.jB(ZJ,aJ,bJ);}g.direction=1-g.direction;g.dB=false;g.IC=false;var EB=eB.LB.iB("ChainRotate");EB.play();if(g.YC(o)){g.dB=true;g.IC=(g.FB==u.OB||o.FB==u.OB);}if(g.gC(m)){g.dB=true;g.IC=(g.FB==u.OB||m.FB==u.OB);}g.jB(ZJ,aJ,bJ);l=l||g.dB;if(g.gC(i)){i.dB=true;i.IC=(g.FB==u.OB||i.FB==u.OB);i.jB(ZJ,aJ,bJ);l=true;}if(g.YC(h)){h.dB=true;h.IC=(g.FB==u.OB||h.FB==u.OB);h.jB(ZJ,aJ,bJ);l=true;}if(l){var IB=eB.LB.iB("ChainLink");IB.play();}tJ();}}}class cB extends BB{static const  QE="Explosion";static const  DD="Unlocked";static const  RE="Finalized";static const  gD="Timeouted";var zI;cB( h, g,[ bubbles=false]):super(h,bubbles){zI=g;} get info{return zI;}}class xB{static const  sC=1;static const  dD=2;static const  eD=3;}class PE extends AB{var JI;PE( j){var g=new KC();g.QC=new aE("Arial",30,0xFFFFFF,DC:true,align:rB.MC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.VB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;JI=new AB();JI.n(g);n(JI);var i=new NC(0.0,1.0,1.5,MB.sB);i.JC=(h){JI.alpha=1-h;JI.y=-h*50;JI.vB=1.0+0.1*SB.sin(h*10);JI.EC=1.0+0.1*SB.cos(h*10);};i.onComplete=(){this.HE();};p.add(i);}}class iF extends AB{var KI;var TI;var eI;var UI;iF(){var m=new CB(GB.LB.q("ExitBox"));n(m);var g=new KC();g.QC=new aE("Arial",24,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=100;g.wordWrap=true;g.text=cC.LB.pC("GENexitquery");g.x=47;g.y=150-g.KE/2;g.VB=false;n(g);KI=new oD(7,GB.LB.q("ExitGauge"),ID.xD);KI.x=268;KI.y=25;KI.addEventListener("TimeOver",dJ);n(KI);KI.RD("TimeOver",0);KI.start();var i=new CB(GB.LB.q("ExitYesButtonNormal"));var j=new CB(GB.LB.q("ExitYesButtonPressed"));TI=new tC(i,i,j,j);TI.x=68;TI.y=239;TI.addEventListener(t.WC,hJ);n(TI);var h=new CB(GB.LB.q("ExitNoButtonNormal"));var k=new CB(GB.LB.q("ExitNoButtonPressed"));eI=new tC(h,h,k,k);eI.x=173;eI.y=232;eI.addEventListener(t.WC,jJ);n(eI);this.addEventListener(BB.uC,(l)=>p.add(KI));this.addEventListener(BB.wC,(l)=>p.remove(KI));} kJ( g){if(UI!=null){UI(g);UI=null;}} hJ( g){kJ(true);} jJ( g){kJ(false);} dJ( g){kJ(false);}show( g){UI=g;}}class cD{var zE;var ZF;var aF;var angle;var cF;var YB;}class JB{var FI;var GI;var QI;var WI;var bI;var dI;var kI;var oI;var rI;var vI;var yI;JB( h, g){FI=h;GI=g;QI=u.CD;WI=-1000;bI=-1000;dI=false;kI=false;oI=false;rI=null;vI=null;yI=null;} get color=>FI; set color( g){FI=g;} get direction=>GI; set direction( g){GI=g;} get FB=>QI; set FB( g){QI=g;} get dB=>dI; set dB( g){dI=g;} get IC=>kI; set IC( g){kI=g;} get empty=>oI; set empty( g){oI=g;} TD( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.FB!=u.yB&&QI!=u.yB;return h;} YC( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.direction==0&&GI==0&&g.FB!=u.yB&&QI!=u.yB;return h;} gC( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.direction==1&&GI==1&&g.FB!=u.yB&&QI!=u.yB;return h;} get x=>WI; set x( g){WI=g;if(rI!=null)rI.x=g;if(vI!=null)vI.x=g;if(yI!=null)yI.x=g;} get y=>bI; set y( g){bI=g;if(rI!=null)rI.y=g;if(vI!=null)vI.y=g;if(yI!=null)yI.y=g;} set YF( h){if(rI!=null){var g=1+0.3*SB.sin(h*SB.PI);rI.vB=g;rI.EC=g;}} jB( g, h, i){if(rI!=null){rI.parent.uB(rI);rI=null;}if(vI!=null){vI.parent.uB(vI);vI=null;}if(yI!=null){yI.parent.uB(yI);yI=null;}if(empty==false){switch (QI){case u.OB:rI=new gH(GI);rI.x=WI;rI.y=bI;g.n(rI);break;case u.yB:rI=GB.hD(u.yB);rI.x=WI;rI.y=bI;g.n(rI);break;default:rI=GB.fD(FI,GI);rI.x=WI;rI.y=bI;g.n(rI);break;}if(dI){vI=kI?new eH(GI):GB.kF(FI,GI);vI.x=WI+((GI==0)?25:0);vI.y=bI+((GI==1)?25:0);h.n(vI);}switch (QI){case u.CD:break;case u.yB:break;case u.OB:break;default:yI=new fH(QI);yI.x=WI;yI.y=bI;i.n(yI);break;}}}}class eF extends AB{var II;var SI;var cI;var lI;var KI;var qI;var sI;var uI;var xI;var HI;var BJ;var CJ;var DJ;var EJ;var GJ;var HJ;var IJ;var KJ;var LJ;eF(){var j=new CB(GB.LB.q("ShuffleButtonNormal"));var h=new CB(GB.LB.q("ShuffleButtonPressed"));SI=new tC(j,j,h,h);SI.addEventListener(t.WC,YJ);SI.x=530;SI.y=525;n(SI);var g=new CB(GB.LB.q("ExitButtonNormal"));var i=new CB(GB.LB.q("ExitButtonPressed"));cI=new tC(g,g,i,i);cI.addEventListener(t.WC,gJ);cI.x=700;cI.y=500;n(cI);II=new fF();II.x=540;II.y=-1000;n(II);KI=new oD(10,GB.LB.q("TimeGauge"),ID.rD);KI.x=659;KI.y=244;KI.addEventListener("TimeShort",iJ);KI.addEventListener("TimeOver",dJ);n(KI);p.add(KI);qI=new hF();qI.x=640;qI.y=230;n(qI);sI=new jF();sI.x=665;sI.y=160;n(sI);uI=new KC();uI.QC=new aE("Arial",30,0xD0D0D0,DC:true,align:rB.MC);uI.width=140;uI.height=36;uI.wordWrap=false;uI.x=646;uI.y=130;uI.VB=false;uI.text="0";uI.vB=0.9;n(uI);xI=new KC();xI.QC=new aE("Arial",20,0xFFFFFF,DC:true,align:rB.MC);xI.width=44;xI.height=30;xI.wordWrap=false;xI.x=610;xI.y=559;xI.VB=false;xI.text="3x";n(xI);GJ=new AB();n(GJ);HJ=new AB();n(HJ);IJ=new AB();n(IJ);KJ=eB.LB.iB("Intro");LJ=KJ.play();} start(){HI=1;BJ=1;EJ=0;CJ=3;var g=new bD(cC.LB.pC("ESCStartText"));HJ.n(g);p.fB(()=>qI.PF(21),1);g.show(()=>p.fB(()=>nJ(),0.5));} nJ(){if(lI!=null&&this.contains(lI))GJ.uB(lI);var m=HI;var g=0;var h=0;switch (HI){case 01:h=50;lI=new gF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;lI=new gF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;lI=new gF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;lI=new gF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;lI=new gF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;lI=new gF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;lI=new gF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;lI=new gF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;lI=new gF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;lI=new gF(g=80+(HI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}DJ=g;if(CJ<3){CJ++ ;xI.text="${CJ}x";}lI.addEventListener(cB.QE,oJ);lI.addEventListener(cB.DD,pJ);lI.addEventListener(cB.RE,qJ);lI.addEventListener(cB.gD,rJ);lI.x=20;lI.y=16;lI.VB=false;GJ.n(lI);KI.reset(h);KI.RD("TimeShort",9);KI.RD("TimeOver",0);KI.pause();II.level=m;II.AF=g;II.y=-210;var k=new mB(II,0.4,MB.sB);k.XB("y",-90);p.add(k);var j=new bD(cC.LB.pC("ESCLevelBoxText").replaceAll("{0}","${g}"));HJ.n(j);j.show((){lI.VB=true;KI.start();if(KJ!=null){var i=new NC(1.0,0.0,4.0,MB.OC);i.JC=(l){LJ.FC.volume=l;LJ.FC=LJ.FC;};i.onComplete=(){LJ.stop();qI.KH();};p.add(i);KJ=null;}});} iJ( g){sI.start();} dJ( g){lI.bF(xB.eD);} pJ( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new PE(g);i.x=k.x;i.y=k.y;GJ.n(i);EJ=EJ+g;uI.text="${EJ}";} oJ( j){var g=DJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;DJ=g;II.AF=g;if(g==0)lI.bF(xB.dD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}EJ=EJ+h*k;uI.text="${EJ}";} qJ( m){KI.pause();sI.stop();var l=eB.LB.iB("Laugh");var k=eB.LB.iB("LevelUp");l.play();qI.PF(3);var g=GB.lF();g.x=55;g.y=260;GJ.n(g);p.fB((){lI.GF();k.play();},2.0);p.fB((){var j=(KI.TH*1000).toInt();var h=new PE(j);h.x=704;h.y=360;GJ.n(h);EJ=EJ+j;uI.text="${EJ}";},2.5);var i=new mB(II,0.5,MB.sB);i.XB("y",-210);i.delay=3.0;p.add(i);p.fB((){GJ.uB(g);},3.5);p.fB((){HI++ ;nJ();},4.0);} rJ( j){sI.stop();lI.GF();var g;var i;if(BJ>0){BJ-- ;g=new bD(cC.LB.pC("GEN2ndchancetime"));HJ.n(g);i=eB.LB.iB("LevelUp");i.play();g.show((){p.fB(()=>nJ(),0.5);var h=new mB(II,0.5,MB.sB);h.XB("y",-210);p.add(h);});}else{g=new bD(cC.LB.pC("GENtimeup"));HJ.n(g);i=eB.LB.iB("GameOver");i.play();g.show((){p.fB(()=>uJ(),0.5);var h=new mB(II,0.5,MB.sB);h.XB("y",-210);p.add(h);});}} YJ( h){if(lI!=null&&CJ>0){var g=lI.XF();if(g){CJ=CJ-1;xI.text="${CJ}x";}}} gJ( j){var h=new AB();h.n(new CB(new DB(800,600,false,0x000000)));h.alpha=0.6;IJ.n(h);var g=new iF();g.x=235;g.y=150;IJ.n(g);g.show(( i){IJ.uB(g);if(i==false)IJ.uB(h);else wJ(false);});}uJ(){var h=new AB();var j=new CB(GB.LB.q("ExitBox"));h.n(j);var g=new KC();g.QC=new aE("Arial",30,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=cC.LB.pC("GENgameover");g.x=47;g.y=30+(g.height-g.KE)/2;g.VB=false;h.n(g);h.x=110;h.y=-h.height;HJ.n(h);var k=eB.LB.iB("Laugh");p.fB(()=>k.play(),0.3);var i=new mB(h,0.3,MB.sB);i.XB("y",150);p.add(i);p.fB(()=>wJ(true),5.0);h.addEventListener(t.WC,( l)=>wJ(true));}var yJ=false; wJ( g){KI.pause();if(yJ==false){yJ=true;}}}class GB{static var LB;static  fD( i, h){var g=new CB(LB.RC("Elements").q("Chain${i}${h}"));g.TC=25;g.UC=25;return g;}static  kF( i, h){var g=new CB(LB.RC("Elements").q("Link${i}${h}"));g.TC=25;g.UC=25;return g;}static  hD( h){var g=new CB(LB.RC("Elements").q(h));g.TC=25;g.UC=25;return g;}static  lF(){var m=new AB();var l=0;var o=LB.RC("Levelup");for(int k=0;k<7;k++ ){var g=new CB(o.q("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new AB();h.n(g);h.x=l+g.width/2;h.vB=0;h.EC=0;m.n(h);var i=new mB(h,2.0,MB.qG);i.XB("scaleX",1.0);i.XB("scaleY",1.0);i.delay=k*0.05;var j=new mB(h,0.4,MB.OC);j.XB("scaleX",0.0);j.XB("scaleY",0.0);j.delay=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  nF( h){var i=LB.RC("Elements");var g=new List<DB>();g.add(i.q("JokerChain${h}0"));g.add(i.q("JokerChain${h}1"));g.add(i.q("JokerChain${h}2"));g.add(i.q("JokerChain${h}3"));g.add(i.q("JokerChain${h}4"));return g;}static  oF( h){var i=LB.RC("Elements");var g=new List<DB>();g.add(i.q("JokerLink${h}0"));g.add(i.q("JokerLink${h}1"));g.add(i.q("JokerLink${h}2"));g.add(i.q("JokerLink${h}3"));g.add(i.q("JokerLink${h}4"));return g;}static  pF( h){var i=LB.RC("Locks");var g=new List<DB>();g.add(i.q("Lock${h}0"));g.add(i.q("Lock${h}1"));g.add(i.q("Lock${h}2"));g.add(i.q("Lock${h}3"));g.add(i.q("Lock${h}4"));return g;}static  qF(){var h=LB.RC("Head");var g=new List<DB>();g.add(h.q("Head1"));g.add(h.q("Head2"));g.add(h.q("Head3"));g.add(h.q("Head2"));g.add(h.q("Head1"));return g;}static  rF(){var h=LB.RC("Alarm");var g=new List<DB>();g.add(h.q("Alarm0"));g.add(h.q("Alarm1"));g.add(h.q("Alarm2"));g.add(h.q("Alarm3"));g.add(h.q("Alarm4"));g.add(h.q("Alarm5"));return g;}}class hF extends AB{var LI;var VI;var iI;hF(){LI=GB.qF();VI=new CB(LI[0]);VI.x=-VI.width/2;VI.y=-VI.height/2;n(VI);iI=null;} PF( g){p.remove(iI);iI=new NC(0,g,0.5*g,MB.OC);iI.JC=(h){var i=((h*LI.length)%LI.length).toInt();VI.QB=LI[i];VI.y=SB.sin(h*2*SB.PI)*3-VI.height/2;};p.add(iI);} KH(){p.remove(iI);VI.QB=LI[0];}}class fF extends AB{var HI;var RI;var YI;var gI;var mI;fF(){n(new CB(GB.LB.q("InfoBox")));RI=new KC();RI.QC=new aE("Arial",35,0xFFFFFF,DC:true,align:rB.MC);RI.width=220;RI.height=40;RI.wordWrap=false;RI.text="Level 1";RI.x=20;RI.y=115;RI.YB=-2*SB.PI/180;n(RI);gI=new KC();gI.QC=new aE("Arial",25,0xFFFFFF,DC:true,align:rB.MC);gI.width=220;gI.height=30;gI.wordWrap=false;gI.text="40";gI.x=-gI.width/2;gI.y=-gI.height/2;gI.YB=-2*SB.PI/180;mI=new AB();mI.n(gI);mI.x=150;mI.y=172;n(mI);var g=GB.fD(3,0);g.x=110;g.y=171;g.YB=-2*SB.PI/180;g.vB=g.EC=0.6;n(g);} set level( g){HI=g;RI.text="Level ${HI}";} set AF( g){YI=g;gI.text="${YI}";}}class BD extends AB{var FI;var OI;var ZI;var jI;BD( g){FI=g;ZI=GB.pF(g);jI=true;OI=new CB(ZI[0]);OI.x=-34;OI.y=-50;n(OI);} get AD=>jI; set AD( g){jI=g;} WF( g){OI.QB=ZI[g?0:4];} WH(){var i=new NC(0.0,1.0,2.0,MB.sB);i.JC=(j){vB=EC=1.0+0.2*SB.sin(j*4*SB.PI);};var g=new mB(this,0.2,MB.sB);g.XB("alpha",0.0);g.delay=2.0;g.onComplete=()=>WF(jI);var h=new mB(this,0.2,MB.wE);h.XB("alpha",1);h.delay=2.2;p.add(i);p.add(g);p.add(h);}}class eH extends AB implements kB{var OI;var fI;var aI;eH( g){this.VB=false;aI=0.0;fI=GB.oF(g);OI=new CB(fI[0]);OI.x=-25;OI.y=-25;n(OI);addEventListener(BB.uC,(h)=>p.add(this));addEventListener(BB.wC,(h)=>p.remove(this));} CC( g){aI+= g;var h=(aI*10).toInt()%fI.length;OI.QB=fI[h];return true;}}class bD extends AB{var MI;var UI;bD( h){var i=new CB(GB.LB.q("MessageBox"));n(i);var g=new KC();g.QC=new aE("Arial",24,0xFFFFFF,DC:true,align:rB.MC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.KE/2;g.VB=false;n(g);MI=null;addEventListener(t.WC,RJ);}void show( h){this.parent.n(this);this.x=-this.width;this.y=150;UI=h;var g=new mB(this,0.3,MB.sB);g.XB("x",110);g.onComplete=()=>MI=p.fB(fJ,10);p.add(g);} fJ(){if(MI!=null){p.remove(MI);MI=null;UI();var g=new mB(this,0.4,MB.wE);g.XB("x",800);g.onComplete=()=>this.parent.uB(this);p.add(g);}} RJ( g){fJ();}}class gH extends AB implements kB{var OI;var fI;var aI;gH( g){this.VB=false;aI=0.0;fI=GB.nF(g);OI=new CB(fI[0]);OI.x=-25;OI.y=-25;n(OI);addEventListener(BB.uC,(h)=>p.add(this));addEventListener(BB.wC,(h)=>p.remove(this));} CC( g){aI+= g;var h=(aI*10).toInt()%fI.length;OI.QB=fI[h];return true;}}class eB{static var LB;}class rC{var value=0; WD([ inc=1])=>(value+= inc); EF([ dec=1])=>(value-= dec);}class fH extends AB implements kB{var OI;var aI;fH( h){this.VB=false;aI=0.0;OI=GB.hD(h);n(OI);addEventListener(BB.uC,(g)=>p.add(this));addEventListener(BB.wC,(g)=>p.remove(this));} CC( g){aI+= g;this.YB=SB.sin(aI*7)*10*SB.PI/180;return true;}}class u{static const  CD="None";static const  OB="Joker";static const  yB="Block";static const  SE="Double";static const  TE="Quint";}class cC{static var LB;}class QE extends AB implements kB{var wI;var aI;QE( s, o){wI=new List<cD>();aI=0.0;this.VB=false;var v=GB.fD(s,o);var m=new SB.Random();var i;var l;var EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=SB.PI*1.15;YB=-SB.PI*2;}if(g==1&&h==0){i=SB.PI*1.85;YB=SB.PI*2;}if(g==1&&h==1){i=SB.PI*0.15;YB=SB.PI*2;}if(g==0&&h==1){i=SB.PI*0.85;YB=-SB.PI*2;}i=i+0.2*SB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new CB(v.QB);j.SD=new PB(g*25,h*25,25,25);j.TC=12.5+g*25;j.UC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);var k=new cD();k.zE=j;k.ZF=g*25+12.5;k.aF=h*25+12.5;k.angle=i;k.cF=l;k.YB=YB;wI.add(k);}}} CC( m){aI=SB.min(0.8,aI+m);var v=981.0;for(int h=0;h<wI.length;h++ ){var g=wI[h];var i=g.zE;var j=g.angle;var k=g.cF;var l=g.YB;var o=g.ZF+aI*(SB.cos(j)*k);var s=g.aF+aI*(SB.sin(j)*k+aI*v*0.5);i.x=o;i.y=s;i.YB=aI*l;}if(aI>=0.6)this.alpha=(0.8-aI)/0.2;if(aI>=0.8)this.HE();return (aI<0.8);}}var ED;var dC;var FD;var p;var VC;var GD;var zB; main(){ED=new oC("StageBackground",bC.query('#stageBackground'));dC=new oC("StageForeground",bC.query('#stageForeground'));FD=new wF();FD.yE(ED);FD.yE(dC);p=FD.HH;var g=DB.xE("images/Loading.png");g.then((h){VC=new CB(h);VC.TC=20;VC.UC=20;VC.x=400;VC.y=270;dC.n(VC);GD=new mB(VC,100,MB.OC);GD.XB("rotation",100.0*2.0*SB.PI);p.add(GD);zB=new KC();zB.QC=new aE("Arial",20,0xA0A0A0,DC:true);zB.width=240;zB.height=40;zB.text="... loading ...";zB.x=400-zB.YH/2;zB.y=320;zB.VB=false;dC.n(zB);mF();});} mF(){var g=new jC();g.hB("Background","images/Background.jpg");g.hB("ExitBox","images/ExitBox.png");g.hB("ExitButtonNormal","images/ExitButtonNormal.png");g.hB("ExitButtonPressed","images/ExitButtonPressed.png");g.hB("ExitGauge","images/ExitGauge.png");g.hB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.hB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.hB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.hB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.hB("InfoBox","images/InfoBox.png");g.hB("MessageBox","images/MessageBox.png");g.hB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.hB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.hB("TimeGauge","images/TimeGauge.png");g.yC("Alarm","images/AlarmTextureAtlas.json",eC.nC);g.yC("Head","images/HeadTextureAtlas.json",eC.nC);g.yC("Elements","images/ElementsTextureAtlas.json",eC.nC);g.yC("Levelup","images/LevelupTextureAtlas.json",eC.nC);g.yC("Locks","images/LocksTextureAtlas.json",eC.nC);g.bB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.bB("BonusUniversal","sounds/BonusUniversal.mp3");g.bB("ChainBlast","sounds/ChainBlast.mp3");g.bB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.bB("ChainError","sounds/ChainError.mp3");g.bB("ChainFall","sounds/ChainFall.mp3");g.bB("ChainHelp","sounds/ChainHelp.mp3");g.bB("ChainLink","sounds/ChainLink.mp3");g.bB("ChainRotate","sounds/ChainRotate.mp3");g.bB("Click","sounds/Click.mp3");g.bB("GameOver","sounds/GameOver.mp3");g.bB("Laugh","sounds/Laugh.mp3");g.bB("LevelUp","sounds/LevelUp.mp3");g.bB("PointsCounter","sounds/PointsCounter.mp3");g.bB("Unlock","sounds/Unlock.mp3");g.bB("Warning","sounds/Warning.mp3");g.bB("Intro","sounds/Intro.mp3");g.nB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.nB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.nB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.nB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.nB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.nB("ESCNoActionHint","Press on the chain links to twist them.");g.nB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.nB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.nB("ESCtogo","Chain links:");g.nB("GENexitquery","Do you really want to quit the game?");g.nB("GEN2ndchancetime","Time is up. Second chance!");g.nB("GENtimeup","Sorry! Your time is up.");g.nB("GENgameover","Game Over");g.load().then((j){dC.uB(VC);dC.uB(zB);p.remove(GD);GB.LB=g;eB.LB=g;cC.LB=g;var i=new CB(GB.LB.q("Background"));ED.n(i);ED.SH=iC.vD;var h=new eF();dC.n(h);h.start();});}class nD implements kB{var OK=0.0;var hK=0.0;var sK=1;var EL;nD( g, h){EL=g;hK=SB.max(h,0.0001);} CC( h){var g=OK+h;while (g>=hK&&sK>0){OK=hK;sK-- ;EL();g-= hK;}if(sK==0)return false;OK=g;return true;} get totalTime=>hK; get currentTime=>OK;}class aB{var YK; zG( g){return YK!=null&&YK.containsKey(g);} addEventListener( g, h,[ useCapture=false]){eL(g).add(h,useCapture);} KB( g){lM(g,this,this,fC.LD);}ZE get on=>new ZE(this); lM( g, i, k, j){if(YK!=null){var h=YK[g.type];if(h!=null){g.CN=i;g.DN=k;g.xM=j;g.GN=false;g.IN=false;h.KB(g);}}} eL( h){if(YK==null)YK=new Map<String,UB>();var g=YK[h];if(g==null)g=YK[h]=new UB(this,h);return g;}}class xF{var UD;var aD;xF(this.UD,this.aD);}class eC{static const  FG="json";static const  nC="jsonarray";}class ZB{var HK;var kK;ZB(){HK=new bC.ImageElement();kK=new List<YE>();}static  cG( o, RB){var m=new Completer<ZB>();var i=new ZB();switch (RB){case eC.FG:case eC.nC:var k=new bC.HttpRequest();k.open('GET',o,true);k.on.load.add((pB){ s( l, g){var EB=oG(l);var h=new YE(EB,i);h.lK=g["frame"]["x"].toInt();h.rK=g["frame"]["y"].toInt();h.zK=g["frame"]["w"].toInt();h.FL=g["frame"]["h"].toInt();h.ML=g["spriteSourceSize"]["x"].toInt();h.QL=g["spriteSourceSize"]["y"].toInt();h.TL=g["sourceSize"]["w"].toInt();h.aL=g["sourceSize"]["h"].toInt();h.gL=g["rotated"] as bool;i.kK.add(h);}var v=dH.JSON.parse(k.responseText);var j=v["frames"];var IB=v["meta"];if(j is List)for(var g in j)s(g["filename"],g);if(j is Map)for(String l in j.keys)s(l,j[l]);i.HK.on.load.add((gB)=>m.complete(i));i.HK.on.error.add((gB)=>m.completeException("Failed to load image."));i.HK.src=pG(o,IB["image"]);});k.on.error.add((pB)=>m.completeException("Failed to load json file."));k.send();break;}return m.future;} get BH=>HK; q( i){var h;for(int g=0;g<kK.length&&h==null;g++ )if(kK[g].name==i)h=new DB.EI(kK[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}static  oG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,ignoreCase:true);var i=h.firstMatch(g);return i.group(1);}static  pG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,ignoreCase:true);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";}}class JD{static final qD=new JD();var cL;JD(){cL=new List<UB>();} add( g){cL.add(g);} remove( h){var g=cL.indexOf(h);if(g!=-1)cL[g]=null;} KB( j){var k=cL.length;var h=0;for(int g=0;g<k;g++ ){var i=cL[g];if(i!=null){j.CN=i.HF;j.DN=i.HF;j.xM=fC.LD;i.KB(j);if(h!=g)cL[h]=i;h++ ;}}for(int g=k;g<cL.length;g++ )cL[h++ ]=cL[g];cL.length=h;}}class yF extends BB{var MK;yF( g):super(BB.wD,false){MK=g;} get CE=>false;}class t extends BB{static const  WC="click";static const  PG="doubleClick";static const  MD="mouseDown";static const  yD="mouseUp";static const  pE="mouseMove";static const  OD="mouseOut";static const  qE="mouseOver";static const  eG="mouseWheel";static const  sE="middleClick";static const  hG="middleMouseDown";static const  jG="middleMouseUp";static const  tE="rightClick";static const  kG="rightMouseDown";static const  lG="rightMouseUp";var mM,nM;var oM,pM;var NN;var uL;var LM;var wL;var zL;var RN;var SN;var TN;t( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);mM=nM=0;oM=pM=0;NN=false;uL=false;LM=false;wL=false;zL=false;RN=0;SN=0;TN=0;}set UN( g){mM=g.x;nM=g.y;}set VN( g){oM=g.x;pM=g.y;} get JF=>mM; get KF=>nM; get PC=>NN; get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL; get zC=>RN;}class hC extends BB{static const  sD="keyDown";static const  hE="keyUp";var uL;var wL;var zL;var CM;var LM;var PM;var SM;var UM;hC( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);uL=false;wL=false;zL=false;CM=false;LM=false;PM=0;SM=0;UM=0;} get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL; get charCode=>PM; get keyCode=>SM; get keyLocation=>UM;}class BC extends BB{static const  gE="touchBegin";static const  iE="touchEnd";static const  kE="touchCancel";static const  oE="touchMove";static const  aG="touchOver";static const  bG="touchOut";var hM;var jM;var mM,nM;var oM,pM;var uL;var LM;var wL;var zL;var rM;var tM;var uM;BC( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);hM=0;jM=false;mM=nM=0;oM=pM=0;uL=false;LM=false;wL=false;zL=false;rM=1.00;tM=0;uM=0;}set UN( g){mM=g.x;nM=g.y;}set VN( g){oM=g.x;pM=g.y;} get ZD=>hM; get JF=>mM; get KF=>nM; get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL;}class jD implements kB{var WK;var iK;var uK;jD(){uK=0.0;WK=new List<kB>();iK=0;} add( g){if(g==null)return;if(iK>=WK.length)WK.add(g);else WK[iK]=g;iK++ ;} remove( h){if(h==null)return;for(int g=0;g<iK;g++ )if(WK[g]==h)WK[g]=null;} fB( h, i){var g=new nD(h,i);add(g);return g;} CC( j){uK+= j;var k=iK;var h=0;for(int g=0;g<k;g++ ){var i=WK[g];if(i!=null&&i.CC(j)){if(h!=g)WK[h]=i;h++ ;}}for(int g=k;g<iK;g++ )WK[h++ ]=WK[g];for(int g=h;g<iK;g++ )WK[g]=null;iK=h;return true;}}class XE extends BB{static const  NG="textInput";var SK="";XE( g,[ bubbles=false]):super(g,bubbles){}}class iC{static const  pD="auto";static const  LG="stop";static const  vD="once";}class tF{tF();}class YE{var GK;var XK;var lK;var rK;var zK;var FL;var ML;var QL;var TL;var aL;var gL;YE( g, h){GK=g;XK=h;} get ZH=>XK; get name=>GK; get xG=>lK; get yG=>rK; get wG=>zK; get vG=>FL; get offsetX=>ML; get offsetY=>QL; get NH=>TL; get MH=>aL; get VH=>gL;}abstract class w extends aB implements UE{var oK=0.0;var vK=0.0;var DL=0.0;var IL=0.0;var OL=1.0;var UL=1.0;var ZL=0.0;var hL;var jL;var qL=1.0;var sL=true;var GK="";var EM=null;var mask;var bM;var eM;w(){hL=new TB.CI();jL=true;bM=new TB.CI();eM=new TB.CI();} get x=>oK; get y=>vK; get TC=>DL; get UC=>IL; get vB=>OL; get EC=>UL; get YB=>ZL; get alpha=>qL; get visible=>sL; get name=>GK; get parent=>EM;dE get on=>new dE(this); get root{var g=this;while (g.EM!=null)g=g.EM;return g;} get YD{var g=this.root;if(g is oC)return g;return null;} set x( g){oK=g;jL=true;} set y( g){vK=g;jL=true;} set TC( g){DL=g;jL=true;} set UC( g){IL=g;jL=true;} set vB( g){OL=g;jL=true;} set EC( g){UL=g;jL=true;} set YB( g){ZL=g;jL=true;} set alpha( g){qL=g;jL=true;} get width=>tB(AN).width; get height=>tB(AN).height; set width( h){this.vB=1;var g=this.width;this.vB=(g!=0.0)?h/g:1.0;} set height( h){this.EC=1;var g=this.height;this.EC=(g!=0.0)?h/g:1.0;} HE(){if(EM!=null)EM.uB(this);} get AN{if(jL){jL=false;if(ZL==0.0){hL.VF(OL,0.0,0.0,UL,oK-DL*OL,vK-IL*UL);}else{var g=SB.cos(ZL);var h=SB.sin(ZL);var i=OL*g;var l=OL*h;var k=-UL*h;var j=UL*g;var m=oK-DL*i-IL*k;var o=vK-DL*l-IL*j;hL.VF(i,l,k,j,m,o);}}return hL;} tB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.zH();returnRectangle.x=g.GC;returnRectangle.y=g.HC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} SC( g, h){if(tB(eM).contains(g,h))return this;return null;} qC( h){bM.AH();for(w g=this;g!=null;g=g.EM)bM.concat(g.AN);bM.GH();return bM.aH(h);} KB( h){var g=null;if(h.CE||h.bubbles)for(w j=EM;j!=null;j=j.EM)if(j.zG(h.type)){if(g==null)g=new List<w>();g.add(j);}if(h.CE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.IE==false)g[i].lM(h,this,g[i],fC.fE);if(h.IE==false)lM(h,this,this,fC.LD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.IE==false)g[i].lM(h,this,g[i],fC.RG);} XN( h){for(var g=h;g!=null;g=g.EM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");EM=h;} oB( g);}abstract class lB extends w{var uG=false;var VB=true;var yH=true;var tabIndex=0;bE get on=>new bE(this);}abstract class lC extends lB{var qK;var wK=true;var HL=true;lC(){qK=new List<w>();}AG get on=>new AG(this); n( g){if(g.parent==this){var h=qK.indexOf(g);qK.removeAt(h);qK.add(g);}else{rG(g,qK.length);}} rG( g, h){if(h<0&&h>qK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){qK.removeAt(qK.indexOf(g));if(h>qK.length)h-- ;qK.insertRange(h,1,g);}else{g.HE();g.XN(this);qK.insertRange(h,1,g);g.KB(new BB(BB.GG,true));if(this.YD!=null)YN(g,new BB(BB.uC));}} uB( h){var g=qK.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");RH(g);} RH( g){if(g<0&&g>=qK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=qK[g];h.KB(new BB(BB.YG,true));if(this.YD!=null)YN(h,new BB(BB.wC));h.XN(null);qK.removeAt(g);} contains( g){for(;g!=null;g=g.EM)if(g==this)return true;return false;} tB( m,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.zH();if(qK.length==0)return super.tB(m,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var o=qK.length;for(int j=0;j<o;j++ ){bM.FE(qK[j].AN,m);var g=qK[j].tB(bM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>l)l=g.right;if(g.bottom>k)k=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=l-h;returnRectangle.height=k-i;return returnRectangle;} SC( s, v){var l=null;for(int j=qK.length-1;j>=0;j-- ){var i=qK[j];if(i.visible){var g=i.AN;var m=s-g.GC;var k=v-g.HC;var EB=(g.d*m-g.c*k)/g.ZC;var o=(g.a*k-g.b*m)/g.ZC;var h=i.SC(EB,o);if(h!=null){if(h is lB)if(h.VB)return wK?h:this;l=this;}}}return l;} oB( i){for(int g=0;g<qK.length;g++ ){var h=qK[g];if(h.visible)i.UF(h);}} YN( g, j){g.KB(j);if(g is lC){var i=new List<w>.from(g.qK);var k=i.length;for(int h=0;h<k;h++ )YN(i[h],j);}}}class WE{var target=null;var PC=false;var DE=0;var zC=0;var NF,OF;var LF,MF;WE(this.NF,this.OF,this.LF,this.MF);}class jC{var LK;var fK;var AL;var LL;var SL;var YL;var dL;jC(){LK=new Map<String,DB>();fK=new Map<String,HB>();AL=new Map<String,ZB>();LL=new Map<String,String>();SL=null;YL=0;dL=0;} hB( h, i){var g=DB.xE(i);YL++ ;g.then(( j){LK[h]=j;YL-- ;zM();});g.handleException((k){dL++ ;YL-- ;zM();});} bB( h, i){var g=HB.EG(i);YL++ ;g.then(( j){fK[h]=j;YL-- ;zM();});g.handleException((k){dL++ ;YL-- ;zM();});} yC( i, k, h){var g=ZB.cG(k,h);YL++ ;g.then(( j){AL[i]=j;YL-- ;zM();});g.handleException((l){dL++ ;YL-- ;zM();});} nB( h, g){LL[h]=g;} load(){SL=new Completer<jC>();zM();return SL.future;} q( g){if(LK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return LK[g];} iB( g){if(fK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return fK[g];} RC( g){if(AL.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return AL[g];} pC( g){if(LL.containsKey(g)==false)return "[[${g}]]";return LL[g];}zM(){if(SL!=null&&YL==0){if(dL==0)SL.complete(this);else SL.completeException(this);}}}class fC{static const  fE=1;static const  LD=2;static const  RG=3;}class AB extends lC{var mH=false;var ME=false;}class CB extends w{var QB;var PH;var SD;CB([this.QB=null,this.PH="auto"]){SD=null;} tB( h,[ returnRectangle]){var g=(QB!=null)?QB.width:0;var i=(QB!=null)?QB.height:0;return BE(h,g,i,returnRectangle);} SC( g, h){if(QB!=null&&g>=0.0&&h>=0.0&&g<QB.width&&h<QB.height)return this;return null;} oB( g){if(QB!=null){if(SD==null)QB.oB(g);else QB.TF(g,SD);}}}class VE{static const  OG="none";static const  UG="touchPoint";}abstract class UE{ oB( g);}class NB{var x;var y;NB(this.x,this.y);NB.zH():this(0,0); get length=>SB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new NB(this.x+g.x,this.y+g.y); EE( g){this.x=g.x;this.y=g.y;} equals( g)=>this.x==g.x&&this.y==g.y;}class PB{var x;var y;var width;var height;PB(this.x,this.y,this.width,this.height);PB.zH():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new NB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0); EE( g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class TB{var BK,CK,DK,FK,IK,KK;var QK;TB.CI():BK=1.0,CK=0.0,DK=0.0,FK=1.0,IK=0.0,KK=0.0,QK=1.0; get a=>BK; get b=>CK; get c=>DK; get d=>FK; get GC=>IK; get HC=>KK; get ZC=>QK; aH( g){return new NB(g.x*BK+g.y*DK+IK,g.x*CK+g.y*FK+KK);} concat( g){var m=BK;var v=CK;var EB=DK;var s=FK;var l=IK;var o=KK;var RB=QK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var gB=g.GC;var IB=g.HC;var pB=g.ZC;BK=(m*j+v*i);CK=(m*k+v*h);DK=(EB*j+s*i);FK=(EB*k+s*h);IK=(l*j+o*i+gB);KK=(l*k+o*h+IB);QK=(RB*pB);} AH(){BK=1.0;CK=0.0;DK=0.0;FK=1.0;IK=0.0;KK=0.0;QK=1.0;} GH(){var j=BK;var m=CK;var l=DK;var k=FK;var h=IK;var i=KK;var g=QK;BK=(k/g);CK=-(m/g);DK=-(l/g);FK=(j/g);IK=-(BK*h+DK*i);KK=-(CK*h+FK*i);QK=(1.0/g);} VF( g, j, i, h, k, l){BK=g;CK=j;DK=i;FK=h;IK=k;KK=l;QK=(g*h-j*i);} EE( g){BK=g.a;CK=g.b;DK=g.c;FK=g.d;IK=g.GC;KK=g.HC;QK=g.ZC;} FE( h, g){var o=h.a;var EB=h.b;var IB=h.c;var v=h.d;var m=h.GC;var s=h.HC;var gB=h.ZC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var pB=g.GC;var RB=g.HC;var aC=g.ZC;BK=(o*k+EB*j);CK=(o*l+EB*i);DK=(IB*k+v*j);FK=(IB*l+v*i);IK=(m*k+s*j+pB);KK=(m*l+s*i+RB);QK=(gB*aC);}}class tC extends lB{var LE;var RF;var FF;var VD;var ME=true;var enabled=true;var fL;tC([this.LE,this.RF,this.FF,this.VD]){addEventListener(t.qE,BM);addEventListener(t.OD,BM);addEventListener(t.MD,BM);addEventListener(t.yD,BM);fL=this.LE;} tB( g,[ returnRectangle]){if(fL!=null){bM.FE(fL.AN,g);return fL.tB(bM,returnRectangle);}return super.tB(g,returnRectangle);} SC( k, l){if(this.VD!=null){var g=this.VD.AN;var h=k-g.GC;var i=l-g.HC;var m=(g.d*h-g.c*i)/g.ZC;var j=(g.a*i-g.b*h)/g.ZC;if(this.VD.SC(m,j)!=null)return this;}return null;} oB( g){if(fL!=null)g.UF(fL);} BM( g){if(g.type==t.OD){fL=LE;}else{fL=g.PC?FF:RF;}}}abstract class kB{ CC( g);}class wF{var EK;var PK;var aK;var yK;var KL;wF(){EK=new jD();PK=new List<oC>();aK=double.NAN;yK=JD.qD;KL=new yF(0);bC.window.requestAnimationFrame(JM);} get HH=>EK; JM( g){bC.window.requestAnimationFrame(JM);if(aK.isNaN)aK=g;if(aK>g)aK=g;var j=g-aK;var i=j/1000.0;if(j>=1){aK=g;KL.MK=i;yK.KB(KL);EK.CC(i);for(int h=0;h<PK.length;h++ ){var k=PK[h];k.JH();}}} yE( g){PK.add(g);}}class AC{var NK;var eK;var tK;var CL;AC.BI( j,[ matrix]){NK=j;eK=new List<TB>(100);tK=new List<double>(100);for(int h=0;h<100;h++ ){eK[h]=new TB.CI();tK[h]=1.0;}CL=0;if(matrix!=null)eK[0].EE(matrix);var g=eK[0];var i=tK[0];NK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);NK.globalAlpha=i;} get context=>NK; reset(){CL=0;var g=eK[0];var h=tK[0];NK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);NK.globalAlpha=h;NK.clearRect(0,0,NK.canvas.width,NK.canvas.height);} UF( h){var i=CL;var j=CL+1;var l=eK[i];var g=eK[j];var m=tK[i];var k=tK[j]=h.qL*m;g.FE(h.AN,l);NK.setTransform(g.a,g.b,g.c,g.d,g.GC,g.HC);NK.globalAlpha=k;CL=j;if(h.mask==null){h.oB(this);}else{NK.save();h.mask.oB(this);h.oB(this);NK.restore();}CL=i;}}class sF{var name;var wB;var JE;sF(this.name,this.wB,this.JE);}class zF{var AK;var JK;var ZK;var mK;zF.AI( i, g, h, j){AK=0;JK=new PB(i,g,h,j);} oB( i){var g=i.context;g.beginPath();switch (AK){case 0:g.rect(JK.x,JK.y,JK.width,JK.height);break;case 1:g.arc(ZK.x,ZK.y,ZK.uH,0,SB.PI*2.0,false);break;case 2:g.moveTo(mK[0].x,mK[0].y);for(int h=1;h<mK.length;h++ )g.lineTo(mK[h].x,mK[h].y);break;}g.clip();}}class dE extends ZE{dE( g):super(g);}class AG extends bE{AG( g):super(g);}class bE extends dE{bE( g):super(g); get mouseOut=>this[t.OD]; get mouseMove=>this[t.pE]; get mouseDown=>this[t.MD]; get mouseUp=>this[t.yD]; get mouseWheel=>this[t.eG]; get touchMove=>this[BC.oE]; get touchEnd=>this[BC.iE]; get touchCancel=>this[BC.kE]; get keyUp=>this[hC.hE]; get keyDown=>this[hC.sD];}class BB{static const  GG="added";static const  uC="addedToStage";static const  wD="enterFrame";static const  YG="removed";static const  wC="removedFromStage";var AK;var vM;var xM;var CN;var DN;var GN;var IN;BB( g,[ bubbles=false]){dM(g,bubbles);} dM( g,[ bubbles=false]){AK=g;vM=bubbles;xM=fC.LD;CN=null;DN=null;GN=false;IN=false;} get IE=>GN; get XH=>IN; get type=>AK; get eventPhase=>xM; get bubbles=>vM; get CE=>true; get target=>CN;}class kC{static const  CG=0;static const  HG=1;static const  QG=2;static const  VG=3;static const  mE=4;}class qB{static const  pD="auto";static const  tD="arrow";static const  uD="button";static const  WG="hand";static const  XG="ibeam";static const  ZG="wait";}class ZE{var TG;ZE( g){TG=g;} operator[]( g){return TG.eL(g);}}abstract class HB{static  EG( g){var h=HD.mG;if(h=="WebAudioApi")return lD.EG(g);if(h=="AudioElement")return kD.EG(g);return cE.EG(g);} get length; play([ loop=false, soundTransform]);static var XC;static  uE( g){if(XC==null){XC=new List<String>();var i=new bC.AudioElement();var h=["maybe","probably"];if(h.indexOf(i.canPlayType("audio/ogg",""))!=-1)XC.add("ogg");if(h.indexOf(i.canPlayType("audio/mp3",""))!=-1)XC.add("mp3");if(h.indexOf(i.canPlayType("audio/wav",""))!=-1)XC.add("wav");}var k=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,ignoreCase:true);var j=k.firstMatch(g);if(j==null)throw new ArgumentError("Unsupported file extension.");var l=j.group(1).toLowerCase();if(XC.indexOf(l)==-1&&XC.length>0)g="${g.substring(0,g.length-3)}${XC[0]}";return g;}}abstract class LC extends aB{ get FC; set FC( g); stop();}class WB{var volume;var OH;var sH=1;var tH=0;var xH=1;var wH=0;WB([this.volume=1,this.OH=0]);}class HD{static var PD;static  get QD{if(PD==null){try {PD=new dF.AudioContext();}catch (g){PD=null;}}return PD;}static var xC;static  get mG{if(xC==null){xC=(QD!=null)?"WebAudioApi":"AudioElement";var g=bC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))xC="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))xC="Mock";}return xC;}}class kD extends HB{var UK;var nK;var GL;kD(){GL=new List<KD>();UK=new bC.AudioElement();UK.on.ended.add(nL);nK=new List<bC.AudioElement>();nK.add(UK);bC.document.body.children.add(UK);}static  EG( l){var g=new kD();var j=new Completer<HB>();var i;var h;i=(k){g.UK.on.canPlayThrough.remove(i);g.UK.on.error.remove(h);j.complete(g);};h=(k){g.UK.on.canPlayThrough.remove(i);g.UK.on.error.remove(h);j.completeException("Failed to load audio.");};g.UK.src=HB.uE(l);g.UK.on.canPlayThrough.add(i);g.UK.on.error.add(h);g.UK.load();return j.future;} get length{return UK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new KD(this,loop,soundTransform);} GM( h){var g;if(nK.length==0){g=UK.clone(true);g.on.ended.add(nL);}else{g=nK.removeAt(0);}GL.add(h);return g;} ON( g){var h=g.UK;var i=GL.indexOf(g);GL.removeAt(i);nK.add(h);if(UK.currentTime>0&&UK.ended==false)UK.currentTime=0;} nL(j){var i=j.target;var g=null;for(int h=0;h<GL.length&&g==null;h++ )if(GL[h].UK==i)g=GL[h];if(g!=null)g.stop();}}class KD extends LC{var gK;var UK;var TK;var jK;KD( g, i, h){gK=g;TK=i;jK=h;UK=g.GM(this);UK.loop=TK;this.FC=h;UK.play();} get FC=>jK; set FC( g){jK=g;if(UK!=null)UK.volume=(jK!=null)?jK.volume:1;} stop(){if(UK!=null){if(UK.ended==false)UK.pause();gK.ON(this);UK=null;}}}class lD extends HB{var RK;lD(){if(HD.QD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  EG( o){var i=new lD();var g=new Completer<HB>();var h=new bC.HttpRequest(); l( k){i.RK=k;if(g.future.isComplete==false)g.complete(i);} v(IB){if(g.future.isComplete==false)g.completeException("Failed to decode audio.");} EB(s){var m=HD.QD;m.decodeAudioData(h.response,l,v);} j(s){if(g.future.isComplete==false)g.completeException("Failed to load audio.");}h.open('GET',HB.uE(o),true);h.responseType='arraybuffer';h.on.load.add(EB);h.on.error.add(j);h.send();return g.future;} get length{return RK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new hH(this,loop,soundTransform);}}class hH extends LC{var dK;var jK;var TK;var NL;var VL;hH( j, h, i){dK=j;TK=h;jK=i;var g=HD.QD;NL=g.createGain();NL.connect(g.destination,0,0);NL.gain.value=(jK!=null)?SB.pow(jK.volume,2):1;VL=g.createBufferSource();VL.buffer=dK.RK;VL.loop=h;VL.connect(NL,0,0);VL.start(0);} get FC=>jK; set FC( g){jK=g;NL.gain.value=(jK!=null)?SB.pow(jK.volume,2):1;} stop(){VL.stop(0);}}class cE extends HB{cE(){}static  EG( i){var h=new cE();var g=new Completer<HB>();bC.window.setTimeout(()=>g.complete(h),1);return g.future;} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new WB();return new iH(this,loop,soundTransform);}}class iH extends LC{var TK;var jK;iH( i, h, g){TK=h;jK=g;} get FC=>jK; set FC( g){jK=g;} stop(){}}class uF{static const  JG="pixel";}class KC extends lB{var SK="";var cK=0x000000;var xK=null;var JL=vF.OG;var WL=uF.JG;var AK=BG.DG;var kL=false;var pL=false;var tL=0x000000;var yL=false;var DM=0x000000;var HM=0;var MM=0;var RM;var VM;var WM=true;var ZM=100;var cM=100;var fM=null;var NK=null;KC(){xK=new aE("Arial",12,0x000000);RM=new List<String>();VM=new List<iD>();} get type=>AK; get width=>ZM; get height=>cM; set text( g){SK=g;WM=true;} set QC( g){xK=g;cK=xK.color;WM=true;} set wordWrap( g){kL=g;WM=true;} set width( g){ZM=g;WM=true;} set height( g){cM=g;WM=true;} get YH{bN();return HM;} get KE{bN();return MM;} tB( g,[ returnRectangle]){return BE(g,ZM,cM,returnRectangle);} SC( g, h){if(g>=0&&h>=0&&g<ZM&&h<cM)return this;return null;} oB( g){bN();g.NK.drawImage(fM,0.0,0.0);} fN(){RM.clear();VM.clear();if(kL==false){RM.add(SK);}else{var g=new StringBuffer();var i;var h;for(String o in SK.replaceAll('\r','').split('\n')){for(String j in o.split(' ')){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(NK.measureText(h).width>ZM){if(i>0)h=h.substring(0,i);else j="";RM.add(h);g.clear();g.add(j);}}if(g.isEmpty==false){RM.add(g.toString());g.clear();}}}HM=0;MM=0;for(String h in RM){var l=NK.measureText(h);var m=0;if(xK.align==rB.MC||xK.align==rB.SG)m=(ZM-l.width)/2;if(xK.align==rB.QG||xK.align==rB.MG)m=ZM-l.width;var k=new iD(m,l.width,xK.size,0,0,0);VM.add(k);HM=SB.max(HM,k.width);MM=MM+k.height;}} bN(){if(WM){WM=false;var i=ZM.ceil().toInt();var j=cM.ceil().toInt();if(fM==null){fM=new bC.CanvasElement(width:i,height:j);NK=fM.context2d;}if(fM.width!=i)fM.width=i;if(fM.height!=j)fM.height=j;var g=new StringBuffer();g.add(xK.IF?"italic ":"normal ");g.add("normal ");g.add(xK.DC?"bold ":"normal ");g.add("${xK.size}px ");g.add("${xK.font},sans-serif");NK.font=g.toString();NK.textAlign="start";NK.textBaseline="top";NK.fillStyle=vC(cK);fN();if(pL){NK.fillStyle=vC(tL);NK.fillRect(0,0,ZM,cM);}else{NK.clearRect(0,0,ZM,cM);}var k=0;for(int h=0;h<RM.length;h++ ){var l=VM[h];NK.fillStyle=vC(cK);NK.fillText(RM[h],l.x,k);k+= l.height;}if(yL){NK.strokeStyle=vC(DM);NK.lineWidth=1;NK.strokeRect(0,0,ZM,cM);}}}}class vF{static const  OG="none";}class BG{static const  DG="dynamic";}class mD{static var eE=qB.pD;static var IG=false;static var TG=new aB();static  vE( i){var h=i;var g="auto";if(eE!=qB.pD)h=eE;switch (h){case qB.pD:g="auto";break;case qB.tD:g="default";break;case qB.uD:g="pointer";break;case qB.WG:g="move";break;case qB.XG:g="text";break;case qB.ZG:g="wait";break;}if(IG)g="none";return g;}}class rB{static const  MC="center";static const  MG="end";static const  SG="justify";static const  QG="right";}class iD{var sG;var tG;var height;var GE;var width;var x;iD(this.x,this.width,this.height,this.sG,this.tG,this.GE);}class ID extends w{static const  rD='DIRECTION_UP';static const  jE='DIRECTION_RIGHT';static const  xD='DIRECTION_DOWN';static const  ND='DIRECTION_LEFT';var lL;var oL;var rL;var vL;ID( g,[ direction=ND]){if(direction!=rD&&direction!=xD&&direction!=ND&&direction!=jE){throw new ArgumentError('Invalid Gauge direction!');}lL=direction;oL=1.0;rL=g;vL=new PB.zH();iM();} get ratio=>oL;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;oL=g;iM();} get QB=>rL;set QB( g){rL=g;iM();}iM(){if(rL==null){vL.left=0;vL.top=0;vL.right=0;vL.bottom=0;}else{var h=rL.width;var g=rL.height;switch (lL){case ND:vL.left=((1.0-oL)*h).toInt();vL.top=0;vL.right=h;vL.bottom=g;break;case rD:vL.left=0;vL.top=((1.0-oL)*g).toInt();vL.right=h;vL.bottom=g;break;case jE:vL.left=0;vL.top=0;vL.right=(oL*h).toInt();vL.bottom=g;break;case xD:vL.left=0;vL.top=0;vL.right=h;vL.bottom=(oL*g).toInt();break;}}} tB( h,[ returnRectangle]){var g=(rL!=null)?rL.width:0;var i=(rL!=null)?rL.height:0;return BE(h,g,i,returnRectangle);} SC( g, h){if(rL!=null&&g>=0.0&&h>=0.0&&g<rL.width&&h<rL.height)return this;return null;} oB( g){if(rL!=null)rL.TF(g,vL);}}class aE{var font;var size;var color;var DC;var IF;var bH;var align;var IH;var UH;var CH;var GE;var letterSpacing=0;var kH=0;var lH=false;var rH=false;aE(this.font,this.size,this.color,{this.DC: false,this.IF: false,this.bH: false,this.align: "left",this.IH: 0,this.UH: 0,this.CH: 0,this.GE: 0});}class oD extends ID implements kB{static const  KG='TIME_OUT';var PL=false;var OK=0.0;var hK=0.0;var iL;var mL=true;oD( g, h,[ direction=ID.ND]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');hK=g;BF();} CC( g){if(PL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){PL=true;} pause(){PL=false;} reset([ time=0.0]){pause();time=SB.max(time,0.0);if(time!=0.0){hK=time;BF();}ratio=1.0;} RD( g, h){iL[g]=h/totalTime;} BF(){iL=new Map<String,num>();RD(oD.KG,0);} get totalTime=>hK; get TH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(mL){iL.forEach((j,g){if(g<h&&g>=ratio)KB(new BB(j));});}}}class DB implements UE{var VK;var bK;var pK;var BL;var NK;var RL;var XL;var bL;var lK;var rK;var zK;var FL;DB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){VK=g;bK=h;pK=transparent;var i=new bC.CanvasElement(width:VK,height:bK);NK=i.context2d;NK.fillStyle=pK?dG(fillColor):vC(fillColor);NK.fillRect(0,0,g,h);BL=i;RL=0;}DB.DI( g){VK=g.naturalWidth;bK=g.naturalHeight;pK=true;BL=g;RL=0;}DB.EI( g){VK=g.NH;bK=g.MH;pK=true;BL=g.ZH.BH;RL=g.VH?2:1;XL=g.offsetX.toDouble();bL=g.offsetY.toDouble();lK=g.xG.toDouble();rK=g.yG.toDouble();zK=g.wG.toDouble();FL=g.vG.toDouble();}static  xE( i){var h=new Completer<DB>();var g=new bC.ImageElement();g.on.load.add((j)=>h.complete(new DB.DI(g)));g.on.error.add((j)=>h.completeException("Failed to load image."));g.src=i;return h.future;} get width=>VK; get height=>bK; oB( g){switch (RL){case 0:g.context.drawImage(BL,0.0,0.0);break;case 1:g.context.drawImage(BL,lK,rK,zK,FL,XL,bL,zK,FL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,XL,bL+FL);g.context.drawImage(BL,lK,rK,FL,zK,0.0,0.0,FL,zK);break;}} TF( gB, g){if(g.width<=0.0||g.height<=0.0)return;switch (RL){case 0:gB.context.drawImage(BL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=lK;double h=rK;double v=j+zK;double EB=h+FL;double l=lK-XL+g.x;double m=rK-bL+g.y;double RB=l+g.width;double IB=m+g.height;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double NE=(EB<IB)?EB:IB;double OE=XL-j+s;double aC=bL-h+o;double k=pB-s;double i=NE-o;if(k>0.0&&i>0.0){gB.context.drawImage(BL,s,o,k,i,OE,aC,k,i);}break;case 2:double j=lK;double h=rK;double v=j+FL;double EB=h+zK;double l=lK+bL-g.y+FL-g.height;double m=rK-XL+g.x;double RB=l+g.height;double IB=m+g.width;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double NE=(EB<IB)?EB:IB;double OE=XL-h+o;double aC=bL+v-pB;double k=NE-o;double i=pB-s;if(k>0.0&&i>0.0){gB.context.transform(0.0,-1.0,1.0,0.0,OE,aC+i);gB.context.drawImage(BL,s,o,i,k,0.0,0.0,i,k);}break;}}}typedef  mC(event); vC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class lE{static var nE=false;static var zD=false;static var AE=0;static var gG=VE.OG;static var TG=new aB();static iG(){if(nE==false){nE=true;var g=bC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){zD=true;AE=10;}if(g.contains("Android")){zD=true;AE=10;}if(g.contains("IEMobile")){zD=true;AE=10;}}}static  get nG{iG();return gG;}}class NC extends kB{var xL;var AM;var FM;var IM;var NM;var OM;var TM;var hK;var OK;var XM;var YM;var aM;NC( g, h, i,[ transitionType( ratio)]){xL=g;AM=h;FM=g;IM=(transitionType!=null)?transitionType:MB.OC;OK=0.0;hK=SB.max(0.0001,i);XM=0.0;YM=false;aM=false;} CC( i){if(OK<hK||aM==false){OK=OK+i;if(OK>hK)OK=hK;if(OK>=0.0){if(aM==false){aM=true;if(NM!=null)NM();}var g=OK/hK;var h=IM(g);FM=xL+h*(AM-xL);if(OM!=null)OM(YM?FM.round():FM);if(TM!=null&&OK==hK)TM();}}return OK<hK;} get wB=>xL; get JE=>AM; get totalTime=>hK; get currentTime=>OK; get isComplete=>OK>=hK;set delay( g){if(aM==false)OK=OK+XM-g;XM=g;} set QF( g()){NM=g;} set JC( g( value)){OM=g;} set onComplete( g()){TM=g;}}class UB{var TG;var KM;var QM;UB( h, g){TG=h;KM=g;QM=new List<xF>();} get HF=>TG; add( h,[ useCapture=false]){for(int g=0;g<QM.length;g++ )if(QM[g].UD==h&&QM[g].aD==useCapture)return;if(KM==BB.wD&&QM.length==0)JD.qD.add(this);QM.add(new xF(h,useCapture));} remove( h,[ useCapture=false]){for(int g=0;g<QM.length;g++ ){if(QM[g].UD==h&&QM[g].aD==useCapture){QM=new List<xF>.from(QM);QM.removeAt(g);if(KM==BB.wD&&QM.length==0)JD.qD.remove(this);break;}}} operator+( g){this.add(g,false);} operator-( g){this.remove(g,false);} KB( h){for(int g=0;g<QM.length;g++ )if(h.eventPhase!=fC.fE||QM[g].aD)if(h.XH==false)QM[g].UD(h);}}class rE{static var fG=0;var ZD=fG++ ;var target=null;var XD=false;rE(this.target,this.XD);} dG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static  OC( g){return g;}static  wE( g){return g*g*g;}static  sB( g){g=1.0-g;return 1.0-g*g*g;}static  qG( g){if(g==0.0||g==1.0)return g;return SB.pow(2.0,-10.0*g)*SB.sin((g-0.3/4.0)*(2.0*SB.PI)/0.3)+1;}}class mB implements kB{var gM;var IM;var kM;var NM;var OM;var TM;var hK;var OK;var XM;var YM;var aM;mB( g, h,[ transitionType( ratio)]){gM=g;IM=(transitionType!=null)?transitionType:MB.OC;OK=0.0;hK=SB.max(0.0001,h);XM=0.0;YM=false;aM=false;kM=new List<sF>();} XB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(gM!=null&&aM==false)kM.add(new sF(g,0.0,h));} moveTo( h, g){XB('x',h);XB('y',g);} CC( l){if(OK<hK||aM==false){OK=OK+l;if(OK>hK)OK=hK;if(OK>=0.0){if(aM==false){aM=true;for(int i=0;i<kM.length;i++ ){var g=kM[i];switch (g.name){case 'x':g.wB=gM.x;break;case 'y':g.wB=gM.y;break;case 'pivotX':g.wB=gM.TC;break;case 'pivotY':g.wB=gM.UC;break;case 'scaleX':g.wB=gM.vB;break;case 'scaleY':g.wB=gM.EC;break;case 'rotation':g.wB=gM.YB;break;case 'alpha':g.wB=gM.alpha;break;}}if(NM!=null)NM();}var j=OK/hK;var k=IM(j);for(int i=0;i<kM.length;i++ ){var g=kM[i];var h=g.wB+k*(g.JE-g.wB);h=YM?h.round():h;switch (g.name){case 'x':gM.x=h;break;case 'y':gM.y=h;break;case 'pivotX':gM.TC=h;break;case 'pivotY':gM.UC=h;break;case 'scaleX':gM.vB=h;break;case 'scaleY':gM.EC=h;break;case 'rotation':gM.YB=h;break;case 'alpha':gM.alpha=h;break;}}if(OM!=null)OM();if(TM!=null&&OK==hK)TM();}}return OK<hK;} get totalTime=>hK; get currentTime=>OK; get isComplete=>OK>=hK;set delay( g){if(aM==false)OK=OK+XM-g;XM=g;} set QF( g()){NM=g;} set JC( g()){OM=g;} set onComplete( g()){TM=g;}}class oC extends lC{var fM;var NK;var qM;var sM;var wM;var yM;var BN;var EN;var HN;var JN;var KN;var LN;var MN;var PN;var QN;oC( h, g){GK=h;fM=g;fM.focus();NK=g.context2d;sM=new AC.BI(NK);wM=iC.pD;yM=qB.tD;mD.TG.addEventListener("mouseCursorChanged",WN);HN=[new WE(t.MD,t.yD,t.WC,t.PG),new WE(t.hG,t.jG,t.sE,t.sE),new WE(t.kG,t.lG,t.tE,t.tE)];EN=null;BN=new NB(0,0);KN=new t(t.WC,true);PN=BM;fM.on..mouseDown.add(PN)..mouseUp.add(PN)..mouseMove.add(PN)..mouseOut.add(PN)..mouseWheel.add(PN);JN=new Map<int,rE>();MN=new BC(BC.gE,true);QN=ZN;lE.TG.addEventListener("inputModeChanged",aN);aN(null);LN=new hC(hC.sD,true);fM.on.keyDown.add(cN);fM.on.keyUp.add(cN);fM.on.keyPress.add(dN);} get focus=>qM; set SH( g){wM=g;} eN(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){eN();} set y( g){eN();} set TC( g){eN();} set UC( g){eN();} set vB( g){eN();} set EC( g){eN();} set YB( g){eN();} set alpha( g){eN();} set width( g){eN();} set height( g){eN();} JH(){if(wM==iC.pD||wM==iC.vD){sM.reset();oB(sM);if(wM==iC.vD)wM=iC.LG;}} WN( g){fM.style.cursor=mD.vE(yM);} BM( j){j.preventDefault();var IB=fM.getBoundingClientRect();var o=new Date.now().millisecondsSinceEpoch;var v=j.button;var h=null;var i=new NB(j.clientX-IB.left,j.clientY-IB.top);var m=null;if(v<0||v>2)return;if(j.type=="mousemove"&&BN.equals(i))return;var g=HN[v];BN=i;if(j.type!="mouseout")h=SC(i.x,i.y) as lB;var k=qB.tD;if(h is AB)if(h.ME)k=qB.uD;if(h is tC)if(h.ME)k=qB.uD;if(yM!=k){yM=k;fM.style.cursor=mD.vE(k);}if(EN!=null&&EN!=h){EN.KB(KN..dM(t.OD,true)..UN=(EN.YD!=null)?EN.qC(i):new NB.zH()..VN=i..NN=g.PC);EN=null;}if(h!=null&&h!=EN){h.KB(KN..dM(t.qE,true)..UN=h.qC(i)..VN=i..NN=g.PC);EN=h;}var l=null;var s=false;var EB=false;if(j.type=="mousedown"){l=g.NF;if(h!=g.target||o>g.DE+500)g.zC=0;g.PC=true;g.target=h;g.DE=o;g.zC++ ;}if(j.type=="mouseup"){l=g.OF;g.PC=false;s=(g.target==h);EB=s&&g.zC.isEven&&(o<g.DE+500);}if(j.type=="mousemove"){l=t.pE;}if(l!=null&&h!=null){m=h.qC(i);h.KB(KN..dM(l,true)..UN=m..VN=i..NN=g.PC..RN=g.zC);if(s){if(EB&&h.uG){h.KB(KN..dM(g.MF,true)..UN=m..VN=i..NN=g.PC);}else{h.KB(KN..dM(g.LF,true)..UN=m..VN=i..NN=g.PC);}}}} aN( g){fM.on..touchStart.remove(QN)..touchEnd.remove(QN)..touchMove.remove(QN)..touchEnter.remove(QN)..touchLeave.remove(QN)..touchCancel.remove(QN);if(lE.nG==VE.UG){fM.on..touchStart.add(QN)..touchEnd.add(QN)..touchMove.add(QN)..touchEnter.add(QN)..touchLeave.add(QN)..touchCancel.add(QN);}} ZN( j){j.preventDefault();var o=fM.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var h=null;var i=new NB(m.clientX-o.left,m.clientY-o.top);var s=null;h=SC(i.x,i.y) as lB;var g=JN.containsKey(l)?JN[l]:new rE(h,JN.length==0);if(g.target!=null&&g.target!=h){g.target.KB(MN..dM(BC.bG,true)..UN=(g.target.YD!=null)?g.target.qC(i):new NB.zH()..VN=i..hM=g.ZD..jM=g.XD);g.target=null;}if(h!=null&&h!=g.target){h.KB(MN..dM(BC.aG,true)..UN=h.qC(i)..VN=i..hM=g.ZD..jM=g.XD);g.target=h;}var k=null;if(j.type=="touchstart"){JN[l]=g;k=BC.gE;}if(j.type=="touchend"){JN.remove(l);k=BC.iE;}if(j.type=="touchcancel"){JN.remove(l);k=BC.kE;}if(j.type=="touchmove"){k=BC.oE;}if(k!=null&&h!=null){h.KB(MN..dM(k,true)..UN=h.qC(i)..VN=i..hM=g.ZD..jM=g.XD);}}} cN( g){g.preventDefault();var h=null;if(g.type=="keyup")h=hC.hE;if(g.type=="keydown")h=hC.sD;LN..dM(h,true)..uL=g.altKey..wL=g.ctrlKey..zL=g.shiftKey..PM=g.charCode..SM=g.keyCode..UM=kC.CG;if(g.keyLocation==bC.KeyLocation.LEFT)LN.UM=kC.HG;if(g.keyLocation==bC.KeyLocation.RIGHT)LN.UM=kC.QG;if(g.keyLocation==bC.KeyLocation.NUMPAD)LN.UM=kC.VG;if(g.keyLocation==bC.KeyLocation.JOYSTICK)LN.UM=kC.mE;if(g.keyLocation==bC.KeyLocation.MOBILE)LN.UM=kC.mE;if(qM!=null)qM.KB(LN);} dN( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new XE(XE.NG,true);h.SK=new String.fromCharCodes([i]);if(qM!=null)qM.KB(h);}} BE( g, m, EB, j){var aC=0.0;var pB=0.0;var v=m*g.a;var gB=m*g.b;var IB=m*g.a+EB*g.c;var s=m*g.b+EB*g.d;var RB=EB*g.c;var o=EB*g.d;var h=aC;if(h>v)h=v;if(h>IB)h=IB;if(h>RB)h=RB;var i=pB;if(i>gB)i=gB;if(i>s)i=s;if(i>o)i=o;var l=aC;if(l<v)l=v;if(l<IB)l=IB;if(l<RB)l=RB;var k=pB;if(k<gB)k=gB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new PB.zH();j.x=g.GC+h;j.y=g.HC+i;j.width=l-h;j.height=k-i;return j;}
//@ sourceMappingURL=escape.dart.map