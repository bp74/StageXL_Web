import "dart:html" as hC;import "dart:json" as gH;import "dart:web_audio" as VF;import "dart:math" as SB;import "dart:async" as fB;class hH{static const  iH="Chrome";static const  jH="Firefox";static const  kH="Internet Explorer";static const  lH="Safari";final  yG;final  minimumVersion;const hH(this.yG,[this.minimumVersion]);}class mH{final  name;const mH(this.name);}class ZD{var vE;var RF;var SF;var angle;var UF;var YB;}class XF extends BB{var XI;var gI;var qI;var wI;var yI;XF(){qI=cB.KB.iB("Warning");wI=null;XI=GB.jF();gI=new CB(XI[0]);o(gI);} start(){wI=qI.play();p.remove(yI);yI=new OC(0,80,9.0,MB.PC);yI.JC=(h){var g=h.toInt()%8;gI.bitmapData=XI[(g<=4)?g+1:8-g];};p.add(yI);} stop(){if(wI!=null){wI.stop();wI=null;}p.remove(yI);gI.bitmapData=XI[0];}}class aB extends AB{static const  IE="Explosion";static const  DD="Unlocked";static const  JE="Finalized";static const  eD="Timeouted";var IJ;aB( h, g,[ bubbles=false]):super(h,bubbles){IJ=g;} get info{return IJ;}}class wB{static const  pC=1;static const  bD=2;static const  cD=3;}class HE extends BB{var TI;HE( j){var g=new LC();g.RC=new ME("Arial",30,0xFFFFFF,bold:true,align:pB.NC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.UB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;TI=new BB();TI.o(g);o(TI);var i=new OC(0.0,1.0,1.5,MB.rB);i.JC=(h){TI.alpha=1-h;TI.y=-h*50;TI.uB=1.0+0.1*SB.sin(h*10);TI.BC=1.0+0.1*SB.cos(h*10);};i.onComplete=(){this.BE();};p.add(i);}}class bF extends BB{var UI;var cI;var mI;var dI;bF(){var m=new CB(GB.KB.t("ExitBox"));o(m);var g=new LC();g.RC=new ME("Arial",24,0xFFFFFF,bold:true,align:pB.NC);g.width=240;g.height=100;g.wordWrap=true;g.text=bC.KB.nC("GENexitquery");g.x=47;g.y=150-g.DE/2;g.UB=false;o(g);UI=new lD(7,GB.KB.t("ExitGauge"),JD.sD);UI.x=268;UI.y=25;UI.IB("TimeOver",nJ);o(UI);UI.RD("TimeOver",0);UI.start();var i=new CB(GB.KB.t("ExitYesButtonNormal"));var j=new CB(GB.KB.t("ExitYesButtonPressed"));cI=new rC(i,i,j,j);cI.x=68;cI.y=239;cI.IB(q.XC,qJ);o(cI);var h=new CB(GB.KB.t("ExitNoButtonNormal"));var k=new CB(GB.KB.t("ExitNoButtonPressed"));mI=new rC(h,h,k,k);mI.x=173;mI.y=232;mI.IB(q.XC,sJ);o(mI);this.IB(AB.uC,(l)=>p.add(UI));this.IB(AB.wC,(l)=>p.remove(UI));} tJ( g){if(dI!=null){dI(g);dI=null;}} qJ( g){tJ(true);} sJ( g){tJ(false);} nJ( g){tJ(false);}show( g){dI=g;}}class HB{var OI;var QI;var ZI;var fI;var kI;var nI;var tI;var xI;var AJ;var EJ;var HJ;HB( h, g){OI=h;QI=g;ZI=u.CD;fI=-1000;kI=-1000;nI=false;tI=false;xI=false;AJ=null;EJ=null;HJ=null;} get color=>OI; set color( g){OI=g;} get direction=>QI; set direction( g){QI=g;} get EB=>ZI; set EB( g){ZI=g;} get bB=>nI; set bB( g){nI=g;} get IC=>tI; set IC( g){tI=g;} get empty=>xI; set empty( g){xI=g;} TD( g){var h=g!=null&&(g.color==OI||g.EB==u.OB||ZI==u.OB)&&g.EB!=u.xB&&ZI!=u.xB;return h;} YC( g){var h=g!=null&&(g.color==OI||g.EB==u.OB||ZI==u.OB)&&g.direction==0&&QI==0&&g.EB!=u.xB&&ZI!=u.xB;return h;} fC( g){var h=g!=null&&(g.color==OI||g.EB==u.OB||ZI==u.OB)&&g.direction==1&&QI==1&&g.EB!=u.xB&&ZI!=u.xB;return h;} get x=>fI; set x( g){fI=g;if(AJ!=null)AJ.x=g;if(EJ!=null)EJ.x=g;if(HJ!=null)HJ.x=g;} get y=>kI; set y( g){kI=g;if(AJ!=null)AJ.y=g;if(EJ!=null)EJ.y=g;if(HJ!=null)HJ.y=g;} set QF( h){if(AJ!=null){var g=1+0.3*SB.sin(h*SB.PI);AJ.uB=g;AJ.BC=g;}} kB( g, h, i){if(AJ!=null){AJ.parent.tB(AJ);AJ=null;}if(EJ!=null){EJ.parent.tB(EJ);EJ=null;}if(HJ!=null){HJ.parent.tB(HJ);HJ=null;}if(empty==false){switch (ZI){case u.OB:AJ=new oH(QI);AJ.x=fI;AJ.y=kI;g.o(AJ);break;case u.xB:AJ=GB.fD(u.xB);AJ.x=fI;AJ.y=kI;g.o(AJ);break;default:AJ=GB.dD(OI,QI);AJ.x=fI;AJ.y=kI;g.o(AJ);break;}if(nI){EJ=tI?new nH(QI):GB.cF(OI,QI);EJ.x=fI+((QI==0)?25:0);EJ.y=kI+((QI==1)?25:0);h.o(EJ);}switch (ZI){case u.CD:break;case u.xB:break;case u.OB:break;default:HJ=new pH(ZI);HJ.x=fI;HJ.y=kI;i.o(HJ);break;}}}}class WF extends BB{var SI;var bI;var lI;var uI;var UI;var zI;var BJ;var DJ;var GJ;var RI;var KJ;var LJ;var MJ;var NJ;var PJ;var QJ;var RJ;var TJ;var UJ;WF(){var j=new CB(GB.KB.t("ShuffleButtonNormal"));var h=new CB(GB.KB.t("ShuffleButtonPressed"));bI=new rC(j,j,h,h);bI.IB(q.XC,iJ);bI.x=530;bI.y=525;o(bI);var g=new CB(GB.KB.t("ExitButtonNormal"));var i=new CB(GB.KB.t("ExitButtonPressed"));lI=new rC(g,g,i,i);lI.IB(q.XC,pJ);lI.x=700;lI.y=500;o(lI);SI=new YF();SI.x=540;SI.y=-1000;o(SI);UI=new lD(10,GB.KB.t("TimeGauge"),JD.nD);UI.x=659;UI.y=244;UI.IB("TimeShort",rJ);UI.IB("TimeOver",nJ);o(UI);p.add(UI);zI=new aF();zI.x=640;zI.y=230;o(zI);BJ=new XF();BJ.x=665;BJ.y=160;o(BJ);DJ=new LC();DJ.RC=new ME("Arial",30,0xD0D0D0,bold:true,align:pB.NC);DJ.width=140;DJ.height=36;DJ.wordWrap=false;DJ.x=646;DJ.y=130;DJ.UB=false;DJ.text="0";DJ.uB=0.9;o(DJ);GJ=new LC();GJ.RC=new ME("Arial",20,0xFFFFFF,bold:true,align:pB.NC);GJ.width=44;GJ.height=30;GJ.wordWrap=false;GJ.x=610;GJ.y=559;GJ.UB=false;GJ.text="3x";o(GJ);PJ=new BB();o(PJ);QJ=new BB();o(QJ);RJ=new BB();o(RJ);TJ=cB.KB.iB("Intro");UJ=TJ.play();} start(){RI=1;KJ=1;NJ=0;LJ=3;var g=new aD(bC.KB.nC("ESCStartText"));QJ.o(g);p.dB(()=>zI.JF(21),1);g.show(()=>p.dB(()=>wJ(),0.5));} wJ(){if(uI!=null&&this.contains(uI))PJ.tB(uI);var m=RI;var g=0;var h=0;switch (RI){case 01:h=50;uI=new ZF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;uI=new ZF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;uI=new ZF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;uI=new ZF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;uI=new ZF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;uI=new ZF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;uI=new ZF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;uI=new ZF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;uI=new ZF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;uI=new ZF(g=80+(RI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}MJ=g;if(LJ<3){LJ++ ;GJ.text="${LJ}x";}uI.IB(aB.IE,xJ);uI.IB(aB.DD,yJ);uI.IB(aB.JE,zJ);uI.IB(aB.eD,AK);uI.x=20;uI.y=16;uI.UB=false;PJ.o(uI);UI.reset(h);UI.RD("TimeShort",9);UI.RD("TimeOver",0);UI.pause();SI.level=m;SI.wE=g;SI.y=-210;var k=new mB(SI,0.4,MB.rB);k.XB("y",-90);p.add(k);var j=new aD(bC.KB.nC("ESCLevelBoxText").replaceAll("{0}","${g}"));QJ.o(j);j.show((){uI.UB=true;UI.start();if(TJ!=null){var i=new OC(1.0,0.0,4.0,MB.PC);i.JC=(l){UJ.CC.volume=l;UJ.CC=UJ.CC;};i.onComplete=(){UJ.stop();zI.OH();};p.add(i);TJ=null;}});} rJ( g){BJ.start();} nJ( g){uI.TF(wB.cD);} yJ( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new HE(g);i.x=k.x;i.y=k.y;PJ.o(i);NJ=NJ+g;DJ.text="${NJ}";} xJ( j){var g=MJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;MJ=g;SI.wE=g;if(g==0)uI.TF(wB.bD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}NJ=NJ+h*k;DJ.text="${NJ}";} zJ( m){UI.pause();BJ.stop();var l=cB.KB.iB("Laugh");var k=cB.KB.iB("LevelUp");l.play();zI.JF(3);var g=GB.dF();g.x=55;g.y=260;PJ.o(g);p.dB((){uI.BF();k.play();},2.0);p.dB((){var j=(UI.YH*1000).toInt();var h=new HE(j);h.x=704;h.y=360;PJ.o(h);NJ=NJ+j;DJ.text="${NJ}";},2.5);var i=new mB(SI,0.5,MB.rB);i.XB("y",-210);i.SC=3.0;p.add(i);p.dB((){PJ.tB(g);},3.5);p.dB((){RI++ ;wJ();},4.0);} AK( j){BJ.stop();uI.BF();var g;var i;if(KJ>0){KJ-- ;g=new aD(bC.KB.nC("GEN2ndchancetime"));QJ.o(g);i=cB.KB.iB("LevelUp");i.play();g.show((){p.dB(()=>wJ(),0.5);var h=new mB(SI,0.5,MB.rB);h.XB("y",-210);p.add(h);});}else{g=new aD(bC.KB.nC("GENtimeup"));QJ.o(g);i=cB.KB.iB("GameOver");i.play();g.show((){p.dB(()=>DK(),0.5);var h=new mB(SI,0.5,MB.rB);h.XB("y",-210);p.add(h);});}} iJ( h){if(uI!=null&&LJ>0){var g=uI.PF();if(g){LJ=LJ-1;GJ.text="${LJ}x";}}} pJ( j){var h=new BB();h.o(new CB(new DB(800,600,false,0x000000)));h.alpha=0.6;RJ.o(h);var g=new bF();g.x=235;g.y=150;RJ.o(g);g.show(( i){RJ.tB(g);if(i==false)RJ.tB(h);else FK(false);});}DK(){var h=new BB();var j=new CB(GB.KB.t("ExitBox"));h.o(j);var g=new LC();g.RC=new ME("Arial",30,0xFFFFFF,bold:true,align:pB.NC);g.width=240;g.height=200;g.wordWrap=true;g.text=bC.KB.nC("GENgameover");g.x=47;g.y=30+(g.height-g.DE)/2;g.UB=false;h.o(g);h.x=110;h.y=-h.height;QJ.o(h);var k=cB.KB.iB("Laugh");p.dB(()=>k.play(),0.3);var i=new mB(h,0.3,MB.rB);i.XB("y",150);p.add(i);p.dB(()=>FK(true),5.0);h.IB(q.XC,( l)=>FK(true));}var HK=false; FK( g){UI.pause();if(HK==false){HK=true;}}}class GB{static var KB;static  dD( i, h){var g=new CB(KB.TC("Elements").t("Chain${i}${h}"));g.UC=25;g.VC=25;return g;}static  cF( i, h){var g=new CB(KB.TC("Elements").t("Link${i}${h}"));g.UC=25;g.VC=25;return g;}static  fD( h){var g=new CB(KB.TC("Elements").t(h));g.UC=25;g.VC=25;return g;}static  dF(){var m=new BB();var l=0;var n=KB.TC("Levelup");for(int k=0;k<7;k++ ){var g=new CB(n.t("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new BB();h.o(g);h.x=l+g.width/2;h.uB=0;h.BC=0;m.o(h);var i=new mB(h,2.0,MB.vG);i.XB("scaleX",1.0);i.XB("scaleY",1.0);i.SC=k*0.05;var j=new mB(h,0.4,MB.PC);j.XB("scaleX",0.0);j.XB("scaleY",0.0);j.SC=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  fF( h){var i=KB.TC("Elements");var g=new List<DB>();g.add(i.t("JokerChain${h}0"));g.add(i.t("JokerChain${h}1"));g.add(i.t("JokerChain${h}2"));g.add(i.t("JokerChain${h}3"));g.add(i.t("JokerChain${h}4"));return g;}static  gF( h){var i=KB.TC("Elements");var g=new List<DB>();g.add(i.t("JokerLink${h}0"));g.add(i.t("JokerLink${h}1"));g.add(i.t("JokerLink${h}2"));g.add(i.t("JokerLink${h}3"));g.add(i.t("JokerLink${h}4"));return g;}static  hF( h){var i=KB.TC("Locks");var g=new List<DB>();g.add(i.t("Lock${h}0"));g.add(i.t("Lock${h}1"));g.add(i.t("Lock${h}2"));g.add(i.t("Lock${h}3"));g.add(i.t("Lock${h}4"));return g;}static  iF(){var h=KB.TC("Head");var g=new List<DB>();g.add(h.t("Head1"));g.add(h.t("Head2"));g.add(h.t("Head3"));g.add(h.t("Head2"));g.add(h.t("Head1"));return g;}static  jF(){var h=KB.TC("Alarm");var g=new List<DB>();g.add(h.t("Alarm0"));g.add(h.t("Alarm1"));g.add(h.t("Alarm2"));g.add(h.t("Alarm3"));g.add(h.t("Alarm4"));g.add(h.t("Alarm5"));return g;}}class ZF extends BB{var CJ;var JJ;var OJ;var SJ;var VJ;var WJ;var XJ;var YJ;var ZJ;var aJ;var cJ;var dJ;var eJ;var fJ;var gJ;var hJ;var jJ;var kJ;var lJ;var mJ;ZF( FB, s, JB, m, n, w, k){YJ=new SB.Random();ZJ=wB.pC;aJ=k;CJ=FB;JJ=s;OJ=JB;SJ=m;VJ=n;WJ=w;XJ=k.length;fJ=new List<QB>();hJ=new BB();jJ=new BB();kJ=new BB();lJ=new BB();mJ=new BB();o(hJ);o(jJ);o(kJ);o(lJ);o(mJ);jJ.UB=false;kJ.UB=false;lJ.UB=false;mJ.UB=false;JH();KH();IH();gJ=true;var l=new oC();this.mask=new NE.JI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=dJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.kB(hJ,jJ,kJ);var j=new OC(i.y,h*50+25,0.4,MB.rB);j.SC=g*0.03;j.JC=(RB){i.y=RB;};j.onComplete=(){if(l.UD()==100){uJ();gJ=false;fJ.clear();this.mask=null;}};p.add(j);}}IB(q.ND,vJ);} TF( g){if(g==wB.bD)ZJ=g;if(g==wB.cD&&ZJ==wB.pC){ZJ=g;if(gJ==false)dispatchEvent(new aB(aB.eD,null));}} BF(){this.mask=new NE.JI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=dJ[i+h*10];g.bB=false;g.IC=false;g.EB=u.CD;g.kB(hJ,jJ,kJ);var j=new OC(g.y,500+h*50+25,0.5,MB.rB);j.SC=i*0.1;j.JC=(k){g.y=k;};p.add(j);}}} JH(){eJ=new List<BD>();for(int h=0;h<JJ;h++ ){var g=new BD(h);g.YB=(YJ.nextInt(30)-15)*SB.PI/180;g.x=300-(90*JJ)/2+h*90+YJ.nextInt(20)-10;g.y=550;eJ.add(g);lJ.o(g);}} zE( g, h){var i=0;var j=dJ[g+h*10];if(j.direction==0){var l=(g>0)?dJ[g-1+h*10]:null;var m=(g<9)?dJ[g+1+h*10]:null;if(j.YC(l))i++ ;if(j.YC(m))i++ ;}else{var k=(h>0)?dJ[g+(h-1)*10]:null;var n=(h<9)?dJ[g+(h+1)*10]:null;if(j.fC(k))i++ ;if(j.fC(n))i++ ;}return i;} yE(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=dJ[g+h*10];var i=XJ*2;while (zE(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<aJ.length;j++ )if(k.color==aJ[j])m=j;k.color=aJ[(m+1)%aJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(zE(g,h)==2);return l;} KF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(dJ[(h-1)+g*10].TD(dJ[h+g*10])&&dJ[h+g*10].TD(dJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(dJ[h+(g-1)*10].TD(dJ[h+g*10])&&dJ[h+g*10].TD(dJ[h+(g+1)*10]))return true;return false;} BK( j, l, k){for(int g=0;g<20;g++ ){var h=CJ~/k;var i=l*h+YJ.nextInt(h);if(cJ[i].EB==u.CD){cJ[i].EB=j;return;}}} KH(){cJ=new List<HB>();for(int g=0;g<CJ;g++ ){var i=aJ[YJ.nextInt(aJ.length)];var h=YJ.nextInt(2);cJ.add(new HB(i,h));}for(int g=0;g<JJ*2;g++ )BK("Lock${(g%JJ)+1}",g,JJ*2);for(int g=0;g<OJ;g++ )BK(u.OB,g,OJ);for(int g=0;g<SJ;g++ )BK(u.xB,g,SJ);for(int g=0;g<VJ;g++ )BK(u.KE,g,VJ);for(int g=0;g<WJ;g++ )BK(u.LE,g,WJ);} IH(){dJ=new List<HB>();var g=true;while (g){dJ.clear();for(int h=0;h<100;h++ ){var j=aJ[YJ.nextInt(aJ.length)];var i=YJ.nextInt(2);dJ.add(new HB(j,i));}g=yE();}} PF(){if(gJ||ZJ!=wB.pC)return false;var l=true;gJ=true;while (l){for(int k=0;k<dJ.length;k++ ){var g=dJ[k];g.bB=false;g.IC=false;g.kB(hJ,jJ,kJ);g.color=aJ[YJ.nextInt(aJ.length)];g.direction=YJ.nextInt(2);}l=yE()||(KF()==false);}var s=cB.KB.iB("BonusUniversal");s.play();var m=new oC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=dJ[i+j*10];g.QF=0.0;var h=new OC(0.0,1.0,0.2,MB.PC);h.SC=i*0.06;h.JC=(n){g.QF=n;};h.onStart=(){g.kB(hJ,jJ,kJ);};h.onComplete=(){if(m.UD()==100){uJ();CK();fJ.clear();}};p.add(h);}}return true;} uJ(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=dJ[h+i*10];var l=(h<9)?dJ[h+1+i*10]:null;var m=(i<9)?dJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.YC(l)){j=true;k=(g.EB==u.OB||l.EB==u.OB);}if(g.fC(m)){j=true;k=(g.EB==u.OB||m.EB==u.OB);}if(g.bB!=j||g.IC!=k){g.bB=j;g.IC=k;g.kB(hJ,jJ,kJ);}}}} EK( w, l, n, k, m, s){gJ=true;w.UD(k);var i=1;for(int h=0;h<k;h++ ){var g=dJ[l+h*m+(n+h*s)*10];if(g.EB==u.KE)i=i*2;if(g.EB==u.LE)i=i*5;var JB=l+h*m;var RB=n+h*s;p.dB((){g.empty=true;g.kB(hJ,jJ,kJ);var FB=cB.KB.iB("ChainBlast");FB.play();var j=new IE(g.color,g.direction);j.x=JB*50;j.y=RB*50;p.add(j);mJ.o(j);UH(g);if(w.AF()==0)GK();},0.1+h*0.1);}dispatchEvent(new aB(aB.IE,{"Length":k,"Factor":i}));} CK(){gJ=false;var j=new oC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&dJ[i+g-1+h*10].YC(dJ[i+g+h*10]))g++ ;if(g>=3)EK(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&dJ[i+(h+g-1)*10].fC(dJ[i+(h+g)*10]))g++ ;if(g>=3)EK(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(ZJ==wB.bD)dispatchEvent(new aB(aB.JE,null));if(ZJ==wB.cD)dispatchEvent(new aB(aB.eD,null));if(ZJ==wB.pC&&KF()==false)PF();}} UH( h){if(h.EB.indexOf("Lock")==0){var k=int.parse(h.EB.substring(4,5))-1;var j=eJ[k];var g=GB.fD(h.EB);g.x=h.x;g.y=h.y;o(g);var i=new mB(g,0.5,MB.rB);i.XB("x",j.x);i.XB("y",j.y-10);i.onComplete=()=>tB(g);p.add(i);p.dB(()=>PH(k),0.5);}} PH( k){var h=eJ[k];var i;if(h.zC){i=new aB(aB.DD,{"Type":"SingleLocked","Position":new QB(h.x+20,h.y)});var l=cB.KB.iB("Unlock");l.play();}else{i=new aB(aB.DD,{"Type":"SingleUnlocked","Position":new QB(h.x+20,h.y)});}dispatchEvent(i);h.zC=false;h.OF(false);var j=true;for(int g=0;g<eJ.length;g++ )j=j&&(eJ[g].zC==false);if(j){var m=cB.KB.iB("BonusAllUnlock");m.play();for(int g=0;g<eJ.length;g++ ){eJ[g].zC=true;p.dB(()=>eJ[(g+k)%eJ.length].aH(),g*0.2);}p.dB(()=>dispatchEvent(new aB(aB.DD,{"Type":"All","Position":new QB(280,550)})),0.75);}} GK(){var n=new oC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&dJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&dJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=dJ[i+j*10];if(i>0){l=dJ[i-1+j*10];if(h.YC(l)){l.bB=false;l.kB(hJ,jJ,kJ);}}h.bB=false;h.empty=true;h.kB(hJ,jJ,kJ);}else{if(cJ.length>0){h=cJ[0];cJ.removeRange(0,1);}else{h=new HB(aJ[YJ.nextInt(aJ.length)],YJ.nextInt(2));}}g=dJ[i+k*10];g.color=h.color;g.direction=h.direction;g.EB=h.EB;g.bB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.kB(hJ,jJ,kJ);n.UD();var m=new OC(g.y,50*k+25,0.1,MB.PC);m.JC=(s){g.y=s;};m.onComplete=(){if(n.AF()==0){uJ();CK();IK();}};p.add(m);}}}} vJ( g){if(g.target==hJ&&this.UB){var j=SB.min(g.DF/50,9).toInt();var h=SB.min(g.EF/50,9).toInt();var i=new QB(j,h);fJ.add(i);IK();}} IK(){while (ZJ==wB.pC&&gJ==false&&fJ.length>0){var m=fJ[0];fJ.removeRange(0,1);var j=m.x.toInt();var k=m.y.toInt();var g=dJ[j+k*10];var i=(j>0)?dJ[j-1+k*10]:null;var n=(j<9)?dJ[j+1+k*10]:null;var h=(k>0)?dJ[j+(k-1)*10]:null;var s=(k<9)?dJ[j+(k+1)*10]:null;var l=false;if(g.EB==u.xB){var FB=cB.KB.iB("ChainError");FB.play();continue;}if(g.fC(h)){h.bB=false;h.kB(hJ,jJ,kJ);}if(g.YC(i)){i.bB=false;i.kB(hJ,jJ,kJ);}g.direction=1-g.direction;g.bB=false;g.IC=false;var JB=cB.KB.iB("ChainRotate");JB.play();if(g.YC(n)){g.bB=true;g.IC=(g.EB==u.OB||n.EB==u.OB);}if(g.fC(s)){g.bB=true;g.IC=(g.EB==u.OB||s.EB==u.OB);}g.kB(hJ,jJ,kJ);l=l||g.bB;if(g.fC(h)){h.bB=true;h.IC=(g.EB==u.OB||h.EB==u.OB);h.kB(hJ,jJ,kJ);l=true;}if(g.YC(i)){i.bB=true;i.IC=(g.EB==u.OB||i.EB==u.OB);i.kB(hJ,jJ,kJ);l=true;}if(l){var w=cB.KB.iB("ChainLink");w.play();}CK();}}}class YF extends BB{var RI;var aI;var hI;var pI;var vI;YF(){o(new CB(GB.KB.t("InfoBox")));aI=new LC();aI.RC=new ME("Arial",35,0xFFFFFF,bold:true,align:pB.NC);aI.width=220;aI.height=40;aI.wordWrap=false;aI.text="Level 1";aI.x=20;aI.y=115;aI.YB=-2*SB.PI/180;o(aI);pI=new LC();pI.RC=new ME("Arial",25,0xFFFFFF,bold:true,align:pB.NC);pI.width=220;pI.height=30;pI.wordWrap=false;pI.text="40";pI.x=-pI.width/2;pI.y=-pI.height/2;pI.YB=-2*SB.PI/180;vI=new BB();vI.o(pI);vI.x=150;vI.y=172;o(vI);var g=GB.dD(3,0);g.x=110;g.y=171;g.YB=-2*SB.PI/180;g.uB=g.BC=0.6;o(g);} set level( g){RI=g;aI.text="Level ${RI}";} set wE( g){hI=g;pI.text="${hI}";}}class BD extends BB{var OI;var YI;var iI;var sI;BD( g){OI=g;iI=GB.hF(g);sI=true;YI=new CB(iI[0]);YI.x=-34;YI.y=-50;o(YI);} get zC=>sI; set zC( g){sI=g;} OF( g){YI.bitmapData=iI[g?0:4];} aH(){var i=new OC(0.0,1.0,2.0,MB.rB);i.JC=(j){uB=BC=1.0+0.2*SB.sin(j*4*SB.PI);};var g=new mB(this,0.2,MB.rB);g.XB("alpha",0.0);g.SC=2.0;g.onComplete=()=>OF(sI);var h=new mB(this,0.2,MB.sE);h.XB("alpha",1);h.SC=2.2;p.add(i);p.add(g);p.add(h);}}class aD extends BB{var WI;var dI;aD( h){var i=new CB(GB.KB.t("MessageBox"));o(i);var g=new LC();g.RC=new ME("Arial",24,0xFFFFFF,bold:true,align:pB.NC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.DE/2;g.UB=false;o(g);WI=null;IB(q.XC,bJ);}void show( h){this.parent.o(this);this.x=-this.width;this.y=150;dI=h;var g=new mB(this,0.3,MB.rB);g.XB("x",110);g.onComplete=()=>WI=p.dB(oJ,10);p.add(g);} oJ(){if(WI!=null){p.remove(WI);WI=null;dI();var g=new mB(this,0.4,MB.sE);g.XB("x",800);g.onComplete=()=>this.parent.tB(this);p.add(g);}} bJ( g){oJ();}}class cB{static var KB;}class u{static const  CD="None";static const  OB="Joker";static const  xB="Block";static const  KE="Double";static const  LE="Quint";}class oH extends BB implements lB{var YI;var oI;var jI;oH( g){this.UB=false;jI=0.0;oI=GB.fF(g);YI=new CB(oI[0]);YI.x=-25;YI.y=-25;o(YI);IB(AB.uC,(h)=>p.add(this));IB(AB.wC,(h)=>p.remove(this));} AC( g){jI+= g;var h=(jI*10).toInt()%oI.length;YI.bitmapData=oI[h];return true;}}class nH extends BB implements lB{var YI;var oI;var jI;nH( g){this.UB=false;jI=0.0;oI=GB.gF(g);YI=new CB(oI[0]);YI.x=-25;YI.y=-25;o(YI);IB(AB.uC,(h)=>p.add(this));IB(AB.wC,(h)=>p.remove(this));} AC( g){jI+= g;var h=(jI*10).toInt()%oI.length;YI.bitmapData=oI[h];return true;}}class pH extends BB implements lB{var YI;var jI;pH( h){this.UB=false;jI=0.0;YI=GB.fD(h);o(YI);IB(AB.uC,(g)=>p.add(this));IB(AB.wC,(g)=>p.remove(this));} AC( g){jI+= g;this.YB=SB.sin(jI*7)*10*SB.PI/180;return true;}}class bC{static var KB;}class oC{var value=0; UD([ inc=1])=>(value+= inc); AF([ dec=1])=>(value-= dec);}class aF extends BB{var VI;var eI;var rI;aF(){VI=GB.iF();eI=new CB(VI[0]);eI.x=-eI.width/2;eI.y=-eI.height/2;o(eI);rI=null;} JF( g){p.remove(rI);rI=new OC(0,g,0.5*g,MB.PC);rI.JC=(h){var i=((h*VI.length)%VI.length).toInt();eI.bitmapData=VI[i];eI.y=SB.sin(h*2*SB.PI)*3-eI.height/2;};p.add(rI);} OH(){p.remove(rI);eI.bitmapData=VI[0];}}class IE extends BB implements lB{var FJ;var jI;IE( s, n){FJ=new List<ZD>();jI=0.0;this.UB=false;var w=GB.dD(s,n);var m=new SB.Random();var i;var l;var FB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=SB.PI*1.15;YB=-SB.PI*2;}if(g==1&&h==0){i=SB.PI*1.85;YB=SB.PI*2;}if(g==1&&h==1){i=SB.PI*0.15;YB=SB.PI*2;}if(g==0&&h==1){i=SB.PI*0.85;YB=-SB.PI*2;}i=i+0.2*SB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new CB(w.bitmapData);j.SD=new PB(g*25,h*25,25,25);j.UC=12.5+g*25;j.VC=12.5+h*25;j.x=g*25;j.y=h*25;o(j);var k=new ZD();k.vE=j;k.RF=g*25+12.5;k.SF=h*25+12.5;k.angle=i;k.UF=l;k.YB=YB;FJ.add(k);}}} AC( m){jI=SB.min(0.8,jI+m);var w=981.0;for(int h=0;h<FJ.length;h++ ){var g=FJ[h];var i=g.vE;var j=g.angle;var k=g.UF;var l=g.YB;var n=g.RF+jI*(SB.cos(j)*k);var s=g.SF+jI*(SB.sin(j)*k+jI*w*0.5);i.x=n;i.y=s;i.YB=jI*l;}if(jI>=0.6)this.alpha=(0.8-jI)/0.2;if(jI>=0.8)this.BE();return (jI<0.8);}}var ED;var cC;var FD;var p;var WC;var GD;var yB; main(){ED=new mC("StageBackground",hC.query('#stageBackground'));cC=new mC("StageForeground",hC.query('#stageForeground'));FD=new nF();FD.uE(ED);FD.uE(cC);p=FD.MH;var g=DB.tE("images/Loading.png");g.then((h){WC=new CB(h);WC.UC=20;WC.VC=20;WC.x=400;WC.y=270;cC.o(WC);GD=new mB(WC,100,MB.PC);GD.XB("rotation",100.0*2.0*SB.PI);p.add(GD);yB=new LC();yB.RC=new ME("Arial",20,0xA0A0A0,bold:true);yB.width=240;yB.height=40;yB.text="... loading ...";yB.x=400-yB.bH/2;yB.y=320;yB.UB=false;cC.o(yB);eF();});} eF(){var g=new LD();g.hB("Background","images/Background.jpg");g.hB("ExitBox","images/ExitBox.png");g.hB("ExitButtonNormal","images/ExitButtonNormal.png");g.hB("ExitButtonPressed","images/ExitButtonPressed.png");g.hB("ExitGauge","images/ExitGauge.png");g.hB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.hB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.hB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.hB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.hB("InfoBox","images/InfoBox.png");g.hB("MessageBox","images/MessageBox.png");g.hB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.hB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.hB("TimeGauge","images/TimeGauge.png");g.xC("Alarm","images/AlarmTextureAtlas.json",eC.lC);g.xC("Head","images/HeadTextureAtlas.json",eC.lC);g.xC("Elements","images/ElementsTextureAtlas.json",eC.lC);g.xC("Levelup","images/LevelupTextureAtlas.json",eC.lC);g.xC("Locks","images/LocksTextureAtlas.json",eC.lC);g.ZB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.ZB("BonusUniversal","sounds/BonusUniversal.mp3");g.ZB("ChainBlast","sounds/ChainBlast.mp3");g.ZB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.ZB("ChainError","sounds/ChainError.mp3");g.ZB("ChainFall","sounds/ChainFall.mp3");g.ZB("ChainHelp","sounds/ChainHelp.mp3");g.ZB("ChainLink","sounds/ChainLink.mp3");g.ZB("ChainRotate","sounds/ChainRotate.mp3");g.ZB("Click","sounds/Click.mp3");g.ZB("GameOver","sounds/GameOver.mp3");g.ZB("Laugh","sounds/Laugh.mp3");g.ZB("LevelUp","sounds/LevelUp.mp3");g.ZB("PointsCounter","sounds/PointsCounter.mp3");g.ZB("Unlock","sounds/Unlock.mp3");g.ZB("Warning","sounds/Warning.mp3");g.ZB("Intro","sounds/Intro.mp3");g.nB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.nB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.nB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.nB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.nB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.nB("ESCNoActionHint","Press on the chain links to twist them.");g.nB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.nB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.nB("ESCtogo","Chain links:");g.nB("GENexitquery","Do you really want to quit the game?");g.nB("GEN2ndchancetime","Time is up. Second chance!");g.nB("GENtimeup","Sorry! Your time is up.");g.nB("GENgameover","Game Over");g.load().then((l){cC.tB(WC);cC.tB(yB);p.remove(GD);GB.KB=g;cB.KB=g;bC.KB=g;var j=new CB(GB.KB.t("Background"));ED.o(j);ED.XH=jC.rD;var i=new WF();cC.o(i);i.start();}).catchError((k){for(var h in g.CF){print("Loading resouce failed: ${h.kind}.${h.name} - ${h.error}");}});}class iD{static var WE=qB.mD;static var yF=false;static var LG=new fB.StreamController<String>();static var PG=LG.stream.asBroadcastStream();static  rE( i){var h=i;var g="auto";if(WE!=qB.mD)h=WE;switch (h){case qB.mD:g="auto";break;case qB.pD:g="default";break;case qB.qD:g="pointer";break;case qB.MG:g="move";break;case qB.NG:g="text";break;case qB.QG:g="wait";break;}if(yF)g="none";return g;}}class qH extends MC{var ZK;var sK;qH( i, h, g){ZK=h;sK=g;} get CC=>sK;set CC( g){sK=g;} stop(){}}abstract class LB{static  tE( g){var h=sC.UG;if(h=="WebAudioApi")return hD.tE(g);if(h=="AudioElement")return gD.tE(g);return TE.tE(g);} get length; play([ loop=false, soundTransform]);static  qE( g){var m=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,caseSensitive:false);var i=m.firstMatch(g);var h=sC.nE;if(i==null)throw new ArgumentError("Unsupported file extension.");if(h.length==0)throw new UnsupportedError("This browser supports no known audio codec.");var j=i.group(1).toLowerCase();if(h.indexOf(j)==-1){var l=g.substring(0,g.length-j.length);var k=h[0];g="${l}${k}";}return g;}}class qF{static const  zF="pixel";}class LC extends NB{var dK="";var pK=0x000000;var IL=null;var XL=pF.EG;var kL=qF.zF;var JK=mF.tF;var zL=false;var FM=false;var IM=0x000000;var RM=false;var WM=0x000000;var cM=0;var fM=0;var jM;var pM;var sM=true;var uM=100;var yM=100;var CN=null;var bK=null;LC(){IL=new ME("Arial",12,0x000000);jM=new List<String>();pM=new List<OE>();} get type=>JK; get width=>uM; get height=>yM; set text( g){dK=g;sM=true;} set RC( g){IL=g;pK=IL.color;sM=true;} set wordWrap( g){zL=g;sM=true;} set width( g){uM=g;sM=true;} set height( g){yM=g;sM=true;} get bH{BO();return cM;} get DE{BO();return fM;} sB( g,[ returnRectangle]){return wD(g,uM,yM,returnRectangle);} HC( g, h){if(g>=0&&h>=0&&g<uM&&h<yM)return this;return null;} oB( g){BO();g.bK.drawImage(CN,0.0,0.0);} DO(){jM.clear();pM.clear();if(zL==false){jM.add(dK);}else{for(String n in dK.replaceAll('\r','').split('\n')){var h=new StringBuffer();var i=0;var g="";for(String j in n.split(' ')){i=h.length;h.write((i>0)?" ${j}":j);g=h.toString();if(bK.measureText(g).width>uM){if(i>0){g=g.substring(0,i);}else{j="";}jM.add(g);h=new StringBuffer();h.write(j);}}if(h.isEmpty==false){jM.add(h.toString());}}}cM=0;fM=0;for(String g in jM){var l=bK.measureText(g);var m=0;if(IL.align==pB.NC||IL.align==pB.IG)m=(uM-l.width)/2;if(IL.align==pB.GG||IL.align==pB.CG)m=uM-l.width;var k=new OE(m,l.width,IL.size,0,0,0);pM.add(k);cM=SB.max(cM,k.width);fM=fM+k.height;}} BO(){if(sM){sM=false;var j=uM.ceil().toInt();var i=yM.ceil().toInt();if(CN==null){CN=new hC.CanvasElement(width:j,height:i);bK=CN.context2d;}if(CN.width!=j)CN.width=j;if(CN.height!=i)CN.height=i;var g=new StringBuffer();g.write(IL.italic?"italic ":"normal ");g.write("normal ");g.write(IL.bold?"bold ":"normal ");g.write("${IL.size}px ");g.write("${IL.font},sans-serif");bK.font=g.toString();bK.textAlign="start";bK.textBaseline="top";bK.fillStyle=vC(pK);DO();if(FM){bK.fillStyle=vC(IM);bK.fillRect(0,0,uM,yM);}else{bK.clearRect(0,0,uM,yM);}var k=0;for(int h=0;h<jM.length;h++ ){var l=pM[h];bK.fillStyle=vC(pK);bK.fillText(jM[h],l.x,k);k+= l.height;}if(RM){bK.strokeStyle=vC(WM);bK.lineWidth=1;bK.strokeRect(0,0,uM,yM);}}}}class pF{static const  EG="none";}class mF{static const  tF="dynamic";}class ME{var font;var size;var color;var bold;var italic;var underline;var align;var leftMargin;var rightMargin;var indent;var leading;var letterSpacing=0;var tH=0;var uH=false;var AI=false;ME(this.font,this.size,this.color,{this.bold: false,this.italic: false,this.underline: false,this.align: "left",this.leftMargin: 0,this.rightMargin: 0,this.indent: 0,this.leading: 0});}class pB{static const  NC="center";static const  CG="end";static const  IG="justify";static const  GG="right";}class OE{var xG;var zG;var height;var leading;var width;var x;OE(this.x,this.width,this.height,this.xG,this.zG,this.leading);}class JD extends v{static const  nD='DIRECTION_UP';static const  cE='DIRECTION_RIGHT';static const  sD='DIRECTION_DOWN';static const  OD='DIRECTION_LEFT';var yL;var CM;var GM;var KM;JD( g,[ direction=OD]){if(direction!=nD&&direction!=sD&&direction!=OD&&direction!=cE){throw new ArgumentError('Invalid Gauge direction!');}yL=direction;CM=1.0;GM=g;KM=new PB.II();JN();} get ratio=>CM;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;CM=g;JN();} get bitmapData=>GM;set bitmapData( g){GM=g;JN();}JN(){if(GM==null){KM.left=0;KM.top=0;KM.right=0;KM.bottom=0;}else{var h=GM.width;var g=GM.height;switch (yL){case OD:KM.left=((1.0-CM)*h).toInt();KM.top=0;KM.right=h;KM.bottom=g;break;case nD:KM.left=0;KM.top=((1.0-CM)*g).toInt();KM.right=h;KM.bottom=g;break;case cE:KM.left=0;KM.top=0;KM.right=(CM*h).toInt();KM.bottom=g;break;case sD:KM.left=0;KM.top=0;KM.right=h;KM.bottom=(CM*g).toInt();break;}}} sB( h,[ returnRectangle]){var g=(GM!=null)?GM.width:0;var i=(GM!=null)?GM.height:0;return wD(h,g,i,returnRectangle);} HC( g, h){if(GM!=null&&g>=0.0&&h>=0.0&&g<GM.width&&h<GM.height)return this;return null;} oB( g){if(GM!=null)GM.LF(g,KM);}}abstract class MC extends KC{ get CC; set CC( g); stop();}class qB{static const  mD="auto";static const  pD="arrow";static const  qD="button";static const  MG="hand";static const  NG="ibeam";static const  QG="wait";}class iC{static const  sF=0;static const  xF=1;static const  GG=2;static const  KG=3;static const  gE=4;}class NE{var JK;var PK;var hK;var wK;NE.JI( i, g, h, j){JK=0;PK=new PB(i,g,h,j);} oB( i){var g=i.context;g.beginPath();switch (JK){case 0:g.rect(PK.x,PK.y,PK.width,PK.height);break;case 1:g.arc(hK.x,hK.y,hK.DI,0,SB.PI*2.0,false);break;case 2:g.moveTo(wK[0].x,wK[0].y);for(int h=1;h<wK.length;h++ )g.lineTo(wK[h].x,wK[h].y);break;}g.clip();}}class VB{var volume;var pan;var BI=1;var CI=0;var GI=1;var FI=0;VB([this.volume=1,this.pan=0]);}class sC{static var UG=iG();static var QD=mG();static var nE=nG();static  iG(){var h=(QD!=null)?"WebAudioApi":"AudioElement";var g=hC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0")||g.contains("10.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(nE.length==0)h="Mock";print("dartflash: supported audio engine is: ${h}");return h;}static  mG(){try {return new VF.AudioContext();}catch (g){return null;}}static  nG(){var g=new List<String>();var h=new hC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("dartflash: supported audio types are: ${g}");return g;}}class gD extends LB{var cK;var yK;var RL;gD(){RL=new List<KD>();cK=new hC.AudioElement();cK.onEnded.listen(DM);yK=new List<hC.AudioElement>();yK.add(cK);hC.document.body.children.add(cK);}static  tE( s){var k=new gD();var g=k.cK;var i=new fB.Completer<LB>();var h;var j;n(m){h.cancel();j.cancel();i.complete(k);}l(m){h.cancel();j.cancel();i.completeError(new StateError("Failed to load audio."));}h=g.onCanPlayThrough.listen(n);j=g.onError.listen(l);g.src=LB.qE(s);g.load();return i.future;} get length{return cK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new VB();return new KD(this,loop,soundTransform);} aM( h){var g;if(yK.length==0){g=cK.clone(true);g.onEnded.listen(DM);}else{g=yK.removeAt(0);}RL.add(h);return g;} pN( g){var h=g.cK;var i=RL.indexOf(g);RL.removeAt(i);yK.add(h);if(cK.currentTime>0&&cK.ended==false)cK.currentTime=0;} DM(j){var i=j.target;var g=null;for(int h=0;h<RL.length&&g==null;h++ )if(RL[h].cK==i)g=RL[h];if(g!=null)g.stop();}}class rC extends NB{var upState;var overState;var downState;var hitTestState;var EE=true;var enabled=true;var rL;rC([this.upState,this.overState,this.downState,this.hitTestState]){IB(q.lE,TM);IB(q.PD,TM);IB(q.ND,TM);IB(q.tD,TM);rL=this.upState;} sB( g,[ returnRectangle]){if(rL!=null){vM.AE(rL.dN,g);return rL.sB(vM,returnRectangle);}return super.sB(g,returnRectangle);} HC( k, l){if(this.hitTestState!=null){var g=this.hitTestState.dN;var h=k-g.DC;var i=l-g.EC;var m=(g.d*h-g.c*i)/g.ZC;var j=(g.a*i-g.b*h)/g.ZC;if(this.hitTestState.HC(m,j)!=null)return this;}return null;} oB( g){if(rL!=null)g.MF(rL);} TM( g){if(g.type==q.PD){rL=upState;}else{rL=g.QC?downState:overState;}}}class HD{var RK;var NK;var nK;var zK;var HL;var PL;HD( g, h, i){RK=g;NK=h;nK=i;HL=null;PL=null;} get kind=>RK; get name=>NK; get AD=>PL; get error=>HL;DN( i){zK=i.then((g){PL=g;HL=null;},onError:( h){PL=null;HL=h.error;});}}class RE{static const  EG="none";static const  JG="touchPoint";}class gB{final  VK=new hC.ImageElement();final  KL=new List<UE>();static  tE( m, RB){var l=new fB.Completer<gB>();var j=new gB();switch (RB){case eC.uF:case eC.lC: n( k, g){var FB=hG(k);var h=new UE(FB,j);h.tK=g["frame"]["x"].toInt();h.BL=g["frame"]["y"].toInt();h.GL=g["frame"]["w"].toInt();h.QL=g["frame"]["h"].toInt();h.YL=g["spriteSourceSize"]["x"].toInt();h.cL=g["spriteSourceSize"]["y"].toInt();h.fL=g["sourceSize"]["w"].toInt();h.nL=g["sourceSize"]["h"].toInt();h.tL=g["rotated"] as bool;j.KL.add(h);}hC.HttpRequest.getString(m).then((JB){var s=gH.parse(JB);var i=s["frames"];var w=s["meta"];if(i is List)for(var g in i)n(g["filename"],g);if(i is Map)for(String k in i.keys)n(k,i[k]);j.VK..onLoad.listen((eB)=>l.complete(j))..onError.listen((eB)=>l.completeError(new StateError("Failed to load image.")))..src=lG(m,w["image"]);}).catchError((vB){l.completeError(new StateError("Failed to load json file."));});break;}return l.future;} get HH=>VK; t( i){var h;for(int g=0;g<KL.length&&h==null;g++ )if(KL[g].name==i)h=new DB.NI(KL[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}}class eC{static const  uF="json";static const  lC="jsonarray";}final  XE=new oF<List<v>>(()=>new List<v>());class jD implements lB{final  gK;var rK=0.0;var DL=0.0;var NL=1;jD( g, h):gK=g{DL=SB.max(h,0.0001);} AC( h){var g=rK+h;while (g>=DL&&NL>0){rK=DL;NL-- ;gK();g-= DL;}rK=g;return (NL>0);} get totalTime=>DL; get currentTime=>rK;}abstract class lB{ AC( g);}class kD implements lB{final  kK=new List<lB>();var JL=0;var UL=0.0; add( g){if(g==null)return;if(this.contains(g))return;if(JL==kK.length){kK.add(g);}else{kK[JL]=g;}JL++ ;} remove( h){if(h==null)return;for(int g=0;g<JL;g++ ){if(kK[g]==h){kK[g]=null;break;}}} contains( h){if(h==null)return false;for(int g=0;g<JL;g++ ){if(kK[g]==h){return true;}}return false;} dB( h, i){var g=new jD(h,i);add(g);return g;} AC( k){UL+= k;var j=JL;var h=0;for(int g=0;g<j;g++ ){var i=kK[g];if(i==null)continue;if(i.AC(k)==false){kK[g]=null;continue;}if(h!=g){kK[h]=i;kK[g]=null;}h++ ;}if(h!=j){for(int g=j;g<JL;g++ ){kK[h++ ]=kK[g];kK[g]=null;}JL=h;}return true;}}class UE{var NK;var eK;var tK;var BL;var GL;var QL;var YL;var cL;var fL;var nL;var tL;UE( g, h){NK=g;eK=h;} get cH=>eK; get name=>NK; get DH=>tK; get EH=>BL; get CH=>GL; get BH=>QL; get offsetX=>YL; get offsetY=>cL; get RH=>fL; get QH=>nL; get ZH=>tL;}class lF{var name;var jB;var CE;lF(this.name,this.jB,this.CE);}abstract class SE{ oB( g);}class CB extends v{var bitmapData;var pixelSnapping;var SD;CB([this.bitmapData=null,this.pixelSnapping="auto"]){SD=null;} sB( h,[ returnRectangle]){var g=(bitmapData!=null)?bitmapData.width:0;var i=(bitmapData!=null)?bitmapData.height:0;return wD(h,g,i,returnRectangle);} HC( g, h){if(bitmapData!=null&&g>=0.0&&h>=0.0&&g<bitmapData.width&&h<bitmapData.height)return this;return null;} oB( g){if(bitmapData!=null){if(SD==null)bitmapData.oB(g);else bitmapData.LF(g,SD);}}}class QB{var x;var y;QB(this.x,this.y);QB.II():this(0,0); get length=>SB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new QB(this.x+g.x,this.y+g.y); zD( g){this.x=g.x;this.y=g.y;} equals( g)=>this.x==g.x&&this.y==g.y;}class PB{var x;var y;var width;var height;PB(this.x,this.y,this.width,this.height);PB.II():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new QB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0); zD( g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class kF{kF();}class TB{var KK,MK,OK,QK,TK,WK;var jK;TB.LI():KK=1.0,MK=0.0,OK=0.0,QK=1.0,TK=0.0,WK=0.0,jK=1.0; get a=>KK; get b=>MK; get c=>OK; get d=>QK; get DC=>TK; get EC=>WK; get ZC=>jK; dH( g){return new QB(g.x*KK+g.y*OK+TK,g.x*MK+g.y*QK+WK);} concat( g){var m=KK;var w=MK;var FB=OK;var s=QK;var l=TK;var n=WK;var RB=jK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var eB=g.DC;var JB=g.EC;var vB=g.ZC;KK=(m*j+w*i).toDouble();MK=(m*k+w*h).toDouble();OK=(FB*j+s*i).toDouble();QK=(FB*k+s*h).toDouble();TK=(l*j+n*i+eB).toDouble();WK=(l*k+n*h+JB).toDouble();jK=(RB*vB).toDouble();} GH(){KK=1.0;MK=0.0;OK=0.0;QK=1.0;TK=0.0;WK=0.0;jK=1.0;} LH(){var j=KK;var m=MK;var l=OK;var k=QK;var h=TK;var i=WK;var g=jK;KK=(k/g).toDouble();MK=-(m/g).toDouble();OK=-(l/g).toDouble();QK=(j/g).toDouble();TK=-(KK*h+OK*i).toDouble();WK=-(MK*h+QK*i).toDouble();jK=(1.0/g).toDouble();} NF( h, i, g, k, j, l){KK=h.toDouble();MK=i.toDouble();OK=g.toDouble();QK=k.toDouble();TK=j.toDouble();WK=l.toDouble();jK=(KK*QK-MK*OK).toDouble();} zD( g){KK=g.a.toDouble();MK=g.b.toDouble();OK=g.c.toDouble();QK=g.d.toDouble();TK=g.DC.toDouble();WK=g.EC.toDouble();jK=g.ZC.toDouble();} AE( h, g){var n=h.a;var FB=h.b;var JB=h.c;var w=h.d;var m=h.DC;var s=h.EC;var eB=h.ZC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var vB=g.DC;var RB=g.EC;var aC=g.ZC;KK=(n*k+FB*j).toDouble();MK=(n*l+FB*i).toDouble();OK=(JB*k+w*j).toDouble();QK=(JB*l+w*i).toDouble();TK=(m*k+s*j+vB).toDouble();WK=(m*l+s*i+RB).toDouble();jK=(eB*aC).toDouble();}}class nF{var LK;var YK;var lK;var EL;var TL;nF(){LK=new kD();YK=new List<mC>();lK=double.NAN;EL=ID.hE;TL=new PE(0);hC.window.requestAnimationFrame(ZM);} get MH=>LK; ZM( g){hC.window.requestAnimationFrame(ZM);if(lK.isNaN)lK=g;if(lK>g)lK=g;var j=g-lK;var i=j/1000.0;if(j>=1){lK=g;TL.UK=i;EL.ON(TL);LK.AC(i);for(int h=0;h<YK.length;h++ ){var k=YK[h];k.NH();}}} uE( g){YK.add(g);}}class zB{final  bK;final  xK=new List<TB>(100);final  VL=new List<double>(100);var eL=0;zB.KI( j,[ matrix]):bK=j{for(int h=0;h<100;h++ ){xK[h]=new TB.LI();VL[h]=1.0;}if(matrix!=null)xK[0].zD(matrix);var g=xK[0];var i=VL[0];bK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);bK.globalAlpha=i;} get context=>bK; reset(){eL=0;var g=xK[0];var h=VL[0];bK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);bK.globalAlpha=h;bK.clearRect(0,0,bK.canvas.width,bK.canvas.height);} MF( h){var i=eL;var j=eL+1;var n=xK[i];var g=xK[j];var s=VL[i];var m=VL[j]=h.YM*s;g.AE(h.dN,n);bK.setTransform(g.a,g.b,g.c,g.d,g.DC,g.EC);bK.globalAlpha=m;eL=j;var k=h.hM;var l=h.lM;if(k!=null){bK.save();k.oB(this);}if(l!=null){l.oB(this);}else{h.oB(this);}if(k!=null){bK.restore();}eL=i;}}class jC{static const  mD="auto";static const  BG="stop";static const  rD="once";}class BB extends kC{var vH=false;var EE=false;}class dC{static const  YE=1;static const  MD=2;static const  HG=3;}class KC{var XK; FH( g){if(XK!=null)return XK.containsKey(g)||XK.containsKey("${g}_CAPTURE");else return false;} IB( g, i(event),{ useCapture: false}){var h=oL(g,useCapture);var j=h.listen(i);return j;} dispatchEvent( g){jN(g,this,this,dC.MD);} jN( g, k, l, i){if(XK!=null){var j=(i==dC.YE)?"${g.type}_CAPTURE":g.type;var h=XK[j];if(h!=null){g.vK=k;g.gN=l;g.SN=i;g.TN=false;g.YN=false;h.ON(g);}}} oL( g, j){if(XK==null)XK=new Map<String,qC>();var i=j?"${g}_CAPTURE":g;var h=XK[i];if(h==null)h=XK[i]=new qC(this,g,j);return h;}}class ID<tC extends AB>{final  XK=new List<qC>();var LL=0;static var hE=new ID<PE>(); OM( g){for(int h=0;h<LL;h++ )if(XK[h]==g)return;if(LL==XK.length)XK.add(g);else XK[LL]=g;LL++ ;} ON( j){j.SN=dC.MD;j.TN=false;j.YN=false;var k=LL;var i=0;for(int g=0;g<k;g++ ){var h=XK[g];if(h==null)continue;if(h.vL==0){XK[g]=null;continue;}j.vK=h.vK;j.gN=h.vK;h.ON(j);if(i!=g){XK[i]=h;XK[g]=null;}i++ ;}if(i!=k){for(int g=k;g<LL;g++ ){XK[i++ ]=XK[g];XK[g]=null;}LL=i;}}}class qC<tC extends AB> extends fB.Stream<tC>{final  vK;final  iK;final  SL;final  gL=new List<vF>();var vL=0;qC(this.vK,this.iK,this.SL); get isBroadcast=>true; asBroadcastStream()=>this; listen( h( event),{ onError( error), onDone(), unsubscribeOnError}){var g=new vF<tC>(this,h);if(vL==gL.length)gL.add(g);else gL[vL]=g;vL++ ;if(iK==AB.eE&&SL==false)ID.hE.OM(this);return g;} rM( h){for(int g=0;g<vL;g++ ){if(gL[g]==h){gL[g]=null;break;}}} ON( k){var j=vL;var h=0;for(int g=0;g<j;g++ ){var i=gL[g];if(i==null)continue;i.jL(k);if(h!=g){gL[h]=i;gL[g]=null;}h++ ;}if(h!=j){for(int g=j;g<vL;g++ ){gL[h++ ]=gL[g];gL[g]=null;}vL=h;}}}class FC<tC extends AB>{final  iK;const FC(this.iK); forTarget( g,{ useCapture: false}){return g.oL(iK,useCapture);}}class QE{var target=null;var QC=false;var yD=0;var yC=0;var HF,IF;var FF,GF;QE(this.HF,this.IF,this.FF,this.GF);}class PE extends AB{var UK;PE( g):super(AB.eE,false){UK=g;} get xD=>false;}class q extends AB{static const  XC="click";static const  FG="doubleClick";static const  ND="mouseDown";static const  tD="mouseUp";static const  kE="mouseMove";static const  PD="mouseOut";static const  lE="mouseOver";static const  mE="mouseWheel";static const  oE="middleClick";static const  aG="middleMouseDown";static const  cG="middleMouseUp";static const  pE="rightClick";static const  gG="rightMouseDown";static const  jG="rightMouseUp";var MN,NN;var QN,RN;var oN;var JM;var dM;var NM;var SM;var qN;var rN;var sN;q( g,[ bubbles=false]):super(g,bubbles){zM(g,bubbles);} zM( g,[ bubbles=false]){super.zM(g,bubbles);MN=NN=0;QN=RN=0;oN=false;JM=false;dM=false;NM=false;SM=false;qN=0;rN=0;sN=0;}set tN( g){MN=g.x;NN=g.y;}set uN( g){QN=g.x;RN=g.y;} get DF=>MN; get EF=>NN; get QC=>oN; get altKey=>JM; get ctrlKey=>NM; get shiftKey=>SM; get yC=>qN; get deltaX=>rN; get deltaY=>sN;}class GC extends AB{static const  oD="keyDown";static const  aE="keyUp";var JM;var NM;var SM;var VM;var dM;var iM;var mM;var oM;GC( g,[ bubbles=false]):super(g,bubbles){zM(g,bubbles);} zM( g,[ bubbles=false]){super.zM(g,bubbles);JM=false;NM=false;SM=false;VM=false;dM=false;iM=0;mM=0;oM=0;} get altKey=>JM; get ctrlKey=>NM; get shiftKey=>SM; get charCode=>iM; get keyCode=>mM; get keyLocation=>oM;}class VE extends AB{static const  DG="textInput";var dK="";VE( g,[ bubbles=false]):super(g,bubbles){}}class WB extends AB{static const  ZE="touchBegin";static const  bE="touchEnd";static const  dE="touchCancel";static const  jE="touchMove";static const  SG="touchOver";static const  TG="touchOut";var IN;var LN;var MN,NN;var QN,RN;var JM;var dM;var NM;var SM;var VN;var XN;var ZN;WB( g,[ bubbles=false]):super(g,bubbles){zM(g,bubbles);} zM( g,[ bubbles=false]){super.zM(g,bubbles);IN=0;LN=false;MN=NN=0;QN=RN=0;JM=false;dM=false;NM=false;SM=false;VN=1.00;XN=0;ZN=0;}set tN( g){MN=g.x;NN=g.y;}set uN( g){QN=g.x;RN=g.y;} get YD=>IN; get DF=>MN; get EF=>NN; get altKey=>JM; get ctrlKey=>NM; get shiftKey=>SM;}class oF<tC>{final  SK=new List<tC>();final  uK;var FL=0;oF( g()):uK=g; TH(){if(FL==0){return uK();}else{FL-- ;return SK[FL];}}VH( g){if(FL==SK.length){SK.add(g);}else{SK[FL]=g;}FL++ ;}reset(){SK.clear();FL=0;}}class KD extends MC{var qK;var cK;var ZK;var sK;KD( g, i, h){qK=g;ZK=i;sK=h;cK=g.aM(this);cK.loop=ZK;this.CC=h;cK.play();} get CC=>sK; set CC( g){sK=g;if(cK!=null)cK.volume=(sK!=null)?sK.volume:1;} stop(){if(cK!=null){if(cK.ended==false)cK.pause();qK.pN(this);cK=null;}}}class hD extends LB{var aK;hD(){if(sC.QD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  tE( n){var h=new hD();var k=LB.qE(n);var g=new fB.Completer<LB>();hC.HttpRequest.request(k,responseType:'arraybuffer').then((i){var j=i.response;var m=sC.QD;m.decodeAudioData(j,( l){h.aK=l;g.complete(h);},(s){g.completeError(new StateError("Failed to decode audio."));});}).catchError((s){g.completeError(new StateError("Failed to load audio."));});return g.future;} get length{return aK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new VB();return new rH(this,loop,soundTransform);}}class rH extends MC{var mK;var sK;var ZK;var ZL;var iL;rH( j, h, i){mK=j;ZK=h;sK=i;var g=sC.QD;ZL=g.createGain();ZL.connect(g.destination,0,0);ZL.gain.value=(sK!=null)?SB.pow(sK.volume,2):1;iL=g.createBufferSource();iL.buffer=mK.aK;iL.loop=h;iL.connect(ZL,0,0);iL.start(0);} get CC=>sK; set CC( g){sK=g;ZL.gain.value=(sK!=null)?SB.pow(sK.volume,2):1;} stop(){iL.stop(0);}}class TE extends LB{TE(){}static  tE( g){return new fB.Future<LB>.of(()=>new TE());} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null){soundTransform=new VB();}return new qH(this,loop,soundTransform);}}abstract class kC extends NB{final  CL=new List<v>();var WL=true;var dL=true; o( g){if(g.parent==this){var h=CL.indexOf(g);CL.removeAt(h);CL.add(g);}else{wG(g,CL.length);}} wG( g, h){if(h<0||h>CL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){CL.removeAt(CL.indexOf(g));if(h>CL.length)h-- ;CL.insert(h,g);}else{g.BE();g.vN(this);CL.insert(h,g);g.dispatchEvent(new AB(AB.wF,true));if(this.WD!=null)wN(g,new AB(AB.uC));}} tB( h){var g=CL.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");WH(g);} WH( g){if(g<0||g>=CL.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=CL[g];h.dispatchEvent(new AB(AB.OG,true));if(this.WD!=null)wN(h,new AB(AB.wC));h.vN(null);CL.removeAt(g);} contains( g){for(;g!=null;g=g.tM)if(g==this)return true;return false;} sB( n,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.II();if(CL.length==0)return super.sB(n,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var k=double.NEGATIVE_INFINITY;var j=double.NEGATIVE_INFINITY;var s=CL.length;for(int l=0;l<CL.length;l++ ){var m=CL[l];vM.AE(m.dN,n);var g=m.sB(vM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>k)k=g.right;if(g.bottom>j)j=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=k-h;returnRectangle.height=j-i;return returnRectangle;} HC( s, w){var l=null;for(int j=CL.length-1;j>=0;j-- ){var i=CL[j];if(i.visible){var g=i.dN;var m=s-g.DC;var k=w-g.EC;var FB=(g.d*m-g.c*k)/g.ZC;var n=(g.a*k-g.b*m)/g.ZC;var h=i.HC(FB,n);if(h!=null){if(h is NB)if(h.UB)return WL?h:this;l=this;}}}return l;} oB( i){for(int g=0;g<CL.length;g++ ){var h=CL[g];if(h.visible)i.MF(h);}} wN( g, j){g.dispatchEvent(j);if(g is kC){var i=new List<v>.from(g.CL,growable:false);for(int h=0;h<i.length;h++ )wN(i[h],j);}}}abstract class NB extends v{var AH=false;var UB=true;var HI=true;var tabIndex=0;static const  RG=const FC<q>(q.PD);static const  bG=const FC<q>(q.kE);static const  eG=const FC<q>(q.ND);static const  kG=const FC<q>(q.tD);static const  pG=const FC<q>(q.mE); get onMouseOut=>NB.RG.forTarget(this); get onMouseMove=>NB.bG.forTarget(this); get onMouseDown=>NB.eG.forTarget(this); get onMouseUp=>NB.kG.forTarget(this); get onMouseWheel=>NB.pG.forTarget(this);static const  qG=const FC<WB>(WB.jE);static const  rG=const FC<WB>(WB.bE);static const  sG=const FC<WB>(WB.dE); get onTouchMove=>NB.qG.forTarget(this); get onTouchEnd=>NB.rG.forTarget(this); get onTouchCancel=>NB.sG.forTarget(this);static const  tG=const FC<GC>(GC.aE);static const  uG=const FC<GC>(GC.oD); get onKeyUp=>NB.tG.forTarget(this); get onKeyDown=>NB.uG.forTarget(this);}class AB{static const  wF="added";static const  uC="addedToStage";static const  eE="enterFrame";static const  OG="removed";static const  wC="removedFromStage";var JK;var aN;var SN;var vK;var gN;var TN;var YN;AB( g,[ bubbles=false]){zM(g,bubbles);} zM( g,[ bubbles=false]){JK=g;aN=bubbles;SN=dC.MD;vK=null;gN=null;TN=false;YN=false;} get XD=>TN; get type=>JK; get bubbles=>aN; get xD=>true; get target=>vK;}class lD extends JD implements lB{static const  AG='TIME_OUT';var bL=false;var rK=0.0;var DL=0.0;var wL;var AM=true;lD( g, h,[ direction=JD.OD]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');DL=g;xE();} AC( g){if(bL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){bL=true;} pause(){bL=false;} reset([ time=0.0]){pause();time=SB.max(time,0.0);if(time!=0.0){DL=time;xE();}ratio=1.0;} RD( g, h){wL[g]=h/totalTime;} xE(){wL=new Map<String,num>();RD(lD.AG,0);} get totalTime=>DL; get YH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(AM){wL.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new AB(j));});}}}class DB implements SE{var fK;var oK;var AL;var OL;var bK;var hL;var mL;var qL;var tK;var BL;var GL;var QL;DB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){fK=g;oK=h;AL=transparent;var i=new hC.CanvasElement(width:fK,height:oK);bK=i.context2d;bK.fillStyle=AL?WG(fillColor):vC(fillColor);bK.fillRect(0,0,g,h);OL=i;hL=0;mL=0;qL=0;}DB.MI( g){if(g==null)throw new ArgumentError();fK=g.naturalWidth;oK=g.naturalHeight;AL=true;OL=g;hL=0;mL=0;qL=0;}DB.NI( g){fK=g.RH;oK=g.QH;AL=true;OL=g.cH.HH;hL=g.ZH?2:1;mL=g.offsetX;qL=g.offsetY;tK=g.DH;BL=g.EH;GL=g.CH;QL=g.BH;}static  tE( i){var h=new fB.Completer<DB>();var g=new hC.ImageElement();g.onLoad.listen((j)=>h.complete(new DB.MI(g)));g.onError.listen((j)=>h.completeError(new StateError("Error loading image.")));g.src=i;return h.future;} get width=>fK; get height=>oK; clear(){var g=EO();g.clearRect(0,0,fK,oK);} oB( h){var g=h.context;switch (hL){case 0:g.drawImage(OL,mL,qL);break;case 1:g.drawImageScaledFromSource(OL,tK,BL,GL,QL,mL,qL,GL,QL);break;case 2:g.transform(0.0,-1.0,1.0,0.0,mL,qL+QL);g.drawImageScaledFromSource(OL,tK,BL,QL,GL,0,0,QL,GL);break;}} LF( fH, g){var eB=fH.context;if(g.width<=0.0||g.height<=0.0)return;switch (hL){case 0:eB.drawImageScaledFromSource(OL,g.x-mL,g.y-qL,g.width,g.height,g.x+mL,g.y+qL,g.width,g.height);break;case 1:var j=tK;var h=BL;var w=j+GL;var FB=h+QL;var l=tK-mL+g.x;var m=BL-qL+g.y;var RB=l+g.width;var JB=m+g.height;var s=(j>l)?j:l;var n=(h>m)?h:m;var vB=(w<RB)?w:RB;var FE=(FB<JB)?FB:JB;var GE=mL-j+s;var aC=qL-h+n;var k=vB-s;var i=FE-n;if(k>0.0&&i>0.0){eB.drawImageScaledFromSource(OL,s,n,k,i,GE,aC,k,i);}break;case 2:var j=tK;var h=BL;var w=j+QL;var FB=h+GL;var l=tK+qL-g.y+QL-g.height;var m=BL-mL+g.x;var RB=l+g.height;var JB=m+g.width;var s=(j>l)?j:l;var n=(h>m)?h:m;var vB=(w<RB)?w:RB;var FE=(FB<JB)?FB:JB;var GE=mL-h+n;var aC=qL+w-vB;var k=FE-n;var i=vB-s;if(k>0.0&&i>0.0){eB.transform(0.0,-1.0,1.0,0.0,GE,aC+i);eB.drawImageScaledFromSource(OL,s,n,i,k,0,0,i,k);}break;}} EO(){if(bK==null){var g=new hC.CanvasElement(width:fK,height:oK);bK=g.context2d;switch (hL){case 0:bK.drawImage(OL,mL,qL);break;case 1:bK.drawImageScaledFromSource(OL,tK,BL,GL,QL,mL,qL,GL,QL);break;case 2:bK.setTransform(0.0,-1.0,1.0,0.0,mL,qL+QL);bK.drawImageScaledFromSource(OL,tK,BL,QL,GL,0,0,QL,GL);bK.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);break;}OL=g;hL=0;mL=0;qL=0;}return bK;}}typedef  rF<tC extends AB>( event);class vF<tC extends AB> extends fB.StreamSubscription<tC>{var aL;var jL;var lL;var pL;vF(this.aL,this.jL){lL=0;pL=false;} cancel(){if(pL==false){aL.rM(this);pL=true;jL=null;}} onError( g( error)){} get fN=>lL>0; pause([ resumeSignal]){lL++ ;if(resumeSignal!=null)resumeSignal.whenComplete(resume);} resume(){if(fN==false)throw new StateError("Subscription is not paused.");lL-- ;}}class LD{var ML;LD(){ML=new Map<String,HD>();} LM( g){var j=g.kind;var h=g.name;var i="${j}.${h}";if(ML.containsKey(i))throw new StateError("ResourceManager already contains a resource called '${h}'");ML[i]=g;} EN( i, g){var h="${i}.${g}";if(ML.containsKey(h)==false)throw new StateError("ResourceManager does not contains a resource called '${g}'");return ML[h];} hB( i, h){var g=new HD("BitmapData",i,h);g.DN(DB.tE(h));LM(g);} ZB( i, h){var g=new HD("Sound",i,h);g.DN(LB.tE(h));LM(g);} xC( j, h, i){var g=new HD("TextureAtlas",j,h);g.DN(gB.tE(h,i));LM(g);} nB( i, h){var g=new HD("Text",i,"");g.DN(new fB.Future.immediate(h));LM(g);} load(){var h=this.SH.map((i)=>i.zK);return fB.Future.wait(h).then((j){var g=this.CF;if(g.length>0)throw new StateError("Failed to load ${g.length} resource(s).");return this;});} get SH{return ML.values.where((g)=>g.AD==null).toList();} get CF{return ML.values.where((g)=>g.error!=null).toList();} t( g){return EN("BitmapData",g).AD;} iB( g){return EN("Sound",g).AD;} TC( g){return EN("TextureAtlas",g).AD;} nC( g){return EN("Text",g).AD;}} vC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}abstract class v extends KC implements SE{var sL=0.0;var uL=0.0;var xL=0.0;var BM=0.0;var EM=1.0;var HM=1.0;var MM=0.0;var PM=0.0;var UM=0.0;var YM=1.0;var eM=true;var hM=null;var lM=null;var NK="";var tM=null;final  vM=new TB.LI();final  BN=new TB.LI();final  GN=new TB.LI();var KN=true; get x=>sL; get y=>uL; get UC=>xL; get VC=>BM; get uB=>EM; get BC=>HM; get skewX=>MM; get skewY=>PM; get YB=>UM; get alpha=>YM; get visible=>eM; get name=>NK; get parent=>tM; get root{var g=this;while (g.tM!=null)g=g.tM;return g;} get WD{var g=this.root;if(g is mC)return g;return null;}set x( g){sL=g.toDouble();KN=true;}set y( g){uL=g.toDouble();KN=true;}set UC( g){xL=g.toDouble();KN=true;}set VC( g){BM=g.toDouble();KN=true;}set uB( g){EM=g.toDouble();KN=true;}set BC( g){HM=g.toDouble();KN=true;}set skewX( g){MM=g.toDouble();KN=true;}set skewY( g){PM=g.toDouble();KN=true;}set YB( g){UM=g.toDouble();KN=true;}set alpha( g){YM=g.toDouble();KN=true;}set mask( g){hM=g;} get width=>sB(dN).width; get height=>sB(dN).height; set width( h){this.uB=1;var g=this.width;this.uB=(g!=0.0)?h/g:1.0;} set height( h){this.BC=1;var g=this.height;this.BC=(g!=0.0)?h/g:1.0;} BE(){if(tM!=null)tM.tB(this);} get dN{if(KN){KN=false;var j=MM+UM;var i=PM+UM;if(j==0.0&&i==0.0){GN.NF(EM,0.0,0.0,HM,sL-xL*EM,uL-BM*HM);}else{var g,l,k,h;var m=SB.cos(j);var n=SB.sin(j);if(j==i){g=EM*m;l=EM*n;k=-HM*n;h=HM*m;}else{g=EM*SB.cos(i);l=EM*SB.sin(i);k=-HM*n;h=HM*m;}var w=sL-(xL*g+BM*k);var s=uL-(xL*l+BM*h);GN.NF(g,l,k,h,w,s);}}return GN;} sB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new PB.II();returnRectangle.x=g.DC;returnRectangle.y=g.EC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} HC( g, h){if(sB(BN).contains(g,h))return this;return null;} gC( h){vM.GH();for(v g=this;g!=null;g=g.tM)vM.concat(g.dN);vM.LH();return vM.dH(h);} dispatchEvent( h){var g=null;if(h.xD||h.bubbles)for(v j=tM;j!=null;j=j.tM)if(j.FH(h.type)){if(g==null)g=XE.TH() as List<v>;g.add(j);}if(h.xD&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.XD==false)g[i].jN(h,this,g[i],dC.YE);if(h.XD==false)jN(h,this,this,dC.MD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.XD==false)g[i].jN(h,this,g[i],dC.HG);if(g!=null){g.clear();XE.VH(g);}} vN( h){for(var g=h;g!=null;g=g.tM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");tM=h;} oB( g);}class fE{static var iE=false;static var uD=false;static var vD=0;static var YG=RE.EG;static var ZG=new fB.StreamController<String>();static var dG=ZG.stream.asBroadcastStream();static fG(){if(iE==false){iE=true;var g=hC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){uD=true;vD=10;}if(g.contains("Android")){uD=true;vD=10;}if(g.contains("IEMobile")){uD=true;vD=10;}}}static  get oG{fG();return YG;}}class OC extends lB{final  QM;final  XM;final  bM;var gM;var kM;var nM;var qM;var DL;var rK;var wM;var xM;var AN;OC( g, h, i,[ transitionFunction( ratio)]):QM=g,XM=h,bM=(transitionFunction!=null)?transitionFunction:MB.PC{gM=g;rK=0.0;DL=SB.max(0.0001,i);wM=0.0;xM=false;AN=false;} AC( i){if(rK<DL||AN==false){rK=rK+i;if(rK>DL)rK=DL;if(rK>=0.0){if(AN==false){AN=true;if(kM!=null)kM();}var g=rK/DL;var h=bM(g);gM=QM+h*(XM-QM);if(nM!=null)nM(xM?gM.round():gM);if(qM!=null&&rK==DL)qM();}}return rK<DL;} get jB=>QM; get CE=>XM; get totalTime=>DL; get currentTime=>rK;set SC( g){if(AN==false)rK=rK+wM-g;wM=g;} set onStart( g()){kM=g;} set JC( g( value)){nM=g;} set onComplete( g()){qM=g;}}class VG{static var XG=0;var YD=XG++ ;var target=null;var VD=false;VG(this.target,this.VD);} WG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static  PC( g){return g;}static  sE( g){return g*g*g;}static  rB( g){g=1.0-g;return 1.0-g*g*g;}static  vG( g){if(g==0.0||g==1.0)return g;return SB.pow(2.0,-10.0*g)*SB.sin((g-0.3/4.0)*(2.0*SB.PI)/0.3)+1;}}class mB implements lB{final  HN;final  bM;final  PN=new List<lF>();var kM;var nM;var qM;var DL;var rK;var wM;var xM;var AN;mB( g, h,[ transitionFunction( ratio)]):HN=g,bM=(transitionFunction!=null)?transitionFunction:MB.PC{rK=0.0;DL=SB.max(0.0001,h);wM=0.0;xM=false;AN=false;} XB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','skewX','skewY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(HN!=null&&AN==false)PN.add(new lF(g,0.0,h));} moveTo( h, g){XB('x',h);XB('y',g);} AC( l){if(rK<DL||AN==false){rK=rK+l;if(rK>DL)rK=DL;if(rK>=0.0){if(AN==false){AN=true;for(int i=0;i<PN.length;i++ ){var g=PN[i];switch (g.name){case 'x':g.jB=HN.x;break;case 'y':g.jB=HN.y;break;case 'pivotX':g.jB=HN.UC;break;case 'pivotY':g.jB=HN.VC;break;case 'scaleX':g.jB=HN.uB;break;case 'scaleY':g.jB=HN.BC;break;case 'skewX':g.jB=HN.skewX;break;case 'skewY':g.jB=HN.skewY;break;case 'rotation':g.jB=HN.YB;break;case 'alpha':g.jB=HN.alpha;break;}}if(kM!=null)kM();}var j=rK/DL;var k=bM(j);for(int i=0;i<PN.length;i++ ){var g=PN[i];var h=g.jB+k*(g.CE-g.jB);h=xM?h.round():h;switch (g.name){case 'x':HN.x=h;break;case 'y':HN.y=h;break;case 'pivotX':HN.UC=h;break;case 'pivotY':HN.VC=h;break;case 'scaleX':HN.uB=h;break;case 'scaleY':HN.BC=h;break;case 'skewX':HN.skewX=h;break;case 'skewY':HN.skewY=h;break;case 'rotation':HN.YB=h;break;case 'alpha':HN.alpha=h;break;}}if(nM!=null)nM();if(qM!=null&&rK==DL)qM();}}return rK<DL;} get totalTime=>DL; get currentTime=>rK;set SC( g){if(AN==false)rK=rK+wM-g;wM=g;} set onStart( g()){kM=g;} set JC( g()){nM=g;} set onComplete( g()){qM=g;}} hG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);var i=h.firstMatch(g);return i.group(1);}class mC extends kC{var CN;var bK;var UN;var WN;var bN;var cN;var eN;var hN;var iN;var kN;var lN;var mN;var nN;mC( h, g){NK=h;CN=g;CN.focus();bK=g.context2d;WN=new zB.KI(bK);bN=jC.mD;cN=qB.pD;iD.PG.listen(PG);iN=[new QE(q.ND,q.tD,q.XC,q.FG),new QE(q.aG,q.cG,q.oE,q.oE),new QE(q.gG,q.jG,q.pE,q.pE)];hN=null;eN=new QB(0,0);lN=new q(q.XC,true);CN.onMouseDown.listen(TM);CN.onMouseUp.listen(TM);CN.onMouseMove.listen(TM);CN.onMouseOut.listen(TM);CN.onMouseWheel.listen(xN);kN=new Map<int,VG>();nN=new WB(WB.ZE,true);fE.dG.listen(yN);yN(null);mN=new GC(GC.oD,true);CN.onKeyDown.listen(zN);CN.onKeyUp.listen(zN);CN.onKeyPress.listen(AO);} get focus=>UN; set XH( g){bN=g;}CO(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){CO();} set y( g){CO();} set UC( g){CO();} set VC( g){CO();} set uB( g){CO();} set BC( g){CO();} set YB( g){CO();} set alpha( g){CO();} set width( g){CO();} set height( g){CO();}NH(){if(bN==jC.mD||bN==jC.rD){WN.reset();oB(WN);if(bN==jC.rD)bN=jC.BG;}}PG( g){CN.style.cursor=iD.rE(cN);}TM( j){j.preventDefault();var FB=CN.getBoundingClientRect();var n=new DateTime.now().millisecondsSinceEpoch;var w=j.button;var h=null;var i=new QB(j.client.x-FB.left,j.client.y-FB.top);var m=null;if(w<0||w>2)return;if(j.type=="mousemove"&&eN.equals(i))return;var g=iN[w];eN=i;if(j.type!="mouseout")h=HC(i.x,i.y) as NB;var l=qB.pD;if(h is BB)if(h.EE)l=qB.qD;if(h is rC)if(h.EE)l=qB.qD;if(cN!=l){cN=l;CN.style.cursor=iD.rE(l);}if(hN!=null&&hN!=h){hN.dispatchEvent(lN..zM(q.PD,true)..tN=(hN.WD!=null)?hN.gC(i):new QB.II()..uN=i..oN=g.QC);hN=null;}if(h!=null&&h!=hN){h.dispatchEvent(lN..zM(q.lE,true)..tN=h.gC(i)..uN=i..oN=g.QC);hN=h;}var k=null;var s=false;var JB=false;if(j.type=="mousedown"){k=g.HF;if(h!=g.target||n>g.yD+500)g.yC=0;g.QC=true;g.target=h;g.yD=n;g.yC++ ;}if(j.type=="mouseup"){k=g.IF;g.QC=false;s=(g.target==h);JB=s&&g.yC.isEven&&(n<g.yD+500);}if(j.type=="mousemove"){k=q.kE;}if(k!=null&&h!=null){m=h.gC(i);h.dispatchEvent(lN..zM(k,true)..tN=m..uN=i..oN=g.QC..qN=g.yC);if(s){if(JB&&h.AH){h.dispatchEvent(lN..zM(g.GF,true)..tN=m..uN=i..oN=g.QC);}else{h.dispatchEvent(lN..zM(g.FF,true)..tN=m..uN=i..oN=g.QC);}}}}xN( g){var j=CN.getBoundingClientRect();var h=new QB(g.client.x-j.left,g.client.y-j.top);var i=HC(h.x,h.y) as NB;if(i!=null){i.dispatchEvent(lN..zM(q.mE,true)..tN=i.gC(h)..uN=h..rN=g.deltaX..sN=g.deltaY);if(lN.XD)g.preventDefault();}}var FO=[] ;yN( h){FO.forEach((g)=>g.cancel());if(fE.oG==RE.JG){FO=[CN.onTouchStart.listen(GO),CN.onTouchEnd.listen(GO),CN.onTouchMove.listen(GO),CN.onTouchEnter.listen(GO),CN.onTouchLeave.listen(GO),CN.onTouchCancel.listen(GO)];}}GO( j){j.preventDefault();var n=CN.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var i=new QB(m.client.x-n.left,m.client.y-n.top);var h=HC(i.x,i.y) as NB;var g=kN.containsKey(l)?kN[l]:new VG(h,kN.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(nN..zM(WB.TG,true)..tN=(g.target.WD!=null)?g.target.gC(i):new QB.II()..uN=i..IN=g.YD..LN=g.VD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(nN..zM(WB.SG,true)..tN=h.gC(i)..uN=i..IN=g.YD..LN=g.VD);g.target=h;}var k=null;if(j.type=="touchstart"){kN[l]=g;k=WB.ZE;}if(j.type=="touchend"){kN.remove(l);k=WB.bE;}if(j.type=="touchcancel"){kN.remove(l);k=WB.dE;}if(j.type=="touchmove"){k=WB.jE;}if(k!=null&&h!=null){h.dispatchEvent(nN..zM(k,true)..tN=h.gC(i)..uN=i..IN=g.YD..LN=g.VD);}}}zN( g){g.preventDefault();var h=null;if(g.type=="keyup")h=GC.aE;if(g.type=="keydown")h=GC.oD;mN..zM(h,true)..JM=g.altKey..NM=g.ctrlKey..SM=g.shiftKey..iM=g.charCode..mM=g.keyCode..oM=iC.sF;if(g.keyLocation==hC.KeyLocation.LEFT)mN.oM=iC.xF;if(g.keyLocation==hC.KeyLocation.RIGHT)mN.oM=iC.GG;if(g.keyLocation==hC.KeyLocation.NUMPAD)mN.oM=iC.KG;if(g.keyLocation==hC.KeyLocation.JOYSTICK)mN.oM=iC.gE;if(g.keyLocation==hC.KeyLocation.MOBILE)mN.oM=iC.gE;if(UN!=null)UN.dispatchEvent(mN);}AO( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new VE(VE.DG,true);h.dK=new String.fromCharCodes([i]);if(UN!=null)UN.dispatchEvent(h);}} lG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";} wD( g, m, n, j){m=m.toDouble();n=n.toDouble();var aC=0.0;var vB=0.0;var FB=m*g.a;var eB=m*g.b;var JB=m*g.a+n*g.c;var w=m*g.b+n*g.d;var RB=n*g.c;var s=n*g.d;var h=aC;if(h>FB)h=FB;if(h>JB)h=JB;if(h>RB)h=RB;var i=vB;if(i>eB)i=eB;if(i>w)i=w;if(i>s)i=s;var l=aC;if(l<FB)l=FB;if(l<JB)l=JB;if(l<RB)l=RB;var k=vB;if(k<eB)k=eB;if(k<w)k=w;if(k<s)k=s;if(j==null)j=new PB.II();j.x=g.DC+h;j.y=g.EC+i;j.width=l-h;j.height=k-i;return j;}//@ sourceMappingURL=escape.dart.map
