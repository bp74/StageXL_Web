import "dart:json" as cK;import "dart:math" as ZB;import "dart:web_audio" as PH;import "dart:html" as xC;import "dart:async" as YB;class dK{static const String eK="Chrome";static const String fK="Firefox";static const String gK="Internet Explorer";static const String hK="Safari";final String CJ;final String iJ;const dK(this.CJ,[this.iJ]);}class iK{final String name;const iK(this.name);}class QC{num x;num y;QC(this.x,this.y);num get length{return ZB.sqrt(x*x+y*y);}normalize(){var g=this.length;if(g==0)throw new UnsupportedError("divided by 0");if(g==1)return;x/= g;y/= g;}scale(num g){x*= g;y*= g;}QC clone(){return new QC(x,y);}QC add(QC g){if(g==null)return null;return new QC(x+g.x,y+g.y);}num get CF{num g=ZB.PI-ZB.atan2(this.x,this.y);if(g<0)g+= 2*ZB.PI;return g;}set CF(num i){var h=this.length;var g=DB.YI(h,i-ZB.PI/2);this.x=g.x;this.y=g.y;}String toString(){return ("V(${x},${y})");}}class cC{num x;num y;num z;cC(this.x,this.y,this.z);cC clone(){return new cC(x,y,z);}num gG(){return ZB.sqrt(x*x+y*y+z*z);}PK(num g){this.normalize();this.scale(g);}cC add(cC g){return new cC(x+g.x,y+g.y,z+g.z);}scale(num g){x*= g;y*= g;z*= g;}void normalize(){var g=gG();if(g==0||g==1)return;x/= g;y/= g;z/= g;}String toString(){return "V(x: ${x}, y: ${y}, z: ${z})";}bool equals(cC g){return (g.x==x&&g.y==y&&g.z==z);}}class UB extends ZE implements pC{static int nD=588;static int SD=314;static num YH=10.0;hB rC;eC rB;num XL;num bF;String HC;UB(uB g,[bool autoStart=true,String fontName=xD]):super(g){this.HC=fontName;this.width=UB.nD;this.height=UB.SD;this.rC=new hB(m.LB("items").CB("menu_bg"));this.v(this.rC);this.rB=new eC();this.rB.wC=0x000000;this.rB.wordWrap=true;this.rB.WC=new sF(fontName,30,0x000000,zB:true,align:lB.DE);this.rB.width=476;this.rB.height=250;this.rB.x=60;this.rB.y=90;this.v(this.rB);this.t(p.gC,this.onClick);if(autoStart){this.NH=0;this.bF=0;aB.add(this);}else{this.NH=1;}this.alpha=0;}bool DD(num g){this.bF+= g;if(this.bF>YH){fD();LF();return false;}return true;}set text(String g){if(g==null)return;var h=new sF(HC,30,0x000000,zB:true,align:lB.DE);if(g.length<=30)h.size=45;else h.size=30;this.rB.WC=h;this.rB.text=g;}void onClick(p g){fD();LF();}void LF(){this.dispatchEvent(new KB(KB.vB,this));}set NH(num g){if(g<0)g=1;if(g>1)g=1;XL=g;var h=(255*XL).round().toInt();}void fD(){aB.remove(this);}}class KB extends BB{static const String vB="MenuEvent.TYPE_OK";static const String oD="MenuEvent.TYPE_CANCEL";UB PE;KB(String h,UB g,[bool bubbles=false]):super(h,bubbles){this.PE=g;}}class RH extends ZE{hB rC;eC aC;eC BC;eC AC;eC NC;hB LC;hB MC;String font;int dF=30;List<hB> UE;RH(uB h,[String fontName=xD]):super(h){this.font=fontName;this.sC();StringBuffer g=new StringBuffer();g.add((this.u as tB).eB("GENlevel"));g.add(": 0");AC.text=g.toString();}void sC(){this.rC=new hB(m.LB("items").CB("topbar"));this.rC.x=0;this.rC.y=0;this.v(this.rC);this.aC=new eC();this.aC.WC=new sF(font,24,0,zB:true,align:lB.JG);this.aC.wC=0x000000;this.aC.width=400;this.aC.height=100;this.aC.x=20;this.aC.y=dF;this.v(aC);this.BC=new eC();this.BC.WC=new sF(font,24,0,zB:true,align:lB.FE);this.BC.wC=0x000000;this.BC.width=200;this.BC.height=100;this.BC.x=(this.u.ME/2)-this.BC.width+60;this.BC.y=dF;this.v(BC);this.AC=new eC();this.AC.WC=new sF(font,24,0,zB:true,align:lB.FE);this.AC.wC=0x000000;this.AC.width=200;this.AC.height=100;this.AC.x=(this.u.ME)-(this.AC.width)-20;this.AC.y=dF;this.v(AC);this.NC=new eC();this.NC.WC=new sF(font,24,0,zB:true,align:lB.DE);this.NC.wC=0x000000;this.NC.width=200;this.NC.height=100;this.NC.x=20;this.NC.y=this.u.dG-this.NC.height-20;this.v(NC);this.NC.visible=false;this.LC=new hB(m.LB("items").CB("progressbar"));this.LC.x=25;this.LC.y=82;this.v(this.LC);this.MC=new hB(m.LB("items").CB("progressship"));this.MC.x=25;this.MC.y=this.LC.y+(this.LC.height-(this.LC.height-this.MC.height))-(this.MC.height);this.v(this.MC);this.UE=new List<hB>();for(var h=0;h<3;h++ ){var g=new hB(m.LB("items").CB("spaceship"));g.y=10;g.x=(this.u.ME/2)+70+(h*35);this.v(g);this.UE.add(g);}}void wG(o g){this.MC.x=25;this.MC.y=this.LC.y+(this.LC.height-((this.LC.height-this.MC.height)*g.u.lD))-(this.MC.height);}void vG(o i){var h=i.u as tB;if(h.ND){this.BC.text=h.eB("DISPLAY_TRAINING");}else{this.BC.text=h.eB("DISPLAY_LIVES");}for(var g=0;g<this.UE.length;g++ ){this.UE[g].visible=(!h.ND)&&(g<i.u.KD);}}void yG(o h){var i=h.u as tB;var g=new StringBuffer();g.add(i.eB("GENscore"));g.add(": ${h.u.OK.toString()}");aC.text=g.toString();}void RE(o h){var i=h.u as tB;var g=new StringBuffer();g.add(i.eB("GENlevel"));g.add(": ${h.u.level.toString()}");AC.text=g.toString();}}class SH extends UB{AE oB;AE iC;eC bC;eC PC;int UG=40;int VG=30;String HC;SH(uB g,[String fontName=xD]):super(g,true,fontName){this.HC=fontName;this.VB(p.qC);this.VB(p.gC);this.sC();}void sC(){var g=this.u as tB;this.rB.wordWrap=true;this.text=g.eB("GENexitquery");this.oB=new AE(new hB(m.LB("items").CB("but_yes")),new hB(m.LB("items").CB("but_yes2")),new hB(m.LB("items").CB("but_yes2")),new hB(m.LB("items").CB("but_yes2")));this.oB.x=VG;this.oB.y=UB.SD-this.oB.height-UG;this.oB.t(p.qC,this.ZK);this.v(this.oB);this.iC=new AE(new hB(m.LB("items").CB("but_no")),new hB(m.LB("items").CB("but_no2")),new hB(m.LB("items").CB("but_no2")),new hB(m.LB("items").CB("but_no2")));this.iC.x=UB.nD-this.iC.width-VG;this.iC.y=UB.SD-this.oB.height-UG;this.iC.t(p.qC,this.tG);this.v(this.iC);this.bC=new eC();this.bC.t(p.qC,this.oB.dispatchEvent);this.bC.wC=0x000000;this.bC.WC=new sF(HC,48,0,zB:true,align:lB.JG);this.bC.height=60;this.bC.x=this.oB.x+this.oB.width;this.bC.y=this.oB.y+5;this.v(this.bC);this.bC.text=g.eB("GENyes");this.PC=new eC();this.PC.t(p.qC,this.iC.dispatchEvent);this.PC.wC=0x000000;this.PC.WC=new sF(HC,48,0,zB:true,align:lB.FE);this.PC.height=60;this.PC.x=this.iC.x-this.PC.width;this.PC.y=this.oB.y+5;this.v(this.PC);this.PC.text=g.eB("GENno");}LF(){tG(null);}void ZK(BB g){fD();this.dispatchEvent(new KB(KB.vB,this));}void tG(BB g){fD();this.dispatchEvent(new KB(KB.oD,this));}}class o extends BB{static const String RD="GameEvent.TYPE_LIVES_CHANGED";static const String pD="GameEvent.TYPE_PROGRESS_CHANGED";static const String qD="GameEvent.TYPE_PAUSE_CHANGED";static const String rD="GameEvent.TYPE_LEVEL_CHANGED";static const String sD="GameEvent.TYPE_SCORE_CHANGED";static const String tD="GameEvent.TYPE_GAME_START";static const String uD="GameEvent.TYPE_GAME_OVER";static const String vD="GameEvent.TYPE_GAME_ABORT";static const String eE="GameEvent.TYPE_GAME_SIZE_CHANGED";uB u;o(String h,uB g,[bool bubbles=false]):super(h,bubbles){this.u=g;}}class ZE extends BD{uB NL;ZE(uB g){this.u=g;}set u(uB g){if(NL!=null){NL.VB(o.uD);NL.VB(o.vD);NL.VB(o.eE);NL.VB(o.tD);NL.VB(o.rD);NL.VB(o.qD);NL.VB(o.sD);NL.VB(o.RD);NL.VB(o.pD);}NL=g;if(NL!=null){NL.t(o.uD,this.UF);NL.t(o.vD,this.TF);NL.t(o.eE,this.uG);NL.t(o.tD,this.VF);NL.t(o.rD,this.RE);NL.t(o.qD,this.tJ);NL.t(o.sD,this.yG);NL.t(o.RD,this.vG);NL.t(o.pD,this.wG);}}uB get u{return NL;}void UF(o g){}void TF(o g){}void uG(o g){}void VF(o g){}void RE(o g){}void tJ(o g){}void yG(o g){}void vG(o g){}void wG(o g){}}class tB extends uB{static const num lF=1.0;static const num WH=100;static const int XH=0xFFFFFF;num TK=lF;int VJ=5;yC HD;bool kG=false;num EH=500;int BJ=0xffffff;AE pB;UB IB;RH JD;bool YL=true;bool QE=false;num eG=60.0;lE gD;String HC=xD;bool PF=false;String DK="Web";tB(int h,int g):super(h,g){this.t(BB.CG,(i){this.dJ();});}set ND(bool g){YL=g;this.dispatchEvent(new o(o.RD,this));}bool get ND{return YL;}void dJ(){if(!kG){this.t(p.aD,(g)=>this.QE=false);this.t(p.gC,(g)=>this.QE=true);this.FK();this.t(o.tD,this.VF);this.t(o.RD,this.rJ);this.t(o.pD,this.uJ);this.t(o.sD,this.vJ);this.t(o.rD,this.onLevelChange);this.t(o.qD,this.sJ);this.t(o.uD,this.UF);this.t(o.vD,this.TF);this.sC();this.lD=0;this.LD=0;this.KD=3;this.start();kG=true;}}String eB(String i,[List params=null]){var h=m.ZJ(i);if(params!=null)for(int g=0;g<params.length;g++ )h=h.replaceAll("{${g}}",params[g].toString());return h;}void FK(){this.TK=lF;this.BJ=XH;this.EH=WH;this.VJ=5;this.eG=60000;}void sC(){this.HD=new yC(this);this.v(this.HD);jB h=m.LB("items").CB("button_exit");jB g=m.LB("items").CB("button_exit_2");this.pB=new AE(new hB(h),new hB(g),new hB(h),new hB(g));this.pB.width=75;this.pB.height=66;this.pB.x=707;this.pB.y=525;this.pB.t(p.gC,oJ);this.v(this.pB);this.pB.visible=false;this.JD=new RH(this,HC);this.JD.x=0;this.JD.y=0;this.v(this.JD);}void JJ(){var g=this.FD();g.text=this.eB("MESSAGE_RESTART_LEVEL");g.t(KB.vB,this.xG);}void FJ(int h){var g=this.FD();g.text=this.eB("MESSAGE_FREE_LEVEL_BARRIER_${h}");g.t(KB.vB,this.xG);}void xG(KB g){this.vC(g.PE);this.HD.DJ();}void aG(){this.HD.NF();var g=this.FD();if(this.level==0){g.text=this.eB("MESSAGE_FIRST_LEVEL_WEB");}else{g.text=this.eB("MESSAGE_START_LEVEL",[(this.level+1)]);}g.t(KB.vB,this.xJ);}void xJ(KB g){this.vC(g.PE);this.jJ();}void GJ(){var g=this.FD();g.text=this.eB("MESSAGE_GAME_OVER");g.t(KB.vB,this.pJ);}void pJ(KB g){this.vC(g.PE);}UB FD([UB menu=null,num tweenDuration=1.0,bool autoStart=true]){if(this.IB!=null)this.vC(this.IB);this.pB.visible=false;this.JD.visible=true;if(menu==null)this.IB=new UB(this,autoStart,HC);else this.IB=menu;this.IB.width=UB.nD;this.IB.height=UB.SD;this.IB.x=(this.ME/2)-(UB.nD/2)+30;this.IB.y=(this.dG/2)-(UB.SD/2);this.IB.alpha=0;this.v(this.IB);var g=new eI(this.IB,tweenDuration,xE.yE);g.JE("alpha",1);aB.add(g);return this.IB;}void vC(UB g){this.paused=false;this.JD.visible=true;this.pB.visible=true;if(g==null)return;g.fD();if(this.contains(g)){this.qB(g);}this.IB=null;}void XJ(){aB.remove(gD);if(this.PF)this.zG(null);this.QE=true;this.ND=false;}void wJ(){if(this.IB!=null)return;if(DK.toLowerCase()=="web")return;aB.remove(gD);this.gD=new lE(this.XJ,this.eG);aB.add(this.gD);this.PF=true;this.paused=true;var g=this.FD(null,200,false);this.pB.visible=true;g.text=this.eB("MESSAGE_FIRST_LEVEL");g.t(KB.vB,this.zG);}void zG(KB g){aB.remove(this.gD);this.PF=false;this.IB.VB(KB.vB);this.vC(this.IB);}void oJ(p h){if(this.IB is SH)return;var g=new SH(this,HC);this.FD(g);this.paused=true;g.t(KB.vB,this.lJ);g.t(KB.oD,this.kJ);}void lJ(KB g){this.dispatchEvent(new o(o.vD,this));this.IB.VB(KB.vB);this.IB.VB(KB.oD);this.vC(this.IB);this.paused=true;}void kJ(KB g){this.IB.VB(KB.vB);this.IB.VB(KB.oD);this.vC(IB);}void VF(o g){this.HD.NF();aB.LE(this.aG,0.5);}void PJ(){this.HD.NF();}void uJ(o g){}void rJ(o g){}void vJ(o g){}void onLevelChange(o g){}void sJ(o g){}void UF(o g){aB.LE(this.GJ,2.0);}void TF(o g){}}class yC extends ZE{static num jF=0.025;static num bE=1.0;static int zC=600;static int cE=800;static int dE=600;static int mF=400;static int nF=300;static num TD=ZB.sqrt(cE*cE+dE*dE);static num aH=(TD*2/zC);static int oF=6;QC PB;cC RB;cC JC;TH XC;num aF=30.0*ZB.PI/180;num ZF=1.0*ZB.PI/180;num OD=0.05;num XF=-1;num SE=1;QH MB;hB hC;List DF=["barrier01","barrier02","barrier03","barrier04","barrier05","barrier06","barrier07"];cB EF;TC FF;cB XG;TC EJ;cB LH;int YF=15;num mG;bool GD=false;num KE=0;RC MF;RC IE;num AF=0.90;num FH=0;zD ZL;hB mK;vF WB;int UJ=0;hB GC;bool ED=false;num RF,SF;hH hG;YB.StreamSubscription<VD> jD;yC(tB g):super(g){ZL=new zD.FL(80,60,690,524);this.mask=ZL;this.EF=m.OF("speedalizer");this.FF=this.EF.play(true);this.WB=new vF();this.v(this.WB);hG=new hH(800,600);v(hG);RF=SF=0;EC.t(p.tE,this.WF);EC.t(p.gC,this.WF);EC.t(p.aD,this.WF);jD=this.nJ.listen(this.aL);}void WF(p g){RF=g.HH;SF=g.IH;}void EK(){var g=this.u.LD;this.u.LD=g+(this.u as tB).EH*(this.u.level*this.u.KD);}void uG(o g){}void RE(o g){super.RE(g);this.UK();}void UK(){ED=false;jD.pause();this.KE=0;this.u.lD=0;this.GD=false;num h=60;this.XC=new TH(TD,oF*h);for(var g=this.XC.w.length;g>=0;g-- )if(g%h!=0&&g%h!=1)this.XC.CH(g);this.PB=new QC(mF,nF);this.RB=new cC(0,0,0);this.JC=new cC(0,0,bE);this.ZF=(1+(0.1*this.u.level))*ZB.PI/180;this.OD=0.015+(0.004*this.u.level);this.SE=2+this.u.level;this.XF=-this.SE;this.FH=this.u.level*2;this.YF=15+(this.u.level);this.sC();this.HJ();jD.resume();}void sC(){if(this.MB!=null)this.qB(this.MB);this.MB=new QH();this.v(this.MB);if(this.GC!=null)this.qB(this.GC);this.GC=new hB(m.LB("items").CB("crosshair"));this.GC.YC=0.5;this.GC.ZC=0.5;this.GC.x=(cE/2)-this.GC.width/2;this.GC.y=(dE/2)-this.GC.height/2;this.v(this.GC);}void NF(){this.ED=false;this.jD.pause();var h=60;this.XC=new TH(TD,oF*h);for(var g=this.XC.w.length;g>=0;g-- )if(g%h!=0&&g%h!=1)this.XC.CH(g);this.PB=new QC(mF,nF);this.RB=new cC(0,0,0);this.JC=new cC(0,0,bE);this.ZF=2*ZB.PI/180;this.SE=0;this.XF=0;if(this.MB!=null){this.qB(this.MB);this.MB=null;}this.MB=new QH();this.v(this.MB);if(this.hC!=null){this.qB(this.hC);this.hC=null;}this.ZG();this.jD.resume();}void ZG(){var g=new RC(null);g.VC=-1;g.CC=0;g.position=this.RB.clone();g.position.z=0.5;this.MB.CD(g);}void YG(){var g=new RC(new hB(m.LB("items").CB("countdown01")));g.VC=0;g.CC=0;g.position=this.RB.clone();g.position.z=0.5;g.eD=0;g.hD=true;this.MB.CD(g);g=new RC(new hB(m.LB("items").CB("countdown02")));g.VC=0;g.CC=0;g.position=this.RB.clone();g.position.z=0;g.eD=1;g.hD=true;this.MB.CD(g);g=new RC(new hB(m.LB("items").CB("countdown03")));g.VC=0;g.CC=0;g.position=this.RB.clone();g.position.z=-0.5;g.eD=2;g.hD=true;this.MB.CD(g);g=new RC(new hB(m.LB("items").CB("countdown04")));g.VC=0;g.CC=0;g.position=this.RB.clone();g.position.z=-1;g.eD=3;g.hD=true;this.MB.CD(g);}RC IJ(){var h=1+this.u.level;if(h>=this.DF.length)h=this.DF.length-1;var i=QD.kF(0,h);var j=this.DF[i];var g=new RC(new hB(m.CB(j)));g.lC=true;g.OC=QD.kF(0,359)*ZB.PI/180;g.CC=QD.ZH(this.XF,this.SE)*ZB.PI/180;g.position=this.RB.clone();return g;}void HJ(){this.YG();this.ZG();var h=0;for(var i=0;i<YF;i++ ){var g=null;if(i==YF-1){g=new RC(new hB(m.CB("finish")));g.OC=0;g.CC=5*ZB.PI/180;g.position=this.RB.clone();g.VC=0;g.lC=true;g.jG=true;this.MF=g;}else{h++ ;if(this.u.level==1&&h<=3){if(h==1){g=new RC(new hB(m.CB("training01")));g.lC=true;g.OC=0;g.CC=0;g.position=this.RB.clone();g.MD=1;}else if(h==2){g=new RC(new hB(m.CB("training02")));g.lC=true;g.OC=135*ZB.PI/180;g.CC=0;g.position=this.RB.clone();g.MD=2;}else if(h==3){g=new RC(new hB(m.CB("training02")));g.lC=true;g.OC=315*ZB.PI/180;g.CC=0;g.position=this.RB.clone();g.MD=3;}}else{g=this.IJ();}}g.kD=-i*1-3;g.position.z=g.kD;g.VC=0;this.MB.CD(g);}}void qJ(){this.GD=false;var g=u as tB;g.PJ();g.aG();}void aL(BB h){if(this.u.paused==false){this.HK();var g=this.u as tB;if(g.ND&&this.ED&&!g.QE)g.wJ();}else{iD=-1;}}bool NE(RC h){DB g=new DB(this.PB.x,this.PB.y);g=this.nG(g);g=h.kC(g);return h.NE(g);}void DJ(){this.ED=false;for(var g=0;g<this.MB.KC.length;g++ )this.MB.KC[g].position.z-= (2.5+1-AF)+1;IE.position.z+= (1-AF);this.YG();this.GD=false;this.OD=this.mG;this.hC.visible=false;}void mJ(){var g=this.u as tB;g.pB.visible=false;this.GD=false;this.ED=false;this.mG=this.OD;this.OD=0;if(this.hC!=null)this.qB(this.hC);this.hC=new hB(m.CB("broken"));this.v(this.hC);if(this.IE.MD>0&& ++this.UJ<=5){aB.LE((){g.FJ(this.IE.MD);},2.0);}else{this.u.KD-- ;if(this.u.KD>0)aB.LE(g.JJ,2.0);}this.FF.stop();this.FF=this.EF.play(true);this.XG=m.OF("crash");this.EJ=this.XG.play();}num iD=-1;void HK(){var k=aB.elapsedTime;var h=1.0;if(iD==-1)iD=k;h=ZB.min(k-iD,1.0000)*40;iD=k;if(GD){this.KE-= (this.OD*h);var s=this.u.LD;this.u.LD=s+(this.FH*h);}this.MB.SK();this.aF+= (this.ZF*h);this.JC.x=-(this.RF-this.PB.x)*3;this.JC.y=-(this.SF-this.PB.y)*3;if(this.JC.gG()>TD*0.7){this.JC.PK(TD*0.7);}this.JC.z=bE;this.RB=this.JC.clone();this.RB.z=jF;this.GK();for(var n=0;n<this.MB.KC.length;n++ ){var g=this.MB.KC[n];g.position.z+= (OD*h);if(g.position.z>=1){if(g.hD&&g.eD==3)ED=true;if(g.cD!=null){this.LH=m.OF("swish");var AB=this.LH.play();}if(g.lC)GD=true;if(g.kD!=0)this.KE=g.kD;if(g.lC&&NE(g)){g.position.z=AF;IE=g;this.mJ();}else{if(g.MD==3)(this.u as tB).ND=false;if(g.lC)this.EK();if(g.jG){this.qJ();}else if(g.VC==0){this.MB.KK(g);}else{g.position.z+= g.VC;}}}var i=this.JC.clone();i.z=g.position.z;if(i.z<0||i.z>1){g.x=100000;}else{var j=this.YE(i);j=j.add(this.PB);var l=(20*(i.z*i.z));if(l>1)l=1;g.alpha=l;g.x=j.x;g.y=j.y;g.OC+= (g.CC*h);g.setScale(PD(g.position.z)*aH);}}if(this.MF!=null)this.u.lD=(this.KE+3)/(this.MF.kD+3);}QC YE(cC g){var h=new QC(g.x,g.y);h.x*= PD(g.z);h.y*= PD(g.z);return h;}num PD(num g){var h=jF;if(g<0)return 0;if(g>1)return 1;return h/(h+(1-g));}void GK(){if(WB==null)return;var l=2;var j=this.JC.clone();j.scale(l);var h=this.XC.transform(PD(j.z)*l,this.aF,this.YE(j));var i=this.XC.transform(PD(this.RB.z),this.aF,this.YE(this.RB));var k=this.YE(this.RB).add(this.PB);WB.QB.clear();WB.QB.beginPath();WB.QB.WG(k.x,k.y,this.XC.BH*PD(this.RB.z));WB.QB.closePath();WB.QB.JH(0xffcccccc,1);WB.QB.beginPath();for(var g=0;g<h.w.length;g+= 2){WB.QB.moveTo(h.w[g].x+this.PB.x,h.w[g].y+this.PB.y);WB.QB.lineTo(h.w[g+1].x+this.PB.x,h.w[g+1].y+this.PB.y);WB.QB.lineTo(i.w[g+1].x+this.PB.x,i.w[g+1].y+this.PB.y);WB.QB.lineTo(i.w[g].x+this.PB.x,i.w[g].y+this.PB.y);WB.QB.lineTo(h.w[g].x+this.PB.x,h.w[g].y+this.PB.y);}WB.QB.closePath();WB.QB.OJ(0xFF000000);}}class RC extends BD{hB ML;vF PL;BD RL;cC position;num VC=-1;num CC=0;num RK=1;bool lC=false;bool jG=false;bool hD=false;bool wK=false;int eD=0;int MD=0;num kD=0;RC(hB g){RL=new BD();v(RL);this.cD=g;if(this.cD==null)return;this.x=100000;}set cD(hB g){if(ML!=null)this.qB(ML);if(PL!=null)this.qB(PL);ML=null;PL=null;if(g!=null){ML=g;ML.tC=yC.zC/2;ML.uC=yC.zC/2;v(ML);}else{PL=new vF();v(PL);}v(RL);}hB get cD{return ML;}void setScale(num g){this.RK=g;if(PL!=null){PL.QB.clear();PL.QB.beginPath();PL.QB.WG(0,0,yC.zC/2*g);PL.QB.closePath();PL.QB.JH(0xff999999,1);}if(ML!=null)ML.YC=ML.ZC=g;RL.YC=RL.ZC=g;}bool NE(DB j){if(ML==null)return false;var g=this.nG(j);g=ML.kC(g);var k=this.cD.nB.YJ(g.x.toInt(),g.y.toInt());var l=(k>>24)&0xFF;var i=false;if(l>0){i=true;var h=new hB(m.LB("items").CB("blood"));h.tC=50;h.uC=50;h.x=g.x-yC.zC/2;h.y=g.y-yC.zC/2;RL.v(h);}return i;}}class QH extends BD{List<RC> KC;QH(){KC=new List<RC>();}void SK(){this.KC.sort(aK);}void CD(RC g){if(this.contains(g))return;this.v(g);this.KC.add(g);}void KK(RC g){if(this.KC.length>0){var h=this.KC.indexOf(g);if(h>=0)this.KC.removeAt(h);}if(this.contains(g))this.qB(g);}int aK(RC g,RC h){if(!this.contains(g)){return (this.contains(h)?1:0);}if(!this.contains(h)){return (this.contains(g)?-1:0);}if(g.position.z>h.position.z){if(this.ID(g)<this.ID(h))this.KH(g,h);return 1;}if(g.position.z<h.position.z){if(this.ID(g)>this.ID(h))this.KH(g,h);return -1;}return 0;}}class QD{static ZB.Random iF=new ZB.Random();static int kF(int g,int h){int i;if(h<g){var j=g;g=h;h=j;}if(g==h){i=g;}else{i=QD.iF.nextInt(h+1)+g;}return i;}static num ZH(num g,num h){num i;if(h<g){var j=g;g=h;h=j;}if(g==h){i=g;}else{i=QD.iF.nextDouble()*(h-g)+g;}return i;}}class TH extends aE{num KL;int OL;TH(num h,int g):super(){if(g<3)g=3;if(h==0)h=1;this.KL=h;this.OL=g;KJ();}num get BH{return KL;}void KJ(){var g=new List<QC>();var h=0.0;var k=2*ZB.PI/OL;for(var j=0;j<OL;j++ ){var i=new QC(0,-KL);i.CF=h;g.add(i);h+= k;}this.w=g;}}class aE implements VH,UH{List<QC> w;aE([List<QC> pointList]){this.w=(pointList!=null)?pointList:new List();}CH(int g){if(g<w.length)this.w.removeAt(g);}bool NE(QC h){var k=this.w.length;var i=k-1;var j=false;for(var g=0;g<k;g++ ){if(w[g].y<h.y&&w[i].y>=h.y||w[i].y<h.y&&w[g].y>=h.y){if(w[g].x+(h.y-w[g].y)/(w[i].y-w[g].y)*(w[i].x-w[g].x)<h.x){j=!j;}}i=g;}return j;}aE scale(num h){if(h==0)h=double.MIN_POSITIVE;var j=this.w.length;var i=new List<QC>(j);for(var g=0;g<j;g++ ){var k=this.w[g].clone();k.scale(h);i[g]=k;}return new aE(i);}aE transform(num l,num k,QC n){var j=this.w.length;var i=new List<QC>(j);for(var g=0;g<j;g++ ){var h=this.w[g].clone();h.scale(l);h.CF+= k;i[g]=h.add(n);}return new aE(i);}}abstract class UH{}abstract class VH{}class uB extends BD{num LL=0;int QL=0;bool SL=true;int TL=3;num UL=0.0;int VL;int WL;uB(int h,int g){QK(h,g);}void QK(int g,int h){VL=g;WL=h;this.dispatchEvent(new o(o.eE,this));}int get ME{return VL;}int get dG{return WL;}void start(){this.paused=false;this.dispatchEvent(new o(o.tD,this));}void WJ(){this.dispatchEvent(new o(o.uD,this));}set lD(num g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;UL=g;this.dispatchEvent(new o(o.pD,this));}num get lD{return UL;}set KD(int g){if(g<0)g=0;TL=g;this.dispatchEvent(new o(o.RD,this));if(TL==0)this.WJ();}int get KD{return TL;}set LD(num g){if(g<0)g=0;LL=g;this.dispatchEvent(new o(o.sD,this));}num get LD{return LL;}int get OK{return LL.toDouble().round().toInt();}set level(int g){if(g<0)g=0;QL=g;this.dispatchEvent(new o(o.rD,this));}int get level{return QL;}int jJ(){this.level+= 1;return this.level;}set paused(bool g){SL=g;this.dispatchEvent(new o(o.qD,this));}bool get paused{return SL;}}bD EC;mH fE;AG m;hE aB;ZB.Random bH;hB dC;eI wD;eC wB;const String xD="Russo One";void main(){EC=new bD("Stage",xC.query('#stage'));fE=new mH();fE.xI(EC);aB=fE.fJ;bH=new ZB.Random();YB.Future<jB> g=jB.TG("images/Loading.png");g.then((h){dC=new hB(h);dC.tC=20;dC.uC=20;dC.x=400;dC.y=270;EC.v(dC);wD=new eI(dC,100,xE.yE);wD.JE("rotation",100.0*2.0*ZB.PI);aB.add(wD);wB=new eC();wB.WC=new sF("Arial",20,0xA0A0A0,zB:true);wB.width=240;wB.height=40;wB.text="... loading ...";wB.x=400-wB.WK/2;wB.y=320;wB.rG=false;EC.v(wB);cH();});}void cH(){m=new AG();m.yB("barrier01","images/barrier01.png");m.yB("barrier02","images/barrier02.png");m.yB("barrier03","images/barrier03.png");m.yB("barrier04","images/barrier04.png");m.yB("barrier05","images/barrier05.png");m.yB("barrier06","images/barrier06.png");m.yB("barrier07","images/barrier07.png");m.yB("training01","images/training01.png");m.yB("training02","images/training02.png");m.yB("finish","images/finish.png");m.yB("broken","images/broken.png");m.yI("items","images/ItemTextureAtlas.json",nE.BG);m.BF("crash","sounds/crash.mp3");m.BF("swish","sounds/swish.mp3");m.BF("speedalizer","sounds/speedalizer.mp3");m.SB("DISPLAY_LEVEL","Level: {0}");m.SB("DISPLAY_LIVES","Ships:");m.SB("DISPLAY_SCORE","Score: {0}");m.SB("DISPLAY_TRAINING","Training");m.SB("MESSAGE_FIRST_LEVEL","Remain with your finger on the screen in order to fly through the tunnel!");m.SB("MESSAGE_FIRST_LEVEL_WEB","Move the mouse pointer to navigate through the obstacles!");m.SB("MESSAGE_FREE_LEVEL_BARRIER_1","Navigate to the center to fly through the hole!");m.SB("MESSAGE_FREE_LEVEL_BARRIER_2","Navigate to the upper left side to fly through the hole!");m.SB("MESSAGE_FREE_LEVEL_BARRIER_3","Navigate to the bottom right side to fly through the hole!");m.SB("MESSAGE_GAME_OVER","Game\nOver!");m.SB("MESSAGE_RESTART_LEVEL","Ooops!\nGet Ready\nFor Restart!");m.SB("MESSAGE_START_LEVEL","Get Ready\nFor Level {0}!");m.SB("GENscore","Score");m.SB("GENlevel","Level");m.SB("GENexitquery","Do you really want to quit the game?");m.SB("GENyes","Yes");m.SB("GENno","No");m.load().then((j){EC.qB(dC);EC.qB(wB);aB.remove(wD);uB h=new tB(800,600);h.zI(EC);h.start();}).catchError((i){for(var g in m.cG){print("Loading resouce failed: ${g.kind}.${g.name} - ${g.error}");}});}class tF extends BB{static const String yH="textInput";String rL="";tF(String g,[bool bubbles=false]):super(g,bubbles){}}class OB extends BB{static const String zF="touchBegin";static const String EG="touchEnd";static const String GG="touchCancel";static const String LG="touchMove";static const String NI="touchOver";static const String OI="touchOut";int GO;bool HO;num JO,KO;num MO,NO;bool aN;bool nN;bool dN;bool fN;num RO;int UO;int VO;OB(String g,[bool bubbles=false]):super(g,bubbles){BO(g,bubbles);}void BO(String g,[bool bubbles=false]){super.BO(g,bubbles);GO=0;HO=false;JO=KO=0;MO=NO=0;aN=false;nN=false;dN=false;fN=false;RO=1.00;UO=0;VO=0;}set xO(DB g){JO=g.x;KO=g.y;}set yO(DB g){MO=g.x;NO=g.y;}int get XE=>GO;num get HH=>MO;num get IH=>NO;bool get altKey=>aN;bool get ctrlKey=>dN;bool get shiftKey=>fN;}class hE implements pC{final List<pC> DM=new List<pC>();int eM=0;num qM=0.0;num get elapsedTime=>qM;void add(pC g){if(g==null)return;if(eM==DM.length){DM.add(g);}else{DM[eM]=g;}eM++ ;}void remove(pC h){if(h==null)return;for(int g=0;g<eM;g++ ){if(DM[g]==h){DM[g]=null;break;}}}lE LE(Function h,num i){lE g=new lE(h,i);add(g);return g;}bool DD(num k){qM+= k;int j=eM;int h=0;for(int g=0;g<j;g++ ){var i=DM[g];if(i==null)continue;if(i.DD(k)==false){DM[g]=null;continue;}if(h!=g){DM[h]=i;DM[g]=null;}h++ ;}if(h!=j){for(int g=j;g<eM;g++ ){DM[h++ ]=DM[g];DM[g]=null;}eM=h;}return true;}}class jK extends TC{mE HM;dB MM;bool uL;PH.GainNode tM;PH.AudioBufferSourceNode EN;jK(mE j,bool h,dB i){HM=j;uL=h;MM=i;var g=UD.HE;tM=g.createGain();tM.connect(g.destination,0,0);tM.gain.value=(MM!=null)?ZB.pow(MM.volume,2):1;EN=g.createBufferSource();EN.buffer=HM.sL;EN.loop=h;EN.connect(tM,0,0);EN.start(0);}void set VE(dB g){MM=g;tM.gain.value=(MM!=null)?ZB.pow(MM.volume,2):1;}void stop(){EN.stop(0);}}class dH{String name;num DC;num MH;dH(this.name,this.DC,this.MH);}class iE{num AJ;num LJ;num height;num QF;num width;num x;iE(this.x,this.width,this.height,this.AJ,this.LJ,this.QF);}class DB{num x;num y;DB(this.x,this.y);DB.EL():this(0,0);static DB YI(num g,num h)=>new DB(g*ZB.cos(h),-g*ZB.sin(h));num get length=>ZB.sqrt(this.x*this.x+this.y*this.y);DB add(DB g)=>new DB(this.x+g.x,this.y+g.y);DB clone()=>new DB(this.x,this.y);void JF(DB g){this.x=g.x;this.y=g.y;}bool equals(DB g)=>this.x==g.x&&this.y==g.y;}class HB{num x;num y;num width;num height;HB(this.x,this.y,this.width,this.height);HB.EL():this(0,0,0,0);num get left=>this.x;num get top=>this.y;num get right=>this.x+this.width;num get bottom=>this.y+this.height;DB get size=>new DB(this.width,this.height);void set size(DB g){this.width=g.x;this.height=g.y;}HB clone()=>new HB(this.x,this.y,this.width,this.height);bool contains(num g,num h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h);bool equals(HB g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height);bool get isEmpty=>(this.width==0&&this.height==0);void JF(HB g){this.x=g.x;this.y=g.y;this.width=g.width;this.height=g.height;}}class eH{eH();}class FB{num cL,dL,fL,gL,jL,mL;num vL;FB(num h,num i,num g,num j,num k,num l):cL=h,dL=i,fL=g,gL=j,jL=k,mL=l,vL=h*j-i*g;FB.GL():cL=1.0,dL=0.0,fL=0.0,gL=1.0,jL=0.0,mL=0.0,vL=1.0;FB clone(){return new FB(cL,dL,fL,gL,jL,mL);}num get a=>cL;num get b=>dL;num get c=>fL;num get d=>gL;num get fB=>jL;num get gB=>mL;num get jC=>vL;DB OH(DB g){return new DB(g.x*cL+g.y*fL+jL,g.x*dL+g.y*gL+mL);}void concat(FB g){num n=cL;num EB=dL;num JB=fL;num AB=gL;num l=jL;num s=mL;num XB=vL;num j=g.a;num k=g.b;num i=g.c;num h=g.d;num bB=g.fB;num NB=g.gB;num sB=g.jC;cL=(n*j+EB*i);dL=(n*k+EB*h);fL=(JB*j+AB*i);gL=(JB*k+AB*h);jL=(l*j+s*i+bB);mL=(l*k+s*h+NB);vL=(XB*sB);}void iG(){cL=1.0;dL=0.0;fL=0.0;gL=1.0;jL=0.0;mL=0.0;vL=1.0;}void eJ(){num j=cL;num n=dL;num l=fL;num k=gL;num h=jL;num i=mL;num g=vL;cL=(k/g);dL=-(n/g);fL=-(l/g);gL=(j/g);jL=-(cL*h+fL*i);mL=-(dL*h+gL*i);vL=(1.0/g);}void GH(num h,num i,num g,num j,num k,num l){cL=h;dL=i;fL=g;gL=j;jL=k;mL=l;vL=(h*j-i*g);}void JF(FB g){cL=g.a;dL=g.b;fL=g.c;gL=g.d;jL=g.fB;mL=g.gB;vL=g.jC;}void KF(FB h,FB g){num s=h.a;num JB=h.b;num NB=h.c;num EB=h.d;num n=h.fB;num AB=h.gB;num bB=h.jC;num k=g.a;num l=g.b;num j=g.c;num i=g.d;num sB=g.fB;num XB=g.gB;num mC=g.jC;cL=(s*k+JB*j);dL=(s*l+JB*i);fL=(NB*k+EB*j);gL=(NB*l+EB*i);jL=(n*k+AB*j+sB);mL=(n*l+AB*i+XB);vL=(bB*mC);}}class mH{hE eL;List<bD> tL;num EM;BE ZM;VD nM;mH(){eL=new hE();tL=new List<bD>();EM=double.NAN;ZM=BE.NG;nM=new VD(0);xC.window.requestAnimationFrame(kN);}hE get fJ=>eL;void kN(num g){xC.window.requestAnimationFrame(kN);if(EM.isNaN)EM=g;if(EM>g)EM=g;num j=g-EM;num i=j/1000.0;if(j>=1){EM=g;nM.nL=i;ZM.YO(nM);eL.DD(i);for(int h=0;h<tL.length;h++ ){var k=tL[h];k.hJ();}}}void xI(bD g){tL.add(g);}}class iB{final xC.CanvasRenderingContext2D wL;final List<FB> QM=new List<FB>.fixedLength(100);final List<double> vM=new List<double>.fixedLength(100);int LN=0;iB.HL(xC.CanvasRenderingContext2D j,[FB matrix]):wL=j{for(int h=0;h<100;h++ ){QM[h]=new FB.GL();vM[h]=1.0;}if(matrix!=null)QM[0].JF(matrix);var g=QM[0];var i=vM[0];wL.setTransform(g.a,g.b,g.c,g.d,g.fB,g.gB);wL.globalAlpha=i;}xC.CanvasRenderingContext2D get context=>wL;void reset(){LN=0;var g=QM[0];var h=vM[0];wL.setTransform(g.a,g.b,g.c,g.d,g.fB,g.gB);wL.globalAlpha=h;wL.clearRect(0,0,wL.canvas.width,wL.canvas.height);}void DH(q h){var i=LN;var j=LN+1;var l=QM[i];var g=QM[j];var n=vM[i];var k=vM[j]=h.XN*n;g.KF(h.cO,l);wL.setTransform(g.a,g.b,g.c,g.d,g.fB,g.gB);wL.globalAlpha=k;LN=j;if(h.mask==null){h.TB(this);}else{wL.save();h.mask.TB(this);h.TB(this);wL.restore();}LN=i;}}class XD{static const String oE="auto";static const String wH="stop";static const String FG="once";}class BB{static const String sH="added";static const String CG="addedToStage";static const String sE="enterFrame";static const String II="removed";static const String MI="removedFromStage";String bL;bool WO;int ZO;SC OM;SC hO;bool kO;bool mO;BB(String g,[bool bubbles=false]){BO(g,bubbles);}void BO(String g,[bool bubbles=false]){bL=g;WO=bubbles;ZO=nC.EE;OM=null;hO=null;kO=false;mO=false;}bool get cF=>kO;String get type=>bL;bool get bubbles=>WO;bool get GF=>true;SC get target=>OM;}class nC{static const int yF=1;static const int EE=2;static const int BI=3;}class SC{Map<String,WD> qL;bool aJ(String g){if(qL!=null)return qL.containsKey(g)||qL.containsKey("${g}_CAPTURE");else return false;}YB.StreamSubscription<BB> t(String g,void i(event),{bool useCapture: false}){var h=MN(g,useCapture);var j=h.listen(i);return j;}void VB(String g,{bool useCapture: false}){var i=useCapture?"${g}_CAPTURE":g;var h=qL[i];if(h!=null)h.iO();}void dispatchEvent(BB g){nO(g,this,this,nC.EE);}void nO(BB g,SC k,SC l,int i){if(qL!=null){var j=(i==nC.yF)?"${g.type}_CAPTURE":g.type;var h=qL[j];if(h!=null){g.OM=k;g.hO=l;g.ZO=i;g.kO=false;g.mO=false;h.YO(g);}}}WD MN(String g,bool j){if(qL==null)qL=new Map<String,WD>();var i=j?"${g}_CAPTURE":g;var h=qL[i];if(h==null)h=qL[i]=new WD(this,g,j);return h;}}class BE<YD extends BB>{final List<WD> qL;int VM=0;BE():qL=new List<WD>(50);static BE<VD> NG=new BE<VD>();void uN(WD g){for(int h=0;h<VM;h++ )if(qL[h]==g)return;if(VM==qL.length)qL.add(g);else qL[VM]=g;VM++ ;}void YO(BB j){j.ZO=nC.EE;j.kO=false;j.mO=false;int k=VM;int i=0;for(int g=0;g<k;g++ ){var h=qL[g];if(h==null)continue;if(h.SN==0){qL[g]=null;continue;}j.OM=h.OM;j.hO=h.OM;h.YO(j);if(i!=g){qL[i]=h;qL[g]=null;}i++ ;}if(i!=k){for(int g=k;g<VM;g++ ){qL[i++ ]=qL[g];qL[g]=null;}VM=i;}}}class WD<YD extends BB> extends YB.Stream<YD>{final SC OM;final String CM;final bool mM;final List<rH> BN=new List<rH>(5);int SN=0;WD(this.OM,this.CM,this.mM);bool get isBroadcast=>true;YB.Stream<YD> asBroadcastStream()=>this;YB.StreamSubscription<YD> listen(void h(YD event),{void onError(YB.AsyncError error),void onDone(),bool unsubscribeOnError}){var g=new rH<YD>(this,h);if(SN==BN.length)BN.add(g);else BN[SN]=g;SN++ ;if(CM==BB.sE&&mM==false)BE.NG.uN(this);return g;}void xN(YB.StreamSubscription h){for(int g=0;g<SN;g++ ){if(BN[g]==h){BN[g]=null;break;}}}void iO(){for(int g=0;g<SN;g++ )if(BN[g]!=null)BN[g].cancel();}void YO(YD k){int j=SN;int h=0;for(int g=0;g<j;g++ ){var i=BN[g];if(i==null)continue;i.DN(k);if(h!=g){BN[h]=i;BN[g]=null;}h++ ;}if(h!=j){for(int g=j;g<SN;g++ ){BN[h++ ]=BN[g];BN[g]=null;}SN=h;}}}class xB<YD extends BB>{final String CM;const xB(this.CM);YB.Stream<YD> forTarget(SC g,{bool useCapture: false}){return g.MN(CM,useCapture);}}class mE extends cB{PH.AudioBuffer sL;mE(){if(UD.HE==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static YB.Future<cB> TG(String s){var h=new mE();var k=cB.RG(s);var g=new YB.Completer<cB>();xC.HttpRequest.request(k,responseType:'arraybuffer').then((i){var j=i.response;var n=UD.HE;n.decodeAudioData(j,(PH.AudioBuffer l){h.sL=l;g.complete(h);},(AB){g.completeError(new StateError("Failed to decode audio."));});}).catchError((AB){g.completeError(new StateError("Failed to load audio."));});return g.future;}num get length{return sL.duration;}TC play([bool loop=false,dB soundTransform]){if(soundTransform==null)soundTransform=new dB();return new jK(this,loop,soundTransform);}}class VD extends BB{num nL;VD(num g):super(BB.sE,false){nL=g;}bool get GF=>false;}class p extends BB{static const String qC="click";static const String AI="doubleClick";static const String gC="mouseDown";static const String aD="mouseUp";static const String tE="mouseMove";static const String GE="mouseOut";static const String MG="mouseOver";static const String SI="mouseWheel";static const String PG="middleClick";static const String WI="middleMouseDown";static const String ZI="middleMouseUp";static const String QG="rightClick";static const String dI="rightMouseDown";static const String hI="rightMouseUp";num JO,KO;num MO,NO;bool sO;bool aN;bool nN;bool dN;bool fN;int uO;int vO;int wO;p(String g,[bool bubbles=false]):super(g,bubbles){BO(g,bubbles);}void BO(String g,[bool bubbles=false]){super.BO(g,bubbles);JO=KO=0;MO=NO=0;sO=false;aN=false;nN=false;dN=false;fN=false;uO=0;vO=0;wO=0;}set xO(DB g){JO=g.x;KO=g.y;}set yO(DB g){MO=g.x;NO=g.y;}num get HH=>MO;num get IH=>NO;bool get UC=>sO;bool get altKey=>aN;bool get ctrlKey=>dN;bool get shiftKey=>fN;int get dD=>uO;}class FC extends BB{static const String pE="keyDown";static const String DG="keyUp";bool aN;bool dN;bool fN;bool hN;bool nN;int pN;int rN;int tN;FC(String g,[bool bubbles=false]):super(g,bubbles){BO(g,bubbles);}void BO(String g,[bool bubbles=false]){super.BO(g,bubbles);aN=false;dN=false;fN=false;hN=false;nN=false;pN=0;rN=0;tN=0;}bool get altKey=>aN;bool get ctrlKey=>dN;bool get shiftKey=>fN;int get charCode=>pN;int get keyCode=>rN;int get keyLocation=>tN;}class vF extends q{uF oL;vF(){oL=new uF();}uF get QB=>oL;HB kB(FB g,[HB returnRectangle]){if(returnRectangle==null)returnRectangle=new HB.EL();returnRectangle.x=g.fB;returnRectangle.y=g.gB;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;}q IC(num g,num h){return null;}void TB(iB g){oL.TB(g);}}abstract class pC{bool DD(num g);}class nE{static const String qH="json";static const String BG="jsonarray";}class pF{String hL;fC zL;int NM;int XM;int cM;int jM;int sM;int xM;int AN;int KN;bool QN;pF(String g,fC h){hL=g;zL=h;}fC get XK=>zL;String get name=>hL;int get SJ=>NM;int get TJ=>XM;int get RJ=>cM;int get QJ=>jM;int get offsetX=>sM;int get offsetY=>xM;int get zJ=>AN;int get yJ=>KN;bool get NK=>QN;}class AD{static const int oH=0;static const int JG=1;static const int FE=2;static const int EI=3;static const int IG=4;}class kE{static String xF=mB.oE;static bool uH=false;static YB.StreamController<String> FI=new YB.StreamController<String>();static YB.Stream<String> JI=FI.stream.asBroadcastStream();static String SG(String i){String h=i;String g="auto";if(xF!=mB.oE)h=xF;switch (h){case mB.oE:g="auto";break;case mB.qE:g="default";break;case mB.rE:g="pointer";break;case mB.GI:g="move";break;case mB.HI:g="text";break;case mB.KI:g="wait";break;}if(uH)g="none";return g;}}class mB{static const String oE="auto";static const String qE="arrow";static const String rE="button";static const String GI="hand";static const String HI="ibeam";static const String KI="wait";}abstract class q extends SC implements jE{num SM=0.0;num aM=0.0;num gM=0.0;num oM=0.0;num wM=1.0;num CN=1.0;num JN=0.0;FB RN;bool TN;num XN=1.0;bool YN=true;zD cN=null;String hL="";oC lN=null;FB sN;FB wN;q(){RN=new FB.GL();TN=true;sN=new FB.GL();wN=new FB.GL();}static const xB<VD> nI=const xB<VD>(BB.sE);YB.Stream<VD> get nJ=>q.nI.forTarget(this);num get x=>SM;num get y=>aM;num get tC=>gM;num get uC=>oM;num get YC=>wM;num get ZC=>CN;num get OC=>JN;num get alpha=>XN;bool get visible=>YN;zD get mask=>cN;String get name=>hL;oC get parent=>lN;q get root{q g=this;while (g.lN!=null)g=g.lN;return g;}bD get WE{q g=this.root;if(g is bD)return g;return null;}set x(num g){SM=g;TN=true;}set y(num g){aM=g;TN=true;}set tC(num g){gM=g;TN=true;}set uC(num g){oM=g;TN=true;}set YC(num g){wM=g;TN=true;}set ZC(num g){CN=g;TN=true;}set OC(num g){JN=g;TN=true;}set alpha(num g){XN=g;TN=true;}set visible(bool g){YN=g;TN=true;}set mask(zD g){cN=g;}num get width=>kB(cO).width;num get height=>kB(cO).height;void set width(num h){this.YC=1;num g=this.width;this.YC=(g!=0.0)?h/g:1.0;}void set height(num h){this.ZC=1;num g=this.height;this.ZC=(g!=0.0)?h/g:1.0;}void zI(oC g){g.v(this);}void JK(){if(lN!=null)lN.qB(this);}FB get cO{if(TN){TN=false;if(JN==0.0){RN.GH(wM,0.0,0.0,CN,SM-gM*wM,aM-oM*CN);}else{double g=ZB.cos(JN);double h=ZB.sin(JN);double i=wM*g;double l=wM*h;double k=-CN*h;double j=CN*g;double n=SM-gM*i-oM*k;double s=aM-gM*l-oM*j;RN.GH(i,l,k,j,n,s);}}return RN;}HB kB(FB g,[HB returnRectangle]){if(returnRectangle==null)returnRectangle=new HB.EL();returnRectangle.x=g.fB;returnRectangle.y=g.gB;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;}q IC(num g,num h){if(kB(wN).contains(g,h))return this;return null;}DB nG(DB h){sN.iG();for(q g=this;g!=null;g=g.lN)sN.concat(g.cO);return sN.OH(h);}DB kC(DB h){sN.iG();for(q g=this;g!=null;g=g.lN)sN.concat(g.cO);sN.eJ();return sN.OH(h);}void dispatchEvent(BB h){List<q> g=null;if(h.GF||h.bubbles)for(q j=lN;j!=null;j=j.lN)if(j.aJ(h.type)){if(g==null)g=new List<q>();g.add(j);}if(h.GF&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.cF==false)g[i].nO(h,this,g[i],nC.yF);if(h.cF==false)nO(h,this,this,nC.EE);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.cF==false)g[i].nO(h,this,g[i],nC.BI);}void zO(oC h){for(var g=h;g!=null;g=g.lN)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");lN=h;}void TB(iB g);}abstract class GB extends q{bool MJ=false;bool rG=true;bool DL=true;int tabIndex=0;static const xB<p> LI=const xB<p>(p.GE);static const xB<p> XI=const xB<p>(p.tE);static const xB<p> bI=const xB<p>(p.gC);static const xB<p> iI=const xB<p>(p.aD);static const xB<p> pI=const xB<p>(p.SI);YB.Stream<p> get onMouseOut=>GB.LI.forTarget(this);YB.Stream<p> get onMouseMove=>GB.XI.forTarget(this);YB.Stream<p> get onMouseDown=>GB.bI.forTarget(this);YB.Stream<p> get onMouseUp=>GB.iI.forTarget(this);YB.Stream<p> get onMouseWheel=>GB.pI.forTarget(this);static const xB<OB> qI=const xB<OB>(OB.LG);static const xB<OB> sI=const xB<OB>(OB.EG);static const xB<OB> tI=const xB<OB>(OB.GG);YB.Stream<OB> get onTouchMove=>GB.qI.forTarget(this);YB.Stream<OB> get onTouchEnd=>GB.sI.forTarget(this);YB.Stream<OB> get onTouchCancel=>GB.tI.forTarget(this);static const xB<FC> uI=const xB<FC>(FC.DG);static const xB<FC> vI=const xB<FC>(FC.pE);YB.Stream<FC> get onKeyUp=>GB.uI.forTarget(this);YB.Stream<FC> get onKeyDown=>GB.vI.forTarget(this);}abstract class oC extends GB{final List<q> WM=new List<q>();bool pM=true;bool yM=true;void v(q g){if(g.parent==this){int h=WM.indexOf(g);WM.removeAt(h);WM.add(g);}else{wI(g,WM.length);}}void wI(q g,int h){if(h<0&&h>WM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){WM.removeAt(WM.indexOf(g));if(h>WM.length)h-- ;WM.insertRange(h,1,g);}else{g.JK();g.zO(this);WM.insertRange(h,1,g);g.dispatchEvent(new BB(BB.sH,true));if(this.WE!=null)AP(g,new BB(BB.CG));}}void qB(q h){int g=WM.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");IK(g);}void IK(int g){if(g<0&&g>=WM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");q h=WM[g];h.dispatchEvent(new BB(BB.II,true));if(this.WE!=null)AP(h,new BB(BB.MI));h.zO(null);WM.removeAt(g);}dynamic fG(int g){if(g<0&&g>=WM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");return WM[g];}int ID(q g){return WM.indexOf(g);}void KH(q j,q i){int h=ID(j);int g=ID(i);if(h==-1||g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");VK(h,g);}void VK(int h,int g){q j=fG(h);q i=fG(g);WM[h]=i;WM[g]=j;}bool contains(q g){for(;g!=null;g=g.lN)if(g==this)return true;return false;}HB kB(FB s,[HB returnRectangle]){if(returnRectangle==null)returnRectangle=new HB.EL();if(WM.length==0)return super.kB(s,returnRectangle);num h=double.INFINITY;num i=double.INFINITY;num k=double.NEGATIVE_INFINITY;num j=double.NEGATIVE_INFINITY;int AB=WM.length;for(int l=0;l<WM.length;l++ ){q n=WM[l];sN.KF(n.cO,s);HB g=n.kB(sN,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>k)k=g.right;if(g.bottom>j)j=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=k-h;returnRectangle.height=j-i;return returnRectangle;}q IC(num AB,num EB){q l=null;for(int j=WM.length-1;j>=0;j-- ){q i=WM[j];if(i.visible){FB g=i.cO;double n=AB-g.fB;double k=EB-g.gB;double JB=(g.d*n-g.c*k)/g.jC;double s=(g.a*k-g.b*n)/g.jC;var h=i.IC(JB,s);if(h!=null){if(h is GB)if(h.rG)return pM?h:this;l=this;}}}return l;}void TB(iB i){for(int g=0;g<WM.length;g++ ){q h=WM[g];if(h.visible)i.DH(h);}}void AP(q g,BB j){g.dispatchEvent(j);if(g is oC){List<q> i=new List<q>.from(g.WM);for(int h=0;h<i.length;h++ )AP(i[h],j);}}}class rF{GB target=null;bool UC=false;int HF=0;int dD=0;String qG,sG;String oG,pG;rF(this.qG,this.sG,this.oG,this.pG);}class yD extends TC{gE JM;xC.AudioElement xL;bool uL;dB MM;yD(gE g,bool i,dB h){JM=g;uL=i;MM=h;xL=g.jN(this);xL.loop=uL;this.VE=h;xL.play();}void set VE(dB g){MM=g;if(xL!=null)xL.volume=(MM!=null)?MM.volume:1;}void stop(){if(xL!=null){if(xL.ended==false)xL.pause();JM.tO(this);xL=null;}}}class fH{static const String pH="dynamic";}class BD extends oC{bool pK=false;bool fF=false;}class hB extends q{jB nB;String CK;HB IF;hB([this.nB=null,this.CK="auto"]){IF=null;}HB kB(FB h,[HB returnRectangle]){int g=(nB!=null)?nB.width:0;int i=(nB!=null)?nB.height:0;return zE(h,g,i,returnRectangle);}q IC(num g,num h){if(nB!=null&&g>=0.0&&h>=0.0&&g<nB.width&&h<nB.height)return this;return null;}void TB(iB g){if(nB!=null){if(IF==null)nB.TB(g);else nB.LK(g,IF);}}}class gE extends cB{xC.AudioElement xL;List<xC.AudioElement> RM;List<yD> lM;gE(){lM=new List<yD>();xL=new xC.AudioElement();xL.onEnded.listen(VN);RM=new List<xC.AudioElement>();RM.add(xL);xC.document.body.children.add(xL);}static YB.Future<cB> TG(String AB){var k=new gE();var g=k.xL;var i=new YB.Completer<cB>();YB.StreamSubscription h;YB.StreamSubscription j;s(n){h.cancel();j.cancel();i.complete(k);}l(n){h.cancel();j.cancel();i.completeError(new StateError("Failed to load audio."));}h=g.onCanPlayThrough.listen(s);j=g.onError.listen(l);g.src=cB.RG(AB);g.load();return i.future;}num get length{return xL.duration;}TC play([bool loop=false,dB soundTransform]){if(soundTransform==null)soundTransform=new dB();return new yD(this,loop,soundTransform);}xC.AudioElement jN(yD h){xC.AudioElement g;if(RM.length==0){g=xL.clone(true);g.onEnded.listen(VN);}else{g=RM.removeAt(0);}lM.add(h);return g;}void tO(yD g){xC.AudioElement h=g.xL;int i=lM.indexOf(g);lM.removeAt(i);RM.add(h);if(xL.currentTime>0&&xL.ended==false)xL.currentTime=0;}void VN(j){xC.AudioElement i=j.target;yD g=null;for(int h=0;h<lM.length&&g==null;h++ )if(lM[h].xL==i)g=lM[h];if(g!=null)g.stop();}}abstract class jE{void TB(iB g);}class qF{static const String zH="none";static const String DI="touchPoint";}class lB{static const String DE="center";static const String xH="end";static const String CI="justify";static const String JG="left";static const String FE="right";}class UD{static String QI=gI();static PH.AudioContext HE=lI();static List<String> OG=mI();static String gI(){var h=(HE!=null)?"WebAudioApi":"AudioElement";var g=xC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(OG.length==0)h="Mock";print("dartflash: supported audio engine is: ${h}");return h;}static PH.AudioContext lI(){try {return new PH.AudioContext();}catch (g){return null;}}static List<String> mI(){var g=new List<String>();var h=new xC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("dartflash: supported audio types are: ${g}");return g;}}class AE extends GB{q eF;q AH;q bG;q OE;bool fF=true;bool enabled=true;q PN;AE([this.eF,this.AH,this.bG,this.OE]){t(p.MG,gN);t(p.GE,gN);t(p.gC,gN);t(p.aD,gN);PN=this.eF;}HB kB(FB g,[HB returnRectangle]){if(PN!=null){sN.KF(PN.cO,g);return PN.kB(sN,returnRectangle);}return super.kB(g,returnRectangle);}q IC(num k,num l){if(this.OE!=null){FB g=this.OE.cO;double h=k-g.fB;double i=l-g.gB;double n=(g.d*h-g.c*i)/g.jC;double j=(g.a*i-g.b*h)/g.jC;if(this.OE.IC(n,j)!=null)return this;}return null;}void TB(iB g){if(PN!=null)g.DH(PN);}void gN(p g){if(g.type==p.GE){PN=eF;}else{PN=g.UC?bG:AH;}}}class uF{final List<kH> pL=new List<kH>();clear()=>pL.clear();beginPath()=>pL.add(new kH("beginPath"));closePath()=>pL.add(new kH("closePath"));moveTo(num h,num g)=>pL.add(new kH("moveTo",[h,g]));lineTo(num h,num g)=>pL.add(new kH("lineTo",[h,g]));arcTo(num k,num i,num g,num h,num j)=>pL.add(new kH("arcTo",[k,i,g,h,j]));quadraticCurveTo(num j,num i,num g,num h)=>pL.add(new kH("quadraticCurveTo",[j,i,g,h]));bezierCurveTo(num h,num k,num l,num i,num g,num j)=>pL.add(new kH("bezierCurveTo",[h,k,l,i,g,j]));arc(num l,num g,num j,num i,num h,bool k)=>pL.add(new kH("arc",[l,g,j,i,h,k]));rect(num i,num g,num h,num j)=>pL.add(new kH("rect",[i,g,h,j]));JH(int g,[int width=1,String joints=jH.tH,String caps=iH.tH])=>pL.add(new kH("strokeColor",[wE(g),width,joints,caps]));OJ(int g)=>pL.add(new kH("fillColor",[wE(g)]));WG(num i,num g,num h){pL.add(new kH("moveTo",[i+h,g]));pL.add(new kH("arc",[i,g,h,0,ZB.PI*2,false]));}void TB(iB k){var h=k.context;h.save();for(var j in pL){List g=j.arguments;switch (j.name){case "beginPath":h.beginPath();break;case "closePath":h.closePath();break;case "moveTo":h.moveTo(g[0],g[1]);break;case "lineTo":h.lineTo(g[0],g[1]);break;case "arcTo":h.arcTo(g[0],g[1],g[2],g[3],g[4]);break;case "quadraticCurveTo":h.quadraticCurveTo(g[0],g[1],g[2],g[3]);break;case "bezierCurveTo":h.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5]);break;case "arc":h.arc(g[0],g[1],g[2],g[3],g[4],g[5]);break;case "rect":h.rect(g[0],g[1],g[2],g[3]);break;case "strokeColor":h.strokeStyle=g[0];h.lineWidth=g[1];h.lineJoin=g[2];h.lineCap=g[3];h.stroke();break;case "strokeGradient":h.strokeStyle=g[0].IP(h);h.lineWidth=g[1];h.lineJoin=g[2];h.lineCap=g[3];h.stroke();break;case "strokePattern":h.strokeStyle=g[0].JP(h);h.lineWidth=g[1];h.lineJoin=g[2];h.lineCap=g[3];FB i=g[0].KP;if(i!=null){h.save();h.transform(i.a,i.b,i.c,i.d,i.fB,i.gB);h.stroke();h.restore();}else{h.stroke();}break;case "fillColor":h.fillStyle=g[0];h.fill();break;case "fillGradient":h.fillStyle=g[0].uK(h);h.fill();break;case "fillPattern":h.fillStyle=g[0].vK(h);FB i=g[0].KP;if(i!=null){h.save();h.transform(i.a,i.b,i.c,i.d,i.fB,i.gB);h.fill();h.restore();}else{h.fill();}break;}}h.restore();}}class dB{num volume;num AK;num yK=1;num zK=0;num CL=1;num BL=0;dB([this.volume=1,this.AK=0]);}class wF extends cB{wF(){}static YB.Future<cB> TG(String g){return new YB.Future<cB>.of(()=>new wF());}num get length{return double.NAN;}TC play([bool loop=false,dB soundTransform]){if(soundTransform==null){soundTransform=new dB();}return new kK(this,loop,soundTransform);}}class kH{String name;List arguments;kH(this.name,[this.arguments]);}class sF{String font;int size;int color;bool zB;bool lG;bool YK;String align;int gJ;int MK;int cJ;int QF;int letterSpacing=0;int nK=0;bool oK=false;bool xK=false;sF(this.font,this.size,this.color,{this.zB: false,this.lG: false,this.YK: false,this.align: "left",this.gJ: 0,this.MK: 0,this.cJ: 0,this.QF: 0});}class jH{static const String tH="round";}class zD{int bL;HB kL;eH AM;List<DB> PM;zD.FL(num i,num g,num h,num j){bL=0;kL=new HB(i,g,h,j);}void TB(iB i){var g=i.context;g.beginPath();switch (bL){case 0:g.rect(kL.x,kL.y,kL.width,kL.height);break;case 1:g.arc(AM.x,AM.y,AM.BH,0,ZB.PI*2.0,false);break;case 2:g.moveTo(PM[0].x,PM[0].y);for(int h=1;h<PM.length;h++ )g.lineTo(PM[h].x,PM[h].y);break;}g.clip();}}class iH{static const String tH="round";}class fC{xC.ImageElement iL;List<pF> LM;fC(){iL=new xC.ImageElement();LM=new List<pF>();}static YB.Future<fC> TG(String n,String XB){YB.Completer<fC> l=new YB.Completer<fC>();fC j=new fC();switch (XB){case nE.qH:case nE.BG:void s(String k,Map g){var JB=fI(k);var h=new pF(JB,j);h.NM=g["frame"]["x"].toInt();h.XM=g["frame"]["y"].toInt();h.cM=g["frame"]["w"].toInt();h.jM=g["frame"]["h"].toInt();h.sM=g["spriteSourceSize"]["x"].toInt();h.xM=g["spriteSourceSize"]["y"].toInt();h.AN=g["sourceSize"]["w"].toInt();h.KN=g["sourceSize"]["h"].toInt();h.QN=g["rotated"] as bool;j.LM.add(h);}xC.HttpRequest.getString(n).then((NB){var AB=cK.parse(NB);var i=AB["frames"];var EB=AB["meta"];if(i is List)for(var g in i)s(g["filename"],g);if(i is Map)for(String k in i.keys)s(k,i[k]);j.iL..onLoad.listen((bB)=>l.complete(j))..onError.listen((bB)=>l.completeError(new StateError("Failed to load image.")))..src=jI(n,EB["image"]);}).catchError((sB){l.completeError(new StateError("Failed to load json file."));});break;}return l.future;}xC.ImageElement get bJ=>iL;jB CB(String i){jB h;for(int g=0;g<LM.length&&h==null;g++ )if(LM[g].name==i)h=new jB.JL(LM[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}}class hH extends GB{num width;num height;hH(this.width,this.height);HB kB(FB g,[HB returnRectangle]){return zE(g,width,height,returnRectangle);}q IC(num g,num h){if(g>=0.0&&h>=0.0&&g<width&&h<height)return this;return null;}void TB(iB g){}}abstract class TC extends SC{void set VE(dB g);void stop();}class gH{static const String zH="none";}class lE implements pC{final Function BM;num KM=0.0;num YM=0.0;int iM=1;lE(Function g,num h):BM=g{YM=ZB.max(h,0.0001);}bool DD(num h){num g=KM+h;while (g>=YM&&iM>0){KM=YM;iM-- ;BM();g-= YM;}KM=g;return (iM>0);}num get currentTime=>KM;}class eC extends GB{String rL="";int GM=0x000000;sF bM=null;String rM=gH.zH;String GN=lH.vH;String bL=fH.pH;bool UN=false;bool WN=false;int ZN=0x000000;bool eN=false;int iN=0x000000;num mN=0;num oN=0;List<String> qN;List<iE> vN;bool yN=true;num zN=100;num AO=100;xC.CanvasElement CO=null;xC.CanvasRenderingContext2D wL=null;eC(){bM=new sF("Arial",12,0x000000);qN=new List<String>();vN=new List<iE>();}String get type=>bL;num get width=>zN;num get height=>AO;void set text(String g){rL=g;yN=true;}void set wC(int g){GM=g;yN=true;}void set WC(sF g){bM=g;GM=bM.color;yN=true;}void set wordWrap(bool g){UN=g;yN=true;}void set width(num g){zN=g;yN=true;}void set height(num g){AO=g;yN=true;}num get WK{EP();return mN;}HB kB(FB g,[HB returnRectangle]){return zE(g,zN,AO,returnRectangle);}q IC(num g,num h){if(g>=0&&h>=0&&g<zN&&h<AO)return this;return null;}void TB(iB g){EP();g.wL.drawImage(CO,0.0,0.0);}void GP(){qN.clear();vN.clear();if(UN==false){qN.add(rL);}else{StringBuffer g=new StringBuffer();int i;String h;for(String s in rL.replaceAll('\r','').split('\n')){for(String j in s.split(' ')){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(wL.measureText(h).width>zN){if(i>0)h=h.substring(0,i);else j="";qN.add(h);g.clear();g.add(j);}}if(g.isEmpty==false){qN.add(g.toString());g.clear();}}}mN=0;oN=0;for(String h in qN){var l=wL.measureText(h);var n=0;if(bM.align==lB.DE||bM.align==lB.CI)n=(zN-l.width)/2;if(bM.align==lB.FE||bM.align==lB.xH)n=zN-l.width;iE k=new iE(n,l.width,bM.size,0,0,0);vN.add(k);mN=ZB.max(mN,k.width);oN=oN+k.height;}}void EP(){if(yN){yN=false;int j=zN.ceil().toInt();int i=AO.ceil().toInt();if(CO==null){CO=new xC.CanvasElement(width:j,height:i);wL=CO.context2d;}if(CO.width!=j)CO.width=j;if(CO.height!=i)CO.height=i;StringBuffer g=new StringBuffer();g.add(bM.lG?"italic ":"normal ");g.add("normal ");g.add(bM.zB?"bold ":"normal ");g.add("${bM.size}px ");g.add("${bM.font},sans-serif");wL.font=g.toString();wL.textAlign="start";wL.textBaseline="top";wL.fillStyle=ZD(GM);GP();if(WN){wL.fillStyle=ZD(ZN);wL.fillRect(0,0,zN,AO);}else{wL.clearRect(0,0,zN,AO);}int k=0;for(int h=0;h<qN.length;h++ ){iE l=vN[h];wL.fillStyle=ZD(GM);wL.fillText(qN[h],l.x,k);k+= l.height;}if(eN){wL.strokeStyle=ZD(iN);wL.lineWidth=1;wL.strokeRect(0,0,zN,AO);}}}}abstract class cB{static YB.Future<cB> TG(String g){var h=UD.QI;if(h=="WebAudioApi")return mE.TG(g);if(h=="AudioElement")return gE.TG(g);return wF.TG(g);}num get length;TC play([bool loop=false,dB soundTransform]);static String RG(String g){var n=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,caseSensitive:false);var i=n.firstMatch(g);var h=UD.OG;if(i==null)throw new ArgumentError("Unsupported file extension.");if(h.length==0)throw new UnsupportedError("This browser supports no known audio codec.");var j=i.group(1).toLowerCase();if(h.indexOf(j)==-1){var l=g.substring(0,g.length-j.length);var k=h[0];g="${l}${k}";}return g;}}class lH{static const String vH="pixel";}class CE{String lL;String hL;String IM;YB.Future UM;dynamic dM;dynamic kM;CE(String g,String h,String i){lL=g;hL=h;IM=i;dM=null;kM=null;}String get kind=>lL;String get name=>hL;dynamic get mD=>kM;dynamic get error=>dM;DO(YB.Future i){UM=i.then((g){kM=g;dM=null;},onError:(YB.AsyncError h){kM=null;dM=h.error;});}}class kK extends TC{bool uL;dB MM;kK(wF i,bool h,dB g){uL=h;MM=g;}set VE(dB g){MM=g;}void stop(){}}class jB implements jE{int yL;int FM;bool TM;xC.Element fM;xC.CanvasRenderingContext2D wL;int zM;double HN;double NN;double NM;double XM;double cM;double jM;jB(int g,int h,[bool transparent=true,int fillColor=0xFFFFFFFF]){yL=g;FM=h;TM=transparent;var i=new xC.CanvasElement(width:yL,height:FM);wL=i.context2d;wL.fillStyle=TM?wE(fillColor):ZD(fillColor);wL.fillRect(0,0,g,h);fM=i;zM=0;}jB.IL(xC.ImageElement g){yL=g.naturalWidth;FM=g.naturalHeight;TM=true;fM=g;zM=0;}jB.JL(pF g){yL=g.zJ;FM=g.yJ;TM=true;fM=g.XK.bJ;zM=g.NK?2:1;HN=g.offsetX.toDouble();NN=g.offsetY.toDouble();NM=g.SJ.toDouble();XM=g.TJ.toDouble();cM=g.RJ.toDouble();jM=g.QJ.toDouble();}static YB.Future<jB> TG(String i){YB.Completer<jB> h=new YB.Completer<jB>();var g=new xC.ImageElement();g.onLoad.listen((j)=>h.complete(new jB.IL(g)));g.onError.listen((j)=>h.completeError(new StateError("Error loading image.")));g.src=i;return h.future;}int get width=>yL;int get height=>FM;jB clone(){jB g=new jB(yL,FM,true,0);g.NJ(this);return g;}void NJ(jE h,[FB matrix=null]){var g=HP();var i=new iB.HL(g,matrix);h.TB(i);g.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);}int YJ(int j,int h){var i=HP();var k=i.getImageData(j,h,1,1);var g=k.data;if(rI){return (g[0]<<16)+(g[1]<<8)+(g[2]<<0)+(g[3]<<24);}else{return (g[3]<<16)+(g[2]<<8)+(g[1]<<0)+(g[0]<<24);}}void TB(iB g){switch (zM){case 0:g.context.drawImage(fM,0.0,0.0);break;case 1:g.context.drawImage(fM,NM,XM,cM,jM,HN,NN,cM,jM);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,HN,NN+jM);g.context.drawImage(fM,NM,XM,jM,cM,0.0,0.0,jM,cM);break;}}void LK(iB bB,HB g){if(g.width<=0.0||g.height<=0.0)return;switch (zM){case 0:bB.context.drawImage(fM,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=NM;double h=XM;double EB=j+cM;double JB=h+jM;double l=NM-HN+g.x;double n=XM-NN+g.y;double XB=l+g.width;double NB=n+g.height;double AB=(j>l)?j:l;double s=(h>n)?h:n;double sB=(EB<XB)?EB:XB;double gF=(JB<NB)?JB:NB;double hF=HN-j+AB;double mC=NN-h+s;double k=sB-AB;double i=gF-s;if(k>0.0&&i>0.0){bB.context.drawImage(fM,AB,s,k,i,hF,mC,k,i);}break;case 2:double j=NM;double h=XM;double EB=j+jM;double JB=h+cM;double l=NM+NN-g.y+jM-g.height;double n=XM-HN+g.x;double XB=l+g.height;double NB=n+g.width;double AB=(j>l)?j:l;double s=(h>n)?h:n;double sB=(EB<XB)?EB:XB;double gF=(JB<NB)?JB:NB;double hF=HN-h+s;double mC=NN+EB-sB;double k=gF-s;double i=sB-AB;if(k>0.0&&i>0.0){bB.context.transform(0.0,-1.0,1.0,0.0,hF,mC+i);bB.context.drawImage(fM,AB,s,i,k,0.0,0.0,i,k);}break;}}xC.CanvasRenderingContext2D HP(){if(wL==null){var g=new xC.CanvasElement(width:yL,height:FM);wL=g.context2d;switch (zM){case 0:wL.drawImage(fM,0,0);break;case 1:wL.drawImage(fM,NM,XM,cM,jM,HN,NN,cM,jM);break;case 2:wL.setTransform(0.0,-1.0,1.0,0.0,HN,NN+jM);wL.drawImage(fM,NM,XM,jM,cM,0.0,0.0,jM,cM);wL.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);break;}fM=g;zM=0;}return wL;}}typedef void nH<YD extends BB>(YD event);class rH<YD extends BB> extends YB.StreamSubscription<YD>{WD uM;nH<YD> DN;int IN;bool ON;rH(this.uM,this.DN){IN=0;ON=false;}void cancel(){if(ON==false){uM.xN(this);ON=true;DN=null;}}void onError(void g(YB.AsyncError error)){}bool get fO=>IN>0;void pause([YB.Future resumeSignal]){IN++ ;if(resumeSignal!=null)resumeSignal.whenComplete(resume);}void resume(){if(fO==false)throw new StateError("Subscription is not paused.");IN-- ;}}class AG{Map<String,CE> hM;AG(){hM=new Map<String,CE>();}void bN(CE g){var j=g.kind;var h=g.name;var i="${j}.${h}";if(hM.containsKey(i))throw new StateError("ResourceManager already contains a resource called '${h}'");hM[i]=g;}dynamic EO(String i,String g){var h="${i}.${g}";if(hM.containsKey(h)==false)throw new StateError("ResourceManager does not contains a resource called '${g}'");return hM[h];}void yB(String i,String h){var g=new CE("BitmapData",i,h);g.DO(jB.TG(h));bN(g);}void BF(String i,String h){var g=new CE("Sound",i,h);g.DO(cB.TG(h));bN(g);}void yI(String j,String h,String i){var g=new CE("TextureAtlas",j,h);g.DO(fC.TG(h,i));bN(g);}void SB(String i,String h){var g=new CE("Text",i,"");g.DO(new YB.Future.immediate(h));bN(g);}YB.Future<AG> load(){var h=this.BK.map((i)=>i.UM);return YB.Future.wait(h).then((j){var g=this.cG;if(g.length>0)throw new StateError("Failed to load ${g.length} resource(s).");return this;});}List<CE> get BK{return hM.values.where((g)=>g.mD==null).toList();}List<CE> get cG{return hM.values.where((g)=>g.error!=null).toList();}jB CB(String g){return EO("BitmapData",g).mD;}cB OF(String g){return EO("Sound",g).mD;}fC LB(String g){return EO("TextureAtlas",g).mD;}String ZJ(String g){return EO("Text",g).mD;}}String ZD(int g){int h=(g>>16)&0xFF;int i=(g>>8)&0xFF;int j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class HG{static bool KG=false;static bool uE=false;static int vE=0;static String UI=qF.zH;static YB.StreamController<String> VI=new YB.StreamController<String>();static YB.Stream<String> aI=VI.stream.asBroadcastStream();static cI(){if(KG==false){KG=true;var g=xC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){uE=true;vE=10;}if(g.contains("Android")){uE=true;vE=10;}if(g.contains("IEMobile")){uE=true;vE=10;}}}static String get oI{cI();return UI;}}class RI{static int TI=0;int XE=TI++ ;GB target=null;bool TE=false;RI(this.target,this.TE);}String wE(int g){int h=(g>>24)&0xFF;int i=(g>>16)&0xFF;int j=(g>>8)&0xFF;int k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class xE{static num yE(num g){return g;}}class eI implements pC{final q FO;final Function IO;final List<dH> LO=new List<dH>();Function OO;Function PO;Function SO;num YM;num KM;num bO;bool dO;bool gO;eI(q g,num h,[num transitionFunction(num ratio)]):FO=g,IO=(transitionFunction!=null)?transitionFunction:xE.yE{KM=0.0;YM=ZB.max(0.0001,h);bO=0.0;dO=false;gO=false;}void JE(String g,num h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(FO!=null&&gO==false)LO.add(new dH(g,0.0,h));}void moveTo(num h,num g){JE('x',h);JE('y',g);}bool DD(num l){if(KM<YM||gO==false){KM=KM+l;if(KM>YM)KM=YM;if(KM>=0.0){if(gO==false){gO=true;for(int i=0;i<LO.length;i++ ){var g=LO[i];switch (g.name){case 'x':g.DC=FO.x;break;case 'y':g.DC=FO.y;break;case 'pivotX':g.DC=FO.tC;break;case 'pivotY':g.DC=FO.uC;break;case 'scaleX':g.DC=FO.YC;break;case 'scaleY':g.DC=FO.ZC;break;case 'rotation':g.DC=FO.OC;break;case 'alpha':g.DC=FO.alpha;break;}}if(OO!=null)OO();}num j=KM/YM;num k=IO(j);for(int i=0;i<LO.length;i++ ){var g=LO[i];var h=g.DC+k*(g.MH-g.DC);h=dO?h.round():h;switch (g.name){case 'x':FO.x=h;break;case 'y':FO.y=h;break;case 'pivotX':FO.tC=h;break;case 'pivotY':FO.uC=h;break;case 'scaleX':FO.YC=h;break;case 'scaleY':FO.ZC=h;break;case 'rotation':FO.OC=h;break;case 'alpha':FO.alpha=h;break;}}if(PO!=null)PO();if(SO!=null&&KM==YM)SO();}}return KM<YM;}num get currentTime=>KM;}String fI(String g){RegExp h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);Match i=h.firstMatch(g);return i.group(1);}class bD extends oC{xC.CanvasElement CO;xC.CanvasRenderingContext2D wL;GB QO;iB TO;String XO;String aO;DB eO;GB jO;List<rF> lO;Map<int,RI> oO;p pO;FC qO;OB rO;bD(String h,xC.CanvasElement g){hL=h;CO=g;CO.focus();wL=g.context2d;TO=new iB.HL(wL);XO=XD.oE;aO=mB.qE;kE.JI.listen(JI);lO=[new rF(p.gC,p.aD,p.qC,p.AI),new rF(p.WI,p.ZI,p.PG,p.PG),new rF(p.dI,p.hI,p.QG,p.QG)];jO=null;eO=new DB(0,0);pO=new p(p.qC,true);CO.onMouseDown.listen(gN);CO.onMouseUp.listen(gN);CO.onMouseMove.listen(gN);CO.onMouseOut.listen(gN);CO.onMouseWheel.listen(gN);oO=new Map<int,RI>();rO=new OB(OB.zF,true);HG.aI.listen(BP);BP(null);qO=new FC(FC.pE,true);CO.onKeyDown.listen(CP);CO.onKeyUp.listen(CP);CO.onKeyPress.listen(DP);}GB get focus=>QO;void FP(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");}void set x(num g){FP();}void set y(num g){FP();}void set tC(num g){FP();}void set uC(num g){FP();}void set YC(num g){FP();}void set ZC(num g){FP();}void set OC(num g){FP();}void set alpha(num g){FP();}void set width(num g){FP();}void set height(num g){FP();}void hJ(){if(XO==XD.oE||XO==XD.FG){TO.reset();TB(TO);if(XO==XD.FG)XO=XD.wH;}}void JI(String g){CO.style.cursor=kE.SG(aO);}void gN(xC.MouseEvent j){j.preventDefault();var JB=CO.getBoundingClientRect();var s=new DateTime.now().millisecondsSinceEpoch;var EB=j.button;GB h=null;DB i=new DB(j.clientX-JB.left,j.clientY-JB.top);DB n=null;if(EB<0||EB>2)return;if(j.type=="mousemove"&&eO.equals(i))return;rF g=lO[EB];eO=i;if(j.type!="mouseout")h=IC(i.x,i.y) as GB;var l=mB.qE;if(h is BD)if(h.fF)l=mB.rE;if(h is AE)if(h.fF)l=mB.rE;if(aO!=l){aO=l;CO.style.cursor=kE.SG(l);}if(jO!=null&&jO!=h){jO.dispatchEvent(pO..BO(p.GE,true)..xO=(jO.WE!=null)?jO.kC(i):new DB.EL()..yO=i..sO=g.UC);jO=null;}if(h!=null&&h!=jO){h.dispatchEvent(pO..BO(p.MG,true)..xO=h.kC(i)..yO=i..sO=g.UC);jO=h;}String k=null;bool AB=false;bool NB=false;if(j.type=="mousedown"){k=g.qG;if(h!=g.target||s>g.HF+500)g.dD=0;g.UC=true;g.target=h;g.HF=s;g.dD++ ;}if(j.type=="mouseup"){k=g.sG;g.UC=false;AB=(g.target==h);NB=AB&&g.dD.isEven&&(s<g.HF+500);}if(j.type=="mousemove"){k=p.tE;}if(k!=null&&h!=null){n=h.kC(i);h.dispatchEvent(pO..BO(k,true)..xO=n..yO=i..sO=g.UC..uO=g.dD);if(AB){if(NB&&h.MJ){h.dispatchEvent(pO..BO(g.pG,true)..xO=n..yO=i..sO=g.UC);}else{h.dispatchEvent(pO..BO(g.oG,true)..xO=n..yO=i..sO=g.UC);}}}}List<YB.StreamSubscription<OB>> LP=[] ;void BP(String h){LP.forEach((g)=>g.cancel());if(HG.oI==qF.DI){LP=[CO.onTouchStart.listen(MP),CO.onTouchEnd.listen(MP),CO.onTouchMove.listen(MP),CO.onTouchEnter.listen(MP),CO.onTouchLeave.listen(MP),CO.onTouchCancel.listen(MP)];}}void MP(xC.TouchEvent j){j.preventDefault();var s=CO.getBoundingClientRect();for(var n in j.changedTouches){var l=n.identifier;var i=new DB(n.clientX-s.left,n.clientY-s.top);var h=IC(i.x,i.y) as GB;var g=oO.containsKey(l)?oO[l]:new RI(h,oO.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(rO..BO(OB.OI,true)..xO=(g.target.WE!=null)?g.target.kC(i):new DB.EL()..yO=i..GO=g.XE..HO=g.TE);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(rO..BO(OB.NI,true)..xO=h.kC(i)..yO=i..GO=g.XE..HO=g.TE);g.target=h;}String k=null;if(j.type=="touchstart"){oO[l]=g;k=OB.zF;}if(j.type=="touchend"){oO.remove(l);k=OB.EG;}if(j.type=="touchcancel"){oO.remove(l);k=OB.GG;}if(j.type=="touchmove"){k=OB.LG;}if(k!=null&&h!=null){h.dispatchEvent(rO..BO(k,true)..xO=h.kC(i)..yO=i..GO=g.XE..HO=g.TE);}}}void CP(xC.KeyboardEvent g){g.preventDefault();String h=null;if(g.type=="keyup")h=FC.DG;if(g.type=="keydown")h=FC.pE;qO..BO(h,true)..aN=g.altKey..dN=g.ctrlKey..fN=g.shiftKey..pN=g.charCode..rN=g.keyCode..tN=AD.oH;if(g.keyLocation==xC.KeyLocation.LEFT)qO.tN=AD.JG;if(g.keyLocation==xC.KeyLocation.RIGHT)qO.tN=AD.FE;if(g.keyLocation==xC.KeyLocation.NUMPAD)qO.tN=AD.EI;if(g.keyLocation==xC.KeyLocation.JOYSTICK)qO.tN=AD.IG;if(g.keyLocation==xC.KeyLocation.MOBILE)qO.tN=AD.IG;if(QO!=null)QO.dispatchEvent(qO);}void DP(xC.KeyboardEvent g){int i=(g.charCode!=0)?g.charCode:g.keyCode;tF h=new tF(tF.yH,true);h.rL=new String.fromCharCodes([i]);if(QO!=null)QO.dispatchEvent(h);}}String jI(String j,String g){RegExp i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);Match k=i.firstMatch(j);String h=k.group(1);return (h==null)?g:"${h}${g}";}bool kI(){var g=new xC.CanvasElement(width:1,height:1);g.context2d.fillStyle="#000000";g.context2d.fillRect(0,0,1,1);var i=g.context2d.getImageData(0,0,1,1).data;var h=(i[0]==0);return h;}HB zE(FB g,num n,num JB,HB j){num mC=0.0;num sB=0.0;num EB=n*g.a;num bB=n*g.b;num NB=n*g.a+JB*g.c;num AB=n*g.b+JB*g.d;num XB=JB*g.c;num s=JB*g.d;num h=mC;if(h>EB)h=EB;if(h>NB)h=NB;if(h>XB)h=XB;num i=sB;if(i>bB)i=bB;if(i>AB)i=AB;if(i>s)i=s;num l=mC;if(l<EB)l=EB;if(l<NB)l=NB;if(l<XB)l=XB;num k=sB;if(k<bB)k=bB;if(k<AB)k=AB;if(k<s)k=s;if(j==null)j=new HB.EL();j.x=g.fB+h;j.y=g.gB+i;j.width=l-h;j.height=k-i;return j;}bool rI=kI();//@ sourceMappingURL=supersonic.dart.map
